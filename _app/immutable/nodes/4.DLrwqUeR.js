var U1=Object.defineProperty;var Ug=m=>{throw TypeError(m)};var $1=(m,o,f)=>o in m?U1(m,o,{enumerable:!0,configurable:!0,writable:!0,value:f}):m[o]=f;var gr=(m,o,f)=>$1(m,typeof o!="symbol"?o+"":o,f),Ef=(m,o,f)=>o.has(m)||Ug("Cannot "+f);var it=(m,o,f)=>(Ef(m,o,"read from private field"),f?f.call(m):o.get(m)),Mr=(m,o,f)=>o.has(m)?Ug("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(m):o.set(m,f),na=(m,o,f,y)=>(Ef(m,o,"write to private field"),y?y.call(m,f):o.set(m,f),f),Vr=(m,o,f)=>(Ef(m,o,"access private method"),f);import"../chunks/B2cHk4HI.js";import{o as Dn,s as oi}from"../chunks/4WsUhDWi.js";import{a3 as G1,b8 as H1,bp as W1,ba as X1,bq as Y1,b3 as K1,br as J1,au as ct,g as x,aw as ce,av as xi,at as Qn,p as Br,f as Te,d as E,r as k,s as q,u as ft,n as vn,t as Ye,ax as Ai,b as G,c as Fr,y as Wr,v as Cr,bn as Nu,x as Pm,z as ul,ay as er,a as Ct,b4 as bi,aI as Q1,aH as $g,aJ as ex,aL as Iv,bs as co,az as pa,bt as Mv,$ as tx}from"../chunks/BDALf20I.js";import{s as fe}from"../chunks/4k6DpCgf.js";import{p as Lt,i as je,r as ir,s as Ps,u as kv}from"../chunks/Bke_korE.js";import{h as rx}from"../chunks/BUhRjcOt.js";import{r as uo,f as Wi,a as zr,g as Av,b as ar,s as xr,e as kc,h as Ou,c as Ko}from"../chunks/BNZUboE0.js";import{a as sl,k as ju,t as ki}from"../chunks/BCONGQnO.js";import{g as Im,b as nx}from"../chunks/B4HM4TqG.js";import{p as vi}from"../chunks/C-Y7nmnD.js";import{S as Hi,a as en,t as Nr,u as kt,v as So,g as ai,w as ix,x as ax,P as ox,y as sx,z as lx,j as cx,A as ux,C as Gg,B as zf,D as hx,E as dx,d as px,F as fx}from"../chunks/DffDvEhl.js";import{c as Ev,A as aa,a as Gf,g as Lf,p as mx,b as _x}from"../chunks/BvbG2Lay.js";import{h as Mm}from"../chunks/DV6L2nvf.js";import{b as Po}from"../chunks/BrZ10JY-.js";import{L as gx}from"../chunks/CAQlJ3np.js";import{g as Ve,l as vx}from"../chunks/DklPLC_x.js";import{c as up}from"../chunks/CDZgL_Bh.js";import{d as yx,L as km,p as Am}from"../chunks/sZ1mzRzK.js";import{c as Hf,D as zv,p as xx,r as bx,t as wx,b as Tx,R as Cx}from"../chunks/fZ59cmjx.js";import{e as hi,i as hp}from"../chunks/CZW2bcQi.js";import{c as Em,b as zm,a as Sx}from"../chunks/DS58drb5.js";import{P as lo,t as Lv}from"../chunks/DCxPsWiR.js";import{l as Px,p as Lm,m as Dv,v as Ix,s as Mx}from"../chunks/DhR_xAc4.js";import{g as Oi,a as dp,c as kx,b as Ax}from"../chunks/ClOhzjRc.js";import{f as ll,t as Ex}from"../chunks/DS5O-Inb.js";import{A as zx}from"../chunks/CVCd3urP.js";import{A as Rv,d as cl,f as Bv,D as Fv,a as pp,r as Lx,I as Hg,e as Dx,c as Rx,P as Ov,b as Bx}from"../chunks/C2Ms0SfR.js";import{f as ia,s as Gd}from"../chunks/DnhglgUZ.js";import{C as Dm,G as Wg,c as Fx,T as Wf}from"../chunks/ZzI7cLBE.js";import"../chunks/cUtKXcx3.js";import{i as Nv}from"../chunks/BuTItAOu.js";import{L as jv}from"../chunks/CYItkO2S.js";import{c as yi}from"../chunks/ChY_8ULT.js";import{L as Ox,T as Vv,a as Nx}from"../chunks/BHr_eBwR.js";import{_ as jx}from"../chunks/x1RL6Wqy.js";import{c as Vx}from"../chunks/EXYzlOI1.js";import{R as qx}from"../chunks/rLj4C5Bn.js";import{W as Zx}from"../chunks/BtAj0icR.js";import{r as Ux}from"../chunks/Drv8f_fG.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};m.SENTRY_RELEASE={id:"35111e7039e8c68cc677344b7f7c6971567f6820"}}catch{}})();try{(function(){var m=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new m.Error().stack;o&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[o]="6fef6fdc-a71e-45b5-84b2-c8bbb8d8e209",m._sentryDebugIdIdentifier="sentry-dbid-6fef6fdc-a71e-45b5-84b2-c8bbb8d8e209")})()}catch{}const $x=[];function Gx(m,o=!1,f=!1){return Hd(m,new Map,"",$x,null,f)}function Hd(m,o,f,y,M=null,z=!1){if(typeof m=="object"&&m!==null){var T=o.get(m);if(T!==void 0)return T;if(m instanceof Map)return new Map(m);if(m instanceof Set)return new Set(m);if(G1(m)){var s=Array(m.length);o.set(m,s),M!==null&&o.set(M,s);for(var B=0;B<m.length;B+=1){var N=m[B];B in m&&(s[B]=Hd(N,o,f,y,null,z))}return s}if(H1(m)===W1){s={},o.set(m,s),M!==null&&o.set(M,s);for(var Y in m)s[Y]=Hd(m[Y],o,f,y,null,z);return s}if(m instanceof Date)return structuredClone(m);if(typeof m.toJSON=="function"&&!z)return Hd(m.toJSON(),o,f,y,m)}if(m instanceof EventTarget)return m;try{return structuredClone(m)}catch{return m}}function Hx(){return Symbol(X1)}function fp(m,o){Y1(window,["resize"],()=>K1(()=>o(window[m])))}const Wx=J1,Xx=()=>"Log in",Yx=()=>"Entrar",Kx=(m={},o={})=>(o.locale??Ve())==="en"?Xx():Yx(),Jx=()=>"Store",Qx=()=>"Loja",qv=(m={},o={})=>(o.locale??Ve())==="en"?Jx():Qx(),eb=()=>"Alliance",tb=()=>"AlianÃ§a",mp=(m={},o={})=>(o.locale??Ve())==="en"?eb():tb(),rb=()=>"Leaderboard",nb=()=>"Ranking",Rm=(m={},o={})=>(o.locale??Ve())==="en"?rb():nb(),ib=()=>"Unlock",ab=()=>"Destravar",ob=(m={},o={})=>(o.locale??Ve())==="en"?ib():ab(),sb=()=>"Lock",lb=()=>"Travar",cb=(m={},o={})=>(o.locale??Ve())==="en"?sb():lb(),ub=()=>"Info",hb=()=>"InformaÃ§Ãµes",db=(m={},o={})=>(o.locale??Ve())==="en"?ub():hb(),pb=()=>"Zoom in",fb=()=>"Aumentar zoom",mb=(m={},o={})=>(o.locale??Ve())==="en"?pb():fb(),_b=()=>"Zoom out",gb=()=>"Diminuir zoom",vb=(m={},o={})=>(o.locale??Ve())==="en"?_b():gb(),yb=()=>"Previous location",xb=()=>"LocalizaÃ§Ã£o anterior",bb=(m={},o={})=>(o.locale??Ve())==="en"?yb():xb(),wb=()=>"Offline",Tb=()=>"Offline",Cb=(m={},o={})=>(o.locale??Ve())==="en"?wb():Tb(),Sb=()=>"Zoom in to see the pixels",Pb=()=>"Amplie para ver os pixels",Ib=(m={},o={})=>(o.locale??Ve())==="en"?Sb():Pb(),Mb=()=>"Phone verification required",kb=()=>"VerificaÃ§Ã£o de telefone necessÃ¡ria",Xg=(m={},o={})=>(o.locale??Ve())==="en"?Mb():kb(),Ab=()=>"My location",Eb=()=>"Minha localizaÃ§Ã£o",zb=(m={},o={})=>(o.locale??Ve())==="en"?Ab():Eb(),Lb=()=>"You don't have charges to paint. Wait to recharge.",Db=()=>"VocÃª nÃ£o possui tinta para pintar. Aguarde para carrega-las.",Rb=(m={},o={})=>(o.locale??Ve())==="en"?Lb():Db(),Bb=()=>"Map powered by:",Fb=()=>"Mapa fornecido por:",Ob=(m={},o={})=>(o.locale??Ve())==="en"?Bb():Fb(),Nb=()=>"OpenMapTiles Data from",jb=()=>"OpenMapTiles com dados do",Vb=(m={},o={})=>(o.locale??Ve())==="en"?Nb():jb(),qb=()=>"Feedback and bugs",Zb=()=>"Feedback e bugs",Ub=(m={},o={})=>(o.locale??Ve())==="en"?qb():Zb(),$b=()=>"Overview",Gb=()=>"VisÃ£o Geral",Hb=(m={},o={})=>(o.locale??Ve())==="en"?$b():Gb(),Wb=()=>"How to paint faster",Xb=()=>"Como pintar mais rÃ¡pido",Yb=(m={},o={})=>(o.locale??Ve())==="en"?Wb():Xb(),Kb=()=>"When painting, click on the button",Jb=()=>"Quando pintar clique no botÃ£o",Qb=(m={},o={})=>(o.locale??Ve())==="en"?Kb():Jb(),e2=()=>"on the top right corner of the screen. This will lock the screen but it'll also enable painting by moving your finger over the map.",t2=()=>"no canto superior direito da tela. Isso bloquearÃ¡ a tela, mas tambÃ©m permitirÃ¡ pintar movendo o dedo sobre o mapa.",r2=(m={},o={})=>(o.locale??Ve())==="en"?e2():t2(),n2=()=>"Hold",i2=()=>"Segure",a2=(m={},o={})=>(o.locale??Ve())==="en"?n2():i2(),o2=()=>"SPACE",s2=()=>"EspaÃ§o",l2=(m={},o={})=>(o.locale??Ve())==="en"?o2():s2(),c2=()=>"and move your cursor over the map.",u2=()=>"e mova seu cursor sobre o mapa.",h2=(m={},o={})=>(o.locale??Ve())==="en"?c2():u2(),d2=()=>"Explore",p2=()=>"Explorar",f2=(m={},o={})=>(o.locale??Ve())==="en"?d2():p2(),m2=()=>"Recharge paint charges",_2=()=>"Recarga de tinta",g2=(m={},o={})=>(o.locale??Ve())==="en"?m2():_2(),v2=()=>"Items",y2=()=>"Itens",x2=(m={},o={})=>(o.locale??Ve())==="en"?v2():y2(),b2=()=>"Get more charges",w2=()=>"Recarregue tinta para pintar",T2=(m={},o={})=>(o.locale??Ve())==="en"?b2():w2(),C2=m=>`+${m.amount} Max. Charges`,S2=m=>`+${m.amount} Tinta mÃ¡xima`,P2=(m,o={})=>(o.locale??Ve())==="en"?C2(m):S2(m),I2=()=>"Increase your maximum paint charges capacity",M2=()=>"Aumente sua capacidade mÃ¡xima de tinta",k2=(m={},o={})=>(o.locale??Ve())==="en"?I2():M2(),A2=()=>"Profile picture",E2=()=>"Imagem de perfil",z2=(m={},o={})=>(o.locale??Ve())==="en"?A2():E2(),L2=()=>"Add a new 16x16 profile picture",D2=()=>"Adicionar uma nova imagem de perfil 16x16",R2=(m={},o={})=>(o.locale??Ve())==="en"?L2():D2(),B2=()=>"Not enough droplets",F2=()=>"Droplets insuficientes",_p=(m={},o={})=>(o.locale??Ve())==="en"?B2():F2(),O2=()=>"Show profile",N2=()=>"Exibir perfil",j2=(m={},o={})=>(o.locale??Ve())==="en"?O2():N2(),V2=()=>"Menu",q2=()=>"Menu",Z2=(m={},o={})=>(o.locale??Ve())==="en"?V2():q2(),U2=m=>`Could not install the app: ${m.error}`,$2=m=>`NÃ£o pode instalar o app: ${m.error}`,G2=(m,o={})=>(o.locale??Ve())==="en"?U2(m):$2(m),H2=()=>"Install App",W2=()=>"Instalar App",X2=(m={},o={})=>(o.locale??Ve())==="en"?H2():W2(),Y2=()=>"Livestreams",K2=()=>"Livestreams",J2=(m={},o={})=>(o.locale??Ve())==="en"?Y2():K2(),Q2=()=>"Log Out",ew=()=>"Log Out",tw=(m={},o={})=>(o.locale??Ve())==="en"?Q2():ew(),rw=()=>"Hide UI",nw=()=>"Esconder UI",iw=(m={},o={})=>(o.locale??Ve())==="en"?rw():nw(),aw=()=>"Change picture:",ow=()=>"Change picture:",sw=(m={},o={})=>(o.locale??Ve())==="en"?aw():ow(),lw=()=>"Show last painted pixel on alliance",cw=()=>"Mostrar Ãºltimo pixel pintado na alianÃ§a",uw=(m={},o={})=>(o.locale??Ve())==="en"?lw():cw(),hw=()=>"Delete Account",dw=()=>"Deletar Conta",Yg=(m={},o={})=>(o.locale??Ve())==="en"?hw():dw(),pw=()=>"Are you absolutely sure?",fw=()=>"VocÃª tem certeza absoluta?",mw=(m={},o={})=>(o.locale??Ve())==="en"?pw():fw(),_w=()=>"This will permanently delete your account and all associated data. This action cannot be undone.",gw=()=>"Isso excluirÃ¡ permanentemente sua conta e todos os dados associados. Esta aÃ§Ã£o nÃ£o pode ser desfeita.",vw=(m={},o={})=>(o.locale??Ve())==="en"?_w():gw(),yw=()=>"Profile",xw=()=>"Perfil",bw=(m={},o={})=>(o.locale??Ve())==="en"?yw():xw(),ww=()=>"Display your countryâ€™s flag next to your username. Plus, when painting in regions where you own the corresponding flag, you recover 10% of the charges spent.",Tw=()=>"Exiba a bandeira do seu paÃ­s ao lado do seu nome de usuÃ¡rio. AlÃ©m disso, ao pintar em regiÃµes onde vocÃª possui a bandeira correspondente, vocÃª recupera 10% das tintas gastas.",Cw=(m={},o={})=>(o.locale??Ve())==="en"?ww():Tw(),Sw=()=>"Does not need to be equipped to provide the bonus",Pw=()=>"NÃ£o precisa estar equipada para obter o bÃ´nus",Iw=(m={},o={})=>(o.locale??Ve())==="en"?Sw():Pw(),Mw=()=>"Equipped",kw=()=>"Equipado",Aw=(m={},o={})=>(o.locale??Ve())==="en"?Mw():kw(),Ew=()=>"Equip",zw=()=>"Equipar",Lw=(m={},o={})=>(o.locale??Ve())==="en"?Ew():zw(),Dw=()=>"Country",Rw=()=>"PaÃ­s",Zv=(m={},o={})=>(o.locale??Ve())==="en"?Dw():Rw(),Bw=()=>"No country found.",Fw=()=>"PaÃ­s nÃ£o encontrado.",Ow=(m={},o={})=>(o.locale??Ve())==="en"?Bw():Fw(),Nw=()=>"Welcome to",jw=()=>"Bem vindo ao",Vw=(m={},o={})=>(o.locale??Ve())==="en"?Nw():jw(),qw=()=>"Rules",Zw=()=>"Regras",Uw=(m={},o={})=>(o.locale??Ve())==="en"?qw():Zw(),$w=()=>"Important",Gw=()=>"Importante",Hw=(m={},o={})=>(o.locale??Ve())==="en"?$w():Gw(),Ww=()=>"ðŸš« No inappropriate content (+18, hate speech, inappropriate links, highly suggestive material, ...)",Xw=()=>"ðŸš« ConteÃºdo inapropriado nÃ£o permitido (+18, discurso de Ã³dio, links inapropriados, conteÃºdo altamente sugestivo, ...)",Yw=(m={},o={})=>(o.locale??Ve())==="en"?Ww():Xw(),Kw=()=>"ðŸ˜ˆ Do not paint over other artworks using random colors or patterns just to mess things up",Jw=()=>"ðŸ˜ˆ NÃ£o desenhe por cima de outras artes usando cores ou padrÃµes aleatÃ³rios sÃ³ para bagunÃ§ar",Qw=(m={},o={})=>(o.locale??Ve())==="en"?Kw():Jw(),e5=()=>"ðŸ§‘â€ðŸ¤â€ðŸ§‘ Do not paint with more than one account",t5=()=>"ðŸ§‘â€ðŸ¤â€ðŸ§‘ NÃ£o desenhe com mais de uma conta",r5=(m={},o={})=>(o.locale??Ve())==="en"?e5():t5(),n5=()=>"ðŸ¤– Use of bots is not allowed",i5=()=>"ðŸ¤– Usar bots nÃ£o Ã© permitido",a5=(m={},o={})=>(o.locale??Ve())==="en"?n5():i5(),o5=()=>"ðŸ™… Disclosing other's personal information is not allowed",s5=()=>"ðŸ™… Divulgar informaÃ§Ãµes pessoais dos outros nÃ£o Ã© permitido",l5=(m={},o={})=>(o.locale??Ve())==="en"?o5():s5(),c5=()=>"âœ… Painting over other artworks to complement them or create a new drawing is allowed",u5=()=>"âœ… Desenhar sobre outras artes para complementar ou criar novas artes Ã© permitido",h5=(m={},o={})=>(o.locale??Ve())==="en"?c5():u5(),d5=()=>"âœ… Griefing political party flags or portraits of politicians is allowed",p5=()=>"âœ… Desenhar sobre bandeiras de partidos e retratos de polÃ­ticos Ã© permitido",f5=(m={},o={})=>(o.locale??Ve())==="en"?d5():p5(),m5=()=>"Violations of these rules may lead to suspension of your account or removal of drawings.",_5=()=>"A violaÃ§Ã£o destas regras pode levar Ã  suspensÃ£o da conta ou Ã  remoÃ§Ã£o de desenhos.",g5=(m={},o={})=>(o.locale??Ve())==="en"?m5():_5(),v5=()=>"Understood",y5=()=>"Entendido",x5=(m={},o={})=>(o.locale??Ve())==="en"?v5():y5(),b5=()=>"Toggle art opacity",w5=()=>"Alterar opacidade",Uv=(m={},o={})=>(o.locale??Ve())==="en"?b5():w5(),T5=()=>"Paint",C5=()=>"Pintar",$v=(m={},o={})=>(o.locale??Ve())==="en"?T5():C5(),S5=()=>"Select a color",P5=()=>"Selecione uma color",I5=(m={},o={})=>(o.locale??Ve())==="en"?S5():P5(),M5=()=>"Select a pixel to erase",k5=()=>"Selecione um pixel para apagar",A5=(m={},o={})=>(o.locale??Ve())==="en"?M5():k5(),E5=()=>"Pick a color from the map",z5=()=>"Escolha uma cor do mapa",L5=(m={},o={})=>(o.locale??Ve())==="en"?E5():z5(),D5=()=>"Click",R5=()=>"Clique",B5=(m={},o={})=>(o.locale??Ve())==="en"?D5():R5(),F5=()=>"SPACE",O5=()=>"ESPAÃ‡O",N5=(m={},o={})=>(o.locale??Ve())==="en"?F5():O5(),j5=()=>"or hold",V5=()=>"ou segure",q5=(m={},o={})=>(o.locale??Ve())==="en"?j5():V5(),Z5=()=>"to paint,",U5=()=>"para pintar",$5=(m={},o={})=>(o.locale??Ve())==="en"?Z5():U5(),G5=()=>"You can paint more than 1 pixel",H5=()=>"VocÃª pode pintar mais de 1 pixel",W5=(m={},o={})=>(o.locale??Ve())==="en"?G5():H5(),X5=()=>"Paint pixel",Y5=()=>"Pintar pixel",K5=(m={},o={})=>(o.locale??Ve())==="en"?X5():Y5(),J5=()=>"Color Picker",Q5=()=>"Conta Gotas",e3=(m={},o={})=>(o.locale??Ve())==="en"?J5():Q5(),t3=()=>"+2 max. charge/level",r3=()=>"+2 tinta mÃ¡xima/level",n3=(m={},o={})=>(o.locale??Ve())==="en"?t3():r3(),i3=()=>"Name",a3=()=>"Nome",Xf=(m={},o={})=>(o.locale??Ve())==="en"?i3():a3(),o3=()=>"Discord Username",s3=()=>"UsuÃ¡rio do Discord",l3=(m={},o={})=>(o.locale??Ve())==="en"?o3():s3(),c3=()=>"Max. Charges",u3=()=>"Tinta mÃ¡xima",Kg=(m={},o={})=>(o.locale??Ve())==="en"?c3():u3(),h3=()=>"Paint Charges",d3=()=>"Tintas",p3=(m={},o={})=>(o.locale??Ve())==="en"?h3():d3(),f3=m=>`+${m.amount} Paint Charges`,m3=m=>`+${m.amount} Tintas`,_3=(m,o={})=>(o.locale??Ve())==="en"?f3(m):m3(m),g3=()=>"Leave alliance",v3=()=>"Sair da alianÃ§a",y3=(m={},o={})=>(o.locale??Ve())==="en"?g3():v3(),x3=()=>"Headquarters",b3=()=>"Quartel General",w3=(m={},o={})=>(o.locale??Ve())==="en"?x3():b3(),T3=()=>"Not set",C3=()=>"NÃ£o configurado",S3=(m={},o={})=>(o.locale??Ve())==="en"?T3():C3(),P3=()=>"You are not in an alliance",I3=()=>"VocÃª nÃ£o estÃ¡ em uma alianÃ§a",M3=(m={},o={})=>(o.locale??Ve())==="en"?P3():I3(),k3=()=>"Get invited to an alliance",A3=()=>"Seja convidado para uma alianÃ§a",E3=(m={},o={})=>(o.locale??Ve())==="en"?k3():A3(),z3=()=>"OR",L3=()=>"OU",D3=(m={},o={})=>(o.locale??Ve())==="en"?z3():L3(),R3=()=>"Create an alliance",B3=()=>"Crie uma alianÃ§a",F3=(m={},o={})=>(o.locale??Ve())==="en"?R3():B3(),O3=()=>"Invite link",N3=()=>"Link de convite",j3=(m={},o={})=>(o.locale??Ve())==="en"?O3():N3(),V3=()=>"Send the link below to everybody you want to invite to the alliance",q3=()=>"Envie o link abaixo para quem vocÃª deseja convidar para a alianÃ§a",Z3=(m={},o={})=>(o.locale??Ve())==="en"?V3():q3(),U3=()=>"Copied",$3=()=>"Copiado",Bm=(m={},o={})=>(o.locale??Ve())==="en"?U3():$3(),G3=()=>"No description",H3=()=>"Sem descriÃ§Ã£o",Gv=(m={},o={})=>(o.locale??Ve())==="en"?G3():H3(),W3=()=>"Invite",X3=()=>"Convite",Y3=(m={},o={})=>(o.locale??Ve())==="en"?W3():X3(),K3=()=>"No pixels painted",J3=()=>"Nenhum pixel pintado",Fm=(m={},o={})=>(o.locale??Ve())==="en"?K3():J3(),Q3=()=>"Today",eT=()=>"Hoje",gp=(m={},o={})=>(o.locale??Ve())==="en"?Q3():eT(),tT=()=>"Week",rT=()=>"Semana",nT=(m={},o={})=>(o.locale??Ve())==="en"?tT():rT(),iT=()=>"Month",aT=()=>"MÃªs",oT=(m={},o={})=>(o.locale??Ve())==="en"?iT():aT(),sT=()=>"All time",lT=()=>"Geral",cT=(m={},o={})=>(o.locale??Ve())==="en"?sT():lT(),uT=()=>"this week",hT=()=>"nesta semana",Om=(m={},o={})=>(o.locale??Ve())==="en"?uT():hT(),dT=()=>"this month",pT=()=>"neste mÃªs",Nm=(m={},o={})=>(o.locale??Ve())==="en"?dT():pT(),fT=()=>"Create alliance",mT=()=>"Criar alianÃ§a",_T=(m={},o={})=>(o.locale??Ve())==="en"?fT():mT(),gT=()=>"Alliance Name",vT=()=>"Nome da alianÃ§a",yT=(m={},o={})=>(o.locale??Ve())==="en"?gT():vT(),xT=()=>"Create",bT=()=>"Criar",wT=(m={},o={})=>(o.locale??Ve())==="en"?xT():bT(),TT=()=>"Give admin",CT=()=>"Tornar admin",ST=(m={},o={})=>(o.locale??Ve())==="en"?TT():CT(),PT=()=>"Ban from alliance",IT=()=>"Banir da alianÃ§a",Hv=(m={},o={})=>(o.locale??Ve())==="en"?PT():IT(),MT=()=>"No action",kT=()=>"Sem opÃ§Ã£o",AT=(m={},o={})=>(o.locale??Ve())==="en"?MT():kT(),ET=()=>"Unban",zT=()=>"Desbanir",LT=(m={},o={})=>(o.locale??Ve())==="en"?ET():zT(),DT=()=>"No banned users",RT=()=>"Sem usuÃ¡rios banidos",BT=(m={},o={})=>(o.locale??Ve())==="en"?DT():RT(),FT=()=>"Update",OT=()=>"Atualizar",NT=(m={},o={})=>(o.locale??Ve())==="en"?FT():OT(),jT=()=>"Error giving admin to user",VT=()=>"Erro ao tornar usuÃ¡rio admin",qT=(m={},o={})=>(o.locale??Ve())==="en"?jT():VT(),ZT=()=>"Users",UT=()=>"UsuÃ¡rios",$T=(m={},o={})=>(o.locale??Ve())==="en"?ZT():UT(),GT=()=>"Banned",HT=()=>"Banido",Wv=(m={},o={})=>(o.locale??Ve())==="en"?GT():HT(),WT=()=>"Regions",XT=()=>"RegiÃµes",YT=(m={},o={})=>(o.locale??Ve())==="en"?WT():XT(),KT=()=>"Countries",JT=()=>"PaÃ­ses",QT=(m={},o={})=>(o.locale??Ve())==="en"?KT():JT(),eC=()=>"Players",tC=()=>"Jogadores",Xv=(m={},o={})=>(o.locale??Ve())==="en"?eC():tC(),rC=()=>"Alliances",nC=()=>"AlianÃ§as",Yv=(m={},o={})=>(o.locale??Ve())==="en"?rC():nC(),iC=()=>"Region",aC=()=>"RegiÃ£o",oC=(m={},o={})=>(o.locale??Ve())==="en"?iC():aC(),sC=()=>"Pixels",lC=()=>"Pixels",vc=(m={},o={})=>(o.locale??Ve())==="en"?sC():lC(),cC=()=>"Painted",uC=()=>"Pintados",yc=(m={},o={})=>(o.locale??Ve())==="en"?cC():uC(),hC=()=>"Pixels painted inside the region",dC=()=>"Pixels pintados dentro da regiÃ£o",pC=(m={},o={})=>(o.locale??Ve())==="en"?hC():dC(),fC=()=>"Not painted",mC=()=>"NÃ£o pintado",_C=(m={},o={})=>(o.locale??Ve())==="en"?fC():mC(),gC=()=>"Painted by",vC=()=>"Pintado por",yC=(m={},o={})=>(o.locale??Ve())==="en"?gC():vC(),xC=()=>"Limit reached",bC=()=>"Limite atingido",wC=(m={},o={})=>(o.locale??Ve())==="en"?xC():bC(),TC=()=>"Favorite",CC=()=>"Favoritar",SC=(m={},o={})=>(o.locale??Ve())==="en"?TC():CC(),PC=()=>"Share",IC=()=>"Compartilhar",MC=(m={},o={})=>(o.locale??Ve())==="en"?PC():IC(),kC=()=>"Share place",AC=()=>"Compartilhar local",EC=(m={},o={})=>(o.locale??Ve())==="en"?kC():AC(),zC=()=>"Mute",LC=()=>"Mutar",DC=(m={},o={})=>(o.locale??Ve())==="en"?zC():LC(),RC=()=>"Unmute",BC=()=>"Desmutar",FC=(m={},o={})=>(o.locale??Ve())==="en"?RC():BC(),OC=()=>"Select the headquarters location",NC=()=>"Selecione a localizaÃ§Ã£o do quartel general",jC=(m={},o={})=>(o.locale??Ve())==="en"?OC():NC(),VC=()=>"Pixels painted inside the country",qC=()=>"Pixels pintados dentro do paÃ­s",ZC=(m={},o={})=>(o.locale??Ve())==="en"?VC():qC(),UC=()=>"Username copied to clipboard",$C=()=>"UsuÃ¡rio copiado",GC=(m={},o={})=>(o.locale??Ve())==="en"?UC():$C(),HC=()=>"No more charges",WC=()=>"Acabou a tinta",XC=(m={},o={})=>(o.locale??Ve())==="en"?HC():WC(),YC=()=>"You are not allowed to use multiple accounts. Use your main account to paint.",KC=()=>"NÃ£o Ã© permitido usar vÃ¡rias contas. Use sua conta principal para pintar.",JC=(m={},o={})=>(o.locale??Ve())==="en"?YC():KC(),QC=()=>"SMS sent to",eS=()=>"SMS enviado para",tS=(m={},o={})=>(o.locale??Ve())==="en"?QC():eS(),rS=()=>"Phone successfully verified",nS=()=>"Telefone verificado com sucesso",iS=(m={},o={})=>(o.locale??Ve())==="en"?rS():nS(),aS=()=>"Not a valid phone number",oS=()=>"NÃ£o Ã© um nÃºmero vÃ¡lido",sS=(m={},o={})=>(o.locale??Ve())==="en"?aS():oS(),lS=()=>"Location unfavorited",cS=()=>"LocalizaÃ§Ã£o desfavoritada",uS=(m={},o={})=>(o.locale??Ve())==="en"?lS():cS(),hS=()=>"Location favorited",dS=()=>"LocalizaÃ§Ã£o favoritada",pS=(m={},o={})=>(o.locale??Ve())==="en"?hS():dS(),fS=()=>"Giving admin to user",mS=()=>"Tornar usuÃ¡rio um admin",_S=(m={},o={})=>(o.locale??Ve())==="en"?fS():mS(),gS=()=>"Profile updated",vS=()=>"Perfil atualizado",yS=(m={},o={})=>(o.locale??Ve())==="en"?gS():vS(),xS=()=>"Successfully linked your Discord account.",bS=()=>"A sua conta Discord foi conectada com sucesso.",wS=(m={},o={})=>(o.locale??Ve())==="en"?xS():bS(),TS=()=>"Discord unlinked",CS=()=>"Discord desconectado",SS=(m={},o={})=>(o.locale??Ve())==="en"?TS():CS(),PS=()=>"Link your Discord",IS=()=>"Conectar Discord",MS=(m={},o={})=>(o.locale??Ve())==="en"?PS():IS(),kS=m=>`Unlink Discord (${m.username})`,AS=m=>`Desconectar Discord (${m.username})`,ES=(m,o={})=>(o.locale??Ve())==="en"?kS(m):AS(m),zS=()=>"Account successfully deleted",LS=()=>"Conta deletada com sucesso",DS=(m={},o={})=>(o.locale??Ve())==="en"?zS():LS(),RS=()=>"Logged out",BS=()=>"Logout feito",FS=(m={},o={})=>(o.locale??Ve())==="en"?RS():BS(),OS=()=>"Could not logout. Try refreshing the page.",NS=()=>"NÃ£o foi possÃ­vel sair da conta. Tente recarregar a pÃ¡gina.",jS=(m={},o={})=>(o.locale??Ve())==="en"?OS():NS(),VS=()=>"You need to zoom in to select a pixel",qS=()=>"DÃª zoom para selecionar um pixel",ZS=(m={},o={})=>(o.locale??Ve())==="en"?VS():qS(),US=()=>"Phone verification",$S=()=>"VerificaÃ§Ã£o de telefone",GS=(m={},o={})=>(o.locale??Ve())==="en"?US():$S(),HS=()=>"Please verify your phone number to continue playing. This helps us keep bots out and ensure a safe, creative experience for everyone.",WS=()=>"Por favor, verifique com seu telefone para continuar jogando. Isso nos ajuda a filtrar bots e manter um experiÃªncia segura e criativa para todos.",XS=(m={},o={})=>(o.locale??Ve())==="en"?HS():WS(),YS=()=>"Send Code",KS=()=>"Enviar o cÃ³digo",JS=(m={},o={})=>(o.locale??Ve())==="en"?YS():KS(),QS=()=>"Input the code",eP=()=>"Insira o cÃ³digo",tP=(m={},o={})=>(o.locale??Ve())==="en"?QS():eP(),rP=()=>"Sent to",nP=()=>"Enviar para",iP=(m={},o={})=>(o.locale??Ve())==="en"?rP():nP(),aP=()=>"Resend Code",oP=()=>"Reenviar CÃ³digo",sP=(m={},o={})=>(o.locale??Ve())==="en"?aP():oP(),lP=()=>"Try another number",cP=()=>"Tentar outro nÃºmero",uP=(m={},o={})=>(o.locale??Ve())==="en"?lP():cP(),hP=()=>"Edit profile",dP=()=>"Editar perfil",pP=(m={},o={})=>(o.locale??Ve())==="en"?hP():dP(),fP=()=>"Image",mP=()=>"Imagem",_P=(m={},o={})=>(o.locale??Ve())==="en"?fP():mP(),gP=()=>"Download",vP=()=>"Download",yP=(m={},o={})=>(o.locale??Ve())==="en"?gP():vP(),xP=()=>"Image copied to clipboard",bP=()=>"Imagem copiada para a Ã¡rea de transferÃªncia",wP=(m={},o={})=>(o.locale??Ve())==="en"?xP():bP(),TP=()=>"My map is lagging",CP=()=>"Meu mapa estÃ¡ travando",SP=(m={},o={})=>(o.locale??Ve())==="en"?TP():CP(),PP=()=>"Verify if",IP=()=>"Verifique se",MP=(m={},o={})=>(o.locale??Ve())==="en"?PP():IP(),kP=()=>"Use hardware acceleration when available",AP=()=>"Usar aceleraÃ§Ã£o grÃ¡fica quando disponÃ­vel",EP=(m={},o={})=>(o.locale??Ve())==="en"?kP():AP(),zP=()=>"is enabled on",LP=()=>"estÃ¡ habilitado em",DP=(m={},o={})=>(o.locale??Ve())==="en"?zP():LP(),RP=()=>"Follow the instructions to enable hardware acceleration",BP=()=>"Siga a instruÃ§Ã£o para habilitar a aceleraÃ§Ã£o de hardware",FP=(m={},o={})=>(o.locale??Ve())==="en"?RP():BP(),OP=()=>"Moderation",NP=()=>"ModeraÃ§Ã£o",jP=(m={},o={})=>(o.locale??Ve())==="en"?OP():NP(),VP=()=>"Terms",qP=()=>"Termos",ZP=(m={},o={})=>(o.locale??Ve())==="en"?VP():qP(),UP=()=>"Privacy",$P=()=>"Privacidade",GP=(m={},o={})=>(o.locale??Ve())==="en"?UP():$P(),HP=()=>"Refund",WP=()=>"Reembolso",Kv=(m={},o={})=>(o.locale??Ve())==="en"?HP():WP(),XP=()=>"Clear area",YP=()=>"Limpar Ã¡rea",KP=(m={},o={})=>(o.locale??Ve())==="en"?XP():YP(),JP=()=>"Select the area's first corner",QP=()=>"Selecione o primeiro canto da Ã¡rea",Jv=(m={},o={})=>(o.locale??Ve())==="en"?JP():QP(),eI=()=>"Select the area's opposite corner",tI=()=>"Selecione o canto oposto da Ã¡rea",Qv=(m={},o={})=>(o.locale??Ve())==="en"?eI():tI(),rI=()=>"Admin",nI=()=>"AdministraÃ§Ã£o",iI=(m={},o={})=>(o.locale??Ve())==="en"?rI():nI(),aI=m=>`Reason: ${m.reason}`,oI=m=>`Motivo: ${m.reason}`,sI=(m,o={})=>(o.locale??Ve())==="en"?aI(m):oI(m),lI=()=>"No corresponding region on the map (cosmetic effect only)",cI=()=>"NÃ£o possui regiÃ£o no mapa (apenas efeito cosmÃ©tico)",uI=(m={},o={})=>(o.locale??Ve())==="en"?lI():cI(),hI=()=>"Flag without region on the map",dI=()=>"Bandeira sem regiÃ£o no mapa",pI=(m={},o={})=>(o.locale??Ve())==="en"?hI():dI(),fI=m=>`The flag of <b>${m.country}</b> does not have corresponding areas on the map and will only have cosmetic effects.`,mI=m=>`A bandeira <b>${m.country}</b> nÃ£o possui regiÃµes correspondente no mapa e sÃ³ terÃ¡ efeito cosmÃ©tico.`,_I=(m,o={})=>(o.locale??Ve())==="en"?fI(m):mI(m),gI=()=>"Dark mode",vI=()=>"Modo escuro",yI=(m={},o={})=>(o.locale??Ve())==="en"?gI():vI(),xI=()=>"Light mode",bI=()=>"Modo claro",wI=(m={},o={})=>(o.locale??Ve())==="en"?xI():bI(),Go=2*Math.PI*6378137/2;class fl{constructor(o=256){gr(this,"initialResolution");this.tileSize=o,this.initialResolution=2*Go/this.tileSize}latLonToMeters(o,f){const y=f/180*Go,M=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180)*Go/180;return[y,M]}metersToLatLon(o,f){const y=o/Go*180;let M=f/Go*180;return M=180/Math.PI*(2*Math.atan(Math.exp(M*Math.PI/180))-Math.PI/2),[M,y]}pixelsToMeters(o,f,y){const M=this.resolution(y),z=o*M-Go,T=Go-f*M;return[z,T]}pixelsToLatLon(o,f,y){const[M,z]=this.pixelsToMeters(o,f,y);return this.metersToLatLon(M,z)}latLonToPixels(o,f,y){const[M,z]=this.latLonToMeters(o,f);return this.metersToPixels(M,z,y)}latLonToPixelsFloor(o,f,y){const[M,z]=this.latLonToPixels(o,f,y);return[Math.floor(M),Math.floor(z)]}metersToPixels(o,f,y){const M=this.resolution(y),z=(o+Go)/M,T=(Go-f)/M;return[z,T]}latLonToTile(o,f,y){const[M,z]=this.latLonToMeters(o,f);return this.metersToTile(M,z,y)}metersToTile(o,f,y){const[M,z]=this.metersToPixels(o,f,y);return this.pixelsToTile(M,z)}pixelsToTile(o,f){const y=Math.ceil(o/this.tileSize)-1,M=Math.ceil(f/this.tileSize)-1;return[y,M]}pixelsToTileLocal(o,f){return{tile:this.pixelsToTile(o,f),pixel:[Math.floor(o)%this.tileSize,Math.floor(f)%this.tileSize]}}tileBounds(o,f,y){const[M,z]=this.pixelsToMeters(o*this.tileSize,f*this.tileSize,y),[T,s]=this.pixelsToMeters((o+1)*this.tileSize,(f+1)*this.tileSize,y);return{min:[M,z],max:[T,s]}}tileBoundsLatLon(o,f,y){const M=this.tileBounds(o,f,y);return{min:this.metersToLatLon(M.min[0],M.min[1]),max:this.metersToLatLon(M.max[0],M.max[1])}}resolution(o){return this.initialResolution/2**o}latLonToTileAndPixel(o,f,y){const[M,z]=this.latLonToMeters(o,f),[T,s]=this.metersToTile(M,z,y),[B,N]=this.metersToPixels(M,z,y);return{tile:[T,s],pixel:[Math.floor(B)%this.tileSize,Math.floor(N)%this.tileSize]}}pixelBounds(o,f,y){return{min:this.pixelsToMeters(o,f,y),max:this.pixelsToMeters(o+1,f+1,y)}}pixelToBoundsLatLon(o,f,y){const M=this.pixelBounds(o,f,y),z=.001885,T=(M.max[0]-M.min[0])*z,s=(M.max[1]-M.min[1])*z;return M.min[0]-=T,M.max[0]-=T,M.min[1]-=s,M.max[1]-=s,{min:this.metersToLatLon(M.min[0],M.min[1]),max:this.metersToLatLon(M.max[0],M.max[1])}}latLonToTileBoundsLatLon(o,f,y){const[M,z]=this.latLonToMeters(o,f),[T,s]=this.metersToTile(M,z,y);return this.tileBoundsLatLon(T,s,y)}latLonToPixelBoundsLatLon(o,f,y){const[M,z]=this.latLonToMeters(o,f),[T,s]=this.metersToPixels(M,z,y);return this.pixelToBoundsLatLon(Math.floor(T),Math.floor(s),y)}latLonToRegionAndPixel(o,f,y,M=Hi.regionSize){const[z,T]=this.latLonToPixelsFloor(o,f,y),s=this.tileSize*M;return{region:[Math.floor(z/s),Math.floor(T/s)],pixel:[z%s,T%s]}}}function jm(m,o=!0){const{min:f,max:y}=m;return o?[[f[1],y[0]],[y[1],y[0]],[y[1],f[0]],[f[1],f[0]]]:[[f[0],y[1]],[y[0],y[1]],[y[0],f[1]],[f[0],f[1]]]}function Vm(m){return[(m.min[0]+m.max[0])/2,(m.min[1]+m.max[1])/2]}const TI="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAAAAACoWZBhAAAAAXNSR0IArs4c6QAAACpJREFUeNpj+AsEZ86ASIa/DAwMZ84ACRDzDBigMs/AARITq1oUwxBWAADaREUdDMswKwAAAABJRU5ErkJggg==",Jg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAQAAAAnOwc2AAAAAXNSR0IArs4c6QAAACVJREFUeNpj+A8FDEAAZwMRBAIBmIYLIgHcgkQDIs3E6SRsjgcABYFLtfTgakEAAAAASUVORK5CYII=";function CI(m){return Math.floor(Math.random()*m)}const Yf=14.5;async function SI(){const m=MI();if(m)return m;try{if((await navigator.permissions.query({name:"geolocation"})).state==="granted"){const f=await new Promise((y,M)=>navigator.geolocation.getCurrentPosition(z=>y(z),z=>M(z)));return{lat:f.coords.latitude,lng:f.coords.longitude,zoom:Yf}}}catch(o){console.error(o)}return{...PI().pos,zoom:Yf}}function PI(){const m=Object.entries(II),o=CI(m.length),[f,y]=m[o];return{city:f,pos:y}}const II={tokyo:{lat:35.677545560719665,lng:139.76394445809638},paris:{lat:48.8537151734952,lng:2.3484026030630787},newYork:{lat:40.71283173786517,lng:-74.00599771376795},saoPaulo:{lat:-23.550584064565356,lng:-46.63339720713918},sydney:{lat:-33.86943325619071,lng:151.2083447239608}},e0="location";function Co(m,o){localStorage.setItem(e0,JSON.stringify({...m,zoom:o}))}function MI(){const m=localStorage.getItem(e0);if(!m)return;const o=JSON.parse(m);return o.zoom??(o.zoom=Yf),o}var Hu,Wu;class kI{constructor(){Mr(this,Hu,ct(-1));Mr(this,Wu,ct([]))}get idx(){return x(it(this,Hu))}set idx(o){ce(it(this,Hu),o,!0)}get entries(){return x(it(this,Wu))}set entries(o){ce(it(this,Wu),o)}hasNext(){return this.idx<this.entries.length-1}goToNext(o){const f=this.idx+1,y=this.entries[f];y&&(this.idx=f,o.flyTo({center:y.pos,zoom:y.zoom}))}hasPrev(){return this.idx>0}goToPrev(o){const f=this.idx-1,y=this.entries[f];y&&(this.idx=f,o.flyTo({center:y.pos,zoom:y.zoom}))}isEmpty(){return this.entries.length===0}push(o){this.idx=this.idx+1,this.entries=[...this.entries.slice(0,this.idx),o]}}Hu=new WeakMap,Wu=new WeakMap;const hl=new kI;function qm(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var Wd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var AI=Wd.exports,Qg;function EI(){return Qg||(Qg=1,(function(m,o){(function(f,y){m.exports=y()})(AI,(function(){var f={},y={};function M(T,s,B){if(y[T]=B,T==="index"){var N="var sharedModule = {}; ("+y.shared+")(sharedModule); ("+y.worker+")(sharedModule);",Y={};return y.shared(Y),y.index(f,Y),typeof window<"u"&&f.setWorkerUrl(window.URL.createObjectURL(new Blob([N],{type:"text/javascript"}))),f}}M("shared",["exports"],(function(T){function s(n,t,r,a){return new(r||(r=Promise))((function(c,p){function _(S){try{b(a.next(S))}catch(I){p(I)}}function v(S){try{b(a.throw(S))}catch(I){p(I)}}function b(S){var I;S.done?c(S.value):(I=S.value,I instanceof r?I:new r((function(L){L(I)}))).then(_,v)}b((a=a.apply(n,t||[])).next())}))}function B(n,t){this.x=n,this.y=t}function N(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Y,K;typeof SuppressedError=="function"&&SuppressedError,B.prototype={clone(){return new B(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){const t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const t=Math.cos(n),r=Math.sin(n),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround(n,t){const r=Math.cos(n),a=Math.sin(n),c=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:B},B.convert=function(n){if(n instanceof B)return n;if(Array.isArray(n))return new B(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new B(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var ie=(function(){if(K)return Y;function n(t,r,a,c){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=a,this.p2y=c}return K=1,Y=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,c=0;c<8;c++){var p=this.sampleCurveX(a)-t;if(Math.abs(p)<r)return a;var _=this.sampleCurveDerivativeX(a);if(Math.abs(_)<1e-6)break;a-=p/_}var v=0,b=1;for(a=t,c=0;c<20&&(p=this.sampleCurveX(a),!(Math.abs(p-t)<r));c++)t>p?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Y})(),H=N(ie);let me,ve;function Me(){return me==null&&(me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),me}function Ee(){if(ve==null&&(ve=!1,Me())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<25;a++){const c=4*a;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&r[a]!==a){ve=!0;break}}}return ve||!1}var Re=1e-6,ze=typeof Float32Array<"u"?Float32Array:Array;function Fe(){var n=new ze(9);return ze!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Ke(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function rt(){var n=new ze(3);return ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function qe(n){return Math.hypot(n[0],n[1],n[2])}function He(n,t,r){var a=new ze(3);return a[0]=n,a[1]=t,a[2]=r,a}function et(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function De(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function tt(n,t,r){var a=t[0],c=t[1],p=t[2],_=r[0],v=r[1],b=r[2];return n[0]=c*b-p*v,n[1]=p*_-a*b,n[2]=a*v-c*_,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var nt,Ze=qe;function ke(n,t,r){var a=t[0],c=t[1],p=t[2],_=t[3];return n[0]=r[0]*a+r[4]*c+r[8]*p+r[12]*_,n[1]=r[1]*a+r[5]*c+r[9]*p+r[13]*_,n[2]=r[2]*a+r[6]*c+r[10]*p+r[14]*_,n[3]=r[3]*a+r[7]*c+r[11]*p+r[15]*_,n}function bt(){var n=new ze(4);return ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function te(n,t,r,a){var c=.5*Math.PI/180;t*=c,r*=c,a*=c;var p=Math.sin(t),_=Math.cos(t),v=Math.sin(r),b=Math.cos(r),S=Math.sin(a),I=Math.cos(a);return n[0]=p*b*I-_*v*S,n[1]=_*v*I+p*b*S,n[2]=_*b*S-p*v*I,n[3]=_*b*I+p*v*S,n}function re(){var n=new ze(2);return ze!=Float32Array&&(n[0]=0,n[1]=0),n}function ge(n,t){var r=new ze(2);return r[0]=n,r[1]=t,r}rt(),nt=new ze(4),ze!=Float32Array&&(nt[0]=0,nt[1]=0,nt[2]=0,nt[3]=0),rt(),He(1,0,0),He(0,1,0),bt(),bt(),Fe(),re();const oe=8192;function Ae(n,t,r){return t*(oe/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function Ne(n,t){return(n%t+t)%t}function pt(n,t,r){return n*(1-r)+t*r}function ot(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function ut(n,t,r,a){const c=new H(n,t,r,a);return p=>c.solve(p)}const St=ut(.25,.1,.25,1);function Bt(n,t,r){return Math.min(r,Math.max(t,n))}function at(n,t,r){const a=r-t,c=((n-t)%a+a)%a+t;return c===t?r:c}function dt(n,...t){for(const r of t)for(const a in r)n[a]=r[a];return n}let vt=1;function yt(n,t,r){const a={};for(const c in n)a[c]=t.call(this,n[c],c,n);return a}function It(n,t,r){const a={};for(const c in n)t.call(this,n[c],c,n)&&(a[c]=n[c]);return a}function wt(n){return Array.isArray(n)?n.map(wt):typeof n=="object"&&n?yt(n,wt):n}const mt={};function Dt(n){mt[n]||(typeof console<"u"&&console.warn(n),mt[n]=!0)}function zt(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function qt(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let tr=null;function Qt(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function fr(n,t,r,a,c){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(n,{timestamp:0});try{const _=p==null?void 0:p.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),b=new Uint8ClampedArray(a*c*4);if(yield p.copyTo(b,(function(S,I,L,F,V){const U=4*Math.max(-I,0),W=(Math.max(0,L)-L)*F*4+U,J=4*F,le=Math.max(0,I),Le=Math.max(0,L);return{rect:{x:le,y:Le,width:Math.min(S.width,I+F)-le,height:Math.min(S.height,L+V)-Le},layout:[{offset:W,stride:J}]}})(n,t,r,a,c)),v)for(let S=0;S<b.length;S+=4){const I=b[S];b[S]=b[S+2],b[S+2]=I}return b}finally{p.close()}}))}let kr,Ar;function rr(n,t,r,a){return n.addEventListener(t,r,a),{unsubscribe:()=>{n.removeEventListener(t,r,a)}}}function Kt(n){return n*Math.PI/180}function or(n){return n/Math.PI*180}const Sr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Dr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Zr="AbortError";function se(){return new Error(Zr)}const j={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Z(n){return j.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const X="global-dispatcher";class ae extends Error{constructor(t,r,a,c){super(`AJAXError: ${r} (${t}): ${a}`),this.status=t,this.statusText=r,this.url=a,this.body=c}}const de=()=>qt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Se=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const a=Z(n.url);if(a)return a(n,t);if(qt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:X},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(de())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,c){return s(this,void 0,void 0,(function*(){const p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:de(),signal:c.signal});let _,v;a.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{_=yield fetch(p)}catch(S){throw new ae(0,S.message,a.url,new Blob)}if(!_.ok){const S=yield _.blob();throw new ae(_.status,_.statusText,a.url,S)}v=a.type==="arrayBuffer"||a.type==="image"?_.arrayBuffer():a.type==="json"?_.json():_.text();const b=yield v;if(c.signal.aborted)throw se();return{data:b,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(n,t);if(qt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:X},t)}var r;return(function(a,c){return new Promise(((p,_)=>{var v;const b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(const S in a.headers)b.setRequestHeader(S,a.headers[S]);a.type==="json"&&(b.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{_(new Error(b.statusText))},b.onload=()=>{if(!c.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let S=b.response;if(a.type==="json")try{S=JSON.parse(b.response)}catch(I){return void _(I)}p({data:S,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const S=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});_(new ae(b.status,b.statusText,a.url,S))}},c.signal.addEventListener("abort",(()=>{b.abort(),_(se())})),b.send(a.body)}))})(n,t)};function Ie(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function be(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Oe(n,t,r){if(r&&r[n]){const a=r[n].indexOf(t);a!==-1&&r[n].splice(a,1)}}class st{constructor(t,r={}){dt(this,r),this.type=t}}class $e extends st{constructor(t,r={}){super("error",dt({error:t},r))}}class Mt{on(t,r){return this._listeners=this._listeners||{},be(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return Oe(t,r,this._listeners),Oe(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},be(t,r,this._oneTimeListeners),this):new Promise((a=>this.once(t,a)))}fire(t,r){typeof t=="string"&&(t=new st(t,r||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of c)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of p)Oe(a,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(dt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof $e&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ft=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function cr(n,t){const r={};for(const a in n)a!=="ref"&&(r[a]=n[a]);return Ft.forEach((a=>{a in t&&(r[a]=t[a])})),r}function Jt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!Jt(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!Jt(n[r],t[r]))return!1;return!0}return n===t}function Tr(n,t){n.push(t)}function Xr(n,t,r){Tr(r,{command:"addSource",args:[n,t[n]]})}function dn(n,t,r){Tr(t,{command:"removeSource",args:[n]}),r[n]=!0}function xn(n,t,r,a){dn(n,r,a),Xr(n,t,r)}function mn(n,t,r){let a;for(a in n[r])if(Object.prototype.hasOwnProperty.call(n[r],a)&&a!=="data"&&!Jt(n[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!Jt(n[r][a],t[r][a]))return!1;return!0}function jt(n,t,r,a,c,p){n=n||{},t=t||{};for(const _ in n)Object.prototype.hasOwnProperty.call(n,_)&&(Jt(n[_],t[_])||r.push({command:p,args:[a,_,t[_],c]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(n,_)&&(Jt(n[_],t[_])||r.push({command:p,args:[a,_,t[_],c]}))}function Et(n){return n.id}function hr(n,t){return n[t.id]=t,n}class ht{constructor(t,r,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function Hr(n,...t){for(const r of t)for(const a in r)n[a]=r[a];return n}class Yr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class qr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[a,c]of r)this.bindings[a]=c}concat(t){return new qr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const _t={kind:"null"},Ge={kind:"number"},At={kind:"string"},Rt={kind:"boolean"},Yt={kind:"color"},br={kind:"projectionDefinition"},Er={kind:"object"},ur={kind:"value"},rn={kind:"collator"},pn={kind:"formatted"},_n={kind:"padding"},sn={kind:"colorArray"},En={kind:"numberArray"},dr={kind:"resolvedImage"},In={kind:"variableAnchorOffsetCollection"};function tn(n,t){return{kind:"array",itemType:n,N:t}}function Qr(n){if(n.kind==="array"){const t=Qr(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const ma=[_t,Ge,At,Rt,Yt,br,pn,Er,tn(ur),_n,En,sn,dr,In];function di(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!di(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of ma)if(!di(r,t))return null}}return`Expected ${Qr(n)} but found ${Qr(t)} instead.`}function Xi(n,t){return t.some((r=>r.kind===n.kind))}function Zn(n,t){return t.some((r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n))}function ni(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const qi=.96422,Yi=.82521,Ei=4/29,zi=6/29,Ki=3*zi*zi,oa=zi*zi*zi,Ta=Math.PI/180,xt=180/Math.PI;function Wt(n){return(n%=360)<0&&(n+=360),n}function Rr([n,t,r,a]){let c,p;const _=On((.2225045*(n=yn(n))+.7168786*(t=yn(t))+.0606169*(r=yn(r)))/1);n===t&&t===r?c=p=_:(c=On((.4360747*n+.3850649*t+.1430804*r)/qi),p=On((.0139322*n+.0971045*t+.7141733*r)/Yi));const v=116*_-16;return[v<0?0:v,500*(c-_),200*(_-p),a]}function yn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function On(n){return n>oa?Math.pow(n,1/3):n/Ki+Ei}function Xn([n,t,r,a]){let c=(n+16)/116,p=isNaN(t)?c:c+t/500,_=isNaN(r)?c:c-r/200;return c=1*wn(c),p=qi*wn(p),_=Yi*wn(_),[Vn(3.1338561*p-1.6168667*c-.4906146*_),Vn(-.9787684*p+1.9161415*c+.033454*_),Vn(.0719453*p-.2289914*c+1.4052427*_),a]}function Vn(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function wn(n){return n>zi?n*n*n:Ki*(n-Ei)}const Ji=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function sr(n,t){return Ji(n,t)?n[t]:void 0}function Ut(n){return parseInt(n.padEnd(2,n),16)/255}function Ur(n,t){return lr(t?n/100:n,0,1)}function lr(n,t,r){return Math.min(Math.max(t,n),r)}function Tn(n){return!n.some(Number.isNaN)}const nn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Cn(n,t,r){return n+r*(t-n)}function $n(n,t,r){return n.map(((a,c)=>Cn(a,t[c],r)))}class Pr{constructor(t,r,a,c=1,p=!0){this.r=t,this.g=r,this.b=a,this.a=c,p||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,r,a,c]))}static parse(t){if(t instanceof Pr)return t;if(typeof t!="string")return;const r=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=sr(nn,a);if(c){const[_,v,b]=c;return[_/255,v/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const _=a.length<6?1:2;let v=1;return[Ut(a.slice(v,v+=_)),Ut(a.slice(v,v+=_)),Ut(a.slice(v,v+=_)),Ut(a.slice(v,v+_)||"ff")]}if(a.startsWith("rgb")){const _=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,S,I,L,F,V,U,W,J,le,Le]=_,ye=[I||" ",V||" ",J].join("");if(ye==="  "||ye==="  /"||ye===",,"||ye===",,,"){const Ce=[S,F,W].join(""),Xe=Ce==="%%%"?100:Ce===""?255:0;if(Xe){const lt=[lr(+b/Xe,0,1),lr(+L/Xe,0,1),lr(+U/Xe,0,1),le?Ur(+le,Le):1];if(Tn(lt))return lt}}return}}const p=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[_,v,b,S,I,L,F,V,U]=p,W=[b||" ",I||" ",F].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const J=[+v,lr(+S,0,100),lr(+L,0,100),V?Ur(+V,U):1];if(Tn(J))return(function([le,Le,ye,Ce]){function Xe(lt){const Pt=(lt+le/30)%12,Xt=Le*Math.min(ye,1-ye);return ye-Xt*Math.max(-1,Math.min(Pt-3,9-Pt,1))}return le=Wt(le),Le/=100,ye/=100,[Xe(0),Xe(8),Xe(4),Ce]})(J)}}})(t);return r?new Pr(...r,!1):void 0}get rgb(){const{r:t,g:r,b:a,a:c}=this,p=c||1/0;return this.overwriteGetter("rgb",[t/p,r/p,a/p,c])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,a,c,p]=Rr(t),_=Math.sqrt(a*a+c*c);return[Math.round(1e4*_)?Wt(Math.atan2(c,a)*xt):NaN,_,r,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Rr(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,a,c]=this.rgb;return`rgba(${[t,r,a].map((p=>Math.round(255*p))).join(",")},${c})`}static interpolate(t,r,a,c="rgb"){switch(c){case"rgb":{const[p,_,v,b]=$n(t.rgb,r.rgb,a);return new Pr(p,_,v,b,!1)}case"hcl":{const[p,_,v,b]=t.hcl,[S,I,L,F]=r.hcl;let V,U;if(isNaN(p)||isNaN(S))isNaN(p)?isNaN(S)?V=NaN:(V=S,v!==1&&v!==0||(U=I)):(V=p,L!==1&&L!==0||(U=_));else{let ye=S-p;S>p&&ye>180?ye-=360:S<p&&p-S>180&&(ye+=360),V=p+a*ye}const[W,J,le,Le]=(function([ye,Ce,Xe,lt]){return ye=isNaN(ye)?0:ye*Ta,Xn([Xe,Math.cos(ye)*Ce,Math.sin(ye)*Ce,lt])})([V,U??Cn(_,I,a),Cn(v,L,a),Cn(b,F,a)]);return new Pr(W,J,le,Le,!1)}case"lab":{const[p,_,v,b]=Xn($n(t.lab,r.lab,a));return new Pr(p,_,v,b,!1)}}}}Pr.black=new Pr(0,0,0,1),Pr.white=new Pr(1,1,1,1),Pr.transparent=new Pr(0,0,0,0),Pr.red=new Pr(1,0,0,1);class Mn{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const bn=["bottom","center","top"];class ln{constructor(t,r,a,c,p,_){this.text=t,this.image=r,this.scale=a,this.fontStack=c,this.textColor=p,this.verticalAlign=_}}class Sn{constructor(t){this.sections=t}static fromString(t){return new Sn([new ln(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Sn?t:Sn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class kn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kn)return t;if(typeof t=="number")return new kn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new kn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,a){return new kn($n(t.values,r.values,a))}}class gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gn)return t;if(typeof t=="number")return new gn([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new gn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,a){return new gn($n(t.values,r.values,a))}}class fn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof fn)return t;if(typeof t=="string"){const a=Pr.parse(t);return a?new fn([a]):void 0}if(!Array.isArray(t))return;const r=[];for(const a of t){if(typeof a!="string")return;const c=Pr.parse(a);if(!c)return;r.push(c)}return new fn(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,a,c="rgb"){const p=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)p.push(Pr.interpolate(t.values[_],r.values[_],a,c));return new fn(p)}}class an extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const po=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class pi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof pi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const a=t[r],c=t[r+1];if(typeof a!="string"||!po.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new pi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,a){const c=t.values,p=r.values;if(c.length!==p.length)throw new an(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const _=[];for(let v=0;v<c.length;v+=2){if(c[v]!==p[v])throw new an(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${c[v]}, to[${v}]: ${p[v]}`);_.push(c[v]);const[b,S]=c[v+1],[I,L]=p[v+1];_.push([Cn(b,I,a),Cn(S,L,a)])}return new pi(_)}}class Gn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Gn({name:t,available:!1}):null}}class jn{constructor(t,r,a){this.from=t,this.to=r,this.transition=a}static interpolate(t,r,a){return new jn(t,r,a)}static parse(t){return t instanceof jn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new jn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new jn(t.from,t.to,t.transition):typeof t=="string"?new jn(t,t,1):void 0}}function zn(n,t,r,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,r,a]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qa(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof jn||n instanceof Pr||n instanceof Mn||n instanceof Sn||n instanceof kn||n instanceof gn||n instanceof fn||n instanceof pi||n instanceof Gn)return!0;if(Array.isArray(n)){for(const t of n)if(!qa(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!qa(n[t]))return!1;return!0}return!1}function Lr(n){if(n===null)return _t;if(typeof n=="string")return At;if(typeof n=="boolean")return Rt;if(typeof n=="number")return Ge;if(n instanceof Pr)return Yt;if(n instanceof jn)return br;if(n instanceof Mn)return rn;if(n instanceof Sn)return pn;if(n instanceof kn)return _n;if(n instanceof gn)return En;if(n instanceof fn)return sn;if(n instanceof pi)return In;if(n instanceof Gn)return dr;if(Array.isArray(n)){const t=n.length;let r;for(const a of n){const c=Lr(a);if(r){if(r===c)continue;r=ur;break}r=c}return tn(r||ur,t)}return Er}function $r(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Pr||n instanceof jn||n instanceof Sn||n instanceof kn||n instanceof gn||n instanceof fn||n instanceof pi||n instanceof Gn?n.toString():JSON.stringify(n)}class _a{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!qa(t[1]))return r.error("invalid value");const a=t[1];let c=Lr(a);const p=r.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new _a(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const cn={string:At,number:Ge,boolean:Rt,object:Er};class Li{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,c=1;const p=t[0];if(p==="array"){let v,b;if(t.length>2){const S=t[1];if(typeof S!="string"||!(S in cn)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=cn[S],c++}else v=ur;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],c++}a=tn(v,b)}else{if(!cn[p])throw new Error(`Types doesn't contain name = ${p}`);a=cn[p]}const _=[];for(;c<t.length;c++){const v=r.parse(t[c],c,ur);if(!v)return null;_.push(v)}return new Li(a,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(t);if(!di(this.type,Lr(a)))return a;if(r===this.args.length-1)throw new an(`Expected value to be of type ${Qr(this.type)}, but found ${Qr(Lr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ga={"to-boolean":Rt,"to-color":Yt,"to-number":Ge,"to-string":At};class sa{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[0];if(!ga[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");const c=ga[a],p=[];for(let _=1;_<t.length;_++){const v=r.parse(t[_],_,ur);if(!v)return null;p.push(v)}return new sa(c,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,a;for(const c of this.args){if(r=c.evaluate(t),a=null,r instanceof Pr)return r;if(typeof r=="string"){const p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:zn(r[0],r[1],r[2],r[3]),!a))return new Pr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new an(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(t);const c=kn.parse(r);if(c)return c}throw new an(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const a of this.args){r=a.evaluate(t);const c=gn.parse(r);if(c)return c}throw new an(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const a of this.args){r=a.evaluate(t);const c=fn.parse(r);if(c)return c}throw new an(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(t);const c=pi.parse(r);if(c)return c}throw new an(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(t),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new an(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Sn.fromString($r(this.args[0].evaluate(t)));case"resolvedImage":return Gn.fromString($r(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return $r(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ka=["Unknown","Point","LineString","Polygon"];class Is{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ka[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=Pr.parse(t),this._parseColorCache.set(t,r)),r}}class Ca{constructor(t,r,a=[],c,p=new qr,_=[]){this.registry=t,this.path=a,this.key=a.map((v=>`[${v}]`)).join(""),this.scope=p,this.errors=_,this.expectedType=c,this._isConstant=r}parse(t,r,a,c,p={}){return r?this.concat(r,a,c)._parse(t,p):this._parse(t,p)}_parse(t,r){function a(c,p,_){return _==="assert"?new Li(p,[c]):_==="coerce"?new sa(p,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[c];if(p){let _=p.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(b.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(b.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(b.kind)||v.kind==="colorArray"&&["value","string","array"].includes(b.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(b.kind))_=a(_,v,r.typeAnnotation||"coerce");else if(this.checkSubtype(v,b))return null}else _=a(_,v,r.typeAnnotation||"assert")}if(!(_ instanceof _a)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new Is;try{_=new _a(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){const c=typeof t=="number"?this.path.concat(t):this.path,p=a?this.scope.concat(a):this.scope;return new Ca(this.registry,this._isConstant,c,r||null,p,this.errors)}error(t,...r){const a=`${this.key}${r.map((c=>`[${c}]`)).join("")}`;this.errors.push(new Yr(a,t))}checkSubtype(t,r){const a=di(t,r);return a&&this.error(a),a}}class Ja{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let p=1;p<t.length-1;p+=2){const _=t[p];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=r.parse(t[p+1],p+1);if(!v)return null;a.push([_,v])}const c=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return c?new Ja(a,c):null}outputDefined(){return this.result.outputDefined()}}class Jo{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=t[1];return r.scope.has(a)?new Jo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class gl{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,Ge),c=r.parse(t[2],2,tn(r.expectedType||ur));return a&&c?new gl(c.type.itemType,a,c):null}evaluate(t){const r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new an(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new an(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new an(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class vl{constructor(t,r){this.type=Rt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,ur),c=r.parse(t[2],2,ur);return a&&c?Xi(a.type,[Rt,At,Ge,_t,ur])?new vl(a,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qr(a.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!Zn(r,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${Qr(Lr(r))} instead.`);if(!Zn(a,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${Qr(Lr(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Sa{constructor(t,r,a){this.type=Ge,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,ur),c=r.parse(t[2],2,ur);if(!a||!c)return null;if(!Xi(a.type,[Rt,At,Ge,_t,ur]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qr(a.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,Ge);return p?new Sa(a,c,p):null}return new Sa(a,c)}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Zn(r,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${Qr(Lr(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),Zn(a,["string"])){const p=a.indexOf(r,c);return p===-1?-1:[...a.slice(0,p)].length}if(Zn(a,["array"]))return a.indexOf(r,c);throw new an(`Expected second argument to be of type array or string, but found ${Qr(Lr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class wi{constructor(t,r,a,c,p,_){this.inputType=t,this.type=r,this.input=a,this.cases=c,this.outputs=p,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const p={},_=[];for(let S=2;S<t.length-1;S+=2){let I=t[S];const L=t[S+1];Array.isArray(I)||(I=[I]);const F=r.concat(S);if(I.length===0)return F.error("Expected at least one branch label.");for(const U of I){if(typeof U!="number"&&typeof U!="string")return F.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,Lr(U)))return null}else a=Lr(U);if(p[String(U)]!==void 0)return F.error("Branch labels must be unique.");p[String(U)]=_.length}const V=r.parse(L,S,c);if(!V)return null;c=c||V.type,_.push(V)}const v=r.parse(t[1],1,ur);if(!v)return null;const b=r.parse(t[t.length-1],t.length-1,c);return b?v.type.kind!=="value"&&r.concat(1).checkSubtype(a,v.type)?null:new wi(a,c,v,p,_,b):null}evaluate(t){const r=this.input.evaluate(t);return(Lr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Qo{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c=[];for(let _=1;_<t.length-1;_+=2){const v=r.parse(t[_],_,Rt);if(!v)return null;const b=r.parse(t[_+1],_+1,a);if(!b)return null;c.push([v,b]),a=a||b.type}const p=r.parse(t[t.length-1],t.length-1,a);if(!p)return null;if(!a)throw new Error("Can't infer output type");return new Qo(a,c,p)}evaluate(t){for(const[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ms{constructor(t,r,a,c){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,ur),c=r.parse(t[2],2,Ge);if(!a||!c)return null;if(!Xi(a.type,[tn(ur),At,ur]))return r.error(`Expected first argument to be of type array or string, but found ${Qr(a.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,Ge);return p?new Ms(a.type,a,c,p):null}return new Ms(a.type,a,c)}evaluate(t){const r=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),Zn(r,["string"]))return[...r].slice(a,c).join("");if(Zn(r,["array"]))return r.slice(a,c);throw new an(`Expected first argument to be of type array or string, but found ${Qr(Lr(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ko(n,t){const r=n.length-1;let a,c,p=0,_=r,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),a=n[v],c=n[v+1],a<=t){if(v===r||t<c)return v;p=v+1}else{if(!(a>t))throw new an("Input is not a number.");_=v-1}return 0}class ei{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[c,p]of a)this.labels.push(c),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(t[1],1,Ge);if(!a)return null;const c=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],b=t[_+1],S=_,I=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(c.length&&c[c.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const L=r.parse(b,I,p);if(!L)return null;p=p||L.type,c.push([v,L])}return new ei(p,a,c)}evaluate(t){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return a[0].evaluate(t);const p=r.length;return c>=r[p-1]?a[p-1].evaluate(t):a[ko(r,c)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Bh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ks,Ec,xp=(function(){if(Ec)return ks;function n(t,r,a,c){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=a,this.p2y=c}return Ec=1,ks=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,c=0;c<8;c++){var p=this.sampleCurveX(a)-t;if(Math.abs(p)<r)return a;var _=this.sampleCurveDerivativeX(a);if(Math.abs(_)<1e-6)break;a-=p/_}var v=0,b=1;for(a=t,c=0;c<20&&(p=this.sampleCurveX(a),!(Math.abs(p-t)<r));c++)t>p?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},ks})(),es=Bh(xp);class Di{constructor(t,r,a,c,p){this.type=t,this.operator=r,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,r,a,c){let p=0;if(t.name==="exponential")p=As(r,t.base,a,c);else if(t.name==="linear")p=As(r,1,a,c);else if(t.name==="cubic-bezier"){const _=t.controlPoints;p=new es(_[0],_[1],_[2],_[3]).solve(As(r,1,a,c))}return p}static parse(t,r){let[a,c,p,..._]=t;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const S=c[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:S}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const S=c.slice(1);if(S.length!==4||S.some((I=>typeof I!="number"||I<0||I>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Ge),!p)return null;const v=[];let b=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||r.expectedType==sn?r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType):b=Yt;for(let S=0;S<_.length;S+=2){const I=_[S],L=_[S+1],F=S+3,V=S+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const U=r.parse(L,V,b);if(!U)return null;b=b||U.type,v.push([I,U])}return ni(b,Ge)||ni(b,br)||ni(b,Yt)||ni(b,_n)||ni(b,En)||ni(b,sn)||ni(b,In)||ni(b,tn(Ge))?new Di(b,a,c,p,v):r.error(`Type ${Qr(b)} is not interpolatable.`)}evaluate(t){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return a[0].evaluate(t);const p=r.length;if(c>=r[p-1])return a[p-1].evaluate(t);const _=ko(r,c),v=Di.interpolationFactor(this.interpolation,c,r[_],r[_+1]),b=a[_].evaluate(t),S=a[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Cn(b,S,v);case"color":return Pr.interpolate(b,S,v);case"padding":return kn.interpolate(b,S,v);case"colorArray":return fn.interpolate(b,S,v);case"numberArray":return gn.interpolate(b,S,v);case"variableAnchorOffsetCollection":return pi.interpolate(b,S,v);case"array":return $n(b,S,v);case"projectionDefinition":return jn.interpolate(b,S,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Pr.interpolate(b,S,v,"hcl");case"colorArray":return fn.interpolate(b,S,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Pr.interpolate(b,S,v,"lab");case"colorArray":return fn.interpolate(b,S,v,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function As(n,t,r,a){const c=a-r,p=n-r;return c===0?0:t===1?p/c:(Math.pow(t,p)-1)/(Math.pow(t,c)-1)}const Za={color:Pr.interpolate,number:Cn,padding:kn.interpolate,numberArray:gn.interpolate,colorArray:fn.interpolate,variableAnchorOffsetCollection:pi.interpolate,array:$n};class Es{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=null;const c=r.expectedType;c&&c.kind!=="value"&&(a=c);const p=[];for(const v of t.slice(1)){const b=r.parse(v,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,p.push(b)}if(!a)throw new Error("No output type");const _=c&&p.some((v=>di(c,v.type)));return new Es(_?ur:a,p)}evaluate(t){let r,a=null,c=0;for(const p of this.args)if(c++,a=p.evaluate(t),a&&a instanceof Gn&&!a.available&&(r||(r=a.name),a=null,c===this.args.length&&(a=r)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function zs(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ls(n,t,r,a){return a.compare(t,r)===0}function Ni(n,t,r){const a=n!=="=="&&n!=="!=";return class t0{constructor(p,_,v){this.type=Rt,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const v=p[0];let b=_.parse(p[1],1,ur);if(!b)return null;if(!zs(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Qr(b.type)}'.`);let S=_.parse(p[2],2,ur);if(!S)return null;if(!zs(v,S.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Qr(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${Qr(b.type)}' and '${Qr(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Li(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Li(b.type,[S])));let I=null;if(p.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(p[3],3,rn),!I)return null}return new t0(b,S,I)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const b=Lr(_),S=Lr(v);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new an(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Lr(_),S=Lr(v);if(b.kind!=="string"||S.kind!=="string")return t(p,_,v)}return this.collator?r(p,_,v,this.collator.evaluate(p)):t(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Fh=Ni("==",(function(n,t,r){return t===r}),Ls),yl=Ni("!=",(function(n,t,r){return t!==r}),(function(n,t,r,a){return!Ls(0,t,r,a)})),bp=Ni("<",(function(n,t,r){return t<r}),(function(n,t,r,a){return a.compare(t,r)<0})),zc=Ni(">",(function(n,t,r){return t>r}),(function(n,t,r,a){return a.compare(t,r)>0})),wp=Ni("<=",(function(n,t,r){return t<=r}),(function(n,t,r,a){return a.compare(t,r)<=0})),Tp=Ni(">=",(function(n,t,r){return t>=r}),(function(n,t,r,a){return a.compare(t,r)>=0}));class xl{constructor(t,r,a){this.type=rn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const c=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Rt);if(!c)return null;const p=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Rt);if(!p)return null;let _=null;return a.locale&&(_=r.parse(a.locale,1,At),!_)?null:new xl(c,p,_)}evaluate(t){return new Mn(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Lc{constructor(t,r,a,c,p){this.type=At,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const a=r.parse(t[1],1,Ge);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=r.parse(c.locale,1,At),!p))return null;let _=null;if(c.currency&&(_=r.parse(c.currency,1,At),!_))return null;let v=null;if(c["min-fraction-digits"]&&(v=r.parse(c["min-fraction-digits"],1,Ge),!v))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,Ge),!b)?null:new Lc(a,p,_,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ao{constructor(t){this.type=pn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const c=[];let p=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let b=null;if(v["font-scale"]&&(b=r.parse(v["font-scale"],1,Ge),!b))return null;let S=null;if(v["text-font"]&&(S=r.parse(v["text-font"],1,tn(At)),!S))return null;let I=null;if(v["text-color"]&&(I=r.parse(v["text-color"],1,Yt),!I))return null;let L=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!bn.includes(v["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(L=r.parse(v["vertical-align"],1,At),!L)return null}const F=c[c.length-1];F.scale=b,F.font=S,F.textColor=I,F.verticalAlign=L}else{const b=r.parse(t[_],1,ur);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ao(c)}evaluate(t){return new Sn(this.sections.map((r=>{const a=r.content.evaluate(t);return Lr(a)===dr?new ln("",a,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new ln($r(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Dc{constructor(t){this.type=dr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const a=r.parse(t[1],1,At);return a?new Dc(a):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),a=Gn.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class bl{constructor(t){this.type=Ge,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Qr(a.type)} instead.`):new bl(a):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new an(`Expected value to be of type string or array, but found ${Qr(Lr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Pa=8192;function Cp(n,t){const r=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(r*c*Pa),Math.round(a*c*Pa)]}function wl(n,t){const r=Math.pow(2,t.z);return[(c=(n[0]/Pa+t.x)/r,360*c-180),(a=(n[1]/Pa+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function Ds(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Rs(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Sp(n,t,r){const a=n[0]-t[0],c=n[1]-t[1],p=n[0]-r[0],_=n[1]-r[1];return a*_-p*c==0&&a*p<=0&&c*_<=0}function Tl(n,t,r,a){return(c=[a[0]-r[0],a[1]-r[1]])[0]*(p=[t[0]-n[0],t[1]-n[1]])[1]-c[1]*p[0]!=0&&!(!Nh(n,t,r,a)||!Nh(r,a,n,t));var c,p}function Pp(n,t,r){for(const a of r)for(let c=0;c<a.length-1;++c)if(Tl(n,t,a[c],a[c+1]))return!0;return!1}function Eo(n,t,r=!1){let a=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(Sp(n,v[b],v[b+1]))return r;(p=v[b])[1]>(c=n)[1]!=(_=v[b+1])[1]>c[1]&&c[0]<(_[0]-p[0])*(c[1]-p[1])/(_[1]-p[1])+p[0]&&(a=!a)}var c,p,_;return a}function Oh(n,t){for(const r of t)if(Eo(n,r))return!0;return!1}function Rc(n,t){for(const r of n)if(!Eo(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Pp(n[r],n[r+1],t))return!1;return!0}function Ip(n,t){for(const r of t)if(Rc(n,r))return!0;return!1}function Nh(n,t,r,a){const c=a[0]-r[0],p=a[1]-r[1],_=(n[0]-r[0])*p-c*(n[1]-r[1]),v=(t[0]-r[0])*p-c*(t[1]-r[1]);return _>0&&v<0||_<0&&v>0}function Bc(n,t,r){const a=[];for(let c=0;c<n.length;c++){const p=[];for(let _=0;_<n[c].length;_++){const v=Cp(n[c][_],r);Ds(t,v),p.push(v)}a.push(p)}return a}function jh(n,t,r){const a=[];for(let c=0;c<n.length;c++){const p=Bc(n[c],t,r);a.push(p)}return a}function Cl(n,t,r,a){if(n[0]<r[0]||n[0]>r[2]){const c=.5*a;let p=n[0]-r[0]>c?-a:r[0]-n[0]>c?a:0;p===0&&(p=n[0]-r[2]>c?-a:r[2]-n[0]>c?a:0),n[0]+=p}Ds(t,n)}function Vh(n,t,r,a){const c=Math.pow(2,a.z)*Pa,p=[a.x*Pa,a.y*Pa],_=[];for(const v of n)for(const b of v){const S=[b.x+p[0],b.y+p[1]];Cl(S,t,r,c),_.push(S)}return _}function qh(n,t,r,a){const c=Math.pow(2,a.z)*Pa,p=[a.x*Pa,a.y*Pa],_=[];for(const b of n){const S=[];for(const I of b){const L=[I.x+p[0],I.y+p[1]];Ds(t,L),S.push(L)}_.push(S)}if(t[2]-t[0]<=c/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const S of b)Cl(S,t,r,c)}var v;return _}class zo{constructor(t,r){this.type=Rt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(qa(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const c=[];for(const p of a.features){const{type:_,coordinates:v}=p.geometry;_==="Polygon"&&c.push(v),_==="MultiPolygon"&&c.push(...v)}if(c.length)return new zo(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new zo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new zo(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,a){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(a.type==="Polygon"){const v=Bc(a.coordinates,p,_),b=Vh(r.geometry(),c,p,_);if(!Rs(c,p))return!1;for(const S of b)if(!Eo(S,v))return!1}if(a.type==="MultiPolygon"){const v=jh(a.coordinates,p,_),b=Vh(r.geometry(),c,p,_);if(!Rs(c,p))return!1;for(const S of b)if(!Oh(S,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,a){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(a.type==="Polygon"){const v=Bc(a.coordinates,p,_),b=qh(r.geometry(),c,p,_);if(!Rs(c,p))return!1;for(const S of b)if(!Rc(S,v))return!1}if(a.type==="MultiPolygon"){const v=jh(a.coordinates,p,_),b=qh(r.geometry(),c,p,_);if(!Rs(c,p))return!1;for(const S of b)if(!Ip(S,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Fc=class{constructor(n=[],t=(r,a)=>r<a?-1:r>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,a=t[n];for(;n>0;){const c=n-1>>1,p=t[c];if(r(a,p)>=0)break;t[n]=p,n=c}t[n]=a}_down(n){const{data:t,compare:r}=this,a=this.length>>1,c=t[n];for(;n<a;){let p=1+(n<<1);const _=p+1;if(_<this.length&&r(t[_],t[p])<0&&(p=_),r(t[p],c)>=0)break;t[n]=t[p],n=p}t[n]=c}};function Oc(n,t,r=0,a=n.length-1,c=Mp){for(;a>r;){if(a-r>600){const b=a-r+1,S=t-r+1,I=Math.log(b),L=.5*Math.exp(2*I/3),F=.5*Math.sqrt(I*L*(b-L)/b)*(S-b/2<0?-1:1);Oc(n,t,Math.max(r,Math.floor(t-S*L/b+F)),Math.min(a,Math.floor(t+(b-S)*L/b+F)),c)}const p=n[t];let _=r,v=a;for(Bs(n,r,t),c(n[a],p)>0&&Bs(n,r,a);_<v;){for(Bs(n,_,v),_++,v--;c(n[_],p)<0;)_++;for(;c(n[v],p)>0;)v--}c(n[r],p)===0?Bs(n,r,v):(v++,Bs(n,v,a)),v<=t&&(r=v+1),t<=v&&(a=v-1)}}function Bs(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}function Mp(n,t){return n<t?-1:n>t?1:0}function Fs(n,t){if(n.length<=1)return[n];const r=[];let a,c;for(const p of n){const _=kp(p);_!==0&&(p.area=Math.abs(_),c===void 0&&(c=_<0),c===_<0?(a&&r.push(a),a=[p]):a.push(p))}if(a&&r.push(a),t>1)for(let p=0;p<r.length;p++)r[p].length<=t||(Oc(r[p],t,1,r[p].length-1,Zh),r[p]=r[p].slice(0,t));return r}function Zh(n,t){return t.area-n.area}function kp(n){let t=0;for(let r,a,c=0,p=n.length,_=p-1;c<p;_=c++)r=n[c],a=n[_],t+=(a.x-r.x)*(r.y+a.y);return t}const Uh=1/298.257223563,$h=Uh*(2-Uh),Nc=Math.PI/180;class jc{constructor(t){const r=6378.137*Nc*1e3,a=Math.cos(t*Nc),c=1/(1-$h*(1-a*a)),p=Math.sqrt(c);this.kx=r*p*a,this.ky=r*p*c*(1-$h)}distance(t,r){const a=this.wrap(t[0]-r[0])*this.kx,c=(t[1]-r[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(t,r){let a,c,p,_,v=1/0;for(let b=0;b<t.length-1;b++){let S=t[b][0],I=t[b][1],L=this.wrap(t[b+1][0]-S)*this.kx,F=(t[b+1][1]-I)*this.ky,V=0;L===0&&F===0||(V=(this.wrap(r[0]-S)*this.kx*L+(r[1]-I)*this.ky*F)/(L*L+F*F),V>1?(S=t[b+1][0],I=t[b+1][1]):V>0&&(S+=L/this.kx*V,I+=F/this.ky*V)),L=this.wrap(r[0]-S)*this.kx,F=(r[1]-I)*this.ky;const U=L*L+F*F;U<v&&(v=U,a=S,c=I,p=b,_=V)}return{point:[a,c],index:p,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Gh(n,t){return t[0]-n[0]}function Sl(n){return n[1]-n[0]+1}function Qa(n,t){return n[1]>=n[0]&&n[1]<t}function Pn(n,t){if(n[0]>n[1])return[null,null];const r=Sl(n);if(t){if(r===2)return[n,null];const c=Math.floor(r/2);return[[n[0],n[0]+c],[n[0]+c,n[1]]]}if(r===1)return[n,null];const a=Math.floor(r/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function Vc(n,t){if(!Qa(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Ds(r,n[a]);return r}function qc(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const a of r)Ds(t,a);return t}function Hh(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Zc(n,t,r){if(!Hh(n)||!Hh(t))return NaN;let a=0,c=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(c=n[1]-t[3]),n[3]<t[1]&&(c=t[1]-n[3]),r.distance([0,0],[a,c])}function Lo(n,t,r){const a=r.pointOnLine(t,n);return r.distance(n,a.point)}function Uc(n,t,r,a,c){const p=Math.min(Lo(n,[r,a],c),Lo(t,[r,a],c)),_=Math.min(Lo(r,[n,t],c),Lo(a,[n,t],c));return Math.min(p,_)}function Ap(n,t,r,a,c){if(!Qa(t,n.length)||!Qa(a,r.length))return 1/0;let p=1/0;for(let _=t[0];_<t[1];++_){const v=n[_],b=n[_+1];for(let S=a[0];S<a[1];++S){const I=r[S],L=r[S+1];if(Tl(v,b,I,L))return 0;p=Math.min(p,Uc(v,b,I,L,c))}}return p}function Ep(n,t,r,a,c){if(!Qa(t,n.length)||!Qa(a,r.length))return NaN;let p=1/0;for(let _=t[0];_<=t[1];++_)for(let v=a[0];v<=a[1];++v)if(p=Math.min(p,c.distance(n[_],r[v])),p===0)return p;return p}function zp(n,t,r){if(Eo(n,t,!0))return 0;let a=1/0;for(const c of t){const p=c[0],_=c[c.length-1];if(p!==_&&(a=Math.min(a,Lo(n,[_,p],r)),a===0))return a;const v=r.pointOnLine(c,n);if(a=Math.min(a,r.distance(n,v.point)),a===0)return a}return a}function Lp(n,t,r,a){if(!Qa(t,n.length))return NaN;for(let p=t[0];p<=t[1];++p)if(Eo(n[p],r,!0))return 0;let c=1/0;for(let p=t[0];p<t[1];++p){const _=n[p],v=n[p+1];for(const b of r)for(let S=0,I=b.length,L=I-1;S<I;L=S++){const F=b[L],V=b[S];if(Tl(_,v,F,V))return 0;c=Math.min(c,Uc(_,v,F,V,a))}}return c}function Wh(n,t){for(const r of n)for(const a of r)if(Eo(a,t,!0))return!0;return!1}function Dp(n,t,r,a=1/0){const c=qc(n),p=qc(t);if(a!==1/0&&Zc(c,p,r)>=a)return a;if(Rs(c,p)){if(Wh(n,t))return 0}else if(Wh(t,n))return 0;let _=1/0;for(const v of n)for(let b=0,S=v.length,I=S-1;b<S;I=b++){const L=v[I],F=v[b];for(const V of t)for(let U=0,W=V.length,J=W-1;U<W;J=U++){const le=V[J],Le=V[U];if(Tl(L,F,le,Le))return 0;_=Math.min(_,Uc(L,F,le,Le,r))}}return _}function Xh(n,t,r,a,c,p){if(!p)return;const _=Zc(Vc(a,p),c,r);_<t&&n.push([_,p,[0,0]])}function Pl(n,t,r,a,c,p,_){if(!p||!_)return;const v=Zc(Vc(a,p),Vc(c,_),r);v<t&&n.push([v,p,_])}function Il(n,t,r,a,c=1/0){let p=Math.min(a.distance(n[0],r[0][0]),c);if(p===0)return p;const _=new Fc([[0,[0,n.length-1],[0,0]]],Gh),v=qc(r);for(;_.length>0;){const b=_.pop();if(b[0]>=p)continue;const S=b[1],I=t?50:100;if(Sl(S)<=I){if(!Qa(S,n.length))return NaN;if(t){const L=Lp(n,S,r,a);if(isNaN(L)||L===0)return L;p=Math.min(p,L)}else for(let L=S[0];L<=S[1];++L){const F=zp(n[L],r,a);if(p=Math.min(p,F),p===0)return 0}}else{const L=Pn(S,t);Xh(_,p,a,n,v,L[0]),Xh(_,p,a,n,v,L[1])}}return p}function Ml(n,t,r,a,c,p=1/0){let _=Math.min(p,c.distance(n[0],r[0]));if(_===0)return _;const v=new Fc([[0,[0,n.length-1],[0,r.length-1]]],Gh);for(;v.length>0;){const b=v.pop();if(b[0]>=_)continue;const S=b[1],I=b[2],L=t?50:100,F=a?50:100;if(Sl(S)<=L&&Sl(I)<=F){if(!Qa(S,n.length)&&Qa(I,r.length))return NaN;let V;if(t&&a)V=Ap(n,S,r,I,c),_=Math.min(_,V);else if(t&&!a){const U=n.slice(S[0],S[1]+1);for(let W=I[0];W<=I[1];++W)if(V=Lo(r[W],U,c),_=Math.min(_,V),_===0)return _}else if(!t&&a){const U=r.slice(I[0],I[1]+1);for(let W=S[0];W<=S[1];++W)if(V=Lo(n[W],U,c),_=Math.min(_,V),_===0)return _}else V=Ep(n,S,r,I,c),_=Math.min(_,V)}else{const V=Pn(S,t),U=Pn(I,a);Pl(v,_,c,n,r,V[0],U[0]),Pl(v,_,c,n,r,V[0],U[1]),Pl(v,_,c,n,r,V[1],U[0]),Pl(v,_,c,n,r,V[1],U[1])}}return _}function $c(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class Do{constructor(t,r){this.type=Ge,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(qa(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new Do(a,a.features.map((c=>$c(c.geometry))).flat());if(a.type==="Feature")return new Do(a,$c(a.geometry));if("type"in a&&"coordinates"in a)return new Do(a,$c(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,a){const c=r.geometry(),p=c.flat().map((b=>wl([b.x,b.y],r.canonical)));if(c.length===0)return NaN;const _=new jc(p[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,Ml(p,!1,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Ml(p,!1,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Il(p,!1,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,a){const c=r.geometry(),p=c.flat().map((b=>wl([b.x,b.y],r.canonical)));if(c.length===0)return NaN;const _=new jc(p[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,Ml(p,!0,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Ml(p,!0,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Il(p,!0,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,a){const c=r.geometry();if(c.length===0||c[0].length===0)return NaN;const p=Fs(c,0).map((b=>b.map((S=>S.map((I=>wl([I.x,I.y],r.canonical))))))),_=new jc(p[0][0][0][1]);let v=1/0;for(const b of a)for(const S of p){switch(b.type){case"Point":v=Math.min(v,Il([b.coordinates],!1,S,_,v));break;case"LineString":v=Math.min(v,Il(b.coordinates,!0,S,_,v));break;case"Polygon":v=Math.min(v,Dp(S,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Os{constructor(t){this.type=ur,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=t[1];return a==null?r.error("Global state property must be defined."):typeof a!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Os(a)}evaluate(t){var r;const a=(r=t.globals)===null||r===void 0?void 0:r.globalState;return a&&Object.keys(a).length!==0?sr(a,this.key):null}eachChild(){}outputDefined(){return!1}}const ts={"==":Fh,"!=":yl,">":zc,"<":bp,">=":Tp,"<=":wp,array:Li,at:gl,boolean:Li,case:Qo,coalesce:Es,collator:xl,format:Ao,image:Dc,in:vl,"index-of":Sa,interpolate:Di,"interpolate-hcl":Di,"interpolate-lab":Di,length:bl,let:Ja,literal:_a,match:wi,number:Li,"number-format":Lc,object:Li,slice:Ms,step:ei,string:Li,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:Jo,within:zo,distance:Do,"global-state":Os};class va{constructor(t,r,a,c){this.name=t,this.type=r,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const a=t[0],c=va.definitions[a];if(!c)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,_=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,v=_.filter((([S])=>!Array.isArray(S)||S.length===t.length-1));let b=null;for(const[S,I]of v){b=new Ca(r.registry,kl,r.path,null,r.scope);const L=[];let F=!1;for(let V=1;V<t.length;V++){const U=t[V],W=Array.isArray(S)?S[V-1]:S.type,J=b.parse(U,1+L.length,W);if(!J){F=!0;break}L.push(J)}if(!F)if(Array.isArray(S)&&S.length!==L.length)b.error(`Expected ${S.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const U=Array.isArray(S)?S[V]:S.type,W=L[V];b.concat(V+1).checkSubtype(U,W.type)}if(b.errors.length===0)return new va(a,p,I,L)}}if(v.length===1)r.errors.push(...b.errors);else{const S=(v.length?v:_).map((([L])=>{return F=L,Array.isArray(F)?`(${F.map(Qr).join(", ")})`:`(${Qr(F.type)}...)`;var F})).join(" | "),I=[];for(let L=1;L<t.length;L++){const F=r.parse(t[L],1+I.length);if(!F)return null;I.push(Qr(F.type))}r.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(t,r){va.definitions=r;for(const a in r)t[a]=va}}function Yh(n,[t,r,a,c]){t=t.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const p=c?c.evaluate(n):1,_=zn(t,r,a,p);if(_)throw new an(_);return new Pr(t/255,r/255,a/255,p,!1)}function Kh(n,t){return n in t}function Gc(n,t){const r=t[n];return r===void 0?null:r}function Ro(n){return{type:n}}function kl(n){if(n instanceof Jo)return kl(n.boundExpression);if(n instanceof va&&n.name==="error"||n instanceof xl||n instanceof zo||n instanceof Do||n instanceof Os)return!1;const t=n instanceof sa||n instanceof Li;let r=!0;return n.eachChild((a=>{r=t?r&&kl(a):r&&a instanceof _a})),!!r&&Al(n)&&El(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Al(n){if(n instanceof va&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof zo||n instanceof Do)return!1;let t=!0;return n.eachChild((r=>{t&&!Al(r)&&(t=!1)})),t}function Ns(n){if(n instanceof va&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((r=>{t&&!Ns(r)&&(t=!1)})),t}function El(n,t){if(n instanceof va&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild((a=>{r&&!El(a,t)&&(r=!1)})),r}function Jh(n){return{result:"success",value:n}}function rs(n){return{result:"error",value:n}}function fo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Qh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Hc(n){return!!n.expression&&n.expression.interpolated}function on(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function js(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Lr(n)===Er}function Rp(n){return n}function ed(n,t){const r=n.stops&&typeof n.stops[0][0]=="object",a=r||!(r||n.property!==void 0),c=n.type||(Hc(t)?"exponential":"interval"),p=(function(I){switch(I.type){case"color":return Pr.parse;case"padding":return kn.parse;case"numberArray":return gn.parse;case"colorArray":return fn.parse;default:return null}})(t);if(p&&((n=Hr({},n)).stops&&(n.stops=n.stops.map((I=>[I[0],p(I[1])]))),n.default=p(n.default?n.default:t.default)),n.colorSpace&&(_=n.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var _;const v=(function(I){switch(I){case"exponential":return rd;case"interval":return Bp;case"categorical":return td;case"identity":return Fp;default:throw new Error(`Unknown function type "${I}"`)}})(c);let b,S;if(c==="categorical"){b=Object.create(null);for(const I of n.stops)b[I[0]]=I[1];S=typeof n.stops[0][0]}if(r){const I={},L=[];for(let U=0;U<n.stops.length;U++){const W=n.stops[U],J=W[0].zoom;I[J]===void 0&&(I[J]={zoom:J,type:n.type,property:n.property,default:n.default,stops:[]},L.push(J)),I[J].stops.push([W[0].value,W[1]])}const F=[];for(const U of L)F.push([I[U].zoom,ed(I[U],t)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Di.interpolationFactor.bind(void 0,V),zoomStops:F.map((U=>U[0])),evaluate:({zoom:U},W)=>rd({stops:F,base:n.base},t,U).evaluate(U,W)}}if(a){const I=c==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Di.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map((L=>L[0])),evaluate:({zoom:L})=>v(n,t,L,b,S)}}return{kind:"source",evaluate(I,L){const F=L&&L.properties?L.properties[n.property]:void 0;return F===void 0?mo(n.default,t.default):v(n,t,F,b,S)}}}function mo(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function td(n,t,r,a,c){return mo(typeof r===c?a[r]:void 0,n.default,t.default)}function Bp(n,t,r){if(on(r)!=="number")return mo(n.default,t.default);const a=n.stops.length;if(a===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const c=ko(n.stops.map((p=>p[0])),r);return n.stops[c][1]}function rd(n,t,r){const a=n.base!==void 0?n.base:1;if(on(r)!=="number")return mo(n.default,t.default);const c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];const p=ko(n.stops.map((I=>I[0])),r),_=(function(I,L,F,V){const U=V-F,W=I-F;return U===0?0:L===1?W/U:(Math.pow(L,W)-1)/(Math.pow(L,U)-1)})(r,a,n.stops[p][0],n.stops[p+1][0]),v=n.stops[p][1],b=n.stops[p+1][1],S=Za[t.type]||Rp;return typeof v.evaluate=="function"?{evaluate(...I){const L=v.evaluate.apply(void 0,I),F=b.evaluate.apply(void 0,I);if(L!==void 0&&F!==void 0)return S(L,F,_,n.colorSpace)}}:S(v,b,_,n.colorSpace)}function Fp(n,t,r){switch(t.type){case"color":r=Pr.parse(r);break;case"formatted":r=Sn.fromString(r.toString());break;case"resolvedImage":r=Gn.fromString(r.toString());break;case"padding":r=kn.parse(r);break;case"colorArray":r=fn.parse(r);break;case"numberArray":r=gn.parse(r);break;default:on(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return mo(r,n.default,t.default)}va.register(ts,{error:[{kind:"error"},[At],(n,[t])=>{throw new an(t.evaluate(n))}],typeof:[At,[ur],(n,[t])=>Qr(Lr(t.evaluate(n)))],"to-rgba":[tn(Ge,4),[Yt],(n,[t])=>{const[r,a,c,p]=t.evaluate(n).rgb;return[255*r,255*a,255*c,p]}],rgb:[Yt,[Ge,Ge,Ge],Yh],rgba:[Yt,[Ge,Ge,Ge,Ge],Yh],has:{type:Rt,overloads:[[[At],(n,[t])=>Kh(t.evaluate(n),n.properties())],[[At,Er],(n,[t,r])=>Kh(t.evaluate(n),r.evaluate(n))]]},get:{type:ur,overloads:[[[At],(n,[t])=>Gc(t.evaluate(n),n.properties())],[[At,Er],(n,[t,r])=>Gc(t.evaluate(n),r.evaluate(n))]]},"feature-state":[ur,[At],(n,[t])=>Gc(t.evaluate(n),n.featureState||{})],properties:[Er,[],n=>n.properties()],"geometry-type":[At,[],n=>n.geometryType()],id:[ur,[],n=>n.id()],zoom:[Ge,[],n=>n.globals.zoom],"heatmap-density":[Ge,[],n=>n.globals.heatmapDensity||0],elevation:[Ge,[],n=>n.globals.elevation||0],"line-progress":[Ge,[],n=>n.globals.lineProgress||0],accumulated:[ur,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ge,Ro(Ge),(n,t)=>{let r=0;for(const a of t)r+=a.evaluate(n);return r}],"*":[Ge,Ro(Ge),(n,t)=>{let r=1;for(const a of t)r*=a.evaluate(n);return r}],"-":{type:Ge,overloads:[[[Ge,Ge],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Ge],(n,[t])=>-t.evaluate(n)]]},"/":[Ge,[Ge,Ge],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Ge,[Ge,Ge],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Ge,[],()=>Math.LN2],pi:[Ge,[],()=>Math.PI],e:[Ge,[],()=>Math.E],"^":[Ge,[Ge,Ge],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Ge,[Ge],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Ge,[Ge],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Ge,[Ge],(n,[t])=>Math.log(t.evaluate(n))],log2:[Ge,[Ge],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Ge,[Ge],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Ge,[Ge],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Ge,[Ge],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Ge,[Ge],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Ge,[Ge],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Ge,[Ge],(n,[t])=>Math.atan(t.evaluate(n))],min:[Ge,Ro(Ge),(n,t)=>Math.min(...t.map((r=>r.evaluate(n))))],max:[Ge,Ro(Ge),(n,t)=>Math.max(...t.map((r=>r.evaluate(n))))],abs:[Ge,[Ge],(n,[t])=>Math.abs(t.evaluate(n))],round:[Ge,[Ge],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ge,[Ge],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Ge,[Ge],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Rt,[At,ur],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Rt,[ur],(n,[t])=>n.id()===t.value],"filter-type-==":[Rt,[At],(n,[t])=>n.geometryType()===t.value],"filter-<":[Rt,[At,ur],(n,[t,r])=>{const a=n.properties()[t.value],c=r.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Rt,[ur],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[Rt,[At,ur],(n,[t,r])=>{const a=n.properties()[t.value],c=r.value;return typeof a==typeof c&&a>c}],"filter-id->":[Rt,[ur],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[Rt,[At,ur],(n,[t,r])=>{const a=n.properties()[t.value],c=r.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Rt,[ur],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[Rt,[At,ur],(n,[t,r])=>{const a=n.properties()[t.value],c=r.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Rt,[ur],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[Rt,[ur],(n,[t])=>t.value in n.properties()],"filter-has-id":[Rt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Rt,[tn(At)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Rt,[tn(ur)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Rt,[At,tn(ur)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Rt,[At,tn(ur)],(n,[t,r])=>(function(a,c,p,_){for(;p<=_;){const v=p+_>>1;if(c[v]===a)return!0;c[v]>a?_=v-1:p=v+1}return!1})(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[Ro(Rt),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[Ro(Rt),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Rt,[Rt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Rt,[At],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[At,[At],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[At,[At],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[At,Ro(ur),(n,t)=>t.map((r=>$r(r.evaluate(n)))).join("")],"resolved-locale":[At,[rn],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Wc{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new Is,this._defaultValue=r?(function(a){if(a.type==="color"&&js(a.default))return new Pr(0,0,0,0);switch(a.type){case"color":return Pr.parse(a.default)||null;case"padding":return kn.parse(a.default)||null;case"numberArray":return gn.parse(a.default)||null;case"colorArray":return fn.parse(a.default)||null;case"variableAnchorOffsetCollection":return pi.parse(a.default)||null;case"projectionDefinition":return jn.parse(a.default)||null;default:return a.default===void 0?null:a.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,c,p,_){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,c,p,_){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map((b=>JSON.stringify(b))).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function zl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ts}function Vs(n,t){const r=new Ca(ts,kl,[],t?(function(c){const p={color:Yt,string:At,number:Ge,enum:At,boolean:Rt,formatted:pn,padding:_n,numberArray:En,colorArray:sn,projectionDefinition:br,resolvedImage:dr,variableAnchorOffsetCollection:In};return c.type==="array"?tn(p[c.value]||ur,c.length):p[c.type]})(t):void 0),a=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Jh(new Wc(a,t)):rs(r.errors)}class qs{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Ns(r.expression),this.globalStateRefs=$s(r.expression)}evaluateWithoutErrorHandling(t,r,a,c,p,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,c,p,_)}evaluate(t,r,a,c,p,_){return this._styleExpression.evaluate(t,r,a,c,p,_)}}class Xc{constructor(t,r,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Ns(r.expression),this.globalStateRefs=$s(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,r,a,c,p,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,c,p,_)}evaluate(t,r,a,c,p,_){return this._styleExpression.evaluate(t,r,a,c,p,_)}interpolationFactor(t,r,a){return this.interpolationType?Di.interpolationFactor(this.interpolationType,t,r,a):0}}function nd(n,t){const r=Vs(n,t);if(r.result==="error")return r;const a=r.value.expression,c=Al(a);if(!c&&!fo(t))return rs([new Yr("","data expressions not supported")]);const p=El(a,["zoom"]);if(!p&&!Qh(t))return rs([new Yr("","zoom expressions not supported")]);const _=Us(a);return _||p?_ instanceof Yr?rs([_]):_ instanceof Di&&!Hc(t)?rs([new Yr("",'"interpolate" expressions cannot be used with this property')]):Jh(_?new Xc(c?"camera":"composite",r.value,_.labels,_ instanceof Di?_.interpolation:void 0):new qs(c?"constant":"source",r.value)):rs([new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zs{constructor(t,r){this._parameters=t,this._specification=r,Hr(this,ed(this._parameters,this._specification))}static deserialize(t){return new Zs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Us(n){let t=null;if(n instanceof Ja)t=Us(n.result);else if(n instanceof Es){for(const r of n.args)if(t=Us(r),t)break}else(n instanceof ei||n instanceof Di)&&n.input instanceof va&&n.input.name==="zoom"&&(t=n);return t instanceof Yr||n.eachChild((r=>{const a=Us(r);a instanceof Yr?t=a:!t&&a?t=new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function $s(n,t=new Set){return n instanceof Os&&t.add(n.key),n.eachChild((r=>{$s(r,t)})),t}function Ll(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Ll(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Yc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bo(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ll(n)||(n=Fo(n));const t=Vs(n,Yc);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,a,c)=>t.value.evaluate(r,a,{},c),needGeometry:Dl(n),getGlobalStateRefs:()=>$s(t.value.expression)}}function Kc(n,t){return n<t?-1:n>t?1:0}function Dl(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Dl(n[t]))return!0;return!1}function Fo(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Jc(n[1],n[2],"=="):t==="!="?Rl(Jc(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Jc(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Fo))):t==="all"?["all"].concat(n.slice(1).map(Fo)):t==="none"?["all"].concat(n.slice(1).map(Fo).map(Rl)):t==="in"?id(n[1],n.slice(2)):t==="!in"?Rl(id(n[1],n.slice(2))):t==="has"?ad(n[1]):t!=="!has"||Rl(ad(n[1]));var r}function Jc(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function id(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(Kc)]]:["filter-in-small",n,["literal",t]]}}function ad(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Rl(n){return["!",n]}function Qc(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let c="[";for(const p of n)c+=`${Qc(p)},`;return`${c}]`}const r=Object.keys(n).sort();let a="{";for(let c=0;c<r.length;c++)a+=`${JSON.stringify(r[c])}:${Qc(n[r[c]])},`;return`${a}}`}function Op(n){let t="";for(const r of Ft)t+=`/${Qc(n[r])}`;return t}function eu(n){const t=n.value;return t?[new ht(n.key,t,"constants have been deprecated as of v8")]:[]}function Yn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ua(n){if(Array.isArray(n))return n.map(Ua);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Ua(n[r]);return t}return Yn(n)}function ya(n){const t=n.key,r=n.value,a=n.valueSpec||{},c=n.objectElementValidators||{},p=n.style,_=n.styleSpec,v=n.validateSpec;let b=[];const S=on(r);if(S!=="object")return[new ht(t,r,`object expected, ${S} found`)];for(const I in r){const L=I.split(".")[0],F=sr(a,L)||a["*"];let V;if(sr(c,L))V=c[L];else if(sr(a,L))V=v;else if(c["*"])V=c["*"];else{if(!a["*"]){b.push(new ht(t,r[I],`unknown property "${I}"`));continue}V=v}b=b.concat(V({key:(t&&`${t}.`)+I,value:r[I],valueSpec:F,style:p,styleSpec:_,object:r,objectKey:I,validateSpec:v},r))}for(const I in a)c[I]||a[I].required&&a[I].default===void 0&&r[I]===void 0&&b.push(new ht(t,r,`missing required property "${I}"`));return b}function Bl(n){const t=n.value,r=n.valueSpec,a=n.style,c=n.styleSpec,p=n.key,_=n.arrayElementValidator||n.validateSpec;if(on(t)!=="array")return[new ht(p,t,`array expected, ${on(t)} found`)];if(r.length&&t.length!==r.length)return[new ht(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ht(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let v={type:r.value,values:r.values};c.$version<7&&(v.function=r.function),on(r.value)==="object"&&(v=r.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(_({array:t,arrayIndex:S,value:t[S],valueSpec:v,validateSpec:n.validateSpec,style:a,styleSpec:c,key:`${p}[${S}]`}));return b}function Gs(n){const t=n.key,r=n.value,a=n.valueSpec;let c=on(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new ht(t,r,`number expected, ${c} found`)]:"minimum"in a&&r<a.minimum?[new ht(t,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new ht(t,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function od(n){const t=n.valueSpec,r=Yn(n.value.type);let a,c,p,_={};const v=r!=="categorical"&&n.value.property===void 0,b=!v,S=on(n.value.stops)==="array"&&on(n.value.stops[0])==="array"&&on(n.value.stops[0][0])==="object",I=ya({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(V){if(r==="identity")return[new ht(V.key,V.value,'identity function may not have a "stops" property')];let U=[];const W=V.value;return U=U.concat(Bl({key:V.key,value:W,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),on(W)==="array"&&W.length===0&&U.push(new ht(V.key,W,"array must have at least one stop")),U},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return r==="identity"&&v&&I.push(new ht(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||I.push(new ht(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Hc(n.valueSpec)&&I.push(new ht(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!fo(n.valueSpec)?I.push(new ht(n.key,n.value,"property functions not supported")):v&&!Qh(n.valueSpec)&&I.push(new ht(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!S||n.value.property!==void 0||I.push(new ht(n.key,n.value,'"property" property is required')),I;function L(V){let U=[];const W=V.value,J=V.key;if(on(W)!=="array")return[new ht(J,W,`array expected, ${on(W)} found`)];if(W.length!==2)return[new ht(J,W,`array length 2 expected, length ${W.length} found`)];if(S){if(on(W[0])!=="object")return[new ht(J,W,`object expected, ${on(W[0])} found`)];if(W[0].zoom===void 0)return[new ht(J,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new ht(J,W,"object stop key must have value")];if(p&&p>Yn(W[0].zoom))return[new ht(J,W[0].zoom,"stop zoom values must appear in ascending order")];Yn(W[0].zoom)!==p&&(p=Yn(W[0].zoom),c=void 0,_={}),U=U.concat(ya({key:`${J}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Gs,value:F}}))}else U=U.concat(F({key:`${J}[0]`,value:W[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},W));return zl(Ua(W[1]))?U.concat([new ht(`${J}[1]`,W[1],"expressions are not allowed in function stops.")]):U.concat(V.validateSpec({key:`${J}[1]`,value:W[1],valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function F(V,U){const W=on(V.value),J=Yn(V.value),le=V.value!==null?V.value:U;if(a){if(W!==a)return[new ht(V.key,le,`${W} stop domain type must match previous stop domain type ${a}`)]}else a=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new ht(V.key,le,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&r!=="categorical"){let Le=`number expected, ${W} found`;return fo(t)&&r===void 0&&(Le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(V.key,le,Le)]}return r!=="categorical"||W!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&W==="number"&&c!==void 0&&J<c?[new ht(V.key,le,"stop domain values must appear in ascending order")]:(c=J,r==="categorical"&&J in _?[new ht(V.key,le,"stop domain values must be unique")]:(_[J]=!0,[])):[new ht(V.key,le,`integer expected, found ${J}`)]}}function Oo(n){const t=(n.expressionContext==="property"?nd:Vs)(Ua(n.value),n.valueSpec);if(t.result==="error")return t.value.map((a=>new ht(`${n.key}${a.key}`,n.value,a.message)));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new ht(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Ns(r))return[new ht(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Ns(r))return[new ht(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!El(r,["zoom","feature-state"]))return[new ht(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Al(r))return[new ht(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fl(n){const t=n.key,r=n.value,a=on(r);return a!=="string"?[new ht(t,r,`color expected, ${a} found`)]:Pr.parse(String(r))?[]:[new ht(t,r,`color expected, "${r}" found`)]}function eo(n){const t=n.key,r=n.value,a=n.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(Yn(r))===-1&&c.push(new ht(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Yn(r))===-1&&c.push(new ht(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function tu(n){return Ll(Ua(n.value))?Oo(Hr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):sd(n)}function sd(n){const t=n.value,r=n.key;if(on(t)!=="array")return[new ht(r,t,`array expected, ${on(t)} found`)];const a=n.styleSpec;let c,p=[];if(t.length<1)return[new ht(r,t,"filter array must have at least 1 element")];switch(p=p.concat(eo({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Yn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yn(t[1])==="$type"&&p.push(new ht(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new ht(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=on(t[1]),c!=="string"&&p.push(new ht(`${r}[1]`,t[1],`string expected, ${c} found`)));for(let _=2;_<t.length;_++)c=on(t[_]),Yn(t[1])==="$type"?p=p.concat(eo({key:`${r}[${_}]`,value:t[_],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&p.push(new ht(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)p=p.concat(sd({key:`${r}[${_}]`,value:t[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=on(t[1]),t.length!==2?p.push(new ht(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&p.push(new ht(`${r}[1]`,t[1],`string expected, ${c} found`))}return p}function ld(n,t){const r=n.key,a=n.validateSpec,c=n.style,p=n.styleSpec,_=n.value,v=n.objectKey,b=p[`${t}_${n.layerType}`];if(!b)return[];const S=v.match(/^(.*)-transition$/);if(t==="paint"&&S&&b[S[1]]&&b[S[1]].transition)return a({key:r,value:_,valueSpec:p.transition,style:c,styleSpec:p});const I=n.valueSpec||b[v];if(!I)return[new ht(r,_,`unknown property "${v}"`)];let L;if(on(_)==="string"&&fo(I)&&!I.tokens&&(L=/^{([^}]+)}$/.exec(_)))return[new ht(r,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return n.layerType==="symbol"&&(v==="text-field"&&c&&!c.glyphs&&F.push(new ht(r,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&js(Ua(_))&&Yn(_.type)==="identity"&&F.push(new ht(r,_,'"text-font" does not support identity functions'))),F.concat(a({key:n.key,value:_,valueSpec:I,style:c,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:v}))}function cd(n){return ld(n,"paint")}function ud(n){return ld(n,"layout")}function hd(n){let t=[];const r=n.value,a=n.key,c=n.style,p=n.styleSpec;if(on(r)!=="object")return[new ht(a,r,`object expected, ${on(r)} found`)];r.type||r.ref||t.push(new ht(a,r,'either "type" or "ref" is required'));let _=Yn(r.type);const v=Yn(r.ref);if(r.id){const b=Yn(r.id);for(let S=0;S<n.arrayIndex;S++){const I=c.layers[S];Yn(I.id)===b&&t.push(new ht(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach((S=>{S in r&&t.push(new ht(a,r[S],`"${S}" is prohibited for ref layers`))})),c.layers.forEach((S=>{Yn(S.id)===v&&(b=S)})),b?b.ref?t.push(new ht(a,r.ref,"ref cannot reference another ref layer")):_=Yn(b.type):t.push(new ht(a,r.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(r.source){const b=c.sources&&c.sources[r.source],S=b&&Yn(b.type);b?S==="vector"&&_==="raster"?t.push(new ht(a,r.source,`layer "${r.id}" requires a raster source`)):S!=="raster-dem"&&_==="hillshade"||S!=="raster-dem"&&_==="color-relief"?t.push(new ht(a,r.source,`layer "${r.id}" requires a raster-dem source`)):S==="raster"&&_!=="raster"?t.push(new ht(a,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new ht(a,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||t.push(new ht(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ht(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ht(a,r.source,`source "${r.source}" not found`))}else t.push(new ht(a,r,'missing required property "source"'));return t=t.concat(ya({key:a,value:r,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:r.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:tu,layout:b=>ya({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>ud(Hr({layerType:_},S))}}),paint:b=>ya({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>cd(Hr({layerType:_},S))}})}})),t}function Ia(n){const t=n.value,r=n.key,a=on(t);return a!=="string"?[new ht(r,t,`string expected, ${a} found`)]:[]}const ns={promoteId:function({key:n,value:t}){if(on(t)==="string")return Ia({key:n,value:t});{const r=[];for(const a in t)r.push(...Ia({key:`${n}.${a}`,value:t[a]}));return r}}};function Qi(n){const t=n.value,r=n.key,a=n.styleSpec,c=n.style,p=n.validateSpec;if(!t.type)return[new ht(r,t,'"type" is required')];const _=Yn(t.type);let v;switch(_){case"vector":case"raster":return v=ya({key:r,value:t,valueSpec:a[`source_${_.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:ns,validateSpec:p}),v;case"raster-dem":return v=(function(b){var S;const I=(S=b.sourceName)!==null&&S!==void 0?S:"",L=b.value,F=b.styleSpec,V=F.source_raster_dem,U=b.style;let W=[];const J=on(L);if(L===void 0)return W;if(J!=="object")return W.push(new ht("source_raster_dem",L,`object expected, ${J} found`)),W;const le=Yn(L.encoding)==="custom",Le=["redFactor","greenFactor","blueFactor","baseShift"],ye=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const Ce in L)!le&&Le.includes(Ce)?W.push(new ht(Ce,L[Ce],`In "${I}": "${Ce}" is only valid when "encoding" is set to "custom". ${ye} encoding found`)):V[Ce]?W=W.concat(b.validateSpec({key:Ce,value:L[Ce],valueSpec:V[Ce],validateSpec:b.validateSpec,style:U,styleSpec:F})):W.push(new ht(Ce,L[Ce],`unknown property "${Ce}"`));return W})({sourceName:r,value:t,style:n.style,styleSpec:a,validateSpec:p}),v;case"geojson":if(v=ya({key:r,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:p,objectElementValidators:ns}),t.cluster)for(const b in t.clusterProperties){const[S,I]=t.clusterProperties[b],L=typeof S=="string"?[S,["accumulated"],["get",b]]:S;v.push(...Oo({key:`${r}.${b}.map`,value:I,expressionContext:"cluster-map"})),v.push(...Oo({key:`${r}.${b}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return ya({key:r,value:t,valueSpec:a.source_video,style:c,validateSpec:p,styleSpec:a});case"image":return ya({key:r,value:t,valueSpec:a.source_image,style:c,validateSpec:p,styleSpec:a});case"canvas":return[new ht(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return eo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function is(n){const t=n.value,r=n.styleSpec,a=r.light,c=n.style;let p=[];const _=on(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new ht("light",t,`object expected, ${_} found`)]),p;for(const v in t){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&a[b[1]]&&a[b[1]].transition?n.validateSpec({key:v,value:t[v],valueSpec:r.transition,validateSpec:n.validateSpec,style:c,styleSpec:r}):a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:c,styleSpec:r}):[new ht(v,t[v],`unknown property "${v}"`)])}return p}function ru(n){const t=n.value,r=n.styleSpec,a=r.sky,c=n.style,p=on(t);if(t===void 0)return[];if(p!=="object")return[new ht("sky",t,`object expected, ${p} found`)];let _=[];for(const v in t)_=_.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:c,styleSpec:r}):[new ht(v,t[v],`unknown property "${v}"`)]);return _}function dd(n){const t=n.value,r=n.styleSpec,a=r.terrain,c=n.style;let p=[];const _=on(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new ht("terrain",t,`object expected, ${_} found`)]),p;for(const v in t)p=p.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:c,styleSpec:r}):[new ht(v,t[v],`unknown property "${v}"`)]);return p}function pd(n){let t=[];const r=n.value,a=n.key;if(Array.isArray(r)){const c=[],p=[];for(const _ in r)r[_].id&&c.includes(r[_].id)&&t.push(new ht(a,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),c.push(r[_].id),r[_].url&&p.includes(r[_].url)&&t.push(new ht(a,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),p.push(r[_].url),t=t.concat(ya({key:`${a}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Ia({key:a,value:r})}function as(n){return t=n.value,t&&t.constructor===Object?[]:[new ht(n.key,n.value,`object expected, ${on(n.value)} found`)];var t}const nu={"*":()=>[],array:Bl,boolean:function(n){const t=n.value,r=n.key,a=on(t);return a!=="boolean"?[new ht(r,t,`boolean expected, ${a} found`)]:[]},number:Gs,color:Fl,constants:eu,enum:eo,filter:tu,function:od,layer:hd,object:ya,source:Qi,light:is,sky:ru,terrain:dd,projection:function(n){const t=n.value,r=n.styleSpec,a=r.projection,c=n.style,p=on(t);if(t===void 0)return[];if(p!=="object")return[new ht("projection",t,`object expected, ${p} found`)];let _=[];for(const v in t)_=_.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:c,styleSpec:r}):[new ht(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const a=on(r);return a!=="array"||(function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"})(r)||(function(c){return!!["interpolate","step","literal"].includes(c[0])})(r)?["array","string"].includes(a)?[]:[new ht(t,r,`projection expected, invalid type "${a}" found`)]:[new ht(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Ia,formatted:function(n){return Ia(n).length===0?[]:Oo(n)},resolvedImage:function(n){return Ia(n).length===0?[]:Oo(n)},padding:function(n){const t=n.key,r=n.value;if(on(r)==="array"){if(r.length<1||r.length>4)return[new ht(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let c=[];for(let p=0;p<r.length;p++)c=c.concat(n.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:n.validateSpec,valueSpec:a}));return c}return Gs({key:t,value:r,valueSpec:{}})},numberArray:function(n){const t=n.key,r=n.value;if(on(r)==="array"){const a={type:"number"};if(r.length<1)return[new ht(t,r,"array length at least 1 expected, length 0 found")];let c=[];for(let p=0;p<r.length;p++)c=c.concat(n.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:n.validateSpec,valueSpec:a}));return c}return Gs({key:t,value:r,valueSpec:{}})},colorArray:function(n){const t=n.key,r=n.value;if(on(r)==="array"){if(r.length<1)return[new ht(t,r,"array length at least 1 expected, length 0 found")];let a=[];for(let c=0;c<r.length;c++)a=a.concat(Fl({key:`${t}[${c}]`,value:r[c]}));return a}return Fl({key:t,value:r})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,a=on(r),c=n.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new ht(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let _=0;_<r.length;_+=2)p=p.concat(eo({key:`${t}[${_}]`,value:r[_],valueSpec:c.layout_symbol["text-anchor"]})),p=p.concat(Bl({key:`${t}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:c}));return p},sprite:pd,state:as};function os(n){const t=n.value,r=n.valueSpec,a=n.styleSpec;return n.validateSpec=os,r.expression&&js(Yn(t))?od(n):r.expression&&zl(Ua(t))?Oo(n):r.type&&nu[r.type]?nu[r.type](n):ya(Hr({},n,{valueSpec:r.type?a[r.type]:r}))}function fd(n){const t=n.value,r=n.key,a=Ia(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new ht(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new ht(r,t,'"glyphs" url must include a "{range}" token'))),a}function ea(n,t=xe){let r=[];return r=r.concat(os({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:os,objectElementValidators:{glyphs:fd,"*":()=>[]}})),n.constants&&(r=r.concat(eu({key:"constants",value:n.constants}))),ss(r)}function Ma(n){return function(t){return n({...t,validateSpec:os})}}function ss(n){return[].concat(n).sort(((t,r)=>t.line-r.line))}function ka(n){return function(...t){return ss(n.apply(this,t))}}ea.source=ka(Ma(Qi)),ea.sprite=ka(Ma(pd)),ea.glyphs=ka(Ma(fd)),ea.light=ka(Ma(is)),ea.sky=ka(Ma(ru)),ea.terrain=ka(Ma(dd)),ea.state=ka(Ma(as)),ea.layer=ka(Ma(hd)),ea.filter=ka(Ma(tu)),ea.paintProperty=ka(Ma(cd)),ea.layoutProperty=ka(Ma(ud));const ls=ea,Np=ls.light,Hs=ls.sky,jp=ls.paintProperty,Vp=ls.layoutProperty;function Ws(n,t){let r=!1;if(t&&t.length)for(const a of t)n.fire(new $e(new Error(a.message))),r=!0;return r}class Xs{constructor(t,r,a){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(r=_[1])+2*(a=_[2]);for(let b=0;b<this.d*this.d;b++){const S=_[3+b],I=_[3+b+1];c.push(S===I?null:_.subarray(S,I))}const v=_[3+c.length+1];this.keys=_.subarray(_[3+c.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let _=0;_<this.d*this.d;_++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=a,this.scale=r/t,this.uid=0;const p=a/r*t;this.min=-p,this.max=t+p}insert(t,r,a,c,p){this._forEachCell(r,a,c,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,a,c,p,_){this.cells[p].push(_)}query(t,r,a,c,p){const _=this.min,v=this.max;if(t<=_&&r<=_&&v<=a&&v<=c&&!p)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,r,a,c,this._queryCell,b,{},p),b}}_queryCell(t,r,a,c,p,_,v,b){const S=this.cells[p];if(S!==null){const I=this.keys,L=this.bboxes;for(let F=0;F<S.length;F++){const V=S[F];if(v[V]===void 0){const U=4*V;(b?b(L[U+0],L[U+1],L[U+2],L[U+3]):t<=L[U+2]&&r<=L[U+3]&&a>=L[U+0]&&c>=L[U+1])?(v[V]=!0,_.push(I[V])):v[V]=!1}}}}_forEachCell(t,r,a,c,p,_,v,b){const S=this._convertToCellCoord(t),I=this._convertToCellCoord(r),L=this._convertToCellCoord(a),F=this._convertToCellCoord(c);for(let V=S;V<=L;V++)for(let U=I;U<=F;U++){const W=this.d*U+V;if((!b||b(this._convertFromCellCoord(V),this._convertFromCellCoord(U),this._convertFromCellCoord(V+1),this._convertFromCellCoord(U+1)))&&p.call(this,t,r,a,c,W,_,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let a=0;for(let _=0;_<this.cells.length;_++)a+=this.cells[_].length;const c=new Int32Array(r+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let p=r;for(let _=0;_<t.length;_++){const v=t[_];c[3+_]=p,c.set(v,p),p+=v.length}return c[3+t.length]=p,c.set(this.keys,p),p+=this.keys.length,c[3+t.length+1]=p,c.set(this.bboxes,p),p+=this.bboxes.length,c.buffer}static serialize(t,r){const a=t.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(t){return new Xs(t.buffer)}}const Aa={};function nr(n,t,r={}){if(Aa[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Aa[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}nr("Object",Object),nr("Set",Set),nr("TransferableGridIndex",Xs),nr("Color",Pr),nr("Error",Error),nr("AJAXError",ae),nr("ResolvedImage",Gn),nr("StylePropertyFunction",Zs),nr("StyleExpression",Wc,{omit:["_evaluator"]}),nr("ZoomDependentExpression",Xc),nr("ZoomConstantExpression",qs),nr("CompoundExpression",va,{omit:["_evaluate"]});for(const n in ts)ts[n]._classRegistryKey||nr(`Expression_${n}`,ts[n]);function iu(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ol(n){return n.$name||n.constructor._classRegistryKey}function au(n){return!(function(t){if(t===null||typeof t!="object")return!1;const r=Ol(t);return!(!r||r==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||iu(n)||Qt(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function cs(n,t){if(au(n))return(iu(n)||Qt(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const p=[];for(const _ of n)p.push(cs(_,t));return p}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=Ol(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Aa[r])throw new Error(`${r} is not registered.`);const{klass:a}=Aa[r],c=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in n){if(!n.hasOwnProperty(p)||Aa[r].omit.indexOf(p)>=0)continue;const _=n[p];c[p]=Aa[r].shallow.indexOf(p)>=0?_:cs(_,t)}n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function No(n){if(au(n))return n;if(Array.isArray(n))return n.map(No);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=Ol(n)||"Object";if(!Aa[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Aa[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const a=Object.create(r.prototype);for(const c of Object.keys(n)){if(c==="$name")continue;const p=n[c];a[c]=Aa[t].shallow.indexOf(c)>=0?p:No(p)}return a}class Nl{constructor(){this.first=!0}update(t,r){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const un={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function jl(n){for(const t of n)if(su(t.charCodeAt(0)))return!0;return!1}function qp(n){for(const t of n)if(!md(t.charCodeAt(0)))return!1;return!0}function Vl(n){const t=n.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const Zp=Vl(["Arab","Dupl","Mong","Ougr","Syrc"]);function md(n){return!Zp.test(String.fromCodePoint(n))}const ou=Vl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function su(n){return!(n!==746&&n!==747&&(n<4352||!(un["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||un["CJK Compatibility"](n)||un["CJK Strokes"](n)||!(!un["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||un["Enclosed CJK Letters and Months"](n)||un["Ideographic Description Characters"](n)||un.Kanbun(n)||un.Katakana(n)&&n!==12540||!(!un["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!un["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||un["Vertical Forms"](n)||un["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||ou.test(String.fromCodePoint(n)))))}function _d(n){return!(su(n)||(function(t){return!!(un["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||un["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||un["Letterlike Symbols"](t)||un["Number Forms"](t)||un["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||un["Control Pictures"](t)&&t!==9251||un["Optical Character Recognition"](t)||un["Enclosed Alphanumerics"](t)||un["Geometric Shapes"](t)||un["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||un["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||un["CJK Symbols and Punctuation"](t)||un.Katakana(t)||un["Private Use Area"](t)||un["CJK Compatibility Forms"](t)||un["Small Form Variants"](t)||un["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}const gd=Vl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function lu(n){return gd.test(String.fromCodePoint(n))}function vd(n,t){return!(!t&&lu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||un.Khmer(n))}function yd(n){for(const t of n)if(lu(t.charCodeAt(0)))return!0;return!1}const Ea=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Ea.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,a=new Promise((p=>{this.loadScriptResolve=p}));t(r);const c=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([a,c]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:r};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Un{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new Nl,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Nl,this.transition={},this.globalState={})}isSupportedScript(t){return(function(r,a){for(const c of r)if(!vd(c.charCodeAt(0),a))return!1;return!0})(t,Ea.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class us{constructor(t,r){this.property=t,this.value=r,this.expression=(function(a,c){if(js(a))return new Zs(a,c);if(zl(a)){const p=nd(a,c);if(p.result==="error")throw new Error(p.value.map((_=>`${_.key}: ${_.message}`)).join(", "));return p.value}{let p=a;return c.type==="color"&&typeof a=="string"?p=Pr.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type!=="numberArray"||typeof a!="number"&&!Array.isArray(a)?c.type!=="colorArray"||typeof a!="string"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)?p=pi.parse(a):c.type==="projectionDefinition"&&typeof a=="string"&&(p=jn.parse(a)):p=fn.parse(a):p=gn.parse(a):p=kn.parse(a),{globalStateRefs:new Set,kind:"constant",evaluate:()=>p}}})(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class cu{constructor(t){this.property=t,this.value=new us(t,void 0)}transitioned(t,r){return new uu(this.property,this.value,r,dt({},t.transition,this.transition),t.now)}untransitioned(){return new uu(this.property,this.value,null,{},0)}}class xd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return wt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new cu(this._values[t].property)),this._values[t].value=new us(this._values[t].property,r===null?void 0:wt(r))}getTransition(t){return wt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new cu(this._values[t].property)),this._values[t].transition=wt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(t[r]=a);const c=this.getTransition(r);c!==void 0&&(t[`${r}-transition`]=c)}return t}transitioned(t,r){const a=new hu(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,r._values[c]);return a}untransitioned(){const t=new hu(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class uu{constructor(t,r,a,c,p){this.property=t,this.value=r,this.begin=p+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){const c=t.now||0,p=this.value.possiblyEvaluate(t,r,a),_=this.prior;if(_){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return _.possiblyEvaluate(t,r,a);{const v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,a),p,ot(v))}}return p}}class hu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){const c=new ql(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(t,r,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class bd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return wt(this._values[t].value)}setValue(t,r){this._values[t]=new us(this._values[t].property,r===null?void 0:wt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){const c=new ql(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(t,r,a);return c}}class $a{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,c){return this.property.evaluate(this.value,this.parameters,t,r,a,c)}}class ql{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class yr{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,a){const c=Za[this.specification.type];return c?c(t,r,a):t}}class Or{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,c){return new $a(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,c)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new $a(this,{kind:"constant",value:void 0},t.parameters);const c=Za[this.specification.type];if(c){const p=c(t.value.value,r.value.value,a);return new $a(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,r,a,c,p,_){return t.kind==="constant"?t.value:t.evaluate(r,a,c,p,_)}}class Zl extends Or{possiblyEvaluate(t,r,a,c){if(t.value===void 0)return new $a(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},a,c),_=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(_,_,_,r);return new $a(this,{kind:"constant",value:v},r)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new $a(this,{kind:"constant",value:p},r)}return new $a(this,t.expression,r)}evaluate(t,r,a,c,p,_){if(t.kind==="source"){const v=t.evaluate(r,a,c,p,_);return this._calculate(v,v,v,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,c),t.evaluate({zoom:Math.floor(r.zoom)},a,c),t.evaluate({zoom:Math.floor(r.zoom)+1},a,c),r):t.value}_calculate(t,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class _o{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},a,c);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new Un(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Un(Math.floor(r.zoom),r)),t.expression.evaluate(new Un(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class Ul{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,c){return!!t.expression.evaluate(r,null,{},a,c)}interpolate(){return!1}}class Zi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const a=t[r];a.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new us(a,void 0),p=this.defaultTransitionablePropertyValues[r]=new cu(a);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}nr("DataDrivenProperty",Or),nr("DataConstantProperty",yr),nr("CrossFadedDataDrivenProperty",Zl),nr("CrossFadedProperty",_o),nr("ColorRampProperty",Ul);const wd="-transition";class xa extends Mt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Bo(t.filter)),r.layout&&(this._unevaluatedLayout=new bd(r.layout)),r.paint)){this._transitionablePaint=new xd(r.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ql(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=Bo(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const a=this._unevaluatedLayout._values[r];for(const c of a.getGlobalStateRefs())t.add(c)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,a={}){r!=null&&this._validate(Vp,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(wd)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(jp,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(t.endsWith(wd))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[t],p=c.property.specification["property-type"]==="cross-faded-data-driven",_=c.value.isDataDriven(),v=c.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),It(t,((r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length)))}_validate(t,r,a,c,p={}){return(!p||p.validate!==!1)&&Ws(this,t.call(ls,{key:r,layerType:this.type,objectKey:a,value:c,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof $a&&fo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Up={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ys{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ti(n,t=1){let r=0,a=0;return{members:n.map((c=>{const p=Up[c.type].BYTES_PER_ELEMENT,_=r=$l(r,Math.max(t,p)),v=c.components||1;return a=Math.max(a,p),r+=p*v,{name:c.name,type:c.type,components:v,offset:_}})),size:$l(r,Math.max(a,t)),alignment:t}}function $l(n,t){return Math.ceil(n/t)*t}class hs extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const c=2*t;return this.int16[c+0]=r,this.int16[c+1]=a,t}}hs.prototype.bytesPerElement=4,nr("StructArrayLayout2i4",hs);class ds extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const p=3*t;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=c,t}}ds.prototype.bytesPerElement=6,nr("StructArrayLayout3i6",ds);class du extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,c)}emplace(t,r,a,c,p){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=c,this.int16[_+3]=p,t}}du.prototype.bytesPerElement=8,nr("StructArrayLayout4i8",du);class ps extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,c,p,_)}emplace(t,r,a,c,p,_,v){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,t}}ps.prototype.bytesPerElement=12,nr("StructArrayLayout2i4i12",ps);class jo extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,c,p,_)}emplace(t,r,a,c,p,_,v){const b=4*t,S=8*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[S+4]=c,this.uint8[S+5]=p,this.uint8[S+6]=_,this.uint8[S+7]=v,t}}jo.prototype.bytesPerElement=8,nr("StructArrayLayout2i4ub8",jo);class Ks extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const c=2*t;return this.float32[c+0]=r,this.float32[c+1]=a,t}}Ks.prototype.bytesPerElement=8,nr("StructArrayLayout2f8",Ks);class Gl extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_,v,b,S,I){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,a,c,p,_,v,b,S,I)}emplace(t,r,a,c,p,_,v,b,S,I,L){const F=10*t;return this.uint16[F+0]=r,this.uint16[F+1]=a,this.uint16[F+2]=c,this.uint16[F+3]=p,this.uint16[F+4]=_,this.uint16[F+5]=v,this.uint16[F+6]=b,this.uint16[F+7]=S,this.uint16[F+8]=I,this.uint16[F+9]=L,t}}Gl.prototype.bytesPerElement=20,nr("StructArrayLayout10ui20",Gl);class Vo extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_,v,b,S,I,L,F){const V=this.length;return this.resize(V+1),this.emplace(V,t,r,a,c,p,_,v,b,S,I,L,F)}emplace(t,r,a,c,p,_,v,b,S,I,L,F,V){const U=12*t;return this.int16[U+0]=r,this.int16[U+1]=a,this.int16[U+2]=c,this.int16[U+3]=p,this.uint16[U+4]=_,this.uint16[U+5]=v,this.uint16[U+6]=b,this.uint16[U+7]=S,this.int16[U+8]=I,this.int16[U+9]=L,this.int16[U+10]=F,this.int16[U+11]=V,t}}Vo.prototype.bytesPerElement=24,nr("StructArrayLayout4i4ui4i24",Vo);class pu extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const p=3*t;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=c,t}}pu.prototype.bytesPerElement=12,nr("StructArrayLayout3f12",pu);class fu extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}fu.prototype.bytesPerElement=4,nr("StructArrayLayout1ul4",fu);class Hl extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_,v,b,S){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,a,c,p,_,v,b,S)}emplace(t,r,a,c,p,_,v,b,S,I){const L=10*t,F=5*t;return this.int16[L+0]=r,this.int16[L+1]=a,this.int16[L+2]=c,this.int16[L+3]=p,this.int16[L+4]=_,this.int16[L+5]=v,this.uint32[F+3]=b,this.uint16[L+8]=S,this.uint16[L+9]=I,t}}Hl.prototype.bytesPerElement=20,nr("StructArrayLayout6i1ul2ui20",Hl);class mu extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,c,p,_)}emplace(t,r,a,c,p,_,v){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,t}}mu.prototype.bytesPerElement=12,nr("StructArrayLayout2i2i2i12",mu);class h extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,a,c,p)}emplace(t,r,a,c,p,_){const v=4*t,b=8*t;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=c,this.int16[b+6]=p,this.int16[b+7]=_,t}}h.prototype.bytesPerElement=16,nr("StructArrayLayout2f1f2i16",h);class e extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,c,p,_)}emplace(t,r,a,c,p,_,v){const b=16*t,S=4*t,I=8*t;return this.uint8[b+0]=r,this.uint8[b+1]=a,this.float32[S+1]=c,this.float32[S+2]=p,this.int16[I+6]=_,this.int16[I+7]=v,t}}e.prototype.bytesPerElement=16,nr("StructArrayLayout2ub2f2i16",e);class i extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=c,t}}i.prototype.bytesPerElement=6,nr("StructArrayLayout3ui6",i);class l extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le){const Le=this.length;return this.resize(Le+1),this.emplace(Le,t,r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le)}emplace(t,r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le,Le){const ye=24*t,Ce=12*t,Xe=48*t;return this.int16[ye+0]=r,this.int16[ye+1]=a,this.uint16[ye+2]=c,this.uint16[ye+3]=p,this.uint32[Ce+2]=_,this.uint32[Ce+3]=v,this.uint32[Ce+4]=b,this.uint16[ye+10]=S,this.uint16[ye+11]=I,this.uint16[ye+12]=L,this.float32[Ce+7]=F,this.float32[Ce+8]=V,this.uint8[Xe+36]=U,this.uint8[Xe+37]=W,this.uint8[Xe+38]=J,this.uint32[Ce+10]=le,this.int16[ye+22]=Le,t}}l.prototype.bytesPerElement=48,nr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",l);class u extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le,Le,ye,Ce,Xe,lt,Pt,Xt,Vt,Gt,wr,$t){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,t,r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le,Le,ye,Ce,Xe,lt,Pt,Xt,Vt,Gt,wr,$t)}emplace(t,r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le,Le,ye,Ce,Xe,lt,Pt,Xt,Vt,Gt,wr,$t,Ht){const gt=32*t,jr=16*t;return this.int16[gt+0]=r,this.int16[gt+1]=a,this.int16[gt+2]=c,this.int16[gt+3]=p,this.int16[gt+4]=_,this.int16[gt+5]=v,this.int16[gt+6]=b,this.int16[gt+7]=S,this.uint16[gt+8]=I,this.uint16[gt+9]=L,this.uint16[gt+10]=F,this.uint16[gt+11]=V,this.uint16[gt+12]=U,this.uint16[gt+13]=W,this.uint16[gt+14]=J,this.uint16[gt+15]=le,this.uint16[gt+16]=Le,this.uint16[gt+17]=ye,this.uint16[gt+18]=Ce,this.uint16[gt+19]=Xe,this.uint16[gt+20]=lt,this.uint16[gt+21]=Pt,this.uint16[gt+22]=Xt,this.uint32[jr+12]=Vt,this.float32[jr+13]=Gt,this.float32[jr+14]=wr,this.uint16[gt+30]=$t,this.uint16[gt+31]=Ht,t}}u.prototype.bytesPerElement=64,nr("StructArrayLayout8i15ui1ul2f2ui64",u);class d extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}d.prototype.bytesPerElement=4,nr("StructArrayLayout1f4",d);class g extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const p=3*t;return this.uint16[6*t+0]=r,this.float32[p+1]=a,this.float32[p+2]=c,t}}g.prototype.bytesPerElement=12,nr("StructArrayLayout1ui2f12",g);class w extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const p=4*t;return this.uint32[2*t+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=c,t}}w.prototype.bytesPerElement=8,nr("StructArrayLayout1ul2ui8",w);class C extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const c=2*t;return this.uint16[c+0]=r,this.uint16[c+1]=a,t}}C.prototype.bytesPerElement=4,nr("StructArrayLayout2ui4",C);class P extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}P.prototype.bytesPerElement=2,nr("StructArrayLayout1ui2",P);class A extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,c)}emplace(t,r,a,c,p){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=c,this.float32[_+3]=p,t}}A.prototype.bytesPerElement=16,nr("StructArrayLayout4f16",A);class R extends Ys{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}R.prototype.size=20;class D extends Hl{get(t){return new R(this,t)}}nr("CollisionBoxArray",D);class O extends Ys{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}O.prototype.size=48;class $ extends l{get(t){return new O(this,t)}}nr("PlacedSymbolArray",$);class ee extends Ys{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ee.prototype.size=64;class Q extends u{get(t){return new ee(this,t)}}nr("SymbolInstanceArray",Q);class ne extends d{getoffsetX(t){return this.float32[1*t+0]}}nr("GlyphOffsetArray",ne);class ue extends ds{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}nr("SymbolLineVertexArray",ue);class _e extends Ys{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}_e.prototype.size=12;class he extends g{get(t){return new _e(this,t)}}nr("TextAnchorOffsetArray",he);class we extends Ys{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}we.prototype.size=8;class Pe extends w{get(t){return new we(this,t)}}nr("FeatureIndexArray",Pe);class pe extends hs{}class Be extends hs{}class Qe extends hs{}class Ue extends ps{}class We extends jo{}class Je extends Ks{}class Nt extends Gl{}class Zt extends Vo{}class Tt extends pu{}class mr extends fu{}class Jr extends mu{}class An extends e{}class Bn extends i{}class Ln extends C{}const Hn=ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kn}=Hn;class Kr{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,a,c){const p=this.segments[this.segments.length-1];return t>Kr.MAX_VERTEX_ARRAY_LENGTH&&Dt(`Max vertices per segment is ${Kr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Kr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+t>Kr.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c?this.createNewSegment(r,a,c):p}createNewSegment(t,r,a){const c={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(c.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(t,r,a){return this.prepareSegment(0,t,r,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,c){return new Kr([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function Fn(n,t){return 256*(n=Bt(Math.floor(n),0,255))+Bt(Math.floor(t),0,255)}Kr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nr("SegmentVector",Kr);const si=ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fi,Ti,Ui,za={exports:{}},go={exports:{}},vo={exports:{}},fs=(function(){if(Ui)return za.exports;Ui=1;var n=(fi||(fi=1,go.exports=function(r,a){var c,p,_,v,b,S,I,L;for(p=r.length-(c=3&r.length),_=a,b=3432918353,S=461845907,L=0;L<p;)I=255&r.charCodeAt(L)|(255&r.charCodeAt(++L))<<8|(255&r.charCodeAt(++L))<<16|(255&r.charCodeAt(++L))<<24,++L,_=27492+(65535&(v=5*(65535&(_=(_^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&r.charCodeAt(L+2))<<16;case 2:I^=(255&r.charCodeAt(L+1))<<8;case 1:_^=I=(65535&(I=(I=(65535&(I^=255&r.charCodeAt(L)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),go.exports),t=(Ti||(Ti=1,vo.exports=function(r,a){for(var c,p=r.length,_=a^p,v=0;p>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:_^=(255&r.charCodeAt(v+2))<<16;case 2:_^=(255&r.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),vo.exports);return za.exports=n,za.exports.murmur3=n,za.exports.murmur2=t,za.exports})(),ms=N(fs);class qo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,c){this.ids.push(Zo(t)),this.positions.push(r,a,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Zo(t);let a=0,c=this.ids.length-1;for(;a<c;){const _=a+c>>1;this.ids[_]>=r?c=_:a=_+1}const p=[];for(;this.ids[a]===r;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(t,r){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return ta(a,c,0,a.length-1),r&&r.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const r=new qo;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Zo(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ms(String(n))}function ta(n,t,r,a){for(;r<a;){const c=n[r+a>>1];let p=r-1,_=a+1;for(;;){do p++;while(n[p]<c);do _--;while(n[_]>c);if(p>=_)break;La(n,p,_),La(t,3*p,3*_),La(t,3*p+1,3*_+1),La(t,3*p+2,3*_+2)}_-r<a-_?(ta(n,t,r,_),r=_+1):(ta(n,t,_+1,a),a=_)}}function La(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}nr("FeaturePositionMap",qo);class $i{constructor(t,r){this.gl=t.gl,this.location=r}}class yo extends $i{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class li extends $i{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class mi extends $i{constructor(t,r){super(t,r),this.current=Pr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ba=new Float32Array(16);function ci(n){return[Fn(255*n.r,255*n.g),Fn(255*n.b,255*n.a)]}class Js{constructor(t,r,a){this.value=t,this.uniformNames=r.map((c=>`u_${c}`)),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new mi(t,r):new yo(t,r)}}class _s{constructor(t,r){this.uniformNames=r.map((a=>`u_${a}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,a,c){const p=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,a){return a.substr(0,9)==="u_pattern"?new li(t,r):new yo(t,r)}}class to{constructor(t,r,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map((p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(t,r,a,c,p){const _=this.paintVertexArray.length,v=this.expression.evaluate(new Un(0),r,{},c,[],p);this.paintVertexArray.resize(t),this._setPaintValue(_,t,v)}updatePaintArray(t,r,a,c){const p=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(t,r,p)}_setPaintValue(t,r,a){if(this.type==="color"){const c=ci(a);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(t,r,a,c,p,_){this.expression=t,this.uniformNames=r.map((v=>`u_${v}_t`)),this.type=a,this.useIntegerZoom=c,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map((v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,r,a,c,p){const _=this.expression.evaluate(new Un(this.zoom),r,{},c,[],p),v=this.expression.evaluate(new Un(this.zoom+1),r,{},c,[],p),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,_,v)}updatePaintArray(t,r,a,c){const p=this.expression.evaluate({zoom:this.zoom},a,c),_=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(t,r,p,_)}_setPaintValue(t,r,a,c){if(this.type==="color"){const p=ci(a),_=ci(c);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Bt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,r,a){return new yo(t,r)}}class xo{constructor(t,r,a,c,p,_){this.expression=t,this.type=r,this.useIntegerZoom=a,this.zoom=c,this.layerId=_,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,r,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,c,p){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(t,r,a,c){if(!c||!a)return;const{min:p,mid:_,max:v}=a,b=c[p],S=c[_],I=c[v];if(b&&S&&I)for(let L=t;L<r;L++)this.zoomInPaintVertexArray.emplace(L,S.tl[0],S.tl[1],S.br[0],S.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],S.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,S.tl[0],S.tl[1],S.br[0],S.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],S.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,si.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,si.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Td{constructor(t,r,a){this.binders={},this._buffers=[];const c=[];for(const p in t.paint._values){if(!a(p))continue;const _=t.paint.get(p);if(!(_ instanceof $a&&fo(_.property.specification)))continue;const v=Cd(p,t.type),b=_.value,S=_.property.specification.type,I=_.property.useIntegerZoom,L=_.property.specification["property-type"],F=L==="cross-faded"||L==="cross-faded-data-driven";if(b.kind==="constant")this.binders[p]=F?new _s(b.value,v):new Js(b.value,v,S),c.push(`/u_${p}`);else if(b.kind==="source"||F){const V=_u(p,S,"source");this.binders[p]=F?new xo(b,S,I,r,V,t.id):new to(b,v,S,V),c.push(`/a_${p}`)}else{const V=_u(p,S,"composite");this.binders[p]=new Da(b,v,S,I,r,V),c.push(`/z_${p}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof to||r instanceof Da?r.maxValue:0}populatePaintArrays(t,r,a,c,p){for(const _ in this.binders){const v=this.binders[_];(v instanceof to||v instanceof Da||v instanceof xo)&&v.populatePaintArray(t,r,a,c,p)}}setConstantPatternPositions(t,r){for(const a in this.binders){const c=this.binders[a];c instanceof _s&&c.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,c,p){let _=!1;for(const v in t){const b=r.getPositions(v);for(const S of b){const I=a.feature(S.index);for(const L in this.binders){const F=this.binders[L];if((F instanceof to||F instanceof Da||F instanceof xo)&&F.expression.isStateDependent===!0){const V=c.paint.get(L);F.expression=V.value,F.updatePaintArray(S.start,S.end,I,t[v],p),_=!0}}}}return _}defines(){const t=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Js||a instanceof _s)&&t.push(...a.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof to||a instanceof Da)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name);else if(a instanceof xo)for(let c=0;c<si.members.length;c++)t.push(si.members[c].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Js||a instanceof _s||a instanceof Da)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const a=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Js||p instanceof _s||p instanceof Da){for(const _ of p.uniformNames)if(r[_]){const v=p.getBinding(t,r[_],_);a.push({name:_,property:c,binding:v})}}}return a}setUniforms(t,r,a,c){for(const{name:p,property:_,binding:v}of r)this.binders[_].setUniform(v,c,a.get(_),p)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(t&&a instanceof xo){const c=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof to||a instanceof Da)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const r in this.binders){const a=this.binders[r];(a instanceof to||a instanceof Da||a instanceof xo)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof to||r instanceof Da||r instanceof xo)&&r.destroy()}}}class la{constructor(t,r,a=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Td(c,r,a);this.needsUpload=!1,this._featureMap=new qo,this._bufferOffset=0}populatePaintArrays(t,r,a,c,p,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,r,c,p,_);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,c){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,r,p,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Cd(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function _u(n,t,r){const a={color:{source:Ks,composite:A},number:{source:d,composite:Ks}},c=(function(p){return{"line-pattern":{source:Nt,composite:Nt},"fill-pattern":{source:Nt,composite:Nt},"fill-extrusion-pattern":{source:Nt,composite:Nt}}[p]})(n);return c&&c[r]||a[t][r]}nr("ConstantBinder",Js),nr("CrossFadedConstantBinder",_s),nr("SourceExpressionBinder",to),nr("CrossFadedCompositeBinder",xo),nr("CompositeExpressionBinder",Da),nr("ProgramConfiguration",Td,{omit:["_buffers"]}),nr("ProgramConfigurationSet",la);const Wl=Math.pow(2,14)-1,Xl=-Wl-1;function bo(n){const t=oe/n.extent,r=n.loadGeometry();for(let a=0;a<r.length;a++){const c=r[a];for(let p=0;p<c.length;p++){const _=c[p],v=Math.round(_.x*t),b=Math.round(_.y*t);_.x=Bt(v,Xl,Wl),_.y=Bt(b,Xl,Wl),(v<_.x||v>_.x+1||b<_.y||b>_.y+1)&&Dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ro(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?bo(n):[]}}const u_=-32768;function Y0(n,t,r,a,c){n.emplaceBack(u_+8*t+a,u_+8*r+c)}class $p{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.indexArray=new Bn,this.segments=new Kr,this.programConfigurations=new la(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,a){const c=this.layers[0],p=[];let _=null,v=!1,b=c.type==="heatmap";if(c.type==="circle"){const I=c;_=I.layout.get("circle-sort-key"),v=!_.isConstant(),b=b||I.paint.get("circle-pitch-alignment")==="map"}const S=b?r.subdivisionGranularity.circle:1;for(const{feature:I,id:L,index:F,sourceLayerIndex:V}of t){const U=this.layers[0]._featureFilter.needGeometry,W=ro(I,U);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{globalState:this.globalState}),W,a))continue;const J=v?_.evaluate(W,{},a):void 0,le={id:L,properties:I.properties,type:I.type,sourceLayerIndex:V,index:F,geometry:U?W.geometry:bo(I),patterns:{},sortKey:J};p.push(le)}v&&p.sort(((I,L)=>I.sortKey-L.sortKey));for(const I of p){const{geometry:L,index:F,sourceLayerIndex:V}=I,U=t[F].feature;this.addFeature(I,L,F,a,S),r.featureIndex.insert(U,L,F,V,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,c,p=1){let _;switch(p){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const b of r)for(const S of b){const I=S.x,L=S.y;if(I<0||I>=oe||L<0||L>=oe)continue;const F=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),V=F.vertexLength;for(let U=0;U<v;U++)for(let W=0;W<v;W++)Y0(this.layoutVertexArray,I,L,_[W],_[U]);for(let U=0;U<v-1;U++)for(let W=0;W<v-1;W++){const J=V+U*v+W,le=V+(U+1)*v+W;this.indexArray.emplaceBack(J,le+1,J+1),this.indexArray.emplaceBack(J,le,le+1)}F.vertexLength+=v*v,F.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c)}}function h_(n,t){for(let r=0;r<n.length;r++)if(Yl(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Yl(n,t[r]))return!0;return!!Gp(n,t)}function K0(n,t,r){return!!Yl(n,t)||!!Hp(t,n,r)}function d_(n,t){if(n.length===1)return f_(t,n[0]);for(let r=0;r<t.length;r++){const a=t[r];for(let c=0;c<a.length;c++)if(Yl(n,a[c]))return!0}for(let r=0;r<n.length;r++)if(f_(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Gp(n,t[r]))return!0;return!1}function J0(n,t,r){if(n.length>1){if(Gp(n,t))return!0;for(let a=0;a<t.length;a++)if(Hp(t[a],n,r))return!0}for(let a=0;a<n.length;a++)if(Hp(n[a],t,r))return!0;return!1}function Gp(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const a=n[r],c=n[r+1];for(let p=0;p<t.length-1;p++)if(Q0(a,c,t[p],t[p+1]))return!0}return!1}function Q0(n,t,r,a){return zt(n,r,a)!==zt(t,r,a)&&zt(n,t,r)!==zt(n,t,a)}function Hp(n,t,r){const a=r*r;if(t.length===1)return n.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(p_(n,t[c-1],t[c])<a)return!0;return!1}function p_(n,t,r){const a=t.distSqr(r);if(a===0)return n.distSqr(t);const c=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/a;return n.distSqr(c<0?t:c>1?r:r.sub(t)._mult(c)._add(t))}function f_(n,t){let r,a,c,p=!1;for(let _=0;_<n.length;_++){r=n[_];for(let v=0,b=r.length-1;v<r.length;b=v++)a=r[v],c=r[b],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(p=!p)}return p}function Yl(n,t){let r=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const p=n[a],_=n[c];p.y>t.y!=_.y>t.y&&t.x<(_.x-p.x)*(t.y-p.y)/(_.y-p.y)+p.x&&(r=!r)}return r}function ey(n,t,r){const a=r[0],c=r[2];if(n.x<a.x&&t.x<a.x||n.x>c.x&&t.x>c.x||n.y<a.y&&t.y<a.y||n.y>c.y&&t.y>c.y)return!1;const p=zt(n,t,r[0]);return p!==zt(n,t,r[1])||p!==zt(n,t,r[2])||p!==zt(n,t,r[3])}function gu(n,t,r){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Sd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Pd(n,t,r,a,c){if(!t[0]&&!t[1])return n;const p=B.convert(t)._mult(c);r==="viewport"&&p._rotate(-a);const _=[];for(let v=0;v<n.length;v++)_.push(n[v].sub(p));return _}let m_,__;nr("CircleBucket",$p,{omit:["layers"]});var ty={get paint(){return __=__||new Zi({"circle-radius":new Or(xe.paint_circle["circle-radius"]),"circle-color":new Or(xe.paint_circle["circle-color"]),"circle-blur":new Or(xe.paint_circle["circle-blur"]),"circle-opacity":new Or(xe.paint_circle["circle-opacity"]),"circle-translate":new yr(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new yr(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yr(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yr(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Or(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Or(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Or(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return m_=m_||new Zi({"circle-sort-key":new Or(xe.layout_circle["circle-sort-key"])})}};class ry extends xa{constructor(t){super(t,ty)}createBucket(t){return new $p(t)}queryRadius(t){const r=t;return gu("circle-radius",this,r)+gu("circle-stroke-width",this,r)+Sd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:a,geometry:c,transform:p,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){const S=Pd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,_),I=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),L=this.paint.get("circle-pitch-alignment")==="map",F=L?S:(function(U,W,J,le){return U.map((Le=>g_(Le,W,J,le)))})(S,p,v,b),V=L?I*_:I;for(const U of c)for(const W of U){const J=L?W:g_(W,p,v,b);let le=V;const Le=p.projectTileCoordinates(W.x,W.y,v,b).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=Le/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=p.cameraToCenterDistance/Le),K0(F,J,le))return!0}return!1}}function g_(n,t,r,a){const c=t.projectTileCoordinates(n.x,n.y,r,a).point;return new B((.5*c.x+.5)*t.width,(.5*-c.y+.5)*t.height)}class v_ extends $p{}let y_;nr("HeatmapBucket",v_,{omit:["layers"]});var ny={get paint(){return y_=y_||new Zi({"heatmap-radius":new Or(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Or(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yr(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ul(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yr(xe.paint_heatmap["heatmap-opacity"])})}};function Wp(n,{width:t,height:r},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*r*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*r*a}`)}else c=new Uint8Array(t*r*a);return n.width=t,n.height=r,n.data=c,n}function x_(n,{width:t,height:r},a){if(t===n.width&&r===n.height)return;const c=Wp({},{width:t,height:r},a);Xp(n,c,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},a),n.width=t,n.height=r,n.data=c.data}function Xp(n,t,r,a,c,p){if(c.width===0||c.height===0)return t;if(c.width>n.width||c.height>n.height||r.x>n.width-c.width||r.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<c.height;b++){const S=((r.y+b)*n.width+r.x)*p,I=((a.y+b)*t.width+a.x)*p;for(let L=0;L<c.width*p;L++)v[I+L]=_[S+L]}return t}class vu{constructor(t,r){Wp(this,t,1,r)}resize(t){x_(this,t,1)}clone(){return new vu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,c,p){Xp(t,r,a,c,p,1)}}class ca{constructor(t,r){Wp(this,t,4,r)}resize(t){x_(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ca({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,c,p){Xp(t,r,a,c,p,4)}setPixel(t,r,a){const c=4*(t*this.width+r);this.data[c+0]=Math.round(255*a.r/a.a),this.data[c+1]=Math.round(255*a.g/a.a),this.data[c+2]=Math.round(255*a.b/a.a),this.data[c+3]=Math.round(255*a.a)}}function b_(n){const t={},r=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new ca({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(_,v,b)=>{t[n.evaluationKey]=b;const S=n.expression.evaluate(t);c.setPixel(_/4/r,v/4,S)};if(n.clips)for(let _=0,v=0;_<a;++_,v+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const I=b/(r-1),{start:L,end:F}=n.clips[_];p(v,S,L*(1-I)+F*I)}else for(let _=0,v=0;_<r;_++,v+=4)p(0,v,_/(r-1));return c}nr("AlphaImage",vu),nr("RGBAImage",ca);const Yp="big-fb";class iy extends xa{createBucket(t){return new v_(t)}constructor(t){super(t,ny),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=b_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Yp)&&this.heatmapFbos.delete(Yp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let w_;var ay={get paint(){return w_=w_||new Zi({"hillshade-illumination-direction":new yr(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new yr(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new yr(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yr(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yr(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yr(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yr(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new yr(xe.paint_hillshade["hillshade-method"])})}};class oy extends xa{constructor(t){super(t,ay),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,c=this.paint.get("hillshade-shadow-color").values;const p=Math.max(t.length,r.length,a.length,c.length);t=t.concat(Array(p-t.length).fill(t.at(-1))),r=r.concat(Array(p-r.length).fill(r.at(-1))),a=a.concat(Array(p-a.length).fill(a.at(-1))),c=c.concat(Array(p-c.length).fill(c.at(-1)));const _=r.map(Kt);return{directionRadians:t.map(Kt),altitudeRadians:_,shadowColor:c,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let T_;var sy={get paint(){return T_=T_||new Zi({"color-relief-opacity":new yr(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Ul(xe["paint_color-relief"]["color-relief-color"])})}};class Kp{constructor(t,r,a,c){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(r,c)}update(t,r,a){const{width:c,height:p}=t,_=!(this.size&&this.size[0]===c&&this.size[1]===p||a),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(r&&r.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[c,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Qt(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,c,p,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:S,y:I}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Qt(t)?b.texSubImage2D(b.TEXTURE_2D,0,S,I,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,S,I,c,p,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,a){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),a!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,a||t),this.filter=t),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class C_{constructor(t,r,a,c=1,p=1,_=1,v=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Dt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=p,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<b;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(b,S)]=this.data[this._idx(b-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,b)]=this.data[this._idx(S,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<b;S++)for(let I=0;I<b;I++){const L=this.get(S,I);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(t,r){const a=new Uint8Array(this.data.buffer),c=4*this._idx(t,r);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,a){return t*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}pack(t){return S_(t,this.getUnpackVector())}getPixels(){return new ca({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,p=r*this.dim+this.dim,_=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:c=p-1;break;case 1:p=c+1}switch(a){case-1:_=v-1;break;case 1:v=_+1}const b=-r*this.dim,S=-a*this.dim;for(let I=_;I<v;I++)for(let L=c;L<p;L++)this.data[this._idx(L,I)]=t.data[this._idx(L+b,I+S)]}}function S_(n,t){const r=t[0],a=t[1],c=t[2],p=t[3],_=Math.min(r,a,c),v=Math.round((n+p)/_);return{r:Math.floor(v*_/r)%256,g:Math.floor(v*_/a)%256,b:Math.floor(v*_/c)%256}}nr("DEMData",C_);class ly extends xa{constructor(t){super(t,sy)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},a=this._transitionablePaint._values["color-relief-color"].value.expression;if(a instanceof qs&&a._styleExpression.expression instanceof Di){this.colorRampExpression=a;const _=a._styleExpression.expression;r.elevationStops=_.labels,r.colorStops=[];for(const v of r.elevationStops)r.colorStops.push(_.evaluate({globals:{elevation:v}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Pr.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const c={elevationStops:[],colorStops:[]},p=(r.elevationStops.length-1)/(t-1);for(let _=0;_<r.elevationStops.length-.5;_+=p)c.elevationStops.push(r.elevationStops[Math.round(_)]),c.colorStops.push(r.colorStops[Math.round(_)]);return Dt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),c}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,a){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const c=this._createColorRamp(r),p=new ca({width:c.colorStops.length,height:1}),_=new ca({width:c.colorStops.length,height:1});for(let v=0;v<c.elevationStops.length;v++){const b=S_(c.elevationStops[v],a);_.setPixel(0,v,new Pr(b.r/255,b.g/255,b.b/255,1)),p.setPixel(0,v,c.colorStops[v])}return this.colorRampTextures={elevationTexture:new Kp(t,_,t.gl.RGBA),colorTexture:new Kp(t,p,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const cy=ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:uy}=cy;function Jp(n,t,r){const a=r.patternDependencies;let c=!1;for(const p of t){const _=p.paint.get(`${n}-pattern`);_.isConstant()||(c=!0);const v=_.constantOr(null);v&&(c=!0,a[v.to]=!0,a[v.from]=!0)}return c}function Qp(n,t,r,a,c){const p=c.patternDependencies;for(const _ of t){const v=_.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},r,{},c.availableImages),S=v.evaluate({zoom:a},r,{},c.availableImages),I=v.evaluate({zoom:a+1},r,{},c.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,p[b]=!0,p[S]=!0,p[I]=!0,r.patterns[_.id]={min:b,mid:S,max:I}}}return r}function P_(n,t,r,a,c){let p;if(c===(function(_,v,b,S){let I=0;for(let L=v,F=b-S;L<b;L+=S)I+=(_[F]-_[L])*(_[L+1]+_[F+1]),F=L;return I})(n,t,r,a)>0)for(let _=t;_<r;_+=a)p=A_(_/a|0,n[_],n[_+1],p);else for(let _=r-a;_>=t;_-=a)p=A_(_/a|0,n[_],n[_+1],p);return p&&Kl(p,p.next)&&(wu(p),p=p.next),p}function Qs(n,t){if(!n)return n;t||(t=n);let r,a=n;do if(r=!1,a.steiner||!Kl(a,a.next)&&ii(a.prev,a,a.next)!==0)a=a.next;else{if(wu(a),a=t=a.prev,a===a.next)break;r=!0}while(r||a!==t);return t}function yu(n,t,r,a,c,p,_){if(!n)return;!_&&p&&(function(b,S,I,L){let F=b;do F.z===0&&(F.z=ef(F.x,F.y,S,I,L)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==b);F.prevZ.nextZ=null,F.prevZ=null,(function(V){let U,W=1;do{let J,le=V;V=null;let Le=null;for(U=0;le;){U++;let ye=le,Ce=0;for(let lt=0;lt<W&&(Ce++,ye=ye.nextZ,ye);lt++);let Xe=W;for(;Ce>0||Xe>0&&ye;)Ce!==0&&(Xe===0||!ye||le.z<=ye.z)?(J=le,le=le.nextZ,Ce--):(J=ye,ye=ye.nextZ,Xe--),Le?Le.nextZ=J:V=J,J.prevZ=Le,Le=J;le=ye}Le.nextZ=null,W*=2}while(U>1)})(F)})(n,a,c,p);let v=n;for(;n.prev!==n.next;){const b=n.prev,S=n.next;if(p?dy(n,a,c,p):hy(n))t.push(b.i,n.i,S.i),wu(n),n=S.next,v=S.next;else if((n=S)===v){_?_===1?yu(n=py(Qs(n),t),t,r,a,c,p,2):_===2&&fy(n,t,r,a,c,p):yu(Qs(n),t,r,a,c,p,1);break}}}function hy(n){const t=n.prev,r=n,a=n.next;if(ii(t,r,a)>=0)return!1;const c=t.x,p=r.x,_=a.x,v=t.y,b=r.y,S=a.y,I=Math.min(c,p,_),L=Math.min(v,b,S),F=Math.max(c,p,_),V=Math.max(v,b,S);let U=a.next;for(;U!==t;){if(U.x>=I&&U.x<=F&&U.y>=L&&U.y<=V&&xu(c,v,p,b,_,S,U.x,U.y)&&ii(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function dy(n,t,r,a){const c=n.prev,p=n,_=n.next;if(ii(c,p,_)>=0)return!1;const v=c.x,b=p.x,S=_.x,I=c.y,L=p.y,F=_.y,V=Math.min(v,b,S),U=Math.min(I,L,F),W=Math.max(v,b,S),J=Math.max(I,L,F),le=ef(V,U,t,r,a),Le=ef(W,J,t,r,a);let ye=n.prevZ,Ce=n.nextZ;for(;ye&&ye.z>=le&&Ce&&Ce.z<=Le;){if(ye.x>=V&&ye.x<=W&&ye.y>=U&&ye.y<=J&&ye!==c&&ye!==_&&xu(v,I,b,L,S,F,ye.x,ye.y)&&ii(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Ce.x>=V&&Ce.x<=W&&Ce.y>=U&&Ce.y<=J&&Ce!==c&&Ce!==_&&xu(v,I,b,L,S,F,Ce.x,Ce.y)&&ii(Ce.prev,Ce,Ce.next)>=0))return!1;Ce=Ce.nextZ}for(;ye&&ye.z>=le;){if(ye.x>=V&&ye.x<=W&&ye.y>=U&&ye.y<=J&&ye!==c&&ye!==_&&xu(v,I,b,L,S,F,ye.x,ye.y)&&ii(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Ce&&Ce.z<=Le;){if(Ce.x>=V&&Ce.x<=W&&Ce.y>=U&&Ce.y<=J&&Ce!==c&&Ce!==_&&xu(v,I,b,L,S,F,Ce.x,Ce.y)&&ii(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.nextZ}return!0}function py(n,t){let r=n;do{const a=r.prev,c=r.next.next;!Kl(a,c)&&M_(a,r,r.next,c)&&bu(a,c)&&bu(c,a)&&(t.push(a.i,r.i,c.i),wu(r),wu(r.next),r=n=c),r=r.next}while(r!==n);return Qs(r)}function fy(n,t,r,a,c,p){let _=n;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&yy(_,v)){let b=k_(_,v);return _=Qs(_,_.next),b=Qs(b,b.next),yu(_,t,r,a,c,p,0),void yu(b,t,r,a,c,p,0)}v=v.next}_=_.next}while(_!==n)}function my(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function _y(n,t){const r=(function(c,p){let _=p;const v=c.x,b=c.y;let S,I=-1/0;if(Kl(c,_))return _;do{if(Kl(c,_.next))return _.next;if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){const W=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(W<=v&&W>I&&(I=W,S=_.x<_.next.x?_:_.next,W===v))return S}_=_.next}while(_!==p);if(!S)return null;const L=S,F=S.x,V=S.y;let U=1/0;_=S;do{if(v>=_.x&&_.x>=F&&v!==_.x&&I_(b<V?v:I,b,F,V,b<V?I:v,b,_.x,_.y)){const W=Math.abs(b-_.y)/(v-_.x);bu(_,c)&&(W<U||W===U&&(_.x>S.x||_.x===S.x&&gy(S,_)))&&(S=_,U=W)}_=_.next}while(_!==L);return S})(n,t);if(!r)return t;const a=k_(r,n);return Qs(a,a.next),Qs(r,r.next)}function gy(n,t){return ii(n.prev,n,t.prev)<0&&ii(t.next,n,n.next)<0}function ef(n,t,r,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function vy(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function I_(n,t,r,a,c,p,_,v){return(c-_)*(t-v)>=(n-_)*(p-v)&&(n-_)*(a-v)>=(r-_)*(t-v)&&(r-_)*(p-v)>=(c-_)*(a-v)}function xu(n,t,r,a,c,p,_,v){return!(n===_&&t===v)&&I_(n,t,r,a,c,p,_,v)}function yy(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(r,a){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==a.i&&c.next.i!==a.i&&M_(c,c.next,r,a))return!0;c=c.next}while(c!==r);return!1})(n,t)&&(bu(n,t)&&bu(t,n)&&(function(r,a){let c=r,p=!1;const _=(r.x+a.x)/2,v=(r.y+a.y)/2;do c.y>v!=c.next.y>v&&c.next.y!==c.y&&_<(c.next.x-c.x)*(v-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==r);return p})(n,t)&&(ii(n.prev,n,t.prev)||ii(n,t.prev,t))||Kl(n,t)&&ii(n.prev,n,n.next)>0&&ii(t.prev,t,t.next)>0)}function ii(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function Kl(n,t){return n.x===t.x&&n.y===t.y}function M_(n,t,r,a){const c=Md(ii(n,t,r)),p=Md(ii(n,t,a)),_=Md(ii(r,a,n)),v=Md(ii(r,a,t));return c!==p&&_!==v||!(c!==0||!Id(n,r,t))||!(p!==0||!Id(n,a,t))||!(_!==0||!Id(r,n,a))||!(v!==0||!Id(r,t,a))}function Id(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Md(n){return n>0?1:n<0?-1:0}function bu(n,t){return ii(n.prev,n,n.next)<0?ii(n,t,n.next)>=0&&ii(n,n.prev,t)>=0:ii(n,t,n.prev)<0||ii(n,n.next,t)<0}function k_(n,t){const r=tf(n.i,n.x,n.y),a=tf(t.i,t.x,t.y),c=n.next,p=t.prev;return n.next=t,t.prev=n,r.next=c,c.prev=r,a.next=r,r.prev=a,p.next=a,a.prev=p,a}function A_(n,t,r,a){const c=tf(n,t,r);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function wu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function tf(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Jl{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class kd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}kd.noSubdivision=new kd({fill:new Jl(0,0),line:new Jl(0,0),tile:new Jl(0,0),stencil:new Jl(0,0),circle:1}),nr("SubdivisionGranularityExpression",Jl),nr("SubdivisionGranularitySetting",kd);const Ql=-32768,Tu=32767;class xy{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=oe/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const a=0|Math.round(t),c=0|Math.round(r),p=this._getKey(a,c);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,_),this._vertexBuffer.push(a,c),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(c,p){const _=[];for(let v=0;v<p.length;v+=3){const b=p[v],S=p[v+1],I=p[v+2],L=c[2*b],F=c[2*b+1];(c[2*S]-L)*(c[2*I+1]-F)-(c[2*S+1]-F)*(c[2*I]-L)>0?(_.push(b),_.push(I),_.push(S)):(_.push(b),_.push(S),_.push(I))}return _})(this._vertexBuffer,t);const r=[],a=t.length;for(let c=0;c<a;c+=3){const p=[t[c+0],t[c+1],t[c+2]],_=[this._vertexBuffer[2*t[c+0]+0],this._vertexBuffer[2*t[c+0]+1],this._vertexBuffer[2*t[c+1]+0],this._vertexBuffer[2*t[c+1]+1],this._vertexBuffer[2*t[c+2]+0],this._vertexBuffer[2*t[c+2]+1]];let v=1/0,b=1/0,S=-1/0,I=-1/0;for(let W=0;W<3;W++){const J=_[2*W],le=_[2*W+1];v=Math.min(v,J),S=Math.max(S,J),b=Math.min(b,le),I=Math.max(I,le)}if(v===S||b===I)continue;const L=Math.floor(v/this._granularityCellSize),F=Math.ceil(S/this._granularityCellSize),V=Math.floor(b/this._granularityCellSize),U=Math.ceil(I/this._granularityCellSize);if(L!==F||V!==U)for(let W=V;W<U;W++){const J=this._scanlineGenerateVertexRingForCellRow(W,_,p);by(this._vertexBuffer,J,r)}else r.push(...p)}return r}_scanlineGenerateVertexRingForCellRow(t,r,a){const c=t*this._granularityCellSize,p=c+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const b=r[2*v],S=r[2*v+1],I=r[2*(v+1)%6],L=r[(2*(v+1)+1)%6],F=r[2*(v+2)%6],V=r[(2*(v+2)+1)%6],U=I-b,W=L-S,J=U===0,le=W===0,Le=(c-S)/W,ye=(p-S)/W,Ce=Math.min(Le,ye),Xe=Math.max(Le,ye);if(!le&&(Ce>=1||Xe<=0)||le&&(S<c||S>p)){L>=c&&L<=p&&_.push(a[(v+1)%3]);continue}!le&&Ce>0&&_.push(this._vertexToIndex(b+U*Ce,S+W*Ce));const lt=b+U*Math.max(Ce,0),Pt=b+U*Math.min(Xe,1);J||this._generateIntraEdgeVertices(_,b,S,I,L,lt,Pt),!le&&Xe<1&&_.push(this._vertexToIndex(b+U*Xe,S+W*Xe)),(le||L>=c&&L<=p)&&_.push(a[(v+1)%3]),!le&&(L<=c||L>=p)&&this._generateInterEdgeVertices(_,b,S,I,L,F,V,Pt,c,p)}return _}_generateIntraEdgeVertices(t,r,a,c,p,_,v){const b=c-r,S=p-a,I=S===0,L=I?Math.min(r,c):Math.min(_,v),F=I?Math.max(r,c):Math.max(_,v),V=Math.floor(L/this._granularityCellSize)+1,U=Math.ceil(F/this._granularityCellSize)-1;if(I?r<c:_<v)for(let W=V;W<=U;W++){const J=W*this._granularityCellSize;t.push(this._vertexToIndex(J,a+S*(J-r)/b))}else for(let W=U;W>=V;W--){const J=W*this._granularityCellSize;t.push(this._vertexToIndex(J,a+S*(J-r)/b))}}_generateInterEdgeVertices(t,r,a,c,p,_,v,b,S,I){const L=p-a,F=_-c,V=v-p,U=(S-p)/V,W=(I-p)/V,J=Math.min(U,W),le=Math.max(U,W),Le=c+F*J;let ye=Math.floor(Math.min(Le,b)/this._granularityCellSize)+1,Ce=Math.ceil(Math.max(Le,b)/this._granularityCellSize)-1,Xe=b<Le;const lt=V===0;if(lt&&(v===S||v===I))return;if(lt||J>=1||le<=0){const Xt=a-v,Vt=_+(r-_)*Math.min((S-v)/Xt,(I-v)/Xt);ye=Math.floor(Math.min(Vt,b)/this._granularityCellSize)+1,Ce=Math.ceil(Math.max(Vt,b)/this._granularityCellSize)-1,Xe=b<Vt}const Pt=L>0?I:S;if(Xe)for(let Xt=ye;Xt<=Ce;Xt++)t.push(this._vertexToIndex(Xt*this._granularityCellSize,Pt));else for(let Xt=Ce;Xt>=ye;Xt--)t.push(this._vertexToIndex(Xt*this._granularityCellSize,Pt))}_generateOutline(t){const r=[];for(const a of t){const c=el(a,this._granularity,!0),p=this._pointArrayToIndices(c),_=[];for(let v=1;v<p.length;v++)_.push(p[v-1]),_.push(p[v]);r.push(_)}return r}_handlePoles(t){let r=!1,a=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(r||a)&&this._fillPoles(t,r,a)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const a=t[r+1];a===Ql&&(t[r+1]=-32767),a===Tu&&(t[r+1]=32766)}}_generatePoleQuad(t,r,a,c,p,_){c>p!=(_===Ql)?(t.push(r),t.push(a),t.push(this._vertexToIndex(c,_)),t.push(a),t.push(this._vertexToIndex(p,_)),t.push(this._vertexToIndex(c,_))):(t.push(a),t.push(r),t.push(this._vertexToIndex(c,_)),t.push(this._vertexToIndex(p,_)),t.push(a),t.push(this._vertexToIndex(c,_)))}_fillPoles(t,r,a){const c=this._vertexBuffer,p=oe,_=t.length;for(let v=2;v<_;v+=3){const b=t[v-2],S=t[v-1],I=t[v],L=c[2*b],F=c[2*b+1],V=c[2*S],U=c[2*S+1],W=c[2*I],J=c[2*I+1];r&&(F===0&&U===0&&this._generatePoleQuad(t,b,S,L,V,Ql),U===0&&J===0&&this._generatePoleQuad(t,S,I,V,W,Ql),J===0&&F===0&&this._generatePoleQuad(t,I,b,W,L,Ql)),a&&(F===p&&U===p&&this._generatePoleQuad(t,b,S,L,V,Tu),U===p&&J===p&&this._generatePoleQuad(t,S,I,V,W,Tu),J===p&&F===p&&this._generatePoleQuad(t,I,b,W,L,Tu))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:a,holeIndices:c}=(function(v){const b=[],S=[];for(const I of v)if(I.length!==0){I!==v[0]&&b.push(S.length/2);for(let L=0;L<I.length;L++)S.push(I[L].x),S.push(I[L].y)}return{flattened:S,holeIndices:b}})(t);let p;this._initializeVertices(a);try{const v=(function(S,I,L=2){const F=I&&I.length,V=F?I[0]*L:S.length;let U=P_(S,0,V,L,!0);const W=[];if(!U||U.next===U.prev)return W;let J,le,Le;if(F&&(U=(function(ye,Ce,Xe,lt){const Pt=[];for(let Xt=0,Vt=Ce.length;Xt<Vt;Xt++){const Gt=P_(ye,Ce[Xt]*lt,Xt<Vt-1?Ce[Xt+1]*lt:ye.length,lt,!1);Gt===Gt.next&&(Gt.steiner=!0),Pt.push(vy(Gt))}Pt.sort(my);for(let Xt=0;Xt<Pt.length;Xt++)Xe=_y(Pt[Xt],Xe);return Xe})(S,I,U,L)),S.length>80*L){J=S[0],le=S[1];let ye=J,Ce=le;for(let Xe=L;Xe<V;Xe+=L){const lt=S[Xe],Pt=S[Xe+1];lt<J&&(J=lt),Pt<le&&(le=Pt),lt>ye&&(ye=lt),Pt>Ce&&(Ce=Pt)}Le=Math.max(ye-J,Ce-le),Le=Le!==0?32767/Le:0}return yu(U,W,L,J,le,Le,0),W})(a,c),b=this._convertIndices(a,v);p=this._subdivideTrianglesScanline(b)}catch(v){console.error(v)}let _=[];return r&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:_}}_convertIndices(t,r){const a=[];for(let c=0;c<r.length;c++)a.push(this._vertexToIndex(t[2*r[c]],t[2*r[c]+1]));return a}_pointArrayToIndices(t){const r=[];for(let a=0;a<t.length;a++){const c=t[a];r.push(this._vertexToIndex(c.x,c.y))}return r}}function E_(n,t,r,a=!0){return new xy(r,t).subdividePolygonInternal(n,a)}function el(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const a=n[0],c=n[n.length-1],p=r&&(a.x!==c.x||a.y!==c.y);if(t<2)return p?[...n,n[0]]:[...n];const _=Math.floor(oe/t),v=[];v.push(new B(n[0].x,n[0].y));const b=n.length,S=p?b:b-1;for(let I=0;I<S;I++){const L=n[I],F=I<b-1?n[I+1]:n[0],V=L.x,U=L.y,W=F.x,J=F.y,le=V!==W,Le=U!==J;if(!le&&!Le)continue;const ye=W-V,Ce=J-U,Xe=Math.abs(ye),lt=Math.abs(Ce);let Pt=V,Xt=U;for(;;){const Gt=ye>0?(Math.floor(Pt/_)+1)*_:(Math.ceil(Pt/_)-1)*_,wr=Ce>0?(Math.floor(Xt/_)+1)*_:(Math.ceil(Xt/_)-1)*_,$t=Math.abs(Pt-Gt),Ht=Math.abs(Xt-wr),gt=Math.abs(Pt-W),jr=Math.abs(Xt-J),Gr=le?$t/Xe:Number.POSITIVE_INFINITY,Ir=Le?Ht/lt:Number.POSITIVE_INFINITY;if((gt<=$t||!le)&&(jr<=Ht||!Le))break;if(Gr<Ir&&le||!Le){Pt=Gt,Xt+=Ce*Gr;const _r=new B(Pt,Math.round(Xt));v[v.length-1].x===_r.x&&v[v.length-1].y===_r.y||v.push(_r)}else{Pt+=ye*Ir,Xt=wr;const _r=new B(Math.round(Pt),Xt);v[v.length-1].x===_r.x&&v[v.length-1].y===_r.y||v.push(_r)}}const Vt=new B(W,J);v[v.length-1].x===Vt.x&&v[v.length-1].y===Vt.y||v.push(Vt)}return v}function by(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,c=n[2*t[0]];for(let b=1;b<t.length;b++){const S=n[2*t[b]];S<c&&(c=S,a=b)}const p=t.length;let _=a,v=(_+1)%p;for(;;){const b=_-1>=0?_-1:p-1,S=(v+1)%p,I=n[2*t[b]],L=n[2*t[S]],F=n[2*t[_]],V=n[2*t[_]+1],U=n[2*t[v]+1];let W=!1;if(I<L)W=!0;else if(I>L)W=!1;else{const J=U-V,le=-(n[2*t[v]]-F),Le=V<U?1:-1;((I-F)*J+(n[2*t[b]+1]-V)*le)*Le>((L-F)*J+(n[2*t[S]+1]-V)*le)*Le&&(W=!0)}if(W){const J=t[b],le=t[_],Le=t[v];J!==le&&J!==Le&&le!==Le&&r.push(Le,le,J),_--,_<0&&(_=p-1)}else{const J=t[S],le=t[_],Le=t[v];J!==le&&J!==Le&&le!==Le&&r.push(Le,le,J),v++,v>=p&&(v=0)}if(b===S)break}}function z_(n,t,r,a,c,p,_,v,b){const S=c.length/2,I=_&&v&&b;if(S<Kr.MAX_VERTEX_ARRAY_LENGTH){const L=t.prepareSegment(S,r,a),F=L.vertexLength;for(let W=0;W<p.length;W+=3)a.emplaceBack(F+p[W],F+p[W+1],F+p[W+2]);let V,U;L.vertexLength+=S,L.primitiveLength+=p.length/3,I&&(U=_.prepareSegment(S,r,v),V=U.vertexLength,U.vertexLength+=S);for(let W=0;W<c.length;W+=2)n(c[W],c[W+1]);if(I)for(let W=0;W<b.length;W++){const J=b[W];for(let le=1;le<J.length;le+=2)v.emplaceBack(V+J[le-1],V+J[le]);U.primitiveLength+=J.length/2}}else(function(L,F,V,U,W,J){const le=[];for(let lt=0;lt<U.length/2;lt++)le.push(-1);const Le={count:0};let ye=0,Ce=L.getOrCreateLatestSegment(F,V),Xe=Ce.vertexLength;for(let lt=2;lt<W.length;lt+=3){const Pt=W[lt-2],Xt=W[lt-1],Vt=W[lt];let Gt=le[Pt]<ye,wr=le[Xt]<ye,$t=le[Vt]<ye;Ce.vertexLength+((Gt?1:0)+(wr?1:0)+($t?1:0))>Kr.MAX_VERTEX_ARRAY_LENGTH&&(Ce=L.createNewSegment(F,V),ye=Le.count,Gt=!0,wr=!0,$t=!0,Xe=0);const Ht=Cu(le,U,J,Le,Pt,Gt,Ce),gt=Cu(le,U,J,Le,Xt,wr,Ce),jr=Cu(le,U,J,Le,Vt,$t,Ce);V.emplaceBack(Xe+Ht-ye,Xe+gt-ye,Xe+jr-ye),Ce.primitiveLength++}})(t,r,a,c,p,n),I&&(function(L,F,V,U,W,J){const le=[];for(let lt=0;lt<U.length/2;lt++)le.push(-1);const Le={count:0};let ye=0,Ce=L.getOrCreateLatestSegment(F,V),Xe=Ce.vertexLength;for(let lt=0;lt<W.length;lt++){const Pt=W[lt];for(let Xt=1;Xt<W[lt].length;Xt+=2){const Vt=Pt[Xt-1],Gt=Pt[Xt];let wr=le[Vt]<ye,$t=le[Gt]<ye;Ce.vertexLength+((wr?1:0)+($t?1:0))>Kr.MAX_VERTEX_ARRAY_LENGTH&&(Ce=L.createNewSegment(F,V),ye=Le.count,wr=!0,$t=!0,Xe=0);const Ht=Cu(le,U,J,Le,Vt,wr,Ce),gt=Cu(le,U,J,Le,Gt,$t,Ce);V.emplaceBack(Xe+Ht-ye,Xe+gt-ye),Ce.primitiveLength++}}})(_,r,v,c,b,n),t.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function Cu(n,t,r,a,c,p,_){if(p){const v=a.count;return r(t[2*c],t[2*c+1]),n[c]=a.count,a.count++,_.vertexLength++,v}return n[c]}class rf{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qe,this.indexArray=new Bn,this.indexArray2=new Ln,this.programConfigurations=new la(t.layers,t.zoom),this.segments=new Kr,this.segments2=new Kr,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,a){this.hasPattern=Jp("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),p=!c.isConstant(),_=[];for(const{feature:v,id:b,index:S,sourceLayerIndex:I}of t){const L=this.layers[0]._featureFilter.needGeometry,F=ro(v,L);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{globalState:this.globalState}),F,a))continue;const V=p?c.evaluate(F,{},a,r.availableImages):void 0,U={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:L?F.geometry:bo(v),patterns:{},sortKey:V};_.push(U)}p&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){const L=Qp("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(v,b,S,a,{},r.subdivisionGranularity);r.featureIndex.insert(t[S].feature,b,S,I,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,uy),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,c,p,_){for(const v of Fs(r,500)){const b=E_(v,c,_.fill.getGranularityForZoomLevel(c.z)),S=this.layoutVertexArray;z_(((I,L)=>{S.emplaceBack(I,L)}),this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,c)}}let L_,D_;nr("FillBucket",rf,{omit:["layers","patternFeatures"]});var wy={get paint(){return D_=D_||new Zi({"fill-antialias":new yr(xe.paint_fill["fill-antialias"]),"fill-opacity":new Or(xe.paint_fill["fill-opacity"]),"fill-color":new Or(xe.paint_fill["fill-color"]),"fill-outline-color":new Or(xe.paint_fill["fill-outline-color"]),"fill-translate":new yr(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new yr(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zl(xe.paint_fill["fill-pattern"])})},get layout(){return L_=L_||new Zi({"fill-sort-key":new Or(xe.layout_fill["fill-sort-key"])})}};class Ty extends xa{constructor(t){super(t,wy)}recalculate(t,r){super.recalculate(t,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new rf(t)}queryRadius(){return Sd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:a,pixelsToTileUnits:c}){return d_(Pd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,c),r)}isTileClipped(){return!0}}const Cy=ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Sy=ti([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Py}=Cy;class ec{constructor(t,r,a,c,p){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=c,this._values=p,t.readFields(Iy,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,a=[];let c,p=1,_=0,v=0,b=0;for(;t.pos<r;){if(_<=0){const S=t.readVarint();p=7&S,_=S>>3}if(_--,p===1||p===2)v+=t.readSVarint(),b+=t.readSVarint(),p===1&&(c&&a.push(c),c=[]),c&&c.push(new B(v,b));else{if(p!==7)throw new Error(`unknown command ${p}`);c&&c.push(c[0].clone())}}return c&&a.push(c),a}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let a=1,c=0,p=0,_=0,v=1/0,b=-1/0,S=1/0,I=-1/0;for(;t.pos<r;){if(c<=0){const L=t.readVarint();a=7&L,c=L>>3}if(c--,a===1||a===2)p+=t.readSVarint(),_+=t.readSVarint(),p<v&&(v=p),p>b&&(b=p),_<S&&(S=_),_>I&&(I=_);else if(a!==7)throw new Error(`unknown command ${a}`)}return[v,S,b,I]}toGeoJSON(t,r,a){const c=this.extent*Math.pow(2,a),p=this.extent*t,_=this.extent*r,v=this.loadGeometry();function b(F){return[360*(F.x+p)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(F.y+_)/c)*Math.PI))-90]}function S(F){return F.map(b)}let I;if(this.type===1){const F=[];for(const U of v)F.push(U[0]);const V=S(F);I=F.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const F=v.map(S);I=F.length===1?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F}}else{if(this.type!==3)throw new Error("unknown feature type");{const F=(function(U){const W=U.length;if(W<=1)return[U];const J=[];let le,Le;for(let ye=0;ye<W;ye++){const Ce=My(U[ye]);Ce!==0&&(Le===void 0&&(Le=Ce<0),Le===Ce<0?(le&&J.push(le),le=[U[ye]]):le&&le.push(U[ye]))}return le&&J.push(le),J})(v),V=[];for(const U of F)V.push(U.map(S));I=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const L={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function Iy(n,t,r){n===1?t.id=r.readVarint():n===2?(function(a,c){const p=a.readVarint()+a.pos;for(;a.pos<p;){const _=c._keys[a.readVarint()],v=c._values[a.readVarint()];c.properties[_]=v}})(r,t):n===3?t.type=r.readVarint():n===4&&(t._geometry=r.pos)}function My(n){let t=0;for(let r,a,c=0,p=n.length,_=p-1;c<p;_=c++)r=n[c],a=n[_],t+=(a.x-r.x)*(r.y+a.y);return t}ec.types=["Unknown","Point","LineString","Polygon"];class R_{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ky,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new ec(this._pbf,r,this.extent,this._keys,this._values)}}function ky(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push((function(a){let c=null;const p=a.readVarint()+a.pos;for(;a.pos<p;){const _=a.readVarint()>>3;c=_===1?a.readString():_===2?a.readFloat():_===3?a.readDouble():_===4?a.readVarint64():_===5?a.readVarint():_===6?a.readSVarint():_===7?a.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c})(r))}class B_{constructor(t,r){this.layers=t.readFields(Ay,{},r)}}function Ay(n,t,r){if(n===3){const a=new R_(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}const nf=Math.pow(2,13);function Su(n,t,r,a,c,p,_,v){n.emplaceBack(t,r,2*Math.floor(a*nf)+_,c*nf*2,p*nf*2,Math.round(v))}class af{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ue,this.centroidVertexArray=new pe,this.indexArray=new Bn,this.programConfigurations=new la(t.layers,t.zoom),this.segments=new Kr,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,a){this.features=[],this.hasPattern=Jp("fill-extrusion",this.layers,r);for(const{feature:c,id:p,index:_,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,S=ro(c,b);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{globalState:this.globalState}),S,a))continue;const I={id:p,sourceLayerIndex:v,index:_,geometry:b?S.geometry:bo(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Qp("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,_,a,{},r.subdivisionGranularity),r.featureIndex.insert(c,I.geometry,_,v,this.index,!0)}}addFeatures(t,r,a){for(const c of this.features){const{geometry:p}=c;this.addFeature(c,p,c.index,r,a,t.subdivisionGranularity)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Py),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Sy.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,a,c,p,_){for(const v of Fs(r,500)){const b={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(b,c,t,v,_);const I=this.layoutVertexArray.length-S,L=Math.floor(b.x/b.sampleCount),F=Math.floor(b.y/b.sampleCount);for(let V=0;V<I;V++)this.centroidVertexArray.emplaceBack(L,F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,c)}processPolygon(t,r,a,c,p){if(c.length<1||F_(c[0]))return;for(const L of c)L.length!==0&&Ey(t,L);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=p.fill.getGranularityForZoomLevel(r.z),b=ec.types[a.type]==="Polygon";for(const L of c){if(L.length===0||F_(L))continue;const F=el(L,v,b);this._generateSideFaces(F,_)}if(!b)return;const S=E_(c,r,v,!1),I=this.layoutVertexArray;z_(((L,F)=>{Su(I,L,F,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,r){let a=0;for(let c=1;c<t.length;c++){const p=t[c],_=t[c-1];if(zy(p,_))continue;r.segment.vertexLength+4>Kr.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=p.sub(_)._perp()._unit(),b=_.dist(p);a+b>32768&&(a=0),Su(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,0,a),Su(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,1,a),a+=b,Su(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,a),Su(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,a);const S=r.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Ey(n,t){for(let r=0;r<t.length;r++){const a=t[r];r===t.length-1&&t[0].x===a.x&&t[0].y===a.y||(n.x+=a.x,n.y+=a.y,n.sampleCount++)}}function zy(n,t){return n.x===t.x&&(n.x<0||n.x>oe)||n.y===t.y&&(n.y<0||n.y>oe)}function F_(n){return n.every((t=>t.x<0))||n.every((t=>t.x>oe))||n.every((t=>t.y<0))||n.every((t=>t.y>oe))}let O_;nr("FillExtrusionBucket",af,{omit:["layers","features"]});var Ly={get paint(){return O_=O_||new Zi({"fill-extrusion-opacity":new yr(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Or(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yr(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yr(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zl(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Or(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Or(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yr(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Dy extends xa{constructor(t){super(t,Ly)}createBucket(t){return new af(t)}queryRadius(){return Sd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:a,geometry:c,transform:p,pixelsToTileUnits:_,pixelPosMatrix:v}){const b=Pd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,_),S=this.paint.get("fill-extrusion-height").evaluate(r,a),I=this.paint.get("fill-extrusion-base").evaluate(r,a),L=(function(V,U){const W=[];for(const J of V){const le=[J.x,J.y,0,1];ke(le,le,U),W.push(new B(le[0]/le[3],le[1]/le[3]))}return W})(b,v),F=(function(V,U,W,J){const le=[],Le=[],ye=J[8]*U,Ce=J[9]*U,Xe=J[10]*U,lt=J[11]*U,Pt=J[8]*W,Xt=J[9]*W,Vt=J[10]*W,Gt=J[11]*W;for(const wr of V){const $t=[],Ht=[];for(const gt of wr){const jr=gt.x,Gr=gt.y,Ir=J[0]*jr+J[4]*Gr+J[12],_r=J[1]*jr+J[5]*Gr+J[13],hn=J[2]*jr+J[6]*Gr+J[14],Jn=J[3]*jr+J[7]*Gr+J[15],_i=hn+Xe,Vi=Jn+lt,Ba=Ir+Pt,ua=_r+Xt,Ri=hn+Vt,Wn=Jn+Gt,Si=new B((Ir+ye)/Vi,(_r+Ce)/Vi);Si.z=_i/Vi,$t.push(Si);const Bi=new B(Ba/Wn,ua/Wn);Bi.z=Ri/Wn,Ht.push(Bi)}le.push($t),Le.push(Ht)}return[le,Le]})(c,I,S,v);return(function(V,U,W){let J=1/0;d_(W,U)&&(J=N_(W,U[0]));for(let le=0;le<U.length;le++){const Le=U[le],ye=V[le];for(let Ce=0;Ce<Le.length-1;Ce++){const Xe=Le[Ce],lt=[Xe,Le[Ce+1],ye[Ce+1],ye[Ce],Xe];h_(W,lt)&&(J=Math.min(J,N_(W,lt)))}}return J!==1/0&&J})(F[0],F[1],L)}}function Pu(n,t){return n.x*t.x+n.y*t.y}function N_(n,t){if(n.length===1){let r=0;const a=t[r++];let c;for(;!c||a.equals(c);)if(c=t[r++],!c)return 1/0;for(;r<t.length;r++){const p=t[r],_=n[0],v=c.sub(a),b=p.sub(a),S=_.sub(a),I=Pu(v,v),L=Pu(v,b),F=Pu(b,b),V=Pu(S,v),U=Pu(S,b),W=I*F-L*L,J=(F*V-L*U)/W,le=(I*U-L*V)/W,Le=a.z*(1-J-le)+c.z*J+p.z*le;if(isFinite(Le))return Le}return 1/0}{let r=1/0;for(const a of t)r=Math.min(r,a.z);return r}}const Ry=ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:By}=Ry,Fy=ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Oy}=Fy,Ny=Math.cos(Math.PI/180*37.5),j_=Math.pow(2,14)/.5;class of{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new We,this.layoutVertexArray2=new Je,this.indexArray=new Bn,this.programConfigurations=new la(t.layers,t.zoom),this.segments=new Kr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,a){this.hasPattern=Jp("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),p=!c.isConstant(),_=[];for(const{feature:v,id:b,index:S,sourceLayerIndex:I}of t){const L=this.layers[0]._featureFilter.needGeometry,F=ro(v,L);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{globalState:this.globalState}),F,a))continue;const V=p?c.evaluate(F,{},a):void 0,U={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:L?F.geometry:bo(v),patterns:{},sortKey:V};_.push(U)}p&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){const L=Qp("line",this.layers,v,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(v,b,S,a,{},r.subdivisionGranularity);r.featureIndex.insert(t[S].feature,b,S,I,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Oy)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,By),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,c,p,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(t,{}),S=v.get("line-cap"),I=v.get("line-miter-limit"),L=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const F of r)this.addLine(F,t,b,S,I,L,c,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,p,c)}addLine(t,r,a,c,p,_,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=el(t,v?b.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<t.length-1;ye++)this.totalDistance+=t[ye].dist(t[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=ec.types[r.type]==="Polygon";let I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let L=0;for(;L<I-1&&t[L].equals(t[L+1]);)L++;if(I<(S?3:2))return;a==="bevel"&&(p=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let U,W,J,le,Le;this.e1=this.e2=-1,S&&(U=t[I-2],Le=t[L].sub(U)._unit()._perp());for(let ye=L;ye<I;ye++){if(J=ye===I-1?S?t[L+1]:void 0:t[ye+1],J&&t[ye].equals(J))continue;Le&&(le=Le),U&&(W=U),U=t[ye],Le=J?J.sub(U)._unit()._perp():le,le=le||Le;let Ce=le.add(Le);Ce.x===0&&Ce.y===0||Ce._unit();const Xe=le.x*Le.x+le.y*Le.y,lt=Ce.x*Le.x+Ce.y*Le.y,Pt=lt!==0?1/lt:1/0,Xt=2*Math.sqrt(2-2*lt),Vt=lt<Ny&&W&&J,Gt=le.x*Le.y-le.y*Le.x>0;if(Vt&&ye>L){const Ht=U.dist(W);if(Ht>2*F){const gt=U.sub(U.sub(W)._mult(F/Ht)._round());this.updateDistance(W,gt),this.addCurrentVertex(gt,le,0,0,V),W=gt}}const wr=W&&J;let $t=wr?a:S?"butt":c;if(wr&&$t==="round"&&(Pt<_?$t="miter":Pt<=2&&($t="fakeround")),$t==="miter"&&Pt>p&&($t="bevel"),$t==="bevel"&&(Pt>2&&($t="flipbevel"),Pt<p&&($t="miter")),W&&this.updateDistance(W,U),$t==="miter")Ce._mult(Pt),this.addCurrentVertex(U,Ce,0,0,V);else if($t==="flipbevel"){if(Pt>100)Ce=Le.mult(-1);else{const Ht=Pt*le.add(Le).mag()/le.sub(Le).mag();Ce._perp()._mult(Ht*(Gt?-1:1))}this.addCurrentVertex(U,Ce,0,0,V),this.addCurrentVertex(U,Ce.mult(-1),0,0,V)}else if($t==="bevel"||$t==="fakeround"){const Ht=-Math.sqrt(Pt*Pt-1),gt=Gt?Ht:0,jr=Gt?0:Ht;if(W&&this.addCurrentVertex(U,le,gt,jr,V),$t==="fakeround"){const Gr=Math.round(180*Xt/Math.PI/20);for(let Ir=1;Ir<Gr;Ir++){let _r=Ir/Gr;if(_r!==.5){const Jn=_r-.5;_r+=_r*Jn*(_r-1)*((1.0904+Xe*(Xe*(3.55645-1.43519*Xe)-3.2452))*Jn*Jn+(.848013+Xe*(.215638*Xe-1.06021)))}const hn=Le.sub(le)._mult(_r)._add(le)._unit()._mult(Gt?-1:1);this.addHalfVertex(U,hn.x,hn.y,!1,Gt,0,V)}}J&&this.addCurrentVertex(U,Le,-gt,-jr,V)}else if($t==="butt")this.addCurrentVertex(U,Ce,0,0,V);else if($t==="square"){const Ht=W?1:-1;this.addCurrentVertex(U,Ce,Ht,Ht,V)}else $t==="round"&&(W&&(this.addCurrentVertex(U,le,0,0,V),this.addCurrentVertex(U,le,1,1,V,!0)),J&&(this.addCurrentVertex(U,Le,-1,-1,V,!0),this.addCurrentVertex(U,Le,0,0,V)));if(Vt&&ye<I-1){const Ht=U.dist(J);if(Ht>2*F){const gt=U.add(J.sub(U)._mult(F/Ht)._round());this.updateDistance(U,gt),this.addCurrentVertex(gt,Le,0,0,V),U=gt}}}}addCurrentVertex(t,r,a,c,p,_=!1){const v=r.y*c-r.x,b=-r.y-r.x*c;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,_,!1,a,p),this.addHalfVertex(t,v,b,_,!0,-c,p),this.distance>j_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,a,c,p,_))}addHalfVertex({x:t,y:r},a,c,p,_,v,b){const S=.5*(this.lineClips?this.scaledDistance*(j_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),b.primitiveLength++),_?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let V_,q_;nr("LineBucket",of,{omit:["layers","patternFeatures"]});var Z_={get paint(){return q_=q_||new Zi({"line-opacity":new Or(xe.paint_line["line-opacity"]),"line-color":new Or(xe.paint_line["line-color"]),"line-translate":new yr(xe.paint_line["line-translate"]),"line-translate-anchor":new yr(xe.paint_line["line-translate-anchor"]),"line-width":new Or(xe.paint_line["line-width"]),"line-gap-width":new Or(xe.paint_line["line-gap-width"]),"line-offset":new Or(xe.paint_line["line-offset"]),"line-blur":new Or(xe.paint_line["line-blur"]),"line-dasharray":new _o(xe.paint_line["line-dasharray"]),"line-pattern":new Zl(xe.paint_line["line-pattern"]),"line-gradient":new Ul(xe.paint_line["line-gradient"])})},get layout(){return V_=V_||new Zi({"line-cap":new yr(xe.layout_line["line-cap"]),"line-join":new Or(xe.layout_line["line-join"]),"line-miter-limit":new yr(xe.layout_line["line-miter-limit"]),"line-round-limit":new yr(xe.layout_line["line-round-limit"]),"line-sort-key":new Or(xe.layout_line["line-sort-key"])})}};class jy extends Or{possiblyEvaluate(t,r){return r=new Un(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,a,c){return r=dt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,a,c)}}let Ad;class Vy extends xa{constructor(t){super(t,Z_),this.gradientVersion=0,Ad||(Ad=new jy(Z_.paint.properties["line-width"].specification),Ad.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof ei,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ad.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new of(t)}queryRadius(t){const r=t,a=U_(gu("line-width",this,r),gu("line-gap-width",this,r)),c=gu("line-offset",this,r);return a/2+Math.abs(c)+Sd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:a,geometry:c,transform:p,pixelsToTileUnits:_}){const v=Pd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,_),b=_/2*U_(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),S=this.paint.get("line-offset").evaluate(r,a);return S&&(c=(function(I,L){const F=[];for(let V=0;V<I.length;V++){const U=I[V],W=[];for(let J=0;J<U.length;J++){const le=U[J-1],Le=U[J],ye=U[J+1],Ce=J===0?new B(0,0):Le.sub(le)._unit()._perp(),Xe=J===U.length-1?new B(0,0):ye.sub(Le)._unit()._perp(),lt=Ce._add(Xe)._unit(),Pt=lt.x*Xe.x+lt.y*Xe.y;Pt!==0&&lt._mult(1/Pt),W.push(lt._mult(L)._add(Le))}F.push(W)}return F})(c,S*_)),(function(I,L,F){for(let V=0;V<L.length;V++){const U=L[V];if(I.length>=3){for(let W=0;W<U.length;W++)if(Yl(I,U[W]))return!0}if(J0(I,U,F))return!0}return!1})(v,c,b)}isTileClipped(){return!0}}function U_(n,t){return t>0?t+2*n:n}const qy=ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zy=ti([{name:"a_projected_pos",components:3,type:"Float32"}],4);ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Uy=ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $_=ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$y=ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gy(n,t,r){return n.sections.forEach((a=>{a.text=(function(c,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?c=c.toLocaleUpperCase():v==="lowercase"&&(c=c.toLocaleLowerCase()),Ea.applyArabicShaping&&(c=Ea.applyArabicShaping(c)),c})(a.text,t,r)})),n}ti([{name:"triangle",components:3,type:"Uint16"}]),ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ti([{type:"Float32",name:"offsetX"}]),ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ti([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Iu={"!":"ï¸•","#":"ï¼ƒ",$:"ï¼„","%":"ï¼…","&":"ï¼†","(":"ï¸µ",")":"ï¸¶","*":"ï¼Š","+":"ï¼‹",",":"ï¸","-":"ï¸²",".":"ãƒ»","/":"ï¼",":":"ï¸“",";":"ï¸”","<":"ï¸¿","=":"ï¼",">":"ï¹€","?":"ï¸–","@":"ï¼ ","[":"ï¹‡","\\":"ï¼¼","]":"ï¹ˆ","^":"ï¼¾",_:"ï¸³","`":"ï½€","{":"ï¸·","|":"â€•","}":"ï¸¸","~":"ï½ž","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â€“":"ï¸²","â€”":"ï¸±","â€˜":"ï¹ƒ","â€™":"ï¹„","â€œ":"ï¹","â€":"ï¹‚","â€¦":"ï¸™","â€§":"ãƒ»","â‚©":"ï¿¦","ã€":"ï¸‘","ã€‚":"ï¸’","ã€ˆ":"ï¸¿","ã€‰":"ï¹€","ã€Š":"ï¸½","ã€‹":"ï¸¾","ã€Œ":"ï¹","ã€":"ï¹‚","ã€Ž":"ï¹ƒ","ã€":"ï¹„","ã€":"ï¸»","ã€‘":"ï¸¼","ã€”":"ï¸¹","ã€•":"ï¸º","ã€–":"ï¸—","ã€—":"ï¸˜","ï¼":"ï¸•","ï¼ˆ":"ï¸µ","ï¼‰":"ï¸¶","ï¼Œ":"ï¸","ï¼":"ï¸²","ï¼Ž":"ãƒ»","ï¼š":"ï¸“","ï¼›":"ï¸”","ï¼œ":"ï¸¿","ï¼ž":"ï¹€","ï¼Ÿ":"ï¸–","ï¼»":"ï¹‡","ï¼½":"ï¹ˆ","ï¼¿":"ï¸³","ï½›":"ï¸·","ï½œ":"â€•","ï½":"ï¸¸","ï½Ÿ":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸’","ï½¢":"ï¹","ï½£":"ï¹‚"};var Ci=24;const sf=4294967296,G_=1/sf,H_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class lf{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,a=this.length){for(;this.pos<a;){const c=this.readVarint(),p=c>>3,_=this.pos;this.type=7&c,t(p,r,this),this.pos===_&&this.skip(c)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*sf;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*sf;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const r=this.buf;let a,c;return c=r[this.pos++],a=127&c,c<128?a:(c=r[this.pos++],a|=(127&c)<<7,c<128?a:(c=r[this.pos++],a|=(127&c)<<14,c<128?a:(c=r[this.pos++],a|=(127&c)<<21,c<128?a:(c=r[this.pos],a|=(15&c)<<28,(function(p,_,v){const b=v.buf;let S,I;if(I=b[v.pos++],S=(112&I)>>4,I<128||(I=b[v.pos++],S|=(127&I)<<3,I<128)||(I=b[v.pos++],S|=(127&I)<<10,I<128)||(I=b[v.pos++],S|=(127&I)<<17,I<128)||(I=b[v.pos++],S|=(127&I)<<24,I<128)||(I=b[v.pos++],S|=(1&I)<<31,I<128))return tc(p,S,_);throw new Error("Expected varint not more than 10 bytes")})(a,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&H_?H_.decode(this.buf.subarray(r,t)):(function(a,c,p){let _="",v=c;for(;v<p;){const b=a[v];let S,I,L,F=null,V=b>239?4:b>223?3:b>191?2:1;if(v+V>p)break;V===1?b<128&&(F=b):V===2?(S=a[v+1],(192&S)==128&&(F=(31&b)<<6|63&S,F<=127&&(F=null))):V===3?(S=a[v+1],I=a[v+2],(192&S)==128&&(192&I)==128&&(F=(15&b)<<12|(63&S)<<6|63&I,(F<=2047||F>=55296&&F<=57343)&&(F=null))):V===4&&(S=a[v+1],I=a[v+2],L=a[v+3],(192&S)==128&&(192&I)==128&&(192&L)==128&&(F=(15&b)<<18|(63&S)<<12|(63&I)<<6|63&L,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,V=1):F>65535&&(F-=65536,_+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),_+=String.fromCharCode(F),v+=V}return _})(this.buf,r,t)}readBytes(){const t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const r=7&t;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){const a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*G_),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*G_),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(r,a){let c,p;if(r>=0?(c=r%4294967296|0,p=r/4294967296|0):(c=~(-r%4294967296),p=~(-r/4294967296),4294967295^c?c=c+1|0:(c=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(_,v,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)})(c,0,a),(function(_,v){const b=(7&_)<<4;v.buf[v.pos++]|=b|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))})(p,a)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const r=this.pos;this.pos=(function(c,p,_){for(let v,b,S=0;S<p.length;S++){if(v=p.charCodeAt(S),v>55295&&v<57344){if(!b){v>56319||S+1===p.length?(c[_++]=239,c[_++]=191,c[_++]=189):b=v;continue}if(v<56320){c[_++]=239,c[_++]=191,c[_++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(c[_++]=239,c[_++]=191,c[_++]=189,b=null);v<128?c[_++]=v:(v<2048?c[_++]=v>>6|192:(v<65536?c[_++]=v>>12|224:(c[_++]=v>>18|240,c[_++]=v>>12&63|128),c[_++]=v>>6&63|128),c[_++]=63&v|128)}return _})(this.buf,t,this.pos);const a=this.pos-r;a>=128&&W_(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const r=t.length;this.writeVarint(r),this.realloc(r);for(let a=0;a<r;a++)this.buf[this.pos++]=t[a]}writeRawMessage(t,r){this.pos++;const a=this.pos;t(r,this);const c=this.pos-a;c>=128&&W_(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c}writeMessage(t,r,a){this.writeTag(t,2),this.writeRawMessage(r,a)}writePackedVarint(t,r){r.length&&this.writeMessage(t,Hy,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,Wy,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,Ky,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,Xy,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,Yy,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,Jy,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,Qy,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,e1,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,t1,r)}writeBytesField(t,r){this.writeTag(t,2),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,5),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,5),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,1),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,1),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,0),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,0),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,2),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,5),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,1),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}}function tc(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function W_(n,t,r){const a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(let c=r.pos-1;c>=n;c--)r.buf[c+a]=r.buf[c]}function Hy(n,t){for(let r=0;r<n.length;r++)t.writeVarint(n[r])}function Wy(n,t){for(let r=0;r<n.length;r++)t.writeSVarint(n[r])}function Xy(n,t){for(let r=0;r<n.length;r++)t.writeFloat(n[r])}function Yy(n,t){for(let r=0;r<n.length;r++)t.writeDouble(n[r])}function Ky(n,t){for(let r=0;r<n.length;r++)t.writeBoolean(n[r])}function Jy(n,t){for(let r=0;r<n.length;r++)t.writeFixed32(n[r])}function Qy(n,t){for(let r=0;r<n.length;r++)t.writeSFixed32(n[r])}function e1(n,t){for(let r=0;r<n.length;r++)t.writeFixed64(n[r])}function t1(n,t){for(let r=0;r<n.length;r++)t.writeSFixed64(n[r])}function r1(n,t,r){n===1&&r.readMessage(n1,t)}function n1(n,t,r){if(n===3){const{id:a,bitmap:c,width:p,height:_,left:v,top:b,advance:S}=r.readMessage(i1,{});t.push({id:a,bitmap:new vu({width:p+6,height:_+6},c),metrics:{width:p,height:_,left:v,top:b,advance:S}})}}function i1(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}function X_(n){let t=0,r=0;for(const _ of n)t+=_.w*_.h,r=Math.max(r,_.w);n.sort(((_,v)=>v.h-_.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let c=0,p=0;for(const _ of n)for(let v=a.length-1;v>=0;v--){const b=a[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,p=Math.max(p,_.y+_.h),c=Math.max(c,_.x+_.w),_.w===b.w&&_.h===b.h){const S=a.pop();S&&v<a.length&&(a[v]=S)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(a.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:c,h:p,fill:t/(c*p)||0}}class cf{constructor(t,{pixelRatio:r,version:a,stretchX:c,stretchY:p,content:_,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=c,this.stretchY=p,this.content=_,this.version=a,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Y_{constructor(t,r){const a={},c={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,a,p),this.addImages(r,c,p);const{w:_,h:v}=X_(p),b=new ca({width:_||1,height:v||1});for(const S in t){const I=t[S],L=a[S].paddedRect;ca.copy(I.data,b,{x:0,y:0},{x:L.x+1,y:L.y+1},I.data)}for(const S in r){const I=r[S],L=c[S].paddedRect,F=L.x+1,V=L.y+1,U=I.data.width,W=I.data.height;ca.copy(I.data,b,{x:0,y:0},{x:F,y:V},I.data),ca.copy(I.data,b,{x:0,y:W-1},{x:F,y:V-1},{width:U,height:1}),ca.copy(I.data,b,{x:0,y:0},{x:F,y:V+W},{width:U,height:1}),ca.copy(I.data,b,{x:U-1,y:0},{x:F-1,y:V},{width:1,height:W}),ca.copy(I.data,b,{x:0,y:0},{x:F+U,y:V},{width:1,height:W})}this.image=b,this.iconPositions=a,this.patternPositions=c}addImages(t,r,a){for(const c in t){const p=t[c],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};a.push(_),r[c]=new cf(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;const[c,p]=t.tl;a.update(r.data,void 0,{x:c,y:p})}}var gs;nr("ImagePosition",cf),nr("ImageAtlas",Y_),T.ao=void 0,(gs=T.ao||(T.ao={}))[gs.none=0]="none",gs[gs.horizontal=1]="horizontal",gs[gs.vertical=2]="vertical",gs[gs.horizontalOnly=3]="horizontalOnly";class Mu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,a){const c=new Mu;return c.scale=t||1,c.fontStack=r,c.verticalAlign=a||"bottom",c}static forImage(t,r){const a=new Mu;return a.imageName=t,a.verticalAlign=r||"bottom",a}}class rc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const a=new rc;for(let c=0;c<t.sections.length;c++){const p=t.sections[c];p.image?a.addImageSection(p):a.addTextSection(p,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let a=0;a<t.length;a++){const c=t.charCodeAt(a+1)||null,p=t.charCodeAt(a-1)||null;r+=c&&_d(c)&&!Iu[t[a+1]]||p&&_d(p)&&!Iu[t[a-1]]||!Iu[t[a]]?t[a]:Iu[t[a]]}return r})(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&zd[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&zd[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const a=new rc;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}getMaxImageSize(t){let r=0,a=0;for(let c=0;c<this.length();c++){const p=this.getSection(c);if(p.imageName){const _=t[p.imageName];if(!_)continue;const v=_.displaySize;r=Math.max(r,v[0]),a=Math.max(a,v[1])}}return{maxImageWidth:r,maxImageHeight:a}}addTextSection(t,r){this.text+=t.text,this.sections.push(Mu.forText(t.scale,t.fontStack||r,t.verticalAlign));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Dt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Mu.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Dt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ed(n,t,r,a,c,p,_,v,b,S,I,L,F,V,U){const W=rc.fromFeature(n,c);let J;L===T.ao.vertical&&W.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:Le}=Ea;if(le&&W.sections.length===1){J=[];const Xe=le(W.toString(),uf(W,S,p,t,a,V));for(const lt of Xe){const Pt=new rc;Pt.text=lt,Pt.sections=W.sections;for(let Xt=0;Xt<lt.length;Xt++)Pt.sectionIndex.push(0);J.push(Pt)}}else if(Le){J=[];const Xe=Le(W.text,W.sectionIndex,uf(W,S,p,t,a,V));for(const lt of Xe){const Pt=new rc;Pt.text=lt[0],Pt.sectionIndex=lt[1],Pt.sections=W.sections,J.push(Pt)}}else J=(function(Xe,lt){const Pt=[],Xt=Xe.text;let Vt=0;for(const Gt of lt)Pt.push(Xe.substring(Vt,Gt)),Vt=Gt;return Vt<Xt.length&&Pt.push(Xe.substring(Vt,Xt.length)),Pt})(W,uf(W,S,p,t,a,V));const ye=[],Ce={positionedLines:ye,text:W.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(Xe,lt,Pt,Xt,Vt,Gt,wr,$t,Ht,gt,jr,Gr){let Ir=0,_r=0,hn=0,Jn=0;const _i=$t==="right"?1:$t==="left"?0:.5,Vi=Ci/Gr;let Ba=0;for(const Wn of Vt){Wn.trim();const Si=Wn.getMaxScale(),Bi={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[Ba]=Bi;const Fi=Bi.positionedGlyphs;let ra=0;if(!Wn.length()){_r+=Gt,++Ba;continue}const Fa=l1(Xt,Wn,Vi);for(let ha=0;ha<Wn.length();ha++){const gi=Wn.getSection(ha),Ii=Wn.getSectionIndex(ha),Mi=Wn.getCharCode(ha),ui=c1(Ht,jr,Mi);let qn;if(gi.imageName){if(Xe.iconsInText=!0,gi.scale=gi.scale*Vi,qn=h1(gi,ui,Si,Fa,Xt),!qn)continue;ra=Math.max(ra,qn.imageOffset)}else if(qn=u1(gi,Mi,ui,Fa,lt,Pt),!qn)continue;const{rect:no,metrics:oc,baselineOffset:io}=qn;Fi.push({glyph:Mi,imageName:gi.imageName,x:Ir,y:_r+io+-17,vertical:ui,scale:gi.scale,fontStack:gi.fontStack,sectionIndex:Ii,metrics:oc,rect:no}),ui?(Xe.verticalizable=!0,Ir+=(gi.imageName?oc.advance:Ci)*gi.scale+gt):Ir+=oc.advance*gi.scale+gt}Fi.length!==0&&(hn=Math.max(Ir-gt,hn),d1(Fi,0,Fi.length-1,_i)),Ir=0,Bi.lineOffset=Math.max(ra,(Si-1)*Ci);const Pi=Gt*Si+ra;_r+=Pi,Jn=Math.max(Pi,Jn),++Ba}const{horizontalAlign:ua,verticalAlign:Ri}=hf(wr);(function(Wn,Si,Bi,Fi,ra,Fa,Pi,ha,gi){const Ii=(Si-Bi)*ra;let Mi=0;Mi=Fa!==Pi?-ha*Fi- -17:-Fi*gi*Pi+.5*Pi;for(const ui of Wn)for(const qn of ui.positionedGlyphs)qn.x+=Ii,qn.y+=Mi})(Xe.positionedLines,_i,ua,Ri,hn,Jn,Gt,_r,Vt.length),Xe.top+=-Ri*_r,Xe.bottom=Xe.top+_r,Xe.left+=-ua*hn,Xe.right=Xe.left+hn})(Ce,t,r,a,J,_,v,b,L,S,F,U),!(function(Xe){for(const lt of Xe)if(lt.positionedGlyphs.length!==0)return!1;return!0})(ye)&&Ce}const zd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},o1={40:!0};function K_(n,t,r,a,c,p){if(t.imageName){const _=a[t.imageName];return _?_.displaySize[0]*t.scale*Ci/p+c:0}{const _=r[t.fontStack],v=_&&_[n];return v?v.metrics.advance*t.scale+c:0}}function J_(n,t,r,a){const c=Math.pow(n-t,2);return a?n<t?c/2:2*c:c+Math.abs(r)*r}function s1(n,t,r){let a=0;return n===10&&(a-=1e4),r&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function Q_(n,t,r,a,c,p){let _=null,v=J_(t,r,c,p);for(const b of a){const S=J_(t-b.x,r,c,p)+b.badness;S<=v&&(_=b,v=S)}return{index:n,x:t,priorBreak:_,badness:v}}function eg(n){return n?eg(n.priorBreak).concat(n.index):[]}function uf(n,t,r,a,c,p){if(!n)return[];const _=[],v=(function(L,F,V,U,W,J){let le=0;for(let Le=0;Le<L.length();Le++){const ye=L.getSection(Le);le+=K_(L.getCharCode(Le),ye,U,W,F,J)}return le/Math.max(1,Math.ceil(le/V))})(n,t,r,a,c,p),b=n.text.indexOf("â€‹")>=0;let S=0;for(let L=0;L<n.length();L++){const F=n.getSection(L),V=n.getCharCode(L);if(zd[V]||(S+=K_(V,F,a,c,t,p)),L<n.length()-1){const U=!((I=V)<11904)&&(!!un["CJK Compatibility Forms"](I)||!!un["CJK Compatibility"](I)||!!un["CJK Strokes"](I)||!!un["CJK Symbols and Punctuation"](I)||!!un["Enclosed CJK Letters and Months"](I)||!!un["Halfwidth and Fullwidth Forms"](I)||!!un["Ideographic Description Characters"](I)||!!un["Vertical Forms"](I)||ou.test(String.fromCodePoint(I)));(a1[V]||U||F.imageName||L!==n.length()-2&&o1[n.getCharCode(L+1)])&&_.push(Q_(L+1,S,v,_,s1(V,n.getCharCode(L+1),U&&b),!1))}}var I;return eg(Q_(n.length(),S,v,_,0,!0))}function hf(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function l1(n,t,r){const a=t.getMaxScale()*Ci,{maxImageWidth:c,maxImageHeight:p}=t.getMaxImageSize(n),_=Math.max(a,p*r);return{verticalLineContentWidth:Math.max(a,c*r),horizontalLineContentHeight:_}}function tg(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function c1(n,t,r){return!(n===T.ao.horizontal||!t&&!su(r)||t&&(zd[r]||(a=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function u1(n,t,r,a,c,p){const _=p[n.fontStack],v=(function(S,I,L,F){if(S&&S.rect)return S;const V=I[L.fontStack],U=V&&V[F];return U?{rect:null,metrics:U.metrics}:null})(_&&_[t],c,n,t);if(v===null)return null;let b;if(r)b=a.verticalLineContentWidth-n.scale*Ci;else{const S=tg(n.verticalAlign);b=(a.horizontalLineContentHeight-n.scale*Ci)*S}return{rect:v.rect,metrics:v.metrics,baselineOffset:b}}function h1(n,t,r,a,c){const p=c[n.imageName];if(!p)return null;const _=p.paddedRect,v=p.displaySize,b={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]};let S;if(t)S=a.verticalLineContentWidth-v[1]*n.scale;else{const I=tg(n.verticalAlign);S=(a.horizontalLineContentHeight-v[1]*n.scale)*I}return{rect:_,metrics:b,baselineOffset:S,imageOffset:(t?v[0]:v[1])*n.scale-Ci*r}}function d1(n,t,r,a){if(a===0)return;const c=n[r],p=(n[r].x+c.metrics.advance*c.scale)*a;for(let _=t;_<=r;_++)n[_].x-=p}function p1(n,t,r){const{horizontalAlign:a,verticalAlign:c}=hf(r),p=t[0]-n.displaySize[0]*a,_=t[1]-n.displaySize[1]*c;return{image:n,top:_,bottom:_+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function rg(n){var t,r;let a=n.left,c=n.top,p=n.right-a,_=n.bottom-c;const v=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",S=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&p/_<S||v==="proportional"){const I=Math.ceil(_*S);a*=I/p,p=I}}else if(v==="proportional"&&b==="stretchOnly"&&S!==0&&p/_>S){const I=Math.ceil(p/S);c*=I/_,_=I}return{x1:a,y1:c,x2:a+p,y2:c+_}}function ng(n,t,r,a,c,p){const _=n.image;let v;if(_.content){const J=_.content,le=_.pixelRatio||1;v=[J[0]/le,J[1]/le,_.displaySize[0]-J[2]/le,_.displaySize[1]-J[3]/le]}const b=t.left*p,S=t.right*p;let I,L,F,V;r==="width"||r==="both"?(V=c[0]+b-a[3],L=c[0]+S+a[1]):(V=c[0]+(b+S-_.displaySize[0])/2,L=V+_.displaySize[0]);const U=t.top*p,W=t.bottom*p;return r==="height"||r==="both"?(I=c[1]+U-a[0],F=c[1]+W+a[2]):(I=c[1]+(U+W-_.displaySize[1])/2,F=I+_.displaySize[1]),{image:_,top:I,right:L,bottom:F,left:V,collisionPadding:v}}const Uo=128,vs=32640;function ig(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Un(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=r;let p=0;for(;p<a.length&&a[p]<=n;)p++;p=Math.max(0,p-1);let _=p;for(;_<a.length&&a[_]<n+1;)_++;_=Math.min(a.length-1,_);const v=a[p],b=a[_];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:v,maxZoom:b,minSize:r.evaluate(new Un(v)),maxSize:r.evaluate(new Un(b)),interpolationType:c}}}function df(n,t,r){let a="never";const c=n.get(t);return c?a=c:n.get(r)&&(a="always"),a}const f1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ld(n,t,r,a,c,p,_,v,b,S,I,L,F){const V=v?Math.min(vs,Math.round(v[0])):0,U=v?Math.min(vs,Math.round(v[1])):0;n.emplaceBack(t,r,Math.round(32*a),Math.round(32*c),p,_,(V<<1)+(b?1:0),U,16*S,16*I,256*L,256*F)}function pf(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function m1(n){for(const t of n.sections)if(yd(t.text))return!0;return!1}class ff{constructor(t){this.layoutVertexArray=new Zt,this.indexArray=new Bn,this.programConfigurations=t,this.segments=new Kr,this.dynamicLayoutVertexArray=new Tt,this.opacityVertexArray=new mr,this.hasVisibleVertices=!1,this.placedSymbolArray=new $}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qy.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Zy.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,f1,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}nr("SymbolBuffers",ff);class mf{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Kr,this.collisionVertexArray=new An}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Uy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}nr("CollisionBuffers",mf);class nc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ig(this.zoom,r["text-size"]),this.iconSizeData=ig(this.zoom,r["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=df(a,"text-overlap","text-allow-overlap")!=="never"||df(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map((_=>T.ao[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new ff(new la(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new ff(new la(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new ne,this.lineVertexArray=new ue,this.symbolInstances=new Q,this.textAnchorOffsets=new he}calculateGlyphDependencies(t,r,a,c,p){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,(a||c)&&p){const v=Iu[t.charAt(_)];v&&(r[v.charCodeAt(0)]=!0)}}populate(t,r,a){const c=this.layers[0],p=c.layout,_=p.get("text-font"),v=p.get("text-field"),b=p.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof Sn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!S&&!I)return;const F=r.iconDependencies,V=r.glyphDependencies,U=r.availableImages,W=new Un(this.zoom,{globalState:this.globalState});for(const{feature:J,id:le,index:Le,sourceLayerIndex:ye}of t){const Ce=c._featureFilter.needGeometry,Xe=ro(J,Ce);if(!c._featureFilter.filter(W,Xe,a))continue;let lt,Pt;if(Ce||(Xe.geometry=bo(J)),S){const Vt=c.getValueAndResolveTokens("text-field",Xe,a,U),Gt=Sn.factory(Vt),wr=this.hasRTLText=this.hasRTLText||m1(Gt);(!wr||Ea.getRTLTextPluginStatus()==="unavailable"||wr&&Ea.isParsed())&&(lt=Gy(Gt,c,Xe))}if(I){const Vt=c.getValueAndResolveTokens("icon-image",Xe,a,U);Pt=Vt instanceof Gn?Vt:Gn.fromString(Vt)}if(!lt&&!Pt)continue;const Xt=this.sortFeaturesByKey?L.evaluate(Xe,{},a):void 0;if(this.features.push({id:le,text:lt,icon:Pt,index:Le,sourceLayerIndex:ye,geometry:Xe.geometry,properties:J.properties,type:ec.types[J.type],sortKey:Xt}),Pt&&(F[Pt.name]=!0),lt){const Vt=_.evaluate(Xe,{},a).join(","),Gt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ao.vertical)>=0;for(const wr of lt.sections)if(wr.image)F[wr.image.name]=!0;else{const $t=jl(lt.toString()),Ht=wr.fontStack||Vt,gt=V[Ht]=V[Ht]||{};this.calculateGlyphDependencies(wr.text,gt,Gt,this.allowVerticalPlacement,$t)}}}p.get("symbol-placement")==="line"&&(this.features=(function(J){const le={},Le={},ye=[];let Ce=0;function Xe(Vt){ye.push(J[Vt]),Ce++}function lt(Vt,Gt,wr){const $t=Le[Vt];return delete Le[Vt],Le[Gt]=$t,ye[$t].geometry[0].pop(),ye[$t].geometry[0]=ye[$t].geometry[0].concat(wr[0]),$t}function Pt(Vt,Gt,wr){const $t=le[Gt];return delete le[Gt],le[Vt]=$t,ye[$t].geometry[0].shift(),ye[$t].geometry[0]=wr[0].concat(ye[$t].geometry[0]),$t}function Xt(Vt,Gt,wr){const $t=wr?Gt[0][Gt[0].length-1]:Gt[0][0];return`${Vt}:${$t.x}:${$t.y}`}for(let Vt=0;Vt<J.length;Vt++){const Gt=J[Vt],wr=Gt.geometry,$t=Gt.text?Gt.text.toString():null;if(!$t){Xe(Vt);continue}const Ht=Xt($t,wr),gt=Xt($t,wr,!0);if(Ht in Le&&gt in le&&Le[Ht]!==le[gt]){const jr=Pt(Ht,gt,wr),Gr=lt(Ht,gt,ye[jr].geometry);delete le[Ht],delete Le[gt],Le[Xt($t,ye[Gr].geometry,!0)]=Gr,ye[jr].geometry=null}else Ht in Le?lt(Ht,gt,wr):gt in le?Pt(Ht,gt,wr):(Xe(Vt),le[Ht]=Ce-1,Le[gt]=Ce-1)}return ye.filter((Vt=>Vt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((J,le)=>J.sortKey-le.sortKey))}update(t,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const a=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(r[t.segment+1]),p=t.dist(r[t.segment]);const _={};for(let v=t.segment+1;v<r.length;v++)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:c},v<r.length-1&&(c+=r[v+1].dist(r[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,c,p,_,v,b,S,I,L,F){const V=t.indexArray,U=t.layoutVertexArray,W=t.segments.prepareSegment(4*r.length,U,V,this.canOverlap?_.sortKey:void 0),J=this.glyphOffsetArray.length,le=W.vertexLength,Le=this.allowVerticalPlacement&&v===T.ao.vertical?Math.PI/2:0,ye=_.text&&_.text.sections;for(let Ce=0;Ce<r.length;Ce++){const{tl:Xe,tr:lt,bl:Pt,br:Xt,tex:Vt,pixelOffsetTL:Gt,pixelOffsetBR:wr,minFontScaleX:$t,minFontScaleY:Ht,glyphOffset:gt,isSDF:jr,sectionIndex:Gr}=r[Ce],Ir=W.vertexLength,_r=gt[1];Ld(U,b.x,b.y,Xe.x,_r+Xe.y,Vt.x,Vt.y,a,jr,Gt.x,Gt.y,$t,Ht),Ld(U,b.x,b.y,lt.x,_r+lt.y,Vt.x+Vt.w,Vt.y,a,jr,wr.x,Gt.y,$t,Ht),Ld(U,b.x,b.y,Pt.x,_r+Pt.y,Vt.x,Vt.y+Vt.h,a,jr,Gt.x,wr.y,$t,Ht),Ld(U,b.x,b.y,Xt.x,_r+Xt.y,Vt.x+Vt.w,Vt.y+Vt.h,a,jr,wr.x,wr.y,$t,Ht),pf(t.dynamicLayoutVertexArray,b,Le),V.emplaceBack(Ir,Ir+2,Ir+1),V.emplaceBack(Ir+1,Ir+2,Ir+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Ce!==r.length-1&&Gr===r[Ce+1].sectionIndex||t.programConfigurations.populatePaintArrays(U.length,_,_.index,{},F,ye&&ye[Gr])}t.placedSymbolArray.emplaceBack(b.x,b.y,J,this.glyphOffsetArray.length-J,le,S,I,b.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],v,0,!1,0,L)}_addCollisionDebugVertex(t,r,a,c,p,_){return r.emplaceBack(0,0),t.emplaceBack(a.x,a.y,c,p,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,r,a,c,p,_,v){const b=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),S=b.vertexLength,I=p.layoutVertexArray,L=p.collisionVertexArray,F=v.anchorX,V=v.anchorY;this._addCollisionDebugVertex(I,L,_,F,V,new B(t,r)),this._addCollisionDebugVertex(I,L,_,F,V,new B(a,r)),this._addCollisionDebugVertex(I,L,_,F,V,new B(a,c)),this._addCollisionDebugVertex(I,L,_,F,V,new B(t,c)),b.vertexLength+=4;const U=p.indexArray;U.emplaceBack(S,S+1),U.emplaceBack(S+1,S+2),U.emplaceBack(S+2,S+3),U.emplaceBack(S+3,S),b.primitiveLength+=4}addDebugCollisionBoxes(t,r,a,c){for(let p=t;p<r;p++){const _=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,c?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mf(Jr,$_.members,Ln),this.iconCollisionBox=new mf(Jr,$_.members,Ln);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,a,c,p,_,v,b,S){const I={};for(let L=r;L<a;L++){const F=t.get(L);I.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},I.textFeatureIndex=F.featureIndex;break}for(let L=c;L<p;L++){const F=t.get(L);I.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},I.verticalTextFeatureIndex=F.featureIndex;break}for(let L=_;L<v;L++){const F=t.get(L);I.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},I.iconFeatureIndex=F.featureIndex;break}for(let L=b;L<S;L++){const F=t.get(L);I.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},I.verticalIconFeatureIndex=F.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const a=t.placedSymbolArray.get(r),c=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<c;p+=4)t.indexArray.emplaceBack(p,p+2,p+1),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),a=Math.cos(t),c=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);c.push(0|Math.round(r*b.anchorX+a*b.anchorY)),p.push(b.featureIndex)}return _.sort(((v,b)=>c[v]-c[b]||p[b]-p[v])),_}addToSortKeyRanges(t,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(((c,p,_)=>{c>=0&&_.indexOf(c)===p&&this.addIndicesForPlacedSymbol(this.text,c)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ag,og;nr("SymbolBucket",nc,{omit:["layers","collisionBoxArray","features","compareText"]}),nc.MAX_GLYPHS=65535,nc.addDynamicAttributes=pf;var _f={get paint(){return og=og||new Zi({"icon-opacity":new Or(xe.paint_symbol["icon-opacity"]),"icon-color":new Or(xe.paint_symbol["icon-color"]),"icon-halo-color":new Or(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Or(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Or(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new yr(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new yr(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Or(xe.paint_symbol["text-opacity"]),"text-color":new Or(xe.paint_symbol["text-color"],{runtimeType:Yt,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Or(xe.paint_symbol["text-halo-color"]),"text-halo-width":new Or(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Or(xe.paint_symbol["text-halo-blur"]),"text-translate":new yr(xe.paint_symbol["text-translate"]),"text-translate-anchor":new yr(xe.paint_symbol["text-translate-anchor"])})},get layout(){return ag=ag||new Zi({"symbol-placement":new yr(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new yr(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yr(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Or(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yr(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yr(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new yr(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new yr(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new yr(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yr(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Or(xe.layout_symbol["icon-size"]),"icon-text-fit":new yr(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yr(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Or(xe.layout_symbol["icon-image"]),"icon-rotate":new Or(xe.layout_symbol["icon-rotate"]),"icon-padding":new Or(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new yr(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Or(xe.layout_symbol["icon-offset"]),"icon-anchor":new Or(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yr(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yr(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yr(xe.layout_symbol["text-rotation-alignment"]),"text-field":new Or(xe.layout_symbol["text-field"]),"text-font":new Or(xe.layout_symbol["text-font"]),"text-size":new Or(xe.layout_symbol["text-size"]),"text-max-width":new Or(xe.layout_symbol["text-max-width"]),"text-line-height":new yr(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Or(xe.layout_symbol["text-letter-spacing"]),"text-justify":new Or(xe.layout_symbol["text-justify"]),"text-radial-offset":new Or(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yr(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Or(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Or(xe.layout_symbol["text-anchor"]),"text-max-angle":new yr(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new yr(xe.layout_symbol["text-writing-mode"]),"text-rotate":new Or(xe.layout_symbol["text-rotate"]),"text-padding":new yr(xe.layout_symbol["text-padding"]),"text-keep-upright":new yr(xe.layout_symbol["text-keep-upright"]),"text-transform":new Or(xe.layout_symbol["text-transform"]),"text-offset":new Or(xe.layout_symbol["text-offset"]),"text-allow-overlap":new yr(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new yr(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new yr(xe.layout_symbol["text-ignore-placement"]),"text-optional":new yr(xe.layout_symbol["text-optional"])})}};class sg{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:_t,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nr("FormatSectionOverride",sg,{omit:["defaultValue"]});class Dd extends xa{constructor(t){super(t,_f)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const p of a)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,c){const p=this.layout.get(t).evaluate(r,{},a,c),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||zl(_.value)||!p?p:(function(v,b){return b.replace(/{([^{}]+)}/g,((S,I)=>v&&I in v?String(v[I]):""))})(r.properties,p)}createBucket(t){return new nc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of _f.paint.overridableProperties){if(!Dd.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),a=new sg(r),c=new Wc(a,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new qs("source",c):new Xc("composite",c,r.value.zoomStops),this.paint._values[t]=new $a(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Dd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const a=t.get("text-field"),c=_f.paint.properties[r];let p=!1;const _=v=>{for(const b of v)if(c.overrides&&c.overrides.hasOverride(b))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Sn)_(a.value.value.sections);else if(a.value.kind==="source"){const v=S=>{p||(S instanceof _a&&Lr(S.value)===pn?_(S.value.sections):S instanceof Ao?_(S.sections):S.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return p}}let lg;var _1={get paint(){return lg=lg||new Zi({"background-color":new yr(xe.paint_background["background-color"]),"background-pattern":new _o(xe.paint_background["background-pattern"]),"background-opacity":new yr(xe.paint_background["background-opacity"])})}};class g1 extends xa{constructor(t){super(t,_1)}}let cg;var v1={get paint(){return cg=cg||new Zi({"raster-opacity":new yr(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new yr(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yr(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yr(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new yr(xe.paint_raster["raster-saturation"]),"raster-contrast":new yr(xe.paint_raster["raster-contrast"]),"raster-resampling":new yr(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new yr(xe.paint_raster["raster-fade-duration"])})}};class y1 extends xa{constructor(t){super(t,v1)}}class x1 extends xa{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class b1{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const w1={once:!0},gf=63710088e-1;class ys{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ys(at(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,a=this.lat*r,c=t.lat*r,p=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*r);return gf*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof ys)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ys(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ys(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ug=2*Math.PI*gf;function hg(n){return ug*Math.cos(n*Math.PI/180)}function dg(n){return(180+n)/360}function pg(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function fg(n,t){return n/hg(t)}function vf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function mg(n,t){return n*hg(vf(t))}class ku{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){const a=ys.convert(t);return new ku(dg(a.lng),pg(a.lat),fg(r,a.lat))}toLngLat(){return new ys(360*this.x-180,vf(this.y))}toAltitude(){return mg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ug*(t=vf(this.y),1/Math.cos(t*Math.PI/180));var t}}function _g(n,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class yf{constructor(t,r,a){if(!(function(c,p,_){return!(c<0||c>25||_<0||_>=Math.pow(2,c)||p<0||p>=Math.pow(2,c))})(t,r,a))throw new Error(`x=${r}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=a,this.key=ic(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,a){const c=(_=this.y,v=this.z,b=_g(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),S=_g(256*(p+1),256*(_+1),v),b[0]+","+b[1]+","+S[0]+","+S[1]);var p,_,v,b,S;const I=(function(L,F,V){let U,W="";for(let J=L;J>0;J--)U=1<<J-1,W+=(F&U?1:0)+(V&U?2:0);return W})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new B((t.x*r-this.x)*oe,(t.y*r-this.y)*oe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gg{constructor(t,r){this.wrap=t,this.canonical=r,this.key=ic(t,r.z,r.z,r.x,r.y)}}class Ra{constructor(t,r,a,c,p){if(this.terrainRttPosMatrix32f=null,t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=r,this.canonical=new yf(a,+c,+p),this.key=ic(r,t,a,c,p)}clone(){return new Ra(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Ra(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ra(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?ic(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):ic(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Ra(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Ra(r,this.wrap,r,a,c),new Ra(r,this.wrap,r,a+1,c),new Ra(r,this.wrap,r,a,c+1),new Ra(r,this.wrap,r,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ra(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ra(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new ku(t.x-this.wrap,t.y))}}function ic(n,t,r,a,c){(n*=2)<0&&(n=-1*n-1);const p=1<<r;return(p*p*n+p*c+a).toString(36)+r.toString(36)+t.toString(36)}function Au(n,t){return t?n.properties[t]:n.id}nr("CanonicalTileID",yf),nr("OverscaledTileID",Ra,{omit:["terrainRttPosMatrix32f"]});class tl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new tl;return r.extend(t(new B(this.minX,this.minY))),r.extend(t(new B(this.maxX,this.minY))),r.extend(t(new B(this.minX,this.maxY))),r.extend(t(new B(this.maxX,this.maxY))),r}static fromPoints(t){const r=new tl;for(const a of t)r.extend(a);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class vg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class yg{constructor(t,r,a,c,p){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=a,t._y=c,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class xg{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Xs(oe,16,0),this.grid3D=new Xs(oe,16,0),this.featureIndexArray=new Pe,this.promoteId=r}insert(t,r,a,c,p,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,p);const b=_?this.grid3D:this.grid;for(let S=0;S<r.length;S++){const I=r[S],L=[1/0,1/0,-1/0,-1/0];for(let F=0;F<I.length;F++){const V=I[F];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}L[0]<oe&&L[1]<oe&&L[2]>=0&&L[3]>=0&&b.insert(v,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new B_(new lf(this.rawTileData)).layers,this.sourceLayerCoder=new vg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,a,c){this.loadVTLayers();const p=t.params,_=oe/t.tileSize/t.scale,v=Bo(p.filter),b=t.queryGeometry,S=t.queryPadding*_,I=tl.fromPoints(b),L=this.grid.query(I.minX-S,I.minY-S,I.maxX+S,I.maxY+S),F=tl.fromPoints(t.cameraQueryGeometry).expandBy(S),V=this.grid3D.query(F.minX,F.minY,F.maxX,F.maxY,((J,le,Le,ye)=>(function(Ce,Xe,lt,Pt,Xt){for(const Gt of Ce)if(Xe<=Gt.x&&lt<=Gt.y&&Pt>=Gt.x&&Xt>=Gt.y)return!0;const Vt=[new B(Xe,lt),new B(Xe,Xt),new B(Pt,Xt),new B(Pt,lt)];if(Ce.length>2){for(const Gt of Vt)if(Yl(Ce,Gt))return!0}for(let Gt=0;Gt<Ce.length-1;Gt++)if(ey(Ce[Gt],Ce[Gt+1],Vt))return!0;return!1})(t.cameraQueryGeometry,J-S,le-S,Le+S,ye+S)));for(const J of V)L.push(J);L.sort(T1);const U={};let W;for(let J=0;J<L.length;J++){const le=L[J];if(le===W)continue;W=le;const Le=this.featureIndexArray.get(le);let ye=null;this.loadMatchingFeature(U,Le.bucketIndex,Le.sourceLayerIndex,Le.featureIndex,v,p.layers,p.availableImages,r,a,c,((Ce,Xe,lt)=>(ye||(ye=bo(Ce)),Xe.queryIntersectsFeature({queryGeometry:b,feature:Ce,featureState:lt,geometry:ye,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return U}loadMatchingFeature(t,r,a,c,p,_,v,b,S,I,L){const F=this.bucketLayerIDs[r];if(_&&!F.some((J=>_.has(J))))return;const V=this.sourceLayerCoder.decode(a),U=this.vtLayers[V].feature(c);if(p.needGeometry){const J=ro(U,!0);if(!p.filter(new Un(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!p.filter(new Un(this.tileID.overscaledZ),U))return;const W=this.getId(U,V);for(let J=0;J<F.length;J++){const le=F[J];if(_&&!_.has(le))continue;const Le=b[le];if(!Le)continue;let ye={};W&&I&&(ye=I.getState(Le.sourceLayer||"_geojsonTileLayer",W));const Ce=dt({},S[le]);Ce.paint=bg(Ce.paint,Le.paint,U,ye,v),Ce.layout=bg(Ce.layout,Le.layout,U,ye,v);const Xe=!L||L(U,Le,ye);if(!Xe)continue;const lt=new yg(U,this.z,this.x,this.y,W);lt.layer=Ce;let Pt=t[le];Pt===void 0&&(Pt=t[le]=[]),Pt.push({featureIndex:c,feature:lt,intersectionZ:Xe})}}lookupSymbolFeatures(t,r,a,c,p,_,v,b){const S={};this.loadVTLayers();const I=Bo(p);for(const L of t)this.loadMatchingFeature(S,a,c,L,I,_,v,b,r);return S}hasLayer(t){for(const r of this.bucketLayerIDs)for(const a of r)if(t===a)return!0;return!1}getId(t,r){var a;let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((a=t.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(c=Number(t.properties.cluster_id))),c}}function bg(n,t,r,a,c){return yt(n,((p,_)=>{const v=t instanceof ql?t.get(_):null;return v&&v.evaluate?v.evaluate(r,a,c):v}))}function T1(n,t){return t-n}function wg(n,t,r,a,c){const p=[];for(let _=0;_<n.length;_++){const v=n[_];let b;for(let S=0;S<v.length-1;S++){let I=v[S],L=v[S+1];I.x<t&&L.x<t||(I.x<t?I=new B(t,I.y+(t-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x<t&&(L=new B(t,I.y+(t-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y<r&&L.y<r||(I.y<r?I=new B(I.x+(r-I.y)/(L.y-I.y)*(L.x-I.x),r)._round():L.y<r&&(L=new B(I.x+(r-I.y)/(L.y-I.y)*(L.x-I.x),r)._round()),I.x>=a&&L.x>=a||(I.x>=a?I=new B(a,I.y+(a-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x>=a&&(L=new B(a,I.y+(a-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y>=c&&L.y>=c||(I.y>=c?I=new B(I.x+(c-I.y)/(L.y-I.y)*(L.x-I.x),c)._round():L.y>=c&&(L=new B(I.x+(c-I.y)/(L.y-I.y)*(L.x-I.x),c)._round()),b&&I.equals(b[b.length-1])||(b=[I],p.push(b)),b.push(L)))))}}return p}nr("FeatureIndex",xg,{omit:["rawTileData","sourceLayerCoder"]});class xs extends B{constructor(t,r,a,c){super(t,r),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new xs(this.x,this.y,this.angle,this.segment)}}function Tg(n,t,r,a,c){if(t.segment===void 0||r===0)return!0;let p=t,_=t.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=n[_].dist(p),p=n[_]}v+=n[_].dist(n[_+1]),_++;const b=[];let S=0;for(;v<r/2;){const I=n[_],L=n[_+1];if(!L)return!1;let F=n[_-1].angleTo(I)-I.angleTo(L);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:F}),S+=F;v-b[0].distance>a;)S-=b.shift().angleDelta;if(S>c)return!1;_++,v+=I.dist(L)}return!0}function Cg(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function Sg(n,t,r){return n?.6*t*r:0}function Pg(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function C1(n,t,r,a,c,p){const _=Sg(r,c,p),v=Pg(r,a)*p;let b=0;const S=Cg(n)/2;for(let I=0;I<n.length-1;I++){const L=n[I],F=n[I+1],V=L.dist(F);if(b+V>S){const U=(S-b)/V,W=Za.number(L.x,F.x,U),J=Za.number(L.y,F.y,U),le=new xs(W,J,F.angleTo(L),I);return le._round(),!_||Tg(n,le,v,_,t)?le:void 0}b+=V}}function S1(n,t,r,a,c,p,_,v,b){const S=Sg(a,p,_),I=Pg(a,c),L=I*_,F=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-L<t/4&&(t=L+t/4),Ig(n,F?t/2*v%t:(I/2+2*p)*_*v%t,t,S,r,L,F,!1,b)}function Ig(n,t,r,a,c,p,_,v,b){const S=p/2,I=Cg(n);let L=0,F=t-r,V=[];for(let U=0;U<n.length-1;U++){const W=n[U],J=n[U+1],le=W.dist(J),Le=J.angleTo(W);for(;F+r<L+le;){F+=r;const ye=(F-L)/le,Ce=Za.number(W.x,J.x,ye),Xe=Za.number(W.y,J.y,ye);if(Ce>=0&&Ce<b&&Xe>=0&&Xe<b&&F-S>=0&&F+S<=I){const lt=new xs(Ce,Xe,Le,U);lt._round(),a&&!Tg(n,lt,p,a,c)||V.push(lt)}}L+=le}return v||V.length||_||(V=Ig(n,L/2,r,a,c,p,_,!0,b)),V}function Mg(n,t,r,a){const c=[],p=n.image,_=p.pixelRatio,v=p.paddedRect.w-2,b=p.paddedRect.h-2;let S={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const I=p.stretchX||[[0,v]],L=p.stretchY||[[0,b]],F=(gt,jr)=>gt+jr[1]-jr[0],V=I.reduce(F,0),U=L.reduce(F,0),W=v-V,J=b-U;let le=0,Le=V,ye=0,Ce=U,Xe=0,lt=W,Pt=0,Xt=J;if(p.content&&a){const gt=p.content,jr=gt[2]-gt[0],Gr=gt[3]-gt[1];(p.textFitWidth||p.textFitHeight)&&(S=rg(n)),le=Rd(I,0,gt[0]),ye=Rd(L,0,gt[1]),Le=Rd(I,gt[0],gt[2]),Ce=Rd(L,gt[1],gt[3]),Xe=gt[0]-le,Pt=gt[1]-ye,lt=jr-Le,Xt=Gr-Ce}const Vt=S.x1,Gt=S.y1,wr=S.x2-Vt,$t=S.y2-Gt,Ht=(gt,jr,Gr,Ir)=>{const _r=Bd(gt.stretch-le,Le,wr,Vt),hn=Fd(gt.fixed-Xe,lt,gt.stretch,V),Jn=Bd(jr.stretch-ye,Ce,$t,Gt),_i=Fd(jr.fixed-Pt,Xt,jr.stretch,U),Vi=Bd(Gr.stretch-le,Le,wr,Vt),Ba=Fd(Gr.fixed-Xe,lt,Gr.stretch,V),ua=Bd(Ir.stretch-ye,Ce,$t,Gt),Ri=Fd(Ir.fixed-Pt,Xt,Ir.stretch,U),Wn=new B(_r,Jn),Si=new B(Vi,Jn),Bi=new B(Vi,ua),Fi=new B(_r,ua),ra=new B(hn/_,_i/_),Fa=new B(Ba/_,Ri/_),Pi=t*Math.PI/180;if(Pi){const Ii=Math.sin(Pi),Mi=Math.cos(Pi),ui=[Mi,-Ii,Ii,Mi];Wn._matMult(ui),Si._matMult(ui),Fi._matMult(ui),Bi._matMult(ui)}const ha=gt.stretch+gt.fixed,gi=jr.stretch+jr.fixed;return{tl:Wn,tr:Si,bl:Fi,br:Bi,tex:{x:p.paddedRect.x+1+ha,y:p.paddedRect.y+1+gi,w:Gr.stretch+Gr.fixed-ha,h:Ir.stretch+Ir.fixed-gi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ra,pixelOffsetBR:Fa,minFontScaleX:lt/_/wr,minFontScaleY:Xt/_/$t,isSDF:r}};if(a&&(p.stretchX||p.stretchY)){const gt=kg(I,W,V),jr=kg(L,J,U);for(let Gr=0;Gr<gt.length-1;Gr++){const Ir=gt[Gr],_r=gt[Gr+1];for(let hn=0;hn<jr.length-1;hn++)c.push(Ht(Ir,jr[hn],_r,jr[hn+1]))}}else c.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return c}function Rd(n,t,r){let a=0;for(const c of n)a+=Math.max(t,Math.min(r,c[1]))-Math.max(t,Math.min(r,c[0]));return a}function kg(n,t,r){const a=[{fixed:-1,stretch:0}];for(const[c,p]of n){const _=a[a.length-1];a.push({fixed:c-_.stretch,stretch:_.stretch}),a.push({fixed:c-_.stretch,stretch:_.stretch+(p-c)})}return a.push({fixed:t+1,stretch:r}),a}function Bd(n,t,r,a){return n/t*r+a}function Fd(n,t,r,a){return n-t*r/a}nr("Anchor",xs);class Od{constructor(t,r,a,c,p,_,v,b,S,I){var L;if(this.boxStartIndex=t.length,S){let F=_.top,V=_.bottom;const U=_.collisionPadding;U&&(F-=U[1],V+=U[3]);let W=V-F;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const F=!((L=_.image)===null||L===void 0)&&L.content&&(_.image.textFitWidth||_.image.textFitHeight)?rg(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};F.y1=F.y1*v-b[0],F.y2=F.y2*v+b[2],F.x1=F.x1*v-b[3],F.x2=F.x2*v+b[1];const V=_.collisionPadding;if(V&&(F.x1-=V[0]*v,F.y1-=V[1]*v,F.x2+=V[2]*v,F.y2+=V[3]*v),I){const U=new B(F.x1,F.y1),W=new B(F.x2,F.y1),J=new B(F.x1,F.y2),le=new B(F.x2,F.y2),Le=I*Math.PI/180;U._rotate(Le),W._rotate(Le),J._rotate(Le),le._rotate(Le),F.x1=Math.min(U.x,W.x,J.x,le.x),F.x2=Math.max(U.x,W.x,J.x,le.x),F.y1=Math.min(U.y,W.y,J.y,le.y),F.y2=Math.max(U.y,W.y,J.y,le.y)}t.emplaceBack(r.x,r.y,F.x1,F.y1,F.x2,F.y2,a,c,p)}this.boxEndIndex=t.length}}class P1{constructor(t=[],r=(a,c)=>a<c?-1:a>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:a}=this,c=r[t];for(;t>0;){const p=t-1>>1,_=r[p];if(a(c,_)>=0)break;r[t]=_,t=p}r[t]=c}_down(t){const{data:r,compare:a}=this,c=this.length>>1,p=r[t];for(;t<c;){let _=1+(t<<1);const v=_+1;if(v<this.length&&a(r[v],r[_])<0&&(_=v),a(r[_],p)>=0)break;r[t]=r[_],t=_}r[t]=p}}function I1(n,t=1,r=!1){const a=tl.fromPoints(n[0]),c=Math.min(a.width(),a.height());let p=c/2;const _=new P1([],M1),{minX:v,minY:b,maxX:S,maxY:I}=a;if(c===0)return new B(v,b);for(let V=v;V<S;V+=c)for(let U=b;U<I;U+=c)_.push(new ac(V+p,U+p,p,n));let L=(function(V){let U=0,W=0,J=0;const le=V[0];for(let Le=0,ye=le.length,Ce=ye-1;Le<ye;Ce=Le++){const Xe=le[Le],lt=le[Ce],Pt=Xe.x*lt.y-lt.x*Xe.y;W+=(Xe.x+lt.x)*Pt,J+=(Xe.y+lt.y)*Pt,U+=3*Pt}return new ac(W/U,J/U,0,V)})(n),F=_.length;for(;_.length;){const V=_.pop();(V.d>L.d||!L.d)&&(L=V,r&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-L.d<=t||(p=V.h/2,_.push(new ac(V.p.x-p,V.p.y-p,p,n)),_.push(new ac(V.p.x+p,V.p.y-p,p,n)),_.push(new ac(V.p.x-p,V.p.y+p,p,n)),_.push(new ac(V.p.x+p,V.p.y+p,p,n)),F+=4)}return r&&(console.log(`num probes: ${F}`),console.log(`best distance: ${L.d}`)),L.p}function M1(n,t){return t.max-n.max}function ac(n,t,r,a){this.p=new B(n,t),this.h=r,this.d=(function(c,p){let _=!1,v=1/0;for(let b=0;b<p.length;b++){const S=p[b];for(let I=0,L=S.length,F=L-1;I<L;F=I++){const V=S[I],U=S[F];V.y>c.y!=U.y>c.y&&c.x<(U.x-V.x)*(c.y-V.y)/(U.y-V.y)+V.x&&(_=!_),v=Math.min(v,p_(c,V,U))}}return(_?1:-1)*Math.sqrt(v)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var ji;T.aE=void 0,(ji=T.aE||(T.aE={}))[ji.center=1]="center",ji[ji.left=2]="left",ji[ji.right=3]="right",ji[ji.top=4]="top",ji[ji.bottom=5]="bottom",ji[ji["top-left"]=6]="top-left",ji[ji["top-right"]=7]="top-right",ji[ji["bottom-left"]=8]="bottom-left",ji[ji["bottom-right"]=9]="bottom-right";const xf=Number.POSITIVE_INFINITY;function Ag(n,t){return t[1]!==xf?(function(r,a,c){let p=0,_=0;switch(a=Math.abs(a),c=Math.abs(c),r){case"top-right":case"top-left":case"top":_=c-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-c}switch(r){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}return[p,_]})(n,t[0],t[1]):(function(r,a){let c=0,p=0;a<0&&(a=0);const _=a/Math.SQRT2;switch(r){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-a;break;case"top":p=a-7}switch(r){case"top-right":case"bottom-right":c=-_;break;case"top-left":case"bottom-left":c=_;break;case"left":c=a;break;case"right":c=-a}return[c,p]})(n,t[0])}function Eg(n,t,r){var a;const c=n.layout,p=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},r);if(p){const v=p.values,b=[];for(let S=0;S<v.length;S+=2){const I=b[S]=v[S],L=v[S+1].map((F=>F*Ci));I.startsWith("top")?L[1]-=7:I.startsWith("bottom")&&(L[1]+=7),b[S+1]=L}return new pi(b)}const _=c.get("text-variable-anchor");if(_){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},r)*Ci,xf]:c.get("text-offset").evaluate(t,{},r).map((S=>S*Ci));const b=[];for(const S of _)b.push(S,Ag(S,v));return new pi(b)}return null}function bf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k1(n,t,r,a,c,p,_,v,b,S,I,L){let F=p.textMaxSize.evaluate(t,{});F===void 0&&(F=_);const V=n.layers[0].layout,U=V.get("icon-offset").evaluate(t,{},I),W=Lg(r.horizontal),J=_/24,le=n.tilePixelRatio*J,Le=n.tilePixelRatio*F/24,ye=n.tilePixelRatio*v,Ce=n.tilePixelRatio*V.get("symbol-spacing"),Xe=V.get("text-padding")*n.tilePixelRatio,lt=(function(Gr,Ir,_r,hn=1){const Jn=Gr.get("icon-padding").evaluate(Ir,{},_r),_i=Jn&&Jn.values;return[_i[0]*hn,_i[1]*hn,_i[2]*hn,_i[3]*hn]})(V,t,I,n.tilePixelRatio),Pt=V.get("text-max-angle")/180*Math.PI,Xt=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Vt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Gt=V.get("symbol-placement"),wr=Ce/2,$t=V.get("icon-text-fit");let Ht;a&&$t!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Ht=ng(a,r.vertical,$t,V.get("icon-text-fit-padding"),U,J)),W&&(a=ng(a,W,$t,V.get("icon-text-fit-padding"),U,J)));const gt=I?L.line.getGranularityForZoomLevel(I.z):1,jr=(Gr,Ir)=>{Ir.x<0||Ir.x>=oe||Ir.y<0||Ir.y>=oe||(function(_r,hn,Jn,_i,Vi,Ba,ua,Ri,Wn,Si,Bi,Fi,ra,Fa,Pi,ha,gi,Ii,Mi,ui,qn,no,oc,io,z1){const sc=_r.addToLineVertexArray(hn,Jn);let rl,lc,cc,uc,Fg=0,Og=0,Ng=0,jg=0,kf=-1,Af=-1;const $o={};let Vg=ms("");if(_r.allowVerticalPlacement&&_i.vertical){const Gi=Ri.layout.get("text-rotate").evaluate(qn,{},io)+90;cc=new Od(Wn,hn,Si,Bi,Fi,_i.vertical,ra,Fa,Pi,Gi),ua&&(uc=new Od(Wn,hn,Si,Bi,Fi,ua,gi,Ii,Pi,Gi))}if(Vi){const Gi=Ri.layout.get("icon-rotate").evaluate(qn,{}),Oa=Ri.layout.get("icon-text-fit")!=="none",nl=Mg(Vi,Gi,oc,Oa),oo=ua?Mg(ua,Gi,oc,Oa):void 0;lc=new Od(Wn,hn,Si,Bi,Fi,Vi,gi,Ii,!1,Gi),Fg=4*nl.length;const il=_r.iconSizeData;let wo=null;il.kind==="source"?(wo=[Uo*Ri.layout.get("icon-size").evaluate(qn,{})],wo[0]>vs&&Dt(`${_r.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):il.kind==="composite"&&(wo=[Uo*no.compositeIconSizes[0].evaluate(qn,{},io),Uo*no.compositeIconSizes[1].evaluate(qn,{},io)],(wo[0]>vs||wo[1]>vs)&&Dt(`${_r.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_r.addSymbols(_r.icon,nl,wo,ui,Mi,qn,T.ao.none,hn,sc.lineStartIndex,sc.lineLength,-1,io),kf=_r.icon.placedSymbolArray.length-1,oo&&(Og=4*oo.length,_r.addSymbols(_r.icon,oo,wo,ui,Mi,qn,T.ao.vertical,hn,sc.lineStartIndex,sc.lineLength,-1,io),Af=_r.icon.placedSymbolArray.length-1)}const qg=Object.keys(_i.horizontal);for(const Gi of qg){const Oa=_i.horizontal[Gi];if(!rl){Vg=ms(Oa.text);const oo=Ri.layout.get("text-rotate").evaluate(qn,{},io);rl=new Od(Wn,hn,Si,Bi,Fi,Oa,ra,Fa,Pi,oo)}const nl=Oa.positionedLines.length===1;if(Ng+=zg(_r,hn,Oa,Ba,Ri,Pi,qn,ha,sc,_i.vertical?T.ao.horizontal:T.ao.horizontalOnly,nl?qg:[Gi],$o,kf,no,io),nl)break}_i.vertical&&(jg+=zg(_r,hn,_i.vertical,Ba,Ri,Pi,qn,ha,sc,T.ao.vertical,["vertical"],$o,Af,no,io));const L1=rl?rl.boxStartIndex:_r.collisionBoxArray.length,D1=rl?rl.boxEndIndex:_r.collisionBoxArray.length,R1=cc?cc.boxStartIndex:_r.collisionBoxArray.length,B1=cc?cc.boxEndIndex:_r.collisionBoxArray.length,F1=lc?lc.boxStartIndex:_r.collisionBoxArray.length,O1=lc?lc.boxEndIndex:_r.collisionBoxArray.length,N1=uc?uc.boxStartIndex:_r.collisionBoxArray.length,j1=uc?uc.boxEndIndex:_r.collisionBoxArray.length;let ao=-1;const jd=(Gi,Oa)=>Gi&&Gi.circleDiameter?Math.max(Gi.circleDiameter,Oa):Oa;ao=jd(rl,ao),ao=jd(cc,ao),ao=jd(lc,ao),ao=jd(uc,ao);const Zg=ao>-1?1:0;Zg&&(ao*=z1/Ci),_r.glyphOffsetArray.length>=nc.MAX_GLYPHS&&Dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qn.sortKey!==void 0&&_r.addToSortKeyRanges(_r.symbolInstances.length,qn.sortKey);const V1=Eg(Ri,qn,io),[q1,Z1]=(function(Gi,Oa){const nl=Gi.length,oo=Oa==null?void 0:Oa.values;if((oo==null?void 0:oo.length)>0)for(let il=0;il<oo.length;il+=2){const wo=oo[il+1];Gi.emplaceBack(T.aE[oo[il]],wo[0],wo[1])}return[nl,Gi.length]})(_r.textAnchorOffsets,V1);_r.symbolInstances.emplaceBack(hn.x,hn.y,$o.right>=0?$o.right:-1,$o.center>=0?$o.center:-1,$o.left>=0?$o.left:-1,$o.vertical||-1,kf,Af,Vg,L1,D1,R1,B1,F1,O1,N1,j1,Si,Ng,jg,Fg,Og,Zg,0,ra,ao,q1,Z1)})(n,Ir,Gr,r,a,c,Ht,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,le,[Xe,Xe,Xe,Xe],Xt,b,ye,lt,Vt,U,t,p,S,I,_)};if(Gt==="line")for(const Gr of wg(t.geometry,0,0,oe,oe)){const Ir=el(Gr,gt),_r=S1(Ir,Ce,Pt,r.vertical||W,a,24,Le,n.overscaling,oe);for(const hn of _r)W&&A1(n,W.text,wr,hn)||jr(Ir,hn)}else if(Gt==="line-center"){for(const Gr of t.geometry)if(Gr.length>1){const Ir=el(Gr,gt),_r=C1(Ir,Pt,r.vertical||W,a,24,Le);_r&&jr(Ir,_r)}}else if(t.type==="Polygon")for(const Gr of Fs(t.geometry,0)){const Ir=I1(Gr,16);jr(el(Gr[0],gt,!0),new xs(Ir.x,Ir.y,0))}else if(t.type==="LineString")for(const Gr of t.geometry){const Ir=el(Gr,gt);jr(Ir,new xs(Ir[0].x,Ir[0].y,0))}else if(t.type==="Point")for(const Gr of t.geometry)for(const Ir of Gr)jr([Ir],new xs(Ir.x,Ir.y,0))}function zg(n,t,r,a,c,p,_,v,b,S,I,L,F,V,U){const W=(function(Le,ye,Ce,Xe,lt,Pt,Xt,Vt){const Gt=Xe.layout.get("text-rotate").evaluate(Pt,{})*Math.PI/180,wr=[];for(const $t of ye.positionedLines)for(const Ht of $t.positionedGlyphs){if(!Ht.rect)continue;const gt=Ht.rect||{};let jr=4,Gr=!0,Ir=1,_r=0;const hn=(lt||Vt)&&Ht.vertical,Jn=Ht.metrics.advance*Ht.scale/2;if(Vt&&ye.verticalizable&&(_r=$t.lineOffset/2-(Ht.imageName?-(Ci-Ht.metrics.width*Ht.scale)/2:(Ht.scale-1)*Ci)),Ht.imageName){const Ii=Xt[Ht.imageName];Gr=Ii.sdf,Ir=Ii.pixelRatio,jr=1/Ir}const _i=lt?[Ht.x+Jn,Ht.y]:[0,0];let Vi=lt?[0,0]:[Ht.x+Jn+Ce[0],Ht.y+Ce[1]-_r],Ba=[0,0];hn&&(Ba=Vi,Vi=[0,0]);const ua=Ht.metrics.isDoubleResolution?2:1,Ri=(Ht.metrics.left-jr)*Ht.scale-Jn+Vi[0],Wn=(-Ht.metrics.top-jr)*Ht.scale+Vi[1],Si=Ri+gt.w/ua*Ht.scale/Ir,Bi=Wn+gt.h/ua*Ht.scale/Ir,Fi=new B(Ri,Wn),ra=new B(Si,Wn),Fa=new B(Ri,Bi),Pi=new B(Si,Bi);if(hn){const Ii=new B(-Jn,Jn- -17),Mi=-Math.PI/2,ui=12-Jn,qn=new B(22-ui,-(Ht.imageName?ui:0)),no=new B(...Ba);Fi._rotateAround(Mi,Ii)._add(qn)._add(no),ra._rotateAround(Mi,Ii)._add(qn)._add(no),Fa._rotateAround(Mi,Ii)._add(qn)._add(no),Pi._rotateAround(Mi,Ii)._add(qn)._add(no)}if(Gt){const Ii=Math.sin(Gt),Mi=Math.cos(Gt),ui=[Mi,-Ii,Ii,Mi];Fi._matMult(ui),ra._matMult(ui),Fa._matMult(ui),Pi._matMult(ui)}const ha=new B(0,0),gi=new B(0,0);wr.push({tl:Fi,tr:ra,bl:Fa,br:Pi,tex:gt,writingMode:ye.writingMode,glyphOffset:_i,sectionIndex:Ht.sectionIndex,isSDF:Gr,pixelOffsetTL:ha,pixelOffsetBR:gi,minFontScaleX:0,minFontScaleY:0})}return wr})(0,r,v,c,p,_,a,n.allowVerticalPlacement),J=n.textSizeData;let le=null;J.kind==="source"?(le=[Uo*c.layout.get("text-size").evaluate(_,{})],le[0]>vs&&Dt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):J.kind==="composite"&&(le=[Uo*V.compositeTextSizes[0].evaluate(_,{},U),Uo*V.compositeTextSizes[1].evaluate(_,{},U)],(le[0]>vs||le[1]>vs)&&Dt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,W,le,v,p,_,S,t,b.lineStartIndex,b.lineLength,F,U);for(const Le of I)L[Le]=n.text.placedSymbolArray.length-1;return 4*W.length}function Lg(n){for(const t in n)return n[t];return null}function A1(n,t,r,a){const c=n.compareText;if(t in c){const p=c[t];for(let _=p.length-1;_>=0;_--)if(a.dist(p[_])<r)return!0}else c[t]=[];return c[t].push(a),!1}const Dg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=Dg[15&a];if(!p)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new wf(v,_,p,t)}constructor(t,r=64,a=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=Dg.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Tf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:v}=this,b=[0,p.length-1,0],S=[];for(;b.length;){const I=b.pop()||0,L=b.pop()||0,F=b.pop()||0;if(L-F<=v){for(let J=F;J<=L;J++){const le=_[2*J],Le=_[2*J+1];le>=t&&le<=a&&Le>=r&&Le<=c&&S.push(p[J])}continue}const V=F+L>>1,U=_[2*V],W=_[2*V+1];U>=t&&U<=a&&W>=r&&W<=c&&S.push(p[V]),(I===0?t<=U:r<=W)&&(b.push(F),b.push(V-1),b.push(1-I)),(I===0?a>=U:c>=W)&&(b.push(V+1),b.push(L),b.push(1-I))}return S}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:_}=this,v=[0,c.length-1,0],b=[],S=a*a;for(;v.length;){const I=v.pop()||0,L=v.pop()||0,F=v.pop()||0;if(L-F<=_){for(let J=F;J<=L;J++)Bg(p[2*J],p[2*J+1],t,r)<=S&&b.push(c[J]);continue}const V=F+L>>1,U=p[2*V],W=p[2*V+1];Bg(U,W,t,r)<=S&&b.push(c[V]),(I===0?t-a<=U:r-a<=W)&&(v.push(F),v.push(V-1),v.push(1-I)),(I===0?t+a>=U:r+a>=W)&&(v.push(V+1),v.push(L),v.push(1-I))}return b}}function Tf(n,t,r,a,c,p){if(c-a<=r)return;const _=a+c>>1;Rg(n,t,_,a,c,p),Tf(n,t,r,a,_-1,1-p),Tf(n,t,r,_+1,c,1-p)}function Rg(n,t,r,a,c,p){for(;c>a;){if(c-a>600){const S=c-a+1,I=r-a+1,L=Math.log(S),F=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*F*(S-F)/S)*(I-S/2<0?-1:1);Rg(n,t,r,Math.max(a,Math.floor(r-I*F/S+V)),Math.min(c,Math.floor(r+(S-I)*F/S+V)),p)}const _=t[2*r+p];let v=a,b=c;for(Eu(n,t,a,r),t[2*c+p]>_&&Eu(n,t,a,c);v<b;){for(Eu(n,t,v,b),v++,b--;t[2*v+p]<_;)v++;for(;t[2*b+p]>_;)b--}t[2*a+p]===_?Eu(n,t,a,b):(b++,Eu(n,t,b,c)),b<=r&&(a=b+1),r<=b&&(c=b-1)}}function Eu(n,t,r,a){Cf(n,r,a),Cf(t,2*r,2*a),Cf(t,2*r+1,2*a+1)}function Cf(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}function Bg(n,t,r,a){const c=n-r,p=t-a;return c*c+p*p}var Sf;T.cx=void 0,(Sf=T.cx||(T.cx={})).create="create",Sf.load="load",Sf.fullLoad="fullLoad";let Nd=null,zu=[];const Pf=1e3/60,If="loadTime",Mf="fullLoadTime",E1={mark(n){performance.mark(n)},frame(n){const t=n;Nd!=null&&zu.push(t-Nd),Nd=t},clearMetrics(){Nd=null,zu=[],performance.clearMeasures(If),performance.clearMeasures(Mf);for(const n in T.cx)performance.clearMarks(T.cx[n])},getPerformanceMetrics(){performance.measure(If,T.cx.create,T.cx.load),performance.measure(Mf,T.cx.create,T.cx.fullLoad);const n=performance.getEntriesByName(If)[0].duration,t=performance.getEntriesByName(Mf)[0].duration,r=zu.length,a=1/(zu.reduce(((p,_)=>p+_),0)/r/1e3),c=zu.filter((p=>p>Pf)).reduce(((p,_)=>p+(_-Pf)/Pf),0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};T.$=oe,T.A=ze,T.B=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},T.C=Za,T.D=yr,T.E=Mt,T.F=Un,T.G=Hs,T.H=function(n){if(tr==null){const t=n.navigator?n.navigator.userAgent:null;tr=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return tr},T.I=cf,T.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new b1((()=>this.process())),this.subscription=rr(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=qt(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((r,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=t?rr(t.signal,"abort",(()=>{p==null||p.unsubscribe(),delete this.resolveRejects[c];const b={id:c,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)}),w1):null;this.resolveRejects[c]={resolve:b=>{p==null||p.unsubscribe(),r(b)},reject:b=>{p==null||p.unsubscribe(),a(b)}};const _=[],v=Object.assign(Object.assign({},n),{id:c,sourceMapId:this.mapId,origin:location.origin,data:cs(n.data,_)});this.target.postMessage(v,{transfer:_})}))}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(qt(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return s(this,void 0,void 0,(function*(){if(t.type==="<response>"){const c=this.resolveRejects[n];return delete this.resolveRejects[n],c?void(t.error?c.reject(No(t.error)):c.resolve(No(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=No(t.data),a=new AbortController;this.abortControllers[n]=a;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,r,a);this.completeTask(n,null,c)}catch(c){this.completeTask(n,c)}}))}completeTask(n,t,r){const a=[];delete this.abortControllers[n];const c={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?cs(t):null,data:cs(r,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.K=X,T.L=function(){var n=new ze(16);return ze!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},T.M=function(n,t,r){var a,c,p,_,v,b,S,I,L,F,V,U,W=r[0],J=r[1],le=r[2];return t===n?(n[12]=t[0]*W+t[4]*J+t[8]*le+t[12],n[13]=t[1]*W+t[5]*J+t[9]*le+t[13],n[14]=t[2]*W+t[6]*J+t[10]*le+t[14],n[15]=t[3]*W+t[7]*J+t[11]*le+t[15]):(c=t[1],p=t[2],_=t[3],v=t[4],b=t[5],S=t[6],I=t[7],L=t[8],F=t[9],V=t[10],U=t[11],n[0]=a=t[0],n[1]=c,n[2]=p,n[3]=_,n[4]=v,n[5]=b,n[6]=S,n[7]=I,n[8]=L,n[9]=F,n[10]=V,n[11]=U,n[12]=a*W+v*J+L*le+t[12],n[13]=c*W+b*J+F*le+t[13],n[14]=p*W+S*J+V*le+t[14],n[15]=_*W+I*J+U*le+t[15]),n},T.N=function(n,t,r){var a=r[0],c=r[1],p=r[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*c,n[5]=t[5]*c,n[6]=t[6]*c,n[7]=t[7]*c,n[8]=t[8]*p,n[9]=t[9]*p,n[10]=t[10]*p,n[11]=t[11]*p,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},T.O=function(n,t,r){var a=t[0],c=t[1],p=t[2],_=t[3],v=t[4],b=t[5],S=t[6],I=t[7],L=t[8],F=t[9],V=t[10],U=t[11],W=t[12],J=t[13],le=t[14],Le=t[15],ye=r[0],Ce=r[1],Xe=r[2],lt=r[3];return n[0]=ye*a+Ce*v+Xe*L+lt*W,n[1]=ye*c+Ce*b+Xe*F+lt*J,n[2]=ye*p+Ce*S+Xe*V+lt*le,n[3]=ye*_+Ce*I+Xe*U+lt*Le,n[4]=(ye=r[4])*a+(Ce=r[5])*v+(Xe=r[6])*L+(lt=r[7])*W,n[5]=ye*c+Ce*b+Xe*F+lt*J,n[6]=ye*p+Ce*S+Xe*V+lt*le,n[7]=ye*_+Ce*I+Xe*U+lt*Le,n[8]=(ye=r[8])*a+(Ce=r[9])*v+(Xe=r[10])*L+(lt=r[11])*W,n[9]=ye*c+Ce*b+Xe*F+lt*J,n[10]=ye*p+Ce*S+Xe*V+lt*le,n[11]=ye*_+Ce*I+Xe*U+lt*Le,n[12]=(ye=r[12])*a+(Ce=r[13])*v+(Xe=r[14])*L+(lt=r[15])*W,n[13]=ye*c+Ce*b+Xe*F+lt*J,n[14]=ye*p+Ce*S+Xe*V+lt*le,n[15]=ye*_+Ce*I+Xe*U+lt*Le,n},T.P=B,T.Q=function(n,t){const r={};for(let a=0;a<t.length;a++){const c=t[a];c in n&&(r[c]=n[c])}return r},T.R=ca,T.S=ys,T.T=Kp,T.U=pg,T.V=dg,T.W=Me,T.X=Ee,T.Y=fr,T.Z=Ra,T._=s,T.a=j,T.a$=Ze,T.a0=function(n,t){var r,a,c,p;if(!n)return t??{};if(!t)return n;const _=Object.assign({},n);if(t.removeAll&&(_.removeAll=!0),t.remove){const v=new Set(_.remove?_.remove.concat(t.remove):t.remove);_.remove=Array.from(v.values())}if(t.add){const v=_.add?_.add.concat(t.add):t.add,b=new Map(v.map((S=>[S.id,S])));_.add=Array.from(b.values())}if(t.update){const v=new Map((r=_.update)===null||r===void 0?void 0:r.map((b=>[b.id,b])));for(const b of t.update){const S=(a=v.get(b.id))!==null&&a!==void 0?a:{id:b.id};b.newGeometry&&(S.newGeometry=b.newGeometry),b.addOrUpdateProperties&&(S.addOrUpdateProperties=((c=S.addOrUpdateProperties)!==null&&c!==void 0?c:[]).concat(b.addOrUpdateProperties)),b.removeProperties&&(S.removeProperties=((p=S.removeProperties)!==null&&p!==void 0?p:[]).concat(b.removeProperties)),b.removeAllProperties&&(S.removeAllProperties=!0),v.set(b.id,S)}_.update=Array.from(v.values())}return _},T.a1=ku,T.a2=tl,T.a3=25,T.a4=yf,T.a5=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const a of n){const c=window.document.createElement("source");Ie(a)||(t.crossOrigin="Anonymous"),c.src=a,t.appendChild(c)}}))},T.a6=ht,T.a7=function(){return vt++},T.a8=D,T.a9=nc,T.aA=function(n){let t=1/0,r=1/0,a=-1/0,c=-1/0;for(const p of n)t=Math.min(t,p.x),r=Math.min(r,p.y),a=Math.max(a,p.x),c=Math.max(c,p.y);return[t,r,a,c]},T.aB=Ci,T.aC=Ae,T.aD=function(n,t,r,a,c=!1){if(!r[0]&&!r[1])return[0,0];const p=c?a==="map"?-n.bearingInRadians:0:a==="viewport"?n.bearingInRadians:0;if(p){const _=Math.sin(p),v=Math.cos(p);r=[r[0]*v-r[1]*_,r[0]*_+r[1]*v]}return[c?r[0]:Ae(t,r[0],n.zoom),c?r[1]:Ae(t,r[1],n.zoom)]},T.aF=df,T.aG=bf,T.aH=hf,T.aI=wf,T.aJ=ti,T.aK=kd,T.aL=pe,T.aM=Kr,T.aN=Bn,T.aO=at,T.aP=or,T.aQ=mg,T.aR=De,T.aS=et,T.aT=function(n){var t=new ze(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},T.aU=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},T.aV=function(n,t){var r=t[0],a=t[1],c=t[2],p=r*r+a*a+c*c;return p>0&&(p=1/Math.sqrt(p)),n[0]=t[0]*p,n[1]=t[1]*p,n[2]=t[2]*p,n},T.aW=tt,T.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},T.aY=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},T.aZ=qe,T.a_=function(n,t,r){const a=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return a===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/a},T.aa=Bo,T.ab=ro,T.ac=yg,T.ad=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,a,c,p)=>{const _=c||p;return t[a]=!_||_.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},T.ae=Kt,T.af=function(n){return Math.pow(2,n)},T.ag=Ke,T.ah=Bt,T.ai=85.051129,T.aj=fg,T.ak=function(n){return Math.log(n)/Math.LN2},T.al=function(n){var t=n[0],r=n[1];return t*t+r*r},T.am=function(n,t){const r=[];for(const a in n)a in t||r.push(a);return r},T.an=function(n,t){let r=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:p,maxZoom:_}=n,v=c?Bt(Di.interpolationFactor(c,t,p,_),0,1):0;n.kind==="camera"?a=Za.number(n.minSize,n.maxSize,v):r=v}return{uSizeT:r,uSize:a}},T.ap=function(n,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:c}){return n.kind==="source"?a/Uo:n.kind==="composite"?Za.number(a/Uo,c/Uo,r):t},T.aq=function(n,t){var r=t[0],a=t[1],c=t[2],p=t[3],_=t[4],v=t[5],b=t[6],S=t[7],I=t[8],L=t[9],F=t[10],V=t[11],U=t[12],W=t[13],J=t[14],le=t[15],Le=r*v-a*_,ye=r*b-c*_,Ce=r*S-p*_,Xe=a*b-c*v,lt=a*S-p*v,Pt=c*S-p*b,Xt=I*W-L*U,Vt=I*J-F*U,Gt=I*le-V*U,wr=L*J-F*W,$t=L*le-V*W,Ht=F*le-V*J,gt=Le*Ht-ye*$t+Ce*wr+Xe*Gt-lt*Vt+Pt*Xt;return gt?(n[0]=(v*Ht-b*$t+S*wr)*(gt=1/gt),n[1]=(c*$t-a*Ht-p*wr)*gt,n[2]=(W*Pt-J*lt+le*Xe)*gt,n[3]=(F*lt-L*Pt-V*Xe)*gt,n[4]=(b*Gt-_*Ht-S*Vt)*gt,n[5]=(r*Ht-c*Gt+p*Vt)*gt,n[6]=(J*Ce-U*Pt-le*ye)*gt,n[7]=(I*Pt-F*Ce+V*ye)*gt,n[8]=(_*$t-v*Gt+S*Xt)*gt,n[9]=(a*Gt-r*$t-p*Xt)*gt,n[10]=(U*lt-W*Ce+le*Le)*gt,n[11]=(L*Ce-I*lt-V*Le)*gt,n[12]=(v*Vt-_*wr-b*Xt)*gt,n[13]=(r*wr-a*Vt+c*Xt)*gt,n[14]=(W*ye-U*Xe-J*Le)*gt,n[15]=(I*Xe-L*ye+F*Le)*gt,n):null},T.ar=re,T.as=function(n){return Math.hypot(n[0],n[1])},T.at=function(n){return n[0]=0,n[1]=0,n},T.au=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},T.av=pf,T.aw=ke,T.ax=function(n,t,r,a){const c=t.y-n.y,p=t.x-n.x,_=a.y-r.y,v=a.x-r.x,b=_*p-v*c;if(b===0)return null;const S=(v*(n.y-r.y)-_*(n.x-r.x))/b;return new B(n.x+S*p,n.y+S*c)},T.ay=wg,T.az=h_,T.b=Qt,T.b$=class extends h{},T.b0=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},T.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},T.b2=gg,T.b3=ic,T.b4=function(n,t,r,a,c){var p,_=1/Math.tan(t/2);return n[0]=_/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+a)*(p=1/(a-c)),n[14]=2*c*a*p):(n[10]=-1,n[14]=-2*a),n},T.b5=function(n){var t=new ze(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},T.b6=function(n,t,r){var a=Math.sin(r),c=Math.cos(r),p=t[0],_=t[1],v=t[2],b=t[3],S=t[4],I=t[5],L=t[6],F=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=p*c+S*a,n[1]=_*c+I*a,n[2]=v*c+L*a,n[3]=b*c+F*a,n[4]=S*c-p*a,n[5]=I*c-_*a,n[6]=L*c-v*a,n[7]=F*c-b*a,n},T.b7=function(n,t,r){var a=Math.sin(r),c=Math.cos(r),p=t[4],_=t[5],v=t[6],b=t[7],S=t[8],I=t[9],L=t[10],F=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=p*c+S*a,n[5]=_*c+I*a,n[6]=v*c+L*a,n[7]=b*c+F*a,n[8]=S*c-p*a,n[9]=I*c-_*a,n[10]=L*c-v*a,n[11]=F*c-b*a,n},T.b8=function(){const n=new Float32Array(16);return Ke(n),n},T.b9=function(){const n=new Float64Array(16);return Ke(n),n},T.bA=function(n,t){const r=Ne(n,360),a=Ne(t,360),c=a-r,p=a>r?c-360:c+360;return Math.abs(c)<Math.abs(p)?c:p},T.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},T.bC=function(n,t,r,a){const c=Math.sqrt(n*n+t*t),p=Math.sqrt(r*r+a*a);n/=c,t/=c,r/=p,a/=p;const _=Math.acos(n*r+t*a);return-t*r+n*a>0?_:-_},T.bD=function(n,t){const r=Ne(n,2*Math.PI),a=Ne(t,2*Math.PI);return Math.min(Math.abs(r-a),Math.abs(r-a+2*Math.PI),Math.abs(r-a-2*Math.PI))},T.bE=function(){const n={},t=xe.$version;for(const r in xe.$root){const a=xe.$root[r];if(a.required){let c=null;c=r==="version"?t:a.type==="array"?[]:{},c!=null&&(n[r]=c)}}return n},T.bF=Nl,T.bG=de,T.bH=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const a in t)if(!n(t[a],r[a]))return!1;return!0}return t===r},T.bI=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=cr(n[r],t[n[r].ref]));return n},T.bJ=function(n){if(n.type==="custom")return new x1(n);switch(n.type){case"background":return new g1(n);case"circle":return new ry(n);case"color-relief":return new ly(n);case"fill":return new Ty(n);case"fill-extrusion":return new Dy(n);case"heatmap":return new iy(n);case"hillshade":return new oy(n);case"line":return new Vy(n);case"raster":return new y1(n);case"symbol":return new Dd(n)}},T.bK=wt,T.bL=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Jt(n.version,t.version))return[{command:"setStyle",args:[t]}];Jt(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Jt(n.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),Jt(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Jt(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Jt(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Jt(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Jt(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),Jt(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Jt(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Jt(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Jt(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),Jt(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Jt(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Jt(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const a={},c=[];(function(_,v,b,S){let I;for(I in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,I)&&(Object.prototype.hasOwnProperty.call(v,I)||dn(I,b,S));for(I in v)Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(_,I)?Jt(_[I],v[I])||(_[I].type==="geojson"&&v[I].type==="geojson"&&mn(_,v,I)?Tr(b,{command:"setGeoJSONSourceData",args:[I,v[I].data]}):xn(I,v,b,S)):Xr(I,v,b))})(n.sources,t.sources,c,a);const p=[];n.layers&&n.layers.forEach((_=>{"source"in _&&a[_.source]?r.push({command:"removeLayer",args:[_.id]}):p.push(_)})),r=r.concat(c),(function(_,v,b){v=v||[];const S=(_=_||[]).map(Et),I=v.map(Et),L=_.reduce(hr,{}),F=v.reduce(hr,{}),V=S.slice(),U=Object.create(null);let W,J,le,Le,ye;for(let Ce=0,Xe=0;Ce<S.length;Ce++)W=S[Ce],Object.prototype.hasOwnProperty.call(F,W)?Xe++:(Tr(b,{command:"removeLayer",args:[W]}),V.splice(V.indexOf(W,Xe),1));for(let Ce=0,Xe=0;Ce<I.length;Ce++)W=I[I.length-1-Ce],V[V.length-1-Ce]!==W&&(Object.prototype.hasOwnProperty.call(L,W)?(Tr(b,{command:"removeLayer",args:[W]}),V.splice(V.lastIndexOf(W,V.length-Xe),1)):Xe++,Le=V[V.length-Ce],Tr(b,{command:"addLayer",args:[F[W],Le]}),V.splice(V.length-Ce,0,W),U[W]=!0);for(let Ce=0;Ce<I.length;Ce++)if(W=I[Ce],J=L[W],le=F[W],!U[W]&&!Jt(J,le))if(Jt(J.source,le.source)&&Jt(J["source-layer"],le["source-layer"])&&Jt(J.type,le.type)){for(ye in jt(J.layout,le.layout,b,W,null,"setLayoutProperty"),jt(J.paint,le.paint,b,W,null,"setPaintProperty"),Jt(J.filter,le.filter)||Tr(b,{command:"setFilter",args:[W,le.filter]}),Jt(J.minzoom,le.minzoom)&&Jt(J.maxzoom,le.maxzoom)||Tr(b,{command:"setLayerZoomRange",args:[W,le.minzoom,le.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?jt(J[ye],le[ye],b,W,ye.slice(6),"setPaintProperty"):Jt(J[ye],le[ye])||Tr(b,{command:"setLayerProperty",args:[W,ye,le[ye]]}));for(ye in le)Object.prototype.hasOwnProperty.call(le,ye)&&!Object.prototype.hasOwnProperty.call(J,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?jt(J[ye],le[ye],b,W,ye.slice(6),"setPaintProperty"):Jt(J[ye],le[ye])||Tr(b,{command:"setLayerProperty",args:[W,ye,le[ye]]}))}else Tr(b,{command:"removeLayer",args:[W]}),Le=V[V.lastIndexOf(W)+1],Tr(b,{command:"addLayer",args:[le,Le]})})(p,t.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[t]}]}return r},T.bM=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},T.bN=yt,T.bO=It,T.bP=class extends $i{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},T.bQ=mi,T.bR=class extends $i{constructor(n,t){super(n,t),this.current=ba}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},T.bS=li,T.bT=class extends $i{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},T.bU=class extends $i{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},T.bV=Fe,T.bW=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=r,n[2]=0,n[3]=-r,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},T.bX=function(n,t,r){var a=t[0],c=t[1],p=t[2];return n[0]=a*r[0]+c*r[3]+p*r[6],n[1]=a*r[1]+c*r[4]+p*r[7],n[2]=a*r[2]+c*r[5]+p*r[8],n},T.bY=function(n,t,r,a,c,p,_){var v=1/(t-r),b=1/(a-c),S=1/(p-_);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*S,n[11]=0,n[12]=(t+r)*v,n[13]=(c+a)*b,n[14]=(_+p)*S,n[15]=1,n},T.bZ=class extends $i{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)t[4*r]=n[r].r,t[4*r+1]=n[r].g,t[4*r+2]=n[r].b,t[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,t)}}},T.b_=class extends $i{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},T.ba=function(){return new Float64Array(16)},T.bb=function(n,t,r){const a=new Float64Array(4);return te(a,n,t-90,r),a},T.bc=function(n,t,r,a){var c,p,_,v,b,S=t[0],I=t[1],L=t[2],F=t[3],V=r[0],U=r[1],W=r[2],J=r[3];return(p=S*V+I*U+L*W+F*J)<0&&(p=-p,V=-V,U=-U,W=-W,J=-J),1-p>Re?(c=Math.acos(p),_=Math.sin(c),v=Math.sin((1-a)*c)/_,b=Math.sin(a*c)/_):(v=1-a,b=a),n[0]=v*S+b*V,n[1]=v*I+b*U,n[2]=v*L+b*W,n[3]=v*F+b*J,n},T.bd=function(n){const t=new Float64Array(9);var r,a,c,p,_,v,b,S,I,L,F,V,U,W,J,le,Le,ye;L=(c=(a=n)[0])*(b=c+c),F=(p=a[1])*b,U=(_=a[2])*b,W=_*(S=p+p),le=(v=a[3])*b,Le=v*S,ye=v*(I=_+_),(r=t)[0]=1-(V=p*S)-(J=_*I),r[3]=F-ye,r[6]=U+Le,r[1]=F+ye,r[4]=1-L-J,r[7]=W-le,r[2]=U-Le,r[5]=W+le,r[8]=1-L-V;const Ce=or(-Math.asin(Bt(t[2],-1,1)));let Xe,lt;return Math.hypot(t[5],t[8])<.001?(Xe=0,lt=-or(Math.atan2(t[3],t[4]))):(Xe=or(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),lt=or(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Xe,pitch:Ce+90,bearing:lt}},T.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},T.bf=Pr,T.bg=yo,T.bh=Ql,T.bi=Tu,T.bj=Jl,T.bk=pt,T.bl=ot,T.bm=jn,T.bn=function(n,t,r,a,c){return pt(a,c,Bt((n-t)/(r-t),0,1))},T.bo=Ne,T.bp=function(){return new Float64Array(3)},T.bq=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n},T.br=te,T.bs=function(n,t,r){var a=r[0],c=r[1],p=r[2],_=t[0],v=t[1],b=t[2],S=c*b-p*v,I=p*_-a*b,L=a*v-c*_,F=c*L-p*I,V=p*S-a*L,U=a*I-c*S,W=2*r[3];return I*=W,L*=W,V*=2,U*=2,n[0]=_+(S*=W)+(F*=2),n[1]=v+I+V,n[2]=b+L+U,n},T.bt=function(n,t,r){const a=(c=[n[0],n[1],n[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((I=c[8])*(_=c[4])-(v=c[5])*(S=c[7]))+c[1]*(-I*(p=c[3])+v*(b=c[6]))+c[2]*(S*p-_*b);var c,p,_,v,b,S,I;if(a===0)return null;const L=tt([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),F=tt([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),V=tt([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),U=De([],L,-n[3]);return et(U,U,De([],F,-t[3])),et(U,U,De([],V,-r[3])),De(U,U,1/a),U},T.bu=gf,T.bv=function(){return new Float64Array(4)},T.bw=function(n,t,r,a){var c=[],p=[];return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],p[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),p[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),p[2]=c[2],n[0]=p[0]+r[0],n[1]=p[1]+r[1],n[2]=p[2]+r[2],n},T.bx=function(n,t,r,a){var c=[],p=[];return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],p[0]=c[0],p[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),p[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),n[0]=p[0]+r[0],n[1]=p[1]+r[1],n[2]=p[2]+r[2],n},T.by=function(n,t,r,a){var c=[],p=[];return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],p[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),p[1]=c[1],p[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),n[0]=p[0]+r[0],n[1]=p[1]+r[1],n[2]=p[2]+r[2],n},T.bz=function(n,t,r){var a=Math.sin(r),c=Math.cos(r),p=t[0],_=t[1],v=t[2],b=t[3],S=t[8],I=t[9],L=t[10],F=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=p*c-S*a,n[1]=_*c-I*a,n[2]=v*c-L*a,n[3]=b*c-F*a,n[8]=p*a+S*c,n[9]=_*a+I*c,n[10]=v*a+L*c,n[11]=b*a+F*c,n},T.c=se,T.c0=$y,T.c1=class extends i{},T.c2=Yp,T.c3=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},T.c4=b_,T.c5=function(n,t,r){var a=t[0],c=t[1],p=t[2],_=r[3]*a+r[7]*c+r[11]*p+r[15];return n[0]=(r[0]*a+r[4]*c+r[8]*p+r[12])/(_=_||1),n[1]=(r[1]*a+r[5]*c+r[9]*p+r[13])/_,n[2]=(r[2]*a+r[6]*c+r[10]*p+r[14])/_,n},T.c6=class extends du{},T.c7=class extends P{},T.c8=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},T.c9=function(n,t){var r=n[0],a=n[1],c=n[2],p=n[3],_=n[4],v=n[5],b=n[6],S=n[7],I=n[8],L=n[9],F=n[10],V=n[11],U=n[12],W=n[13],J=n[14],le=n[15],Le=t[0],ye=t[1],Ce=t[2],Xe=t[3],lt=t[4],Pt=t[5],Xt=t[6],Vt=t[7],Gt=t[8],wr=t[9],$t=t[10],Ht=t[11],gt=t[12],jr=t[13],Gr=t[14],Ir=t[15];return Math.abs(r-Le)<=Re*Math.max(1,Math.abs(r),Math.abs(Le))&&Math.abs(a-ye)<=Re*Math.max(1,Math.abs(a),Math.abs(ye))&&Math.abs(c-Ce)<=Re*Math.max(1,Math.abs(c),Math.abs(Ce))&&Math.abs(p-Xe)<=Re*Math.max(1,Math.abs(p),Math.abs(Xe))&&Math.abs(_-lt)<=Re*Math.max(1,Math.abs(_),Math.abs(lt))&&Math.abs(v-Pt)<=Re*Math.max(1,Math.abs(v),Math.abs(Pt))&&Math.abs(b-Xt)<=Re*Math.max(1,Math.abs(b),Math.abs(Xt))&&Math.abs(S-Vt)<=Re*Math.max(1,Math.abs(S),Math.abs(Vt))&&Math.abs(I-Gt)<=Re*Math.max(1,Math.abs(I),Math.abs(Gt))&&Math.abs(L-wr)<=Re*Math.max(1,Math.abs(L),Math.abs(wr))&&Math.abs(F-$t)<=Re*Math.max(1,Math.abs(F),Math.abs($t))&&Math.abs(V-Ht)<=Re*Math.max(1,Math.abs(V),Math.abs(Ht))&&Math.abs(U-gt)<=Re*Math.max(1,Math.abs(U),Math.abs(gt))&&Math.abs(W-jr)<=Re*Math.max(1,Math.abs(W),Math.abs(jr))&&Math.abs(J-Gr)<=Re*Math.max(1,Math.abs(J),Math.abs(Gr))&&Math.abs(le-Ir)<=Re*Math.max(1,Math.abs(le),Math.abs(Ir))},T.cA=function(n,t){j.REGISTERED_PROTOCOLS[n]=t},T.cB=function(n){delete j.REGISTERED_PROTOCOLS[n]},T.cC=function(n,t){const r={};for(let c=0;c<n.length;c++){const p=t&&t[n[c].id]||Op(n[c]);t&&(t[n[c].id]=p);let _=r[p];_||(_=r[p]=[]),_.push(n[c])}const a=[];for(const c in r)a.push(r[c]);return a},T.cD=nr,T.cE=vg,T.cF=xg,T.cG=Y_,T.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=oe/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,a=t._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new Un(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Un(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Un(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:I}=n.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Un(S),n.canonical),a["text-size"].possiblyEvaluate(new Un(I),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:I}=n.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Un(S),n.canonical),a["icon-size"].possiblyEvaluate(new Un(I),n.canonical)]}const p=r.get("text-line-height")*Ci,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),b=r.get("text-size");for(const S of n.bucket.features){const I=r.get("text-font").evaluate(S,{},n.canonical).join(","),L=b.evaluate(S,{},n.canonical),F=c.layoutTextSize.evaluate(S,{},n.canonical),V=c.layoutIconSize.evaluate(S,{},n.canonical),U={horizontal:{},vertical:void 0},W=S.text;let J,le=[0,0];if(W){const Ce=W.toString(),Xe=r.get("text-letter-spacing").evaluate(S,{},n.canonical)*Ci,lt=qp(Ce)?Xe:0,Pt=r.get("text-anchor").evaluate(S,{},n.canonical),Xt=Eg(t,S,n.canonical);if(!Xt){const $t=r.get("text-radial-offset").evaluate(S,{},n.canonical);le=$t?Ag(Pt,[$t*Ci,xf]):r.get("text-offset").evaluate(S,{},n.canonical).map((Ht=>Ht*Ci))}let Vt=_?"center":r.get("text-justify").evaluate(S,{},n.canonical);const Gt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(S,{},n.canonical)*Ci:1/0,wr=()=>{n.bucket.allowVerticalPlacement&&jl(Ce)&&(U.vertical=Ed(W,n.glyphMap,n.glyphPositions,n.imagePositions,I,Gt,p,Pt,"left",lt,le,T.ao.vertical,!0,F,L))};if(!_&&Xt){const $t=new Set;if(Vt==="auto")for(let gt=0;gt<Xt.values.length;gt+=2)$t.add(bf(Xt.values[gt]));else $t.add(Vt);let Ht=!1;for(const gt of $t)if(!U.horizontal[gt])if(Ht)U.horizontal[gt]=U.horizontal[0];else{const jr=Ed(W,n.glyphMap,n.glyphPositions,n.imagePositions,I,Gt,p,"center",gt,lt,le,T.ao.horizontal,!1,F,L);jr&&(U.horizontal[gt]=jr,Ht=jr.positionedLines.length===1)}wr()}else{Vt==="auto"&&(Vt=bf(Pt));const $t=Ed(W,n.glyphMap,n.glyphPositions,n.imagePositions,I,Gt,p,Pt,Vt,lt,le,T.ao.horizontal,!1,F,L);$t&&(U.horizontal[Vt]=$t),wr(),jl(Ce)&&_&&v&&(U.vertical=Ed(W,n.glyphMap,n.glyphPositions,n.imagePositions,I,Gt,p,Pt,Vt,lt,le,T.ao.vertical,!1,F,L))}}let Le=!1;if(S.icon&&S.icon.name){const Ce=n.imageMap[S.icon.name];Ce&&(J=p1(n.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},n.canonical),r.get("icon-anchor").evaluate(S,{},n.canonical)),Le=!!Ce.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Le:n.bucket.sdfIcons!==Le&&Dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ce.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const ye=Lg(U.horizontal)||U.vertical;n.bucket.iconsInText=!!ye&&ye.iconsInText,(ye||J)&&k1(n.bucket,S,U,J,n.imageMap,c,F,V,le,Le,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},T.cI=of,T.cJ=rf,T.cK=af,T.cL=B_,T.cM=lf,T.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},T.cO=function(n,t,r,a,c){return s(this,void 0,void 0,(function*(){if(Ee())try{return yield fr(n,t,r,a,c)}catch{}return(function(p,_,v,b,S){const I=p.width,L=p.height;kr&&Ar||(kr=new OffscreenCanvas(I,L),Ar=kr.getContext("2d",{willReadFrequently:!0})),kr.width=I,kr.height=L,Ar.drawImage(p,0,0,I,L);const F=Ar.getImageData(_,v,b,S);return Ar.clearRect(0,0,I,L),F.data})(n,t,r,a,c)}))},T.cP=C_,T.cQ=N,T.cR=R_,T.cS=ec,T.cT=Vs,T.cU=function(n,t){const r=new Map;if(n!=null)if(n.type==="Feature")r.set(Au(n,t),n);else for(const a of n.features)r.set(Au(a,t),a);return r},T.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return Au(n,t)!=null;if(n.type==="FeatureCollection"){const r=new Set;for(const a of n.features){const c=Au(a,t);if(c==null||r.has(c))return!1;r.add(c)}return!0}return!1},T.cW=function(n,t,r){var a,c,p,_;if(t.removeAll&&n.clear(),t.remove)for(const v of t.remove)n.delete(v);if(t.add)for(const v of t.add){const b=Au(v,r);b!=null&&n.set(b,v)}if(t.update)for(const v of t.update){let b=n.get(v.id);if(b==null)continue;const S=!v.removeAllProperties&&(((a=v.removeProperties)===null||a===void 0?void 0:a.length)>0||((c=v.addOrUpdateProperties)===null||c===void 0?void 0:c.length)>0);if((v.newGeometry||v.removeAllProperties||S)&&(b=Object.assign({},b),n.set(v.id,b),S&&(b.properties=Object.assign({},b.properties))),v.newGeometry&&(b.geometry=v.newGeometry),v.removeAllProperties)b.properties={};else if(((p=v.removeProperties)===null||p===void 0?void 0:p.length)>0)for(const I of v.removeProperties)Object.prototype.hasOwnProperty.call(b.properties,I)&&delete b.properties[I];if(((_=v.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(const{key:I,value:L}of v.addOrUpdateProperties)b.properties[I]=L}},T.cX=Ea,T.ca=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},T.cb=n=>n.type==="symbol",T.cc=n=>n.type==="circle",T.cd=n=>n.type==="heatmap",T.ce=n=>n.type==="line",T.cf=n=>n.type==="fill",T.cg=n=>n.type==="fill-extrusion",T.ch=n=>n.type==="hillshade",T.ci=n=>n.type==="color-relief",T.cj=n=>n.type==="raster",T.ck=n=>n.type==="background",T.cl=n=>n.type==="custom",T.cm=ut,T.cn=function(n,t,r){const a=ge(t.x-r.x,t.y-r.y),c=ge(n.x-r.x,n.y-r.y);var p,_;return or(Math.atan2(a[0]*c[1]-a[1]*c[0],(p=a)[0]*(_=c)[0]+p[1]*_[1]))},T.co=St,T.cp=function(n,t){return Dr[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},T.cq=function(n,t){return Sr[t]&&"touches"in n},T.cr=function(n){return Sr[n]||Dr[n]},T.cs=function(n,t,r){var a=t[0],c=t[1];return n[0]=r[0]*a+r[4]*c+r[12],n[1]=r[1]*a+r[5]*c+r[13],n},T.ct=function(n,t){const{x:r,y:a}=ku.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||r<0||r>=1)},T.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},T.cv=class extends ds{},T.cw=E1,T.cy=function(n){return n.message===Zr},T.cz=ae,T.d=Ie,T.e=dt,T.f=n=>s(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),T.g=Z,T.h=n=>new Promise(((t,r)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame((()=>{a.src=Ot}))},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(c):Ot})),T.i=qt,T.j=(n,t)=>Se(dt(n,{type:"json"}),t),T.k=$e,T.l=st,T.m=Se,T.n=(n,t)=>Se(dt(n,{type:"arrayBuffer"}),t),T.o=function(n){return new lf(n).readFields(r1,[])},T.p=X_,T.q=vu,T.r=Zi,T.s=rr,T.t=xd,T.u=un,T.v=xe,T.w=Dt,T.x=Np,T.y=Ws,T.z=ls})),M("worker",["./shared"],(function(T){class s{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,Z){for(const ae of j){this._layerConfigs[ae.id]=ae;const de=this._layers[ae.id]=T.bJ(ae);de._featureFilter=T.aa(de.filter),this.keyCache[ae.id]&&delete this.keyCache[ae.id]}for(const ae of Z)delete this.keyCache[ae],delete this._layerConfigs[ae],delete this._layers[ae];this.familiesBySource={};const X=T.cC(Object.values(this._layerConfigs),this.keyCache);for(const ae of X){const de=ae.map(($e=>this._layers[$e.id])),Se=de[0];if(Se.visibility==="none")continue;const Ie=Se.source||"";let be=this.familiesBySource[Ie];be||(be=this.familiesBySource[Ie]={});const Oe=Se.sourceLayer||"_geojsonTileLayer";let st=be[Oe];st||(st=be[Oe]=[]),st.push(de)}}}class B{constructor(j){const Z={},X=[];for(const Ie in j){const be=j[Ie],Oe=Z[Ie]={};for(const st in be){const $e=be[+st];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Mt={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};X.push(Mt),Oe[st]={rect:Mt,metrics:$e.metrics}}}const{w:ae,h:de}=T.p(X),Se=new T.q({width:ae||1,height:de||1});for(const Ie in j){const be=j[Ie];for(const Oe in be){const st=be[+Oe];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const $e=Z[Ie][Oe].rect;T.q.copy(st.bitmap,Se,{x:0,y:0},{x:$e.x+1,y:$e.y+1},st.bitmap)}}this.image=Se,this.positions=Z}}T.cD("GlyphAtlas",B);class N{constructor(j){this.tileID=new T.Z(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[],this.globalState=j.globalState}parse(j,Z,X,ae,de){return T._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new T.a8;const Se=new T.cE(Object.keys(j.layers).sort()),Ie=new T.cF(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const be={},Oe={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X,subdivisionGranularity:de},st=Z.familiesBySource[this.source];for(const jt in st){const Et=j.layers[jt];if(!Et)continue;Et.version===1&&T.w(`Vector tile source "${this.source}" layer "${jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hr=Se.encode(jt),ht=[];for(let Hr=0;Hr<Et.length;Hr++){const Yr=Et.feature(Hr),qr=Ie.getId(Yr,jt);ht.push({feature:Yr,id:qr,index:Hr,sourceLayerIndex:hr})}for(const Hr of st[jt]){const Yr=Hr[0];Yr.source!==this.source&&T.w(`layer.source = ${Yr.source} does not equal this.source = ${this.source}`),Yr.minzoom&&this.zoom<Math.floor(Yr.minzoom)||Yr.maxzoom&&this.zoom>=Yr.maxzoom||Yr.visibility!=="none"&&(Y(Hr,this.zoom,X),(be[Yr.id]=Yr.createBucket({index:Ie.bucketLayerIDs.length,layers:Hr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hr,sourceID:this.source,globalState:this.globalState})).populate(ht,Oe,this.tileID.canonical),Ie.bucketLayerIDs.push(Hr.map((qr=>qr.id))))}}const $e=T.bN(Oe.glyphDependencies,(jt=>Object.keys(jt).map(Number)));this.inFlightDependencies.forEach((jt=>jt==null?void 0:jt.abort())),this.inFlightDependencies=[];let Mt=Promise.resolve({});if(Object.keys($e).length){const jt=new AbortController;this.inFlightDependencies.push(jt),Mt=ae.sendAsync({type:"GG",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},jt)}const xe=Object.keys(Oe.iconDependencies);let Ft=Promise.resolve({});if(xe.length){const jt=new AbortController;this.inFlightDependencies.push(jt),Ft=ae.sendAsync({type:"GI",data:{icons:xe,source:this.source,tileID:this.tileID,type:"icons"}},jt)}const cr=Object.keys(Oe.patternDependencies);let Jt=Promise.resolve({});if(cr.length){const jt=new AbortController;this.inFlightDependencies.push(jt),Jt=ae.sendAsync({type:"GI",data:{icons:cr,source:this.source,tileID:this.tileID,type:"patterns"}},jt)}const[Tr,Xr,dn]=yield Promise.all([Mt,Ft,Jt]),xn=new B(Tr),mn=new T.cG(Xr,dn);for(const jt in be){const Et=be[jt];Et instanceof T.a9?(Y(Et.layers,this.zoom,X),T.cH({bucket:Et,glyphMap:Tr,glyphPositions:xn.positions,imageMap:Xr,imagePositions:mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Oe.subdivisionGranularity})):Et.hasPattern&&(Et instanceof T.cI||Et instanceof T.cJ||Et instanceof T.cK)&&(Y(Et.layers,this.zoom,X),Et.addFeatures(Oe,this.tileID.canonical,mn.patternPositions))}return this.status="done",{buckets:Object.values(be).filter((jt=>!jt.isEmpty())),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xn.image,imageAtlas:mn,glyphMap:this.returnDependencies?Tr:null,iconMap:this.returnDependencies?Xr:null,glyphPositions:this.returnDependencies?xn.positions:null}}))}}function Y(se,j,Z){const X=new T.F(j);for(const ae of se)ae.recalculate(X,Z)}class K{constructor(j,Z,X){this.actor=j,this.layerIndex=Z,this.availableImages=X,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,Z){return T._(this,void 0,void 0,(function*(){const X=yield T.n(j.request,Z);try{return{vectorTile:new T.cL(new T.cM(X.data)),rawData:X.data,cacheControl:X.cacheControl,expires:X.expires}}catch(ae){const de=new Uint8Array(X.data);let Se=`Unable to parse the tile at ${j.request.url}, `;throw Se+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.message}`,new Error(Se)}}))}loadTile(j){return T._(this,void 0,void 0,(function*(){const Z=j.uid,X=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.cN(j.request),ae=new N(j);this.loading[Z]=ae;const de=new AbortController;ae.abort=de;try{const Se=yield this.loadVectorTile(j,de);if(delete this.loading[Z],!Se)return null;const Ie=Se.rawData,be={};Se.expires&&(be.expires=Se.expires),Se.cacheControl&&(be.cacheControl=Se.cacheControl);const Oe={};if(X){const $e=X.finish();$e&&(Oe.resourceTiming=JSON.parse(JSON.stringify($e)))}ae.vectorTile=Se.vectorTile;const st=ae.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[Z]=ae,this.fetching[Z]={rawTileData:Ie,cacheControl:be,resourceTiming:Oe};try{const $e=yield st;return T.e({rawTileData:Ie.slice(0)},$e,be,Oe)}finally{delete this.fetching[Z]}}catch(Se){throw delete this.loading[Z],ae.status="done",this.loaded[Z]=ae,Se}}))}reloadTile(j){return T._(this,void 0,void 0,(function*(){const Z=j.uid;if(!this.loaded||!this.loaded[Z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const X=this.loaded[Z];if(X.showCollisionBoxes=j.showCollisionBoxes,X.globalState=j.globalState,X.status==="parsing"){const ae=yield X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let de;if(this.fetching[Z]){const{rawTileData:Se,cacheControl:Ie,resourceTiming:be}=this.fetching[Z];delete this.fetching[Z],de=T.e({rawTileData:Se.slice(0)},ae,Ie,be)}else de=ae;return de}if(X.status==="done"&&X.vectorTile)return X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)}))}abortTile(j){return T._(this,void 0,void 0,(function*(){const Z=this.loading,X=j.uid;Z&&Z[X]&&Z[X].abort&&(Z[X].abort.abort(),delete Z[X])}))}removeTile(j){return T._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class ie{constructor(){this.loaded={}}loadTile(j){return T._(this,void 0,void 0,(function*(){const{uid:Z,encoding:X,rawImageData:ae,redFactor:de,greenFactor:Se,blueFactor:Ie,baseShift:be}=j,Oe=ae.width+2,st=ae.height+2,$e=T.b(ae)?new T.R({width:Oe,height:st},yield T.cO(ae,-1,-1,Oe,st)):ae,Mt=new T.cP(Z,$e,X,de,Se,Ie,be);return this.loaded=this.loaded||{},this.loaded[Z]=Mt,Mt}))}removeTile(j){const Z=this.loaded,X=j.uid;Z&&Z[X]&&delete Z[X]}}var H,me,ve=(function(){if(me)return H;function se(Z,X){if(Z.length!==0){j(Z[0],X);for(var ae=1;ae<Z.length;ae++)j(Z[ae],!X)}}function j(Z,X){for(var ae=0,de=0,Se=0,Ie=Z.length,be=Ie-1;Se<Ie;be=Se++){var Oe=(Z[Se][0]-Z[be][0])*(Z[be][1]+Z[Se][1]),st=ae+Oe;de+=Math.abs(ae)>=Math.abs(Oe)?ae-st+Oe:Oe-st+ae,ae=st}ae+de>=0!=!!X&&Z.reverse()}return me=1,H=function Z(X,ae){var de,Se=X&&X.type;if(Se==="FeatureCollection")for(de=0;de<X.features.length;de++)Z(X.features[de],ae);else if(Se==="GeometryCollection")for(de=0;de<X.geometries.length;de++)Z(X.geometries[de],ae);else if(Se==="Feature")Z(X.geometry,ae);else if(Se==="Polygon")se(X.coordinates,ae);else if(Se==="MultiPolygon")for(de=0;de<X.coordinates.length;de++)se(X.coordinates[de],ae);return X}})(),Me=T.cQ(ve);class Ee extends T.cS{constructor(j,Z){super(new T.cM,0,Z,[],[]),this.feature=j,this.type=j.type,this.properties=j.tags?j.tags:{},"id"in j&&(typeof j.id=="string"?this.id=parseInt(j.id,10):typeof j.id!="number"||isNaN(j.id)||(this.id=j.id))}loadGeometry(){const j=[],Z=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const X of Z){const ae=[];for(const de of X)ae.push(new T.P(de[0],de[1]));j.push(ae)}return j}}class Re extends T.cR{constructor(j,Z){super(new T.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=Z?Z.version:1,this.extent=Z?Z.extent:4096,this.length=j.length,this.features=j}feature(j){return new Ee(this.features[j],this.extent)}}function ze(se,j){j.writeVarintField(15,se.version||1),j.writeStringField(1,se.name||""),j.writeVarintField(5,se.extent||4096);const Z={keys:[],values:[],keycache:{},valuecache:{}};for(let de=0;de<se.length;de++)Z.feature=se.feature(de),j.writeMessage(2,Fe,Z);const X=Z.keys;for(const de of X)j.writeStringField(3,de);const ae=Z.values;for(const de of ae)j.writeMessage(4,et,de)}function Fe(se,j){if(!se.feature)return;const Z=se.feature;Z.id!==void 0&&j.writeVarintField(1,Z.id),j.writeMessage(2,Ke,se),j.writeVarintField(3,Z.type),j.writeMessage(4,He,Z)}function Ke(se,j){var Z;for(const X in(Z=se.feature)==null?void 0:Z.properties){let ae=se.feature.properties[X],de=se.keycache[X];if(ae===null)continue;de===void 0&&(se.keys.push(X),de=se.keys.length-1,se.keycache[X]=de),j.writeVarint(de),typeof ae!="string"&&typeof ae!="boolean"&&typeof ae!="number"&&(ae=JSON.stringify(ae));const Se=typeof ae+":"+ae;let Ie=se.valuecache[Se];Ie===void 0&&(se.values.push(ae),Ie=se.values.length-1,se.valuecache[Se]=Ie),j.writeVarint(Ie)}}function rt(se,j){return(j<<3)+(7&se)}function qe(se){return se<<1^se>>31}function He(se,j){const Z=se.loadGeometry(),X=se.type;let ae=0,de=0;for(const Se of Z){let Ie=1;X===1&&(Ie=Se.length),j.writeVarint(rt(1,Ie));const be=X===3?Se.length-1:Se.length;for(let Oe=0;Oe<be;Oe++){Oe===1&&X!==1&&j.writeVarint(rt(2,be-1));const st=Se[Oe].x-ae,$e=Se[Oe].y-de;j.writeVarint(qe(st)),j.writeVarint(qe($e)),ae+=st,de+=$e}se.type===3&&j.writeVarint(rt(7,1))}}function et(se,j){const Z=typeof se;Z==="string"?j.writeStringField(1,se):Z==="boolean"?j.writeBooleanField(7,se):Z==="number"&&(se%1!=0?j.writeDoubleField(3,se):se<0?j.writeSVarintField(6,se):j.writeVarintField(5,se))}const De={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},tt=Math.fround||(nt=new Float32Array(1),se=>(nt[0]=+se,nt[0]));var nt;class Ze{constructor(j){this.options=Object.assign(Object.create(De),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:Z,minZoom:X,maxZoom:ae}=this.options;Z&&console.time("total time");const de=`prepare ${j.length} points`;Z&&console.time(de),this.points=j;const Se=[];for(let be=0;be<j.length;be++){const Oe=j[be];if(!Oe.geometry)continue;const[st,$e]=Oe.geometry.coordinates,Mt=tt(te(st)),xe=tt(re($e));Se.push(Mt,xe,1/0,be,-1,1),this.options.reduce&&Se.push(0)}let Ie=this.trees[ae+1]=this._createTree(Se);Z&&console.timeEnd(de);for(let be=ae;be>=X;be--){const Oe=+Date.now();Ie=this.trees[be]=this._createTree(this._cluster(Ie,be)),Z&&console.log("z%d: %d clusters in %dms",be,Ie.numItems,+Date.now()-Oe)}return Z&&console.timeEnd("total time"),this}getClusters(j,Z){let X=((j[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,j[1]));let de=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)X=-180,de=180;else if(X>de){const $e=this.getClusters([X,ae,180,Se],Z),Mt=this.getClusters([-180,ae,de,Se],Z);return $e.concat(Mt)}const Ie=this.trees[this._limitZoom(Z)],be=Ie.range(te(X),re(Se),te(de),re(ae)),Oe=Ie.data,st=[];for(const $e of be){const Mt=this.stride*$e;st.push(Oe[Mt+5]>1?ke(Oe,Mt,this.clusterProps):this.points[Oe[Mt+3]])}return st}getChildren(j){const Z=this._getOriginId(j),X=this._getOriginZoom(j),ae="No cluster with the specified id.",de=this.trees[X];if(!de)throw new Error(ae);const Se=de.data;if(Z*this.stride>=Se.length)throw new Error(ae);const Ie=this.options.radius/(this.options.extent*Math.pow(2,X-1)),be=de.within(Se[Z*this.stride],Se[Z*this.stride+1],Ie),Oe=[];for(const st of be){const $e=st*this.stride;Se[$e+4]===j&&Oe.push(Se[$e+5]>1?ke(Se,$e,this.clusterProps):this.points[Se[$e+3]])}if(Oe.length===0)throw new Error(ae);return Oe}getLeaves(j,Z,X){const ae=[];return this._appendLeaves(ae,j,Z=Z||10,X=X||0,0),ae}getTile(j,Z,X){const ae=this.trees[this._limitZoom(j)],de=Math.pow(2,j),{extent:Se,radius:Ie}=this.options,be=Ie/Se,Oe=(X-be)/de,st=(X+1+be)/de,$e={features:[]};return this._addTileFeatures(ae.range((Z-be)/de,Oe,(Z+1+be)/de,st),ae.data,Z,X,de,$e),Z===0&&this._addTileFeatures(ae.range(1-be/de,Oe,1,st),ae.data,de,X,de,$e),Z===de-1&&this._addTileFeatures(ae.range(0,Oe,be/de,st),ae.data,-1,X,de,$e),$e.features.length?$e:null}getClusterExpansionZoom(j){let Z=this._getOriginZoom(j)-1;for(;Z<=this.options.maxZoom;){const X=this.getChildren(j);if(Z++,X.length!==1)break;j=X[0].properties.cluster_id}return Z}_appendLeaves(j,Z,X,ae,de){const Se=this.getChildren(Z);for(const Ie of Se){const be=Ie.properties;if(be&&be.cluster?de+be.point_count<=ae?de+=be.point_count:de=this._appendLeaves(j,be.cluster_id,X,ae,de):de<ae?de++:j.push(Ie),j.length===X)break}return de}_createTree(j){const Z=new T.aI(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<j.length;X+=this.stride)Z.add(j[X],j[X+1]);return Z.finish(),Z.data=j,Z}_addTileFeatures(j,Z,X,ae,de,Se){for(const Ie of j){const be=Ie*this.stride,Oe=Z[be+5]>1;let st,$e,Mt;if(Oe)st=bt(Z,be,this.clusterProps),$e=Z[be],Mt=Z[be+1];else{const cr=this.points[Z[be+3]];st=cr.properties;const[Jt,Tr]=cr.geometry.coordinates;$e=te(Jt),Mt=re(Tr)}const xe={type:1,geometry:[[Math.round(this.options.extent*($e*de-X)),Math.round(this.options.extent*(Mt*de-ae))]],tags:st};let Ft;Ft=Oe||this.options.generateId?Z[be+3]:this.points[Z[be+3]].id,Ft!==void 0&&(xe.id=Ft),Se.features.push(xe)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,Z){const{radius:X,extent:ae,reduce:de,minPoints:Se}=this.options,Ie=X/(ae*Math.pow(2,Z)),be=j.data,Oe=[],st=this.stride;for(let $e=0;$e<be.length;$e+=st){if(be[$e+2]<=Z)continue;be[$e+2]=Z;const Mt=be[$e],xe=be[$e+1],Ft=j.within(be[$e],be[$e+1],Ie),cr=be[$e+5];let Jt=cr;for(const Tr of Ft){const Xr=Tr*st;be[Xr+2]>Z&&(Jt+=be[Xr+5])}if(Jt>cr&&Jt>=Se){let Tr,Xr=Mt*cr,dn=xe*cr,xn=-1;const mn=($e/st<<5)+(Z+1)+this.points.length;for(const jt of Ft){const Et=jt*st;if(be[Et+2]<=Z)continue;be[Et+2]=Z;const hr=be[Et+5];Xr+=be[Et]*hr,dn+=be[Et+1]*hr,be[Et+4]=mn,de&&(Tr||(Tr=this._map(be,$e,!0),xn=this.clusterProps.length,this.clusterProps.push(Tr)),de(Tr,this._map(be,Et)))}be[$e+4]=mn,Oe.push(Xr/Jt,dn/Jt,1/0,mn,-1,Jt),de&&Oe.push(xn)}else{for(let Tr=0;Tr<st;Tr++)Oe.push(be[$e+Tr]);if(Jt>1)for(const Tr of Ft){const Xr=Tr*st;if(!(be[Xr+2]<=Z)){be[Xr+2]=Z;for(let dn=0;dn<st;dn++)Oe.push(be[Xr+dn])}}}}return Oe}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,Z,X){if(j[Z+5]>1){const Se=this.clusterProps[j[Z+6]];return X?Object.assign({},Se):Se}const ae=this.points[j[Z+3]].properties,de=this.options.map(ae);return X&&de===ae?Object.assign({},de):de}}function ke(se,j,Z){return{type:"Feature",id:se[j+3],properties:bt(se,j,Z),geometry:{type:"Point",coordinates:[(X=se[j],360*(X-.5)),ge(se[j+1])]}};var X}function bt(se,j,Z){const X=se[j+5],ae=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,de=se[j+6],Se=de===-1?{}:Object.assign({},Z[de]);return Object.assign(Se,{cluster:!0,cluster_id:se[j+3],point_count:X,point_count_abbreviated:ae})}function te(se){return se/360+.5}function re(se){const j=Math.sin(se*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function ge(se){const j=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function oe(se,j,Z,X){let ae=X;const de=j+(Z-j>>1);let Se,Ie=Z-j;const be=se[j],Oe=se[j+1],st=se[Z],$e=se[Z+1];for(let Mt=j+3;Mt<Z;Mt+=3){const xe=Ae(se[Mt],se[Mt+1],be,Oe,st,$e);if(xe>ae)Se=Mt,ae=xe;else if(xe===ae){const Ft=Math.abs(Mt-de);Ft<Ie&&(Se=Mt,Ie=Ft)}}ae>X&&(Se-j>3&&oe(se,j,Se,X),se[Se+2]=ae,Z-Se>3&&oe(se,Se,Z,X))}function Ae(se,j,Z,X,ae,de){let Se=ae-Z,Ie=de-X;if(Se!==0||Ie!==0){const be=((se-Z)*Se+(j-X)*Ie)/(Se*Se+Ie*Ie);be>1?(Z=ae,X=de):be>0&&(Z+=Se*be,X+=Ie*be)}return Se=se-Z,Ie=j-X,Se*Se+Ie*Ie}function Ne(se,j,Z,X){const ae={id:se??null,type:j,geometry:Z,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")pt(ae,Z);else if(j==="Polygon")pt(ae,Z[0]);else if(j==="MultiLineString")for(const de of Z)pt(ae,de);else if(j==="MultiPolygon")for(const de of Z)pt(ae,de[0]);return ae}function pt(se,j){for(let Z=0;Z<j.length;Z+=3)se.minX=Math.min(se.minX,j[Z]),se.minY=Math.min(se.minY,j[Z+1]),se.maxX=Math.max(se.maxX,j[Z]),se.maxY=Math.max(se.maxY,j[Z+1])}function ot(se,j,Z,X){if(!j.geometry)return;const ae=j.geometry.coordinates;if(ae&&ae.length===0)return;const de=j.geometry.type,Se=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2);let Ie=[],be=j.id;if(Z.promoteId?be=j.properties[Z.promoteId]:Z.generateId&&(be=X||0),de==="Point")ut(ae,Ie);else if(de==="MultiPoint")for(const Oe of ae)ut(Oe,Ie);else if(de==="LineString")St(ae,Ie,Se,!1);else if(de==="MultiLineString"){if(Z.lineMetrics){for(const Oe of ae)Ie=[],St(Oe,Ie,Se,!1),se.push(Ne(be,"LineString",Ie,j.properties));return}Bt(ae,Ie,Se,!1)}else if(de==="Polygon")Bt(ae,Ie,Se,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Oe of j.geometry.geometries)ot(se,{id:be,geometry:Oe,properties:j.properties},Z,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of ae){const st=[];Bt(Oe,st,Se,!0),Ie.push(st)}}se.push(Ne(be,de,Ie,j.properties))}function ut(se,j){j.push(at(se[0]),dt(se[1]),0)}function St(se,j,Z,X){let ae,de,Se=0;for(let be=0;be<se.length;be++){const Oe=at(se[be][0]),st=dt(se[be][1]);j.push(Oe,st,0),be>0&&(Se+=X?(ae*st-Oe*de)/2:Math.sqrt(Math.pow(Oe-ae,2)+Math.pow(st-de,2))),ae=Oe,de=st}const Ie=j.length-3;j[2]=1,oe(j,0,Ie,Z),j[Ie+2]=1,j.size=Math.abs(Se),j.start=0,j.end=j.size}function Bt(se,j,Z,X){for(let ae=0;ae<se.length;ae++){const de=[];St(se[ae],de,Z,X),j.push(de)}}function at(se){return se/360+.5}function dt(se){const j=Math.sin(se*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function vt(se,j,Z,X,ae,de,Se,Ie){if(X/=j,de>=(Z/=j)&&Se<X)return se;if(Se<Z||de>=X)return null;const be=[];for(const Oe of se){const st=Oe.geometry;let $e=Oe.type;const Mt=ae===0?Oe.minX:Oe.minY,xe=ae===0?Oe.maxX:Oe.maxY;if(Mt>=Z&&xe<X){be.push(Oe);continue}if(xe<Z||Mt>=X)continue;let Ft=[];if($e==="Point"||$e==="MultiPoint")yt(st,Ft,Z,X,ae);else if($e==="LineString")It(st,Ft,Z,X,ae,!1,Ie.lineMetrics);else if($e==="MultiLineString")mt(st,Ft,Z,X,ae,!1);else if($e==="Polygon")mt(st,Ft,Z,X,ae,!0);else if($e==="MultiPolygon")for(const cr of st){const Jt=[];mt(cr,Jt,Z,X,ae,!0),Jt.length&&Ft.push(Jt)}if(Ft.length){if(Ie.lineMetrics&&$e==="LineString"){for(const cr of Ft)be.push(Ne(Oe.id,$e,cr,Oe.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(Ft.length===1?($e="LineString",Ft=Ft[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=Ft.length===3?"Point":"MultiPoint"),be.push(Ne(Oe.id,$e,Ft,Oe.tags))}}return be.length?be:null}function yt(se,j,Z,X,ae){for(let de=0;de<se.length;de+=3){const Se=se[de+ae];Se>=Z&&Se<=X&&Dt(j,se[de],se[de+1],se[de+2])}}function It(se,j,Z,X,ae,de,Se){let Ie=wt(se);const be=ae===0?zt:qt;let Oe,st,$e=se.start;for(let Jt=0;Jt<se.length-3;Jt+=3){const Tr=se[Jt],Xr=se[Jt+1],dn=se[Jt+2],xn=se[Jt+3],mn=se[Jt+4],jt=ae===0?Tr:Xr,Et=ae===0?xn:mn;let hr=!1;Se&&(Oe=Math.sqrt(Math.pow(Tr-xn,2)+Math.pow(Xr-mn,2))),jt<Z?Et>Z&&(st=be(Ie,Tr,Xr,xn,mn,Z),Se&&(Ie.start=$e+Oe*st)):jt>X?Et<X&&(st=be(Ie,Tr,Xr,xn,mn,X),Se&&(Ie.start=$e+Oe*st)):Dt(Ie,Tr,Xr,dn),Et<Z&&jt>=Z&&(st=be(Ie,Tr,Xr,xn,mn,Z),hr=!0),Et>X&&jt<=X&&(st=be(Ie,Tr,Xr,xn,mn,X),hr=!0),!de&&hr&&(Se&&(Ie.end=$e+Oe*st),j.push(Ie),Ie=wt(se)),Se&&($e+=Oe)}let Mt=se.length-3;const xe=se[Mt],Ft=se[Mt+1],cr=ae===0?xe:Ft;cr>=Z&&cr<=X&&Dt(Ie,xe,Ft,se[Mt+2]),Mt=Ie.length-3,de&&Mt>=3&&(Ie[Mt]!==Ie[0]||Ie[Mt+1]!==Ie[1])&&Dt(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&j.push(Ie)}function wt(se){const j=[];return j.size=se.size,j.start=se.start,j.end=se.end,j}function mt(se,j,Z,X,ae,de){for(const Se of se)It(Se,j,Z,X,ae,de,!1)}function Dt(se,j,Z,X){se.push(j,Z,X)}function zt(se,j,Z,X,ae,de){const Se=(de-j)/(X-j);return Dt(se,de,Z+(ae-Z)*Se,1),Se}function qt(se,j,Z,X,ae,de){const Se=(de-Z)/(ae-Z);return Dt(se,j+(X-j)*Se,de,1),Se}function tr(se,j){const Z=[];for(let X=0;X<se.length;X++){const ae=se[X],de=ae.type;let Se;if(de==="Point"||de==="MultiPoint"||de==="LineString")Se=Qt(ae.geometry,j);else if(de==="MultiLineString"||de==="Polygon"){Se=[];for(const Ie of ae.geometry)Se.push(Qt(Ie,j))}else if(de==="MultiPolygon"){Se=[];for(const Ie of ae.geometry){const be=[];for(const Oe of Ie)be.push(Qt(Oe,j));Se.push(be)}}Z.push(Ne(ae.id,de,Se,ae.tags))}return Z}function Qt(se,j){const Z=[];Z.size=se.size,se.start!==void 0&&(Z.start=se.start,Z.end=se.end);for(let X=0;X<se.length;X+=3)Z.push(se[X]+j,se[X+1],se[X+2]);return Z}function Ot(se,j){if(se.transformed)return se;const Z=1<<se.z,X=se.x,ae=se.y;for(const de of se.features){const Se=de.geometry,Ie=de.type;if(de.geometry=[],Ie===1)for(let be=0;be<Se.length;be+=2)de.geometry.push(fr(Se[be],Se[be+1],j,Z,X,ae));else for(let be=0;be<Se.length;be++){const Oe=[];for(let st=0;st<Se[be].length;st+=2)Oe.push(fr(Se[be][st],Se[be][st+1],j,Z,X,ae));de.geometry.push(Oe)}}return se.transformed=!0,se}function fr(se,j,Z,X,ae,de){return[Math.round(Z*(se*X-ae)),Math.round(Z*(j*X-de))]}function kr(se,j,Z,X,ae){const de=j===ae.maxZoom?0:ae.tolerance/((1<<j)*ae.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:se.length,source:null,x:Z,y:X,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ie of se)Ar(Se,Ie,de,ae);return Se}function Ar(se,j,Z,X){const ae=j.geometry,de=j.type,Se=[];if(se.minX=Math.min(se.minX,j.minX),se.minY=Math.min(se.minY,j.minY),se.maxX=Math.max(se.maxX,j.maxX),se.maxY=Math.max(se.maxY,j.maxY),de==="Point"||de==="MultiPoint")for(let Ie=0;Ie<ae.length;Ie+=3)Se.push(ae[Ie],ae[Ie+1]),se.numPoints++,se.numSimplified++;else if(de==="LineString")rr(Se,ae,se,Z,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Ie=0;Ie<ae.length;Ie++)rr(Se,ae[Ie],se,Z,de==="Polygon",Ie===0);else if(de==="MultiPolygon")for(let Ie=0;Ie<ae.length;Ie++){const be=ae[Ie];for(let Oe=0;Oe<be.length;Oe++)rr(Se,be[Oe],se,Z,!0,Oe===0)}if(Se.length){let Ie=j.tags||null;if(de==="LineString"&&X.lineMetrics){Ie={};for(const Oe in j.tags)Ie[Oe]=j.tags[Oe];Ie.mapbox_clip_start=ae.start/ae.size,Ie.mapbox_clip_end=ae.end/ae.size}const be={geometry:Se,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Ie};j.id!==null&&(be.id=j.id),se.features.push(be)}}function rr(se,j,Z,X,ae,de){const Se=X*X;if(X>0&&j.size<(ae?Se:X))return void(Z.numPoints+=j.length/3);const Ie=[];for(let be=0;be<j.length;be+=3)(X===0||j[be+2]>Se)&&(Z.numSimplified++,Ie.push(j[be],j[be+1])),Z.numPoints++;ae&&(function(be,Oe){let st=0;for(let $e=0,Mt=be.length,xe=Mt-2;$e<Mt;xe=$e,$e+=2)st+=(be[$e]-be[xe])*(be[$e+1]+be[xe+1]);if(st>0===Oe)for(let $e=0,Mt=be.length;$e<Mt/2;$e+=2){const xe=be[$e],Ft=be[$e+1];be[$e]=be[Mt-2-$e],be[$e+1]=be[Mt-1-$e],be[Mt-2-$e]=xe,be[Mt-1-$e]=Ft}})(Ie,de),se.push(Ie)}const Kt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class or{constructor(j,Z){const X=(Z=this.options=(function(de,Se){for(const Ie in Se)de[Ie]=Se[Ie];return de})(Object.create(Kt),Z)).debug;if(X&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let ae=(function(de,Se){const Ie=[];if(de.type==="FeatureCollection")for(let be=0;be<de.features.length;be++)ot(Ie,de.features[be],Se,be);else ot(Ie,de.type==="Feature"?de:{geometry:de},Se);return Ie})(j,Z);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=(function(de,Se){const Ie=Se.buffer/Se.extent;let be=de;const Oe=vt(de,1,-1-Ie,Ie,0,-1,2,Se),st=vt(de,1,1-Ie,2+Ie,0,-1,2,Se);return(Oe||st)&&(be=vt(de,1,-Ie,1+Ie,0,-1,2,Se)||[],Oe&&(be=tr(Oe,1).concat(be)),st&&(be=be.concat(tr(st,-1)))),be})(ae,Z),ae.length&&this.splitTile(ae,0,0,0),X&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,Z,X,ae,de,Se,Ie){const be=[j,Z,X,ae],Oe=this.options,st=Oe.debug;for(;be.length;){ae=be.pop(),X=be.pop(),Z=be.pop(),j=be.pop();const $e=1<<Z,Mt=Sr(Z,X,ae);let xe=this.tiles[Mt];if(!xe&&(st>1&&console.time("creation"),xe=this.tiles[Mt]=kr(j,Z,X,ae,Oe),this.tileCoords.push({z:Z,x:X,y:ae}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,X,ae,xe.numFeatures,xe.numPoints,xe.numSimplified),console.timeEnd("creation"));const hr=`z${Z}`;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(xe.source=j,de==null){if(Z===Oe.indexMaxZoom||xe.numPoints<=Oe.indexMaxPoints)continue}else{if(Z===Oe.maxZoom||Z===de)continue;if(de!=null){const hr=de-Z;if(X!==Se>>hr||ae!==Ie>>hr)continue}}if(xe.source=null,j.length===0)continue;st>1&&console.time("clipping");const Ft=.5*Oe.buffer/Oe.extent,cr=.5-Ft,Jt=.5+Ft,Tr=1+Ft;let Xr=null,dn=null,xn=null,mn=null,jt=vt(j,$e,X-Ft,X+Jt,0,xe.minX,xe.maxX,Oe),Et=vt(j,$e,X+cr,X+Tr,0,xe.minX,xe.maxX,Oe);j=null,jt&&(Xr=vt(jt,$e,ae-Ft,ae+Jt,1,xe.minY,xe.maxY,Oe),dn=vt(jt,$e,ae+cr,ae+Tr,1,xe.minY,xe.maxY,Oe),jt=null),Et&&(xn=vt(Et,$e,ae-Ft,ae+Jt,1,xe.minY,xe.maxY,Oe),mn=vt(Et,$e,ae+cr,ae+Tr,1,xe.minY,xe.maxY,Oe),Et=null),st>1&&console.timeEnd("clipping"),be.push(Xr||[],Z+1,2*X,2*ae),be.push(dn||[],Z+1,2*X,2*ae+1),be.push(xn||[],Z+1,2*X+1,2*ae),be.push(mn||[],Z+1,2*X+1,2*ae+1)}}getTile(j,Z,X){j=+j,Z=+Z,X=+X;const ae=this.options,{extent:de,debug:Se}=ae;if(j<0||j>24)return null;const Ie=1<<j,be=Sr(j,Z=Z+Ie&Ie-1,X);if(this.tiles[be])return Ot(this.tiles[be],de);Se>1&&console.log("drilling down to z%d-%d-%d",j,Z,X);let Oe,st=j,$e=Z,Mt=X;for(;!Oe&&st>0;)st--,$e>>=1,Mt>>=1,Oe=this.tiles[Sr(st,$e,Mt)];return Oe&&Oe.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",st,$e,Mt),console.time("drilling down")),this.splitTile(Oe.source,st,$e,Mt,j,Z,X),Se>1&&console.timeEnd("drilling down"),this.tiles[be]?Ot(this.tiles[be],de):null):null}}function Sr(se,j,Z){return 32*((1<<se)*Z+j)+se}class Dr extends K{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,Z){return T._(this,void 0,void 0,(function*(){const X=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ae=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ae)return null;const de=new Re(ae.features,{version:2,extent:T.$});let Se=(function(Ie){const be=new T.cM;return(function(Oe,st){for(const $e in Oe.layers)st.writeMessage(3,ze,Oe.layers[$e])})(Ie,be),be.finish()})(de);return Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),{vectorTile:de,rawData:Se.buffer}}))}loadData(j){return T._(this,void 0,void 0,(function*(){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.abort();const X=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.cN(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest);const ae=yield this._pendingData;this._geoJSONIndex=j.cluster?new Ze((function({superclusterOptions:Se,clusterProperties:Ie}){if(!Ie||!Se)return Se;const be={},Oe={},st={accumulated:null,zoom:0},$e={properties:null},Mt=Object.keys(Ie);for(const xe of Mt){const[Ft,cr]=Ie[xe],Jt=T.cT(cr),Tr=T.cT(typeof Ft=="string"?[Ft,["accumulated"],["get",xe]]:Ft);be[xe]=Jt.value,Oe[xe]=Tr.value}return Se.map=xe=>{$e.properties=xe;const Ft={};for(const cr of Mt)Ft[cr]=be[cr].evaluate(st,$e);return Ft},Se.reduce=(xe,Ft)=>{$e.properties=Ft;for(const cr of Mt)st.accumulated=xe[cr],xe[cr]=Oe[cr].evaluate(st,$e)},Se})(j)).load(ae.features):(function(Se,Ie){return new or(Se,Ie)})(ae,j.geojsonVtOptions),this.loaded={};const de={data:ae};if(X){const Se=X.finish();Se&&(de.resourceTiming={},de.resourceTiming[j.source]=JSON.parse(JSON.stringify(Se)))}return de}catch(ae){if(delete this._pendingRequest,T.cy(ae))return{abandoned:!0};throw ae}}))}getData(){return T._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const Z=this.loaded;return Z&&Z[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,Z){return T._(this,void 0,void 0,(function*(){let X=yield this.loadGeoJSON(j,Z);if(delete this._pendingRequest,typeof X!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(Me(X,!0),j.filter){const ae=T.cT(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map((Se=>`${Se.key}: ${Se.message}`)).join(", "));X={type:"FeatureCollection",features:X.features.filter((Se=>ae.value.evaluate({zoom:0},Se)))}}return X}))}loadGeoJSON(j,Z){return T._(this,void 0,void 0,(function*(){const{promoteId:X}=j;if(j.request){const ae=yield T.j(j.request,Z);return this._dataUpdateable=T.cV(ae.data,X)?T.cU(ae.data,X):void 0,ae.data}if(typeof j.data=="string")try{const ae=JSON.parse(j.data);return this._dataUpdateable=T.cV(ae,X)?T.cU(ae,X):void 0,ae}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return T.cW(this._dataUpdateable,j.dataDiff,X),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(j){return T._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class Zr{constructor(j){this.self=j,this.actor=new T.J(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Z,X)=>{if(this.externalWorkerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.externalWorkerSourceTypes[Z]=X},this.self.addProtocol=T.cA,this.self.removeProtocol=T.cB,this.self.registerRTLTextPlugin=Z=>{T.cX.setMethods(Z)},this.actor.registerMessageHandler("LDT",((Z,X)=>this._getDEMWorkerSource(Z,X.source).loadTile(X))),this.actor.registerMessageHandler("RDT",((Z,X)=>T._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Z,X.source).removeTile(X)})))),this.actor.registerMessageHandler("GCEZ",((Z,X)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(Z,X.type,X.source).getClusterExpansionZoom(X)})))),this.actor.registerMessageHandler("GCC",((Z,X)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(Z,X.type,X.source).getClusterChildren(X)})))),this.actor.registerMessageHandler("GCL",((Z,X)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(Z,X.type,X.source).getClusterLeaves(X)})))),this.actor.registerMessageHandler("LD",((Z,X)=>this._getWorkerSource(Z,X.type,X.source).loadData(X))),this.actor.registerMessageHandler("GD",((Z,X)=>this._getWorkerSource(Z,X.type,X.source).getData())),this.actor.registerMessageHandler("LT",((Z,X)=>this._getWorkerSource(Z,X.type,X.source).loadTile(X))),this.actor.registerMessageHandler("RT",((Z,X)=>this._getWorkerSource(Z,X.type,X.source).reloadTile(X))),this.actor.registerMessageHandler("AT",((Z,X)=>this._getWorkerSource(Z,X.type,X.source).abortTile(X))),this.actor.registerMessageHandler("RMT",((Z,X)=>this._getWorkerSource(Z,X.type,X.source).removeTile(X))),this.actor.registerMessageHandler("RS",((Z,X)=>T._(this,void 0,void 0,(function*(){if(!this.workerSources[Z]||!this.workerSources[Z][X.type]||!this.workerSources[Z][X.type][X.source])return;const ae=this.workerSources[Z][X.type][X.source];delete this.workerSources[Z][X.type][X.source],ae.removeSource!==void 0&&ae.removeSource(X)})))),this.actor.registerMessageHandler("RM",(Z=>T._(this,void 0,void 0,(function*(){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z]})))),this.actor.registerMessageHandler("SR",((Z,X)=>T._(this,void 0,void 0,(function*(){this.referrer=X})))),this.actor.registerMessageHandler("SRPS",((Z,X)=>this._syncRTLPluginState(Z,X))),this.actor.registerMessageHandler("IS",((Z,X)=>T._(this,void 0,void 0,(function*(){this.self.importScripts(X)})))),this.actor.registerMessageHandler("SI",((Z,X)=>this._setImages(Z,X))),this.actor.registerMessageHandler("UL",((Z,X)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(Z).update(X.layers,X.removedIds)})))),this.actor.registerMessageHandler("SL",((Z,X)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(Z).replace(X)}))))}_setImages(j,Z){return T._(this,void 0,void 0,(function*(){this.availableImages[j]=Z;for(const X in this.workerSources[j]){const ae=this.workerSources[j][X];for(const de in ae)ae[de].availableImages=Z}}))}_syncRTLPluginState(j,Z){return T._(this,void 0,void 0,(function*(){return yield T.cX.syncState(Z,this.self.importScripts)}))}_getAvailableImages(j){let Z=this.availableImages[j];return Z||(Z=[]),Z}_getLayerIndex(j){let Z=this.layerIndexes[j];return Z||(Z=this.layerIndexes[j]=new s),Z}_getWorkerSource(j,Z,X){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][Z]||(this.workerSources[j][Z]={}),!this.workerSources[j][Z][X]){const ae={sendAsync:(de,Se)=>(de.targetMapId=j,this.actor.sendAsync(de,Se))};switch(Z){case"vector":this.workerSources[j][Z][X]=new K(ae,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][Z][X]=new Dr(ae,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][Z][X]=new this.externalWorkerSourceTypes[Z](ae,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][Z][X]}_getDEMWorkerSource(j,Z){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][Z]||(this.demWorkerSources[j][Z]=new ie),this.demWorkerSources[j][Z]}}return T.i(self)&&(self.worker=new Zr(self)),Zr})),M("index",["exports","./shared"],(function(T,s){var B="5.6.2";function N(){var h=new s.A(4);return s.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let Y,K;const ie={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h,e,i){const l=requestAnimationFrame((d=>{u(),e(d)})),{unsubscribe:u}=s.s(h.signal,"abort",(()=>{u(),cancelAnimationFrame(l),i(s.c())}),!1)},frameAsync(h){return new Promise(((e,i)=>{this.frame(h,e,i)}))},getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,i.drawImage(h,0,0,h.width,h.height),i},resolveURL:h=>(Y||(Y=document.createElement("a")),Y.href=h,Y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class H{static testProp(e){if(!H.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in H.docStyle)return e[i];return e[0]}static create(e,i,l){const u=window.document.createElement(e);return i!==void 0&&(u.className=i),l&&l.appendChild(u),u}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(e,i){e.style[H.transformProp]=i}static addEventListener(e,i,l,u={}){e.addEventListener(i,l,"passive"in u?u:u.capture)}static removeEventListener(e,i,l,u={}){e.removeEventListener(i,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",H.suppressClickInternal,!0)}),0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,l){const u=i.boundingClientRect;return new s.P((l.clientX-u.left)/i.x-e.clientLeft,(l.clientY-u.top)/i.y-e.clientTop)}static mousePos(e,i){const l=H.getScale(e);return H.getPoint(e,l,i)}static touchPos(e,i){const l=[],u=H.getScale(e);for(let d=0;d<i.length;d++)l.push(H.getPoint(e,u,i[d]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=i.querySelectorAll("script");for(const u of l)u.remove();return H.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const l=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const l of i)H.removeAttributes(l),H.clean(l)}static removeAttributes(e){for(const{name:i,value:l}of e.attributes)H.isPossiblyDangerous(i,l)&&e.removeAttribute(i)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);const me={supported:!1,testSupport:function(h){!Ee&&Me&&(Re?ze(h):ve=h)}};let ve,Me,Ee=!1,Re=!1;function ze(h){const e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Me),h.isContextLost())return;me.supported=!0}catch{}h.deleteTexture(e),Ee=!0}var Fe;typeof document<"u"&&(Me=document.createElement("img"),Me.onload=()=>{ve&&ze(ve),ve=null,Re=!0},Me.onerror=()=>{Ee=!0,ve=null},Me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(h){let e,i,l,u;h.resetRequestQueue=()=>{e=[],i=0,l=0,u={}},h.addThrottleControl=C=>{const P=l++;return u[P]=C,P},h.removeThrottleControl=C=>{delete u[C],g()},h.getImage=(C,P,A=!0)=>new Promise(((R,D)=>{me.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),s.e(C,{type:"image"}),e.push({abortController:P,requestParameters:C,supportImageRefresh:A,state:"queued",onError:O=>{D(O)},onSuccess:O=>{R(O)}}),g()}));const d=C=>s._(this,void 0,void 0,(function*(){C.state="running";const{requestParameters:P,supportImageRefresh:A,onError:R,onSuccess:D,abortController:O}=C,$=A===!1&&!s.i(self)&&!s.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce(((ne,ue)=>ne&&ue==="accept"),!0));i++;const ee=$?w(P,O):s.m(P,O);try{const ne=yield ee;delete C.abortController,C.state="completed",ne.data instanceof HTMLImageElement||s.b(ne.data)?D(ne):ne.data&&D({data:yield(Q=ne.data,typeof createImageBitmap=="function"?s.f(Q):s.h(Q)),cacheControl:ne.cacheControl,expires:ne.expires})}catch(ne){delete C.abortController,R(ne)}finally{i--,g()}var Q})),g=()=>{const C=(()=>{for(const P of Object.keys(u))if(u[P]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=i;P<C&&e.length>0;P++){const A=e.shift();A.abortController.signal.aborted?P--:d(A)}},w=(C,P)=>new Promise(((A,R)=>{const D=new Image,O=C.url,$=C.credentials;$&&$==="include"?D.crossOrigin="use-credentials":($&&$==="same-origin"||!s.d(O))&&(D.crossOrigin="anonymous"),P.signal.addEventListener("abort",(()=>{D.src="",R(s.c())})),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,A({data:D})},D.onerror=()=>{D.onerror=D.onload=null,P.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=O}))})(Fe||(Fe={})),Fe.resetRequestQueue();class Ke{constructor(e){this._transformRequestFn=e??null}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function rt(h){const e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){const i=[];for(const{id:l,url:u}of h){const d=`${l}${u}`;i.indexOf(d)===-1&&(i.push(d),e.push({id:l,url:u}))}}return e}function qe(h,e,i){try{const l=new URL(h);return l.pathname+=`${e}${i}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function He(h){const{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class et extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:l}of this.requestors)l(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const l=i.spriteData;i.data=new s.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let l=!0;const u=i.data||i.spriteData;return this._validateStretch(i.stretchX,u&&u.width)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(i.stretchY,u&&u.height)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(i.content,i)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,i){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||i<u[1])return!1;l=u[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const l=i.spriteData,u=l&&l.width||i.data.width,d=l&&l.height||i.data.height;return!(e[0]<0||u<e[0]||e[1]<0||d<e[1]||e[2]<0||u<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==i.data.width||u.data.height!==i.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=u.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((i,l)=>{let u=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(u=!1);this.isLoaded()||u?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})}))}_getImagesForIds(e){const i={};for(const l of e){let u=this.getImage(l);u||(this.fire(new s.l("styleimagemissing",{id:l})),u=this.getImage(l)),u?i[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:s.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],l=this.getImage(e);if(!l)return null;if(i&&i.position.version===l.version)return i.position;if(i)i.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},d=new s.I(u,l);this.patterns[e]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:i,h:l}=s.p(e),u=this.atlasImage;u.resize({width:i||1,height:l||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],w=g.x+1,C=g.y+1,P=this.getImage(d).data,A=P.width,R=P.height;s.R.copy(P,u,{x:0,y:0},{x:w,y:C},{width:A,height:R}),s.R.copy(P,u,{x:0,y:R-1},{x:w,y:C-1},{width:A,height:1}),s.R.copy(P,u,{x:0,y:0},{x:w,y:C+R},{width:A,height:1}),s.R.copy(P,u,{x:A-1,y:0},{x:w-1,y:C},{width:1,height:R}),s.R.copy(P,u,{x:0,y:0},{x:w+A,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const l=this.getImage(i);l||s.w(`Image with ID: "${i}" was not found`),He(l)&&this.updateImage(i,l)}}}const De=1e20;function tt(h,e,i,l,u,d,g,w,C){for(let P=e;P<e+l;P++)nt(h,i*d+P,d,u,g,w,C);for(let P=i;P<i+u;P++)nt(h,P*d+e,1,l,g,w,C)}function nt(h,e,i,l,u,d,g){d[0]=0,g[0]=-De,g[1]=De,u[0]=h[e];for(let w=1,C=0,P=0;w<l;w++){u[w]=h[e+w*i];const A=w*w;do{const R=d[C];P=(u[w]-u[R]+A-R*R)/(w-R)/2}while(P<=g[C]&&--C>-1);C++,d[C]=w,g[C]=P,g[C+1]=De}for(let w=0,C=0;w<l;w++){for(;g[C+1]<w;)C++;const P=d[C],A=w-P;h[e+w*i]=u[P]+A*A}}class Ze{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return s._(this,void 0,void 0,(function*(){const i=[];for(const d in e)for(const g of e[d])i.push(this._getAndCacheGlyphsPromise(d,g));const l=yield Promise.all(i),u={};for(const{stack:d,id:g,glyph:w}of l)u[d]||(u[d]={}),u[d][g]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u}))}_getAndCacheGlyphsPromise(e,i){return s._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[i];if(u!==void 0)return{stack:e,id:i,glyph:u};if(u=this._tinySDF(l,e,i),u)return l.glyphs[i]=u,{stack:e,id:i,glyph:u};const d=Math.floor(i/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[d])return{stack:e,id:i,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[d]){const w=Ze.loadGlyphRange(e,d,this.url,this.requestManager);l.requests[d]=w}const g=yield l.requests[d];for(const w in g)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=g[+w]);return l.ranges[d]=!0,{stack:e,id:i,glyph:g[i]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||s.u["CJK Unified Ideographs"](e)||s.u["Hangul Syllables"](e)||s.u.Hiragana(e)||s.u.Katakana(e)||s.u["CJK Symbols and Punctuation"](e)||s.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let d=e.tinySDF;if(!d){let w="400";/bold/i.test(i)?w="900":/medium/i.test(i)?w="500":/light/i.test(i)&&(w="200"),d=e.tinySDF=new Ze.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const g=d.draw(String.fromCharCode(l));return{id:l,bitmap:new s.q({width:g.width||60,height:g.height||60},g.data),metrics:{width:g.glyphWidth/2||24,height:g.glyphHeight/2||24,left:g.glyphLeft/2+.5||0,top:g.glyphTop/2-27.5||-8,advance:g.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ze.loadGlyphRange=function(h,e,i,l){return s._(this,void 0,void 0,(function*(){const u=256*e,d=u+255,g=l.transformRequest(i.replace("{fontstack}",h).replace("{range}",`${u}-${d}`),"Glyphs"),w=yield s.n(g,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${d}`);const C={};for(const P of s.o(w.data))C[P.id]=P;return C}))},Ze.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:g="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=i,this.lang=w;const C=this.size=h+4*e,P=this._createCanvas(C),A=this.ctx=P.getContext("2d",{willReadFrequently:!0});A.font=`${g} ${d} ${h}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(h){const e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(h),g=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),C=Math.min(this.size-this.buffer,g+Math.ceil(l)),P=w+2*this.buffer,A=C+2*this.buffer,R=Math.max(P*A,0),D=new Uint8ClampedArray(R),O={data:D,width:P,height:A,glyphWidth:w,glyphHeight:C,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(w===0||C===0)return O;const{ctx:$,buffer:ee,gridInner:Q,gridOuter:ne}=this;this.lang&&($.lang=this.lang),$.clearRect(ee,ee,w,C),$.fillText(h,ee,ee+g);const ue=$.getImageData(ee,ee,w,C);ne.fill(De,0,R),Q.fill(0,0,R);for(let _e=0;_e<C;_e++)for(let he=0;he<w;he++){const we=ue.data[4*(_e*w+he)+3]/255;if(we===0)continue;const Pe=(_e+ee)*P+he+ee;if(we===1)ne[Pe]=0,Q[Pe]=De;else{const pe=.5-we;ne[Pe]=pe>0?pe*pe:0,Q[Pe]=pe<0?pe*pe:0}}tt(ne,0,0,P,A,P,this.f,this.v,this.z),tt(Q,ee,ee,w,C,P,this.f,this.v,this.z);for(let _e=0;_e<R;_e++){const he=Math.sqrt(ne[_e])-Math.sqrt(Q[_e]);D[_e]=Math.round(255-255*(he/this.radius+this.cutoff))}return O}};class ke{constructor(){this.specification=s.v.light.position}possiblyEvaluate(e,i){return s.B(e.expression.evaluate(i))}interpolate(e,i,l){return{x:s.C.number(e.x,i.x,l),y:s.C.number(e.y,i.y,l),z:s.C.number(e.z,i.z,l)}}}let bt;class te extends s.E{constructor(e){super(),bt=bt||new s.r({anchor:new s.D(s.v.light.anchor),position:new ke,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.t(bt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(s.x,e,i))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,l){return(!l||l.validate!==!1)&&s.y(this,e.call(s.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const re=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class ge extends s.E{constructor(e){super(),this._transitionable=new s.t(re),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0))}setSky(e,i={}){if(!this._validate(s.G,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,l={}){return(l==null?void 0:l.validate)!==!1&&s.y(this,e.call(s.z,s.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class oe{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const l=e.join(",")+String(i);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,i)),this.dashEntry[l]}getDashRanges(e,i,l){const u=[];let d=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,w=!0;u.push({left:d,right:g,isDash:w,zeroLength:e[0]===0});let C=e[0];for(let P=1;P<e.length;P++){w=!w;const A=e[P];d=C*l,C+=A,g=C*l,u.push({left:d,right:g,isDash:w,zeroLength:A===0})}return u}addRoundDash(e,i,l){const u=i/2;for(let d=-l;d<=l;d++){const g=this.width*(this.nextRow+l+d);let w=0,C=e[w];for(let P=0;P<this.width;P++){P/C.right>1&&(C=e[++w]);const A=Math.abs(P-C.left),R=Math.abs(P-C.right),D=Math.min(A,R);let O;const $=d/l*(u+1);if(C.isDash){const ee=u-Math.abs($);O=Math.sqrt(D*D+ee*ee)}else O=u-Math.sqrt(D*D+$*$);this.data[g+P]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const C=e[w],P=e[w+1];C.zeroLength?e.splice(w,1):P&&P.isDash===C.isDash&&(P.left=C.left,e.splice(w,1))}const i=e[0],l=e[e.length-1];i.isDash===l.isDash&&(i.left=l.left-this.width,l.right=i.right+this.width);const u=this.width*this.nextRow;let d=0,g=e[d];for(let w=0;w<this.width;w++){w/g.right>1&&(g=e[++d]);const C=Math.abs(w-g.left),P=Math.abs(w-g.right),A=Math.min(C,P);this.data[u+w]=Math.max(0,Math.min(255,(g.isDash?A:-A)+128))}}addDash(e,i){const l=i?7:0,u=2*l+1;if(this.nextRow+u>this.height)return s.w("LineAtlas out of space"),null;let d=0;for(let w=0;w<e.length;w++)d+=e[w];if(d!==0){const w=this.width/d,C=this.getDashRanges(e,this.width,w);i?this.addRoundDash(C,w,l):this.addRegularDash(C)}const g={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:d};return this.nextRow+=u,this.dirty=!0,g}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const Ae="maplibre_preloaded_worker_pool";class Ne{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ne.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ae]}numActive(){return Object.keys(this.active).length}}const pt=Math.floor(ie.hardwareConcurrency/2);let ot,ut;function St(){return ot||(ot=new Ne),ot}Ne.workerCount=s.H(globalThis)?Math.max(Math.min(pt,3),1):1;class Bt{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const l=this.workerPool.acquire(i);for(let u=0;u<l.length;u++){const d=new s.J(l[u],i);d.name=`Worker ${u}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:i}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((i=>{i.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const l of this.actors)l.registerMessageHandler(e,i)}}function at(){return ut||(ut=new Bt(St(),s.K),ut.registerMessageHandler("GR",((h,e,i)=>s.m(e,i)))),ut}function dt(h,e){const i=s.L();return s.M(i,i,[1,1,0]),s.N(i,i,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?s.O(i,i,h.calculatePosMatrix(e.toUnwrapped())):i}function vt(h,e,i,l,u,d,g){var w;const C=(function(D,O,$){if(D)for(const ee of D){const Q=O[ee];if(Q&&Q.source===$&&Q.type==="fill-extrusion")return!0}else for(const ee in O){const Q=O[ee];if(Q.source===$&&Q.type==="fill-extrusion")return!0}return!1})((w=u==null?void 0:u.layers)!==null&&w!==void 0?w:null,e,h.id),P=d.maxPitchScaleFactor(),A=h.tilesIn(l,P,C);A.sort(yt);const R=[];for(const D of A)R.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,i,h._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,u,d,P,dt(h.transform,D.tileID),g?(O,$)=>g(D.tileID,O,$):void 0)});return(function(D,O){for(const $ in D)for(const ee of D[$])It(ee,O);return D})((function(D){const O={},$={};for(const ee of D){const Q=ee.queryResults,ne=ee.wrappedTileID,ue=$[ne]=$[ne]||{};for(const _e in Q){const he=Q[_e],we=ue[_e]=ue[_e]||{},Pe=O[_e]=O[_e]||[];for(const pe of he)we[pe.featureIndex]||(we[pe.featureIndex]=!0,Pe.push(pe))}}return O})(R),h)}function yt(h,e){const i=h.tileID,l=e.tileID;return i.overscaledZ-l.overscaledZ||i.canonical.y-l.canonical.y||i.wrap-l.wrap||i.canonical.x-l.canonical.x}function It(h,e){const i=h.feature,l=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=l}function wt(h,e,i){return s._(this,void 0,void 0,(function*(){let l=h;if(h.url?l=(yield s.j(e.transformRequest(h.url,"Source"),i)).data:yield ie.frameAsync(i),!l)return null;const u=s.Q(s.e(l,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map((d=>d.id))),u}))}class mt{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof s.S?new s.S(e.lng,e.lat):s.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof s.S?new s.S(e.lng,e.lat):s.S.convert(e),this}extend(e){const i=this._sw,l=this._ne;let u,d;if(e instanceof s.S)u=e,d=e;else{if(!(e instanceof mt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(mt.convert(e)):this.extend(s.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(s.S.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return i||l?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),l.lng=Math.max(d.lng,l.lng),l.lat=Math.max(d.lat,l.lat)):(this._sw=new s.S(u.lng,u.lat),this._ne=new s.S(d.lng,d.lat)),this}getCenter(){return new s.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.S(this.getWest(),this.getNorth())}getSouthEast(){return new s.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=s.S.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof mt?e:e&&new mt(e)}static fromLngLat(e,i=0){const l=360*i/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new mt(new s.S(e.lng-u,e.lat-l),new s.S(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new s.S(this._sw.lng,this._sw.lat),i=new s.S(this._ne.lng,this._ne.lat);return new mt(e,e.lng>i.lng?new s.S(i.lng+360,i.lat):i)}}class Dt{constructor(e,i,l){this.bounds=mt.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),l=Math.floor(s.V(this.bounds.getWest())*i),u=Math.floor(s.U(this.bounds.getNorth())*i),d=Math.ceil(s.V(this.bounds.getEast())*i),g=Math.ceil(s.U(this.bounds.getSouth())*i);return e.x>=l&&e.x<d&&e.y>=u&&e.y<g}}class zt extends s.E{constructor(e,i,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.Q(i,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield wt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(s.e(this,e),e.bounds&&(this.tileBounds=new Dt(e.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new s.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((d,g)=>{e.reloadPromise={resolve:d,reject:g}}))}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return s._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class qt extends s.E{constructor(e,i,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},i),s.e(this,s.Q(i,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield wt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(s.e(this,i),i.bounds&&(this.tileBounds=new Dt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new s.k(i))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return s.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Fe.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,d=u.gl,g=l.data;e.texture=this.map.painter.getTileTexture(g.width),e.texture?e.texture.update(g,{useMipmap:!0}):(e.texture=new s.T(u,g,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return s._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class tr extends qt{constructor(e,i,l,u){super(e,i,l,u),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Fe.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const d=u.data;this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const g=s.b(d)&&s.W()?d:yield this.readImageNow(d),w={type:this.type,uid:e.uid,source:this.id,rawImageData:g,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const C=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}readImageNow(e){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.X()){const i=e.width+2,l=e.height+2;try{return new s.R({width:i,height:l},yield s.Y(e,-1,-1,i,l))}catch{}}return ie.getImageData(e,1)}))}_getNeighboringTiles(e){const i=e.canonical,l=Math.pow(2,i.z),u=(i.x-1+l)%l,d=i.x===0?e.wrap-1:e.wrap,g=(i.x+1+l)%l,w=i.x+1===l?e.wrap+1:e.wrap,C={};return C[new s.Z(e.overscaledZ,d,i.z,u,i.y).key]={backfilled:!1},C[new s.Z(e.overscaledZ,w,i.z,g,i.y).key]={backfilled:!1},i.y>0&&(C[new s.Z(e.overscaledZ,d,i.z,u,i.y-1).key]={backfilled:!1},C[new s.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},C[new s.Z(e.overscaledZ,w,i.z,g,i.y-1).key]={backfilled:!1}),i.y+1<l&&(C[new s.Z(e.overscaledZ,d,i.z,u,i.y+1).key]={backfilled:!1},C[new s.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},C[new s.Z(e.overscaledZ,w,i.z,g,i.y+1).key]={backfilled:!1}),C}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Qt extends s.E{constructor(e,i,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:i.data},this.actor=l.getActor(),this.setEventedParent(u),this._data=i.data,this._options=s.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:s.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(s.$/this.tileSize)}_getClusterMaxZoom(e){const i=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${i}"`),i}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=s.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return s._(this,void 0,void 0,(function*(){const e=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((i=>i.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,(function*(){const e=new mt,i=yield this.getData();let l;switch(i.type){case"FeatureCollection":l=i.features.map((u=>this.getCoordinatesFromGeometry(u.geometry))).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(i.geometry);break;default:l=this.getCoordinatesFromGeometry(i)}if(l.length==0)return e;for(let u=0;u<l.length-1;u+=2)e.extend([l[u],l[u+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:l}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:i}=this._pendingWorkerUpdate;if(!e&&!i)return void s.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const l=s.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(l.request=this.map._requestManager.transformRequest(ie.resolveURL(e),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):i&&(l.dataDiff=i,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||u.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));this._data=u.data;let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const g={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&s.e(g,{resourceTiming:d}),this.fire(new s.l("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))}catch(u){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(u))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return s._(this,void 0,void 0,(function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:i,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,i==="RT")}))}abortTile(e){return s._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return s._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Ot extends s.E{constructor(e,i,l,u){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=i}load(e){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Fe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new s.k(i))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(s.a1.fromLngLat);var l;return this.tileID=(function(u){const d=s.a2.fromPoints(u),g=d.width(),w=d.height(),C=Math.max(g,w),P=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),A=Math.pow(2,P);return new s.a4(P,Math.floor((d.minX+d.maxX)/2*A),Math.floor((d.minY+d.maxY)/2*A))})(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map((u=>this.tileID.getTilePoint(u)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new s.T(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,l=!0)}l&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:i,minY:l,maxX:u,maxY:d}=s.a2.fromPoints(e),g={};for(let w=0;w<=s.a3;w++){const C=Math.pow(2,w),P=Math.floor(i*C),A=Math.floor(l*C),R=Math.floor(u*C),D=Math.floor(d*C);g[w]={minTileX:P,minTileY:A,maxTileX:R,maxTileY:D}}return g}}class fr extends Ot{constructor(e,i,l,u){super(e,i,l,u),this.roundZoom=!0,this.type="video",this.options=i}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield s.a5(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new s.k(i))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new s.k(new s.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,l=!0)}l&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class kr extends Ot{constructor(e,i,l,u){super(e,i,l,u),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some((d=>!Array.isArray(d)||d.length!==2||d.some((g=>typeof g!="number"))))||this.fire(new s.k(new s.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a6(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.k(new s.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,l=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(i,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ar={},rr=h=>{switch(h){case"geojson":return Qt;case"image":return Ot;case"raster":return qt;case"raster-dem":return tr;case"vector":return zt;case"video":return fr;case"canvas":return kr}return Ar[h]},Kt="RTLPluginLoaded";class or extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=at()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((i=>{throw this.status="error",i}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return s._(this,arguments,void 0,(function*(i,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ie.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Kt))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Sr=null;function Dr(){return Sr||(Sr=new or),Sr}class Zr{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=s.a7(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(u,d){const g={};if(!d)return g;for(const w of u){const C=w.layerIds.map((P=>d.getLayer(P))).filter(Boolean);if(C.length!==0){w.layers=C,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((P=>C.filter((A=>A.id===P))[0])));for(const P of C)g[P.id]=w}}return g})(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof s.a9){if(this.hasSymbolBuckets=!0,!l)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof s.a9&&d.hasRTLText){this.hasRTLText=!0,Dr().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new s.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,u,d,g,w,C,P,A,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:A,transform:C,params:w,queryPadding:this.queryPadding*P,getElevation:R},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),d=i&&i.sourceLayer?i.sourceLayer:"",g=u._geojsonTileLayer||u[d];if(!g)return;const w=s.aa(i&&i.filter),{z:C,x:P,y:A}=this.tileID.canonical,R={z:C,x:P,y:A};for(let D=0;D<g.length;D++){const O=g.feature(D);if(w.needGeometry){const Q=s.ab(O,!0);if(!w.filter(new s.F(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!w.filter(new s.F(this.tileID.overscaledZ),O))continue;const $=l.getId(O,d),ee=new s.ac(O,C,P,A,$);ee.tile=R,e.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=s.ad(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const d=this.expirationTime-i;d?this.expirationTime=l+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!i.style.hasLayer(u))continue;const d=this.buckets[u],g=d.layers[0].sourceLayer||"_geojsonTileLayer",w=l[g],C=e[g];if(!w||!C||Object.keys(C).length===0)continue;d.update(C,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=i&&i.style&&i.style.getLayer(u);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ie.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ie.now()+e}setDependencies(e,i){const l={};for(const u of i)l[u]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const u=this.dependencies[l];if(u){for(const d of i)if(u[d])return!0}}return!1}}class se{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:i,timeout:void 0};if(l!==void 0&&(d.timeout=setTimeout((()=>{this.remove(e,d)}),l)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,u=i===void 0?0:this.data[l].indexOf(i),d=this.data[l][u];return this.data[l].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(d.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||i.push(u);for(const l of i)this.remove(l.value.tileID,l)}}class j{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},s.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])l[d]||(this.deletedStates[e][u][d]=null)}else for(const d in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),u=s.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][i];if(d===null)return{};for(const g in d)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),s.e(this.state[u][g],this.stateChanges[u][g]),d[g]=this.state[u][g];l[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const g in this.state[u])d[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else for(const w of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][w];d[g]=this.state[u][g]}l[u]=l[u]||{},s.e(l[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,i)}}const Z=89.25;function X(h,e){const i=s.ah(e.lat,-s.ai,s.ai);return new s.P(s.V(e.lng)*h,s.U(i)*h)}function ae(h,e){return new s.a1(e.x/h,e.y/h).toLngLat()}function de(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(s.ae(90-h.pitch)),Math.tan(s.ae(Z-h.pitch)))}function Se(h,e){const i=h.canonical,l=e/s.af(i.z),u=i.x+Math.pow(2,i.z)*h.wrap,d=s.ag(new Float64Array(16));return s.M(d,d,[u*l,i.y*l,0]),s.N(d,d,[l/s.$,l/s.$,1]),d}function Ie(h,e,i,l,u){const d=s.a1.fromLngLat(h,e),g=u*s.aj(1,h.lat),w=g*Math.cos(s.ae(i)),C=Math.sqrt(g*g-w*w),P=C*Math.sin(s.ae(-l)),A=C*Math.cos(s.ae(-l));return new s.a1(d.x+P,d.y+A,d.z+w)}function be(h,e,i){const l=e.intersectsFrustum(h);if(!i||l===0)return l;const u=e.intersectsPlane(i);return u===0?0:l===2&&u===2?2:1}function Oe(h,e,i){let l=0;const u=(i-e)/10;for(let d=0;d<10;d++)l+=u*Math.pow(Math.cos(e+(d+.5)/10*(i-e)),h);return l}function st(h,e){return function(i,l,u,d,g){const w=2*((h-1)/s.ak(Math.cos(s.ae(Z-g))/Math.cos(s.ae(Z)))-1),C=Math.acos(u/d),P=2*Oe(w-1,0,s.ae(g/2)),A=Math.min(s.ae(Z),C+s.ae(g/2)),R=Oe(w-1,Math.min(A,C-s.ae(g/2)),A),D=Math.atan(l/u),O=Math.hypot(l,u);let $=i;return $+=s.ak(d/O/Math.max(.5,Math.cos(s.ae(g/2)))),$+=w*s.ak(Math.cos(D))/2,$-=s.ak(Math.max(1,R/P/e))/2,$}}const $e=st(9.314,3);function Mt(h,e){const i=(e.roundZoom?Math.round:Math.floor)(h.zoom+s.ak(h.tileSize/e.tileSize));return Math.max(0,i)}function xe(h,e){const i=h.getCameraFrustum(),l=h.getClippingPlane(),u=h.screenPointToMercatorCoordinate(h.getCameraPoint()),d=s.a1.fromLngLat(h.center,h.elevation);u.z=d.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;const g=h.getCoveringTilesDetailsProvider(),w=g.allowVariableZoom(h,e),C=Mt(h,e),P=e.minzoom||0,A=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,R=Math.min(Math.max(0,C),A),D=Math.pow(2,R),O=[D*u.x,D*u.y,0],$=[D*d.x,D*d.y,0],ee=Math.hypot(d.x-u.x,d.y-u.y),Q=Math.abs(d.z-u.z),ne=Math.hypot(ee,Q),ue=we=>({zoom:0,x:0,y:0,wrap:we,fullyVisible:!1}),_e=[],he=[];if(h.renderWorldCopies&&g.allowWorldCopies())for(let we=1;we<=3;we++)_e.push(ue(-we)),_e.push(ue(we));for(_e.push(ue(0));_e.length>0;){const we=_e.pop(),Pe=we.x,pe=we.y;let Be=we.fullyVisible;const Qe={x:Pe,y:pe,z:we.zoom},Ue=g.getTileBoundingVolume(Qe,we.wrap,h.elevation,e);if(!Be){const Zt=be(i,Ue,l);if(Zt===0)continue;Be=Zt===2}const We=g.distanceToTile2d(u.x,u.y,Qe,Ue);let Je=C;w&&(Je=(e.calculateTileZoom||$e)(h.zoom+s.ak(h.tileSize/e.tileSize),We,Q,ne,h.fov)),Je=(e.roundZoom?Math.round:Math.floor)(Je),Je=Math.max(0,Je);const Nt=Math.min(Je,A);if(we.wrap=g.getWrap(d,Qe,we.wrap),we.zoom>=Nt){if(we.zoom<P)continue;const Zt=R-we.zoom,Tt=O[0]-.5-(Pe<<Zt),mr=O[1]-.5-(pe<<Zt),Jr=e.reparseOverscaled?Math.max(we.zoom,Je):we.zoom;he.push({tileID:new s.Z(we.zoom===A?Jr:we.zoom,we.wrap,we.zoom,Pe,pe),distanceSq:s.al([$[0]-.5-Pe,$[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(Tt*Tt+mr*mr)})}else for(let Zt=0;Zt<4;Zt++)_e.push({zoom:we.zoom+1,x:(Pe<<1)+Zt%2,y:(pe<<1)+(Zt>>1),wrap:we.wrap,fullyVisible:Be})}return he.sort(((we,Pe)=>we.distanceSq-Pe.distanceSq)).map((we=>we.tileID))}const Ft=s.a2.fromPoints([new s.P(0,0),new s.P(s.$,s.$)]);class cr extends s.E{constructor(e,i,l){super(),this.id=e,this.dispatcher=l,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,d,g,w)=>{const C=new(rr(d.type))(u,d,g,w);if(C.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${C.id}`);return C})(e,i,l,this),this._tiles={},this._cache=new se(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new j,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,l){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new s.k(u,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new s.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Jt).map((e=>e.key))}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&i.push(this._tiles[l]);return e?i.sort(((l,u)=>{const d=l.tileID,g=u.tileID,w=new s.P(d.canonical.x,d.canonical.y)._rotate(-this.transform.bearingInRadians),C=new s.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians);return d.overscaledZ-g.overscaledZ||C.y-w.y||C.x-w.x})).map((l=>l.tileID.key)):i.map((l=>l.tileID)).sort(Jt).map((l=>l.key))}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)e?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return s._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),yield this._loadTile(l,e,i))}))}_tileLoaded(e,i,l){e.timeAdded=ie.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const d=i[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const g=this.getTileByID(d);l(e,g),l(g,e)}}function l(u,d){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let g=d.tileID.canonical.x-u.tileID.canonical.x;const w=d.tileID.canonical.y-u.tileID.canonical.y,C=Math.pow(2,u.tileID.canonical.z),P=d.tileID.key;g===0&&w===0||Math.abs(w)>1||(Math.abs(g)>1&&(Math.abs(g+C)===1?g+=C:Math.abs(g-C)===1&&(g-=C)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,g,w),u.neighboringTiles&&u.neighboringTiles[P]&&(u.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,u){for(const d in this._tiles){let g=this._tiles[d];if(u[d]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>l)continue;let w=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const P=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[P.key],g&&g.hasData()&&(w=P)}let C=w;for(;C.overscaledZ>i;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]||e[C.canonical.key]){u[w.key]=w;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const u=e.scaledTo(l),d=this._getLoadedTile(u);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(i*l*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),l[d.tileID.key]=d}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,i,l,u,d,g){const w={},C={},P=Object.keys(e),A=ie.now();for(const R of P){const D=e[R],O=this._tiles[R];if(!O||O.fadeEndTime!==0&&O.fadeEndTime<=A)continue;const $=this.findLoadedParent(D,i),ee=this.findLoadedSibling(D),Q=$||ee||null;Q&&(this._addTile(Q.tileID),w[Q.tileID.key]=Q.tileID),C[R]=D}this._retainLoadedChildren(C,u,l,e);for(const R in w)e[R]||(this._coveredTiles[R]=!0,e[R]=w[R]);if(g){const R={},D={};for(const O of d)this._tiles[O.key].hasData()?R[O.key]=O:D[O.key]=O;for(const O in D){const $=D[O].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(R[$[0].key]=e[$[0].key]=$[0],R[$[1].key]=e[$[1].key]=$[1],R[$[2].key]=e[$[2].key]=$[2],R[$[3].key]=e[$[3].key]=$[3],delete D[O])}for(const O in D){const $=D[O],ee=this.findLoadedParent($,this._source.minzoom),Q=this.findLoadedSibling($),ne=ee||Q||null;if(ne){R[ne.tileID.key]=e[ne.tileID.key]=ne.tileID;for(const ue in R)R[ue].isChildOf(ne.tileID)&&delete R[ue]}}for(const O in this._tiles)R[O]||(this._coveredTiles[O]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new s.Z(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(l=xe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((A=>this._source.hasTile(A))))):l=[];const u=Mt(e,this._source),d=Math.max(u-cr.maxOverzooming,this._source.minzoom),g=Math.max(u+cr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const R of l)if(R.canonical.z>this._source.minzoom){const D=R.scaledTo(R.canonical.z-1);A[D.key]=D;const O=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));A[O.key]=O}l=l.concat(Object.values(A))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(l,u);Tr(this._source.type)&&this._updateCoveredAndRetainedTiles(C,d,g,u,l,i);for(const A in C)this._tiles[A].clearFadeHold();const P=s.am(this._tiles,C);for(const A of P){const R=this._tiles[A];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var l;const u={},d={},g=Math.max(i-cr.maxOverzooming,this._source.minzoom),w=Math.max(i+cr.maxUnderzooming,this._source.minzoom),C={};for(const P of e){const A=this._addTile(P);u[P.key]=P,A.hasData()||i<this._source.maxzoom&&(C[P.key]=P)}this._retainLoadedChildren(C,i,w,u);for(const P of e){let A=this._tiles[P.key];if(A.hasData())continue;if(i+1>this._source.maxzoom){const D=P.children(this._source.maxzoom)[0],O=this.getTile(D);if(O&&O.hasData()){u[D.key]=D;continue}}else{const D=P.children(this._source.maxzoom);if(u[D[0].key]&&u[D[1].key]&&u[D[2].key]&&u[D[3].key])continue}let R=A.wasRequested();for(let D=P.overscaledZ-1;D>=g;--D){const O=P.scaledTo(D);if(d[O.key])break;if(d[O.key]=!0,A=this.getTile(O),!A&&R&&(A=this._addTile(O)),A){const $=A.hasData();if(($||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(u[O.key]=O),R=A.wasRequested(),$)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}i.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(d),l)break;u=d}for(const d of i)this._loadedParentTiles[d]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,l=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=i;return i||(i=new Zr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,l||this._source.fire(new s.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}refreshTiles(e){for(const i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&e.some((l=>l.equals(this._tiles[i].tileID.canonical)))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,l){const u=[],d=this.transform;if(!d)return u;const g=d.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?d.getCameraQueryGeometry(e):e,C=O=>d.screenPointToMercatorCoordinate(O,this.terrain),P=this.transformBbox(e,C,!g),A=this.transformBbox(w,C,!g),R=this.getIds(),D=s.a2.fromPoints(A);for(let O=0;O<R.length;O++){const $=this._tiles[R[O]];if($.holdingForFade())continue;const ee=g?[$.tileID]:[$.tileID.unwrapTo(-1),$.tileID.unwrapTo(0)],Q=Math.pow(2,d.zoom-$.tileID.overscaledZ),ne=i*$.queryPadding*s.$/$.tileSize/Q;for(const ue of ee){const _e=D.map((he=>ue.getTilePoint(new s.a1(he.x,he.y))));if(_e.expandBy(ne),_e.intersects(Ft)){const he=P.map((Pe=>ue.getTilePoint(Pe))),we=A.map((Pe=>ue.getTilePoint(Pe)));u.push({tile:$,tileID:g?ue:ue.unwrapTo(0),queryGeometry:he,cameraQueryGeometry:we,scale:Q})}}}return u}transformBbox(e,i,l){let u=e.map(i);if(l){const d=s.a2.fromPoints(e);d.shrinkBy(.001*Math.min(d.width(),d.height()));const g=d.map(i);s.a2.fromPoints(u).covers(g)||(u=u.map((w=>w.x>.5?new s.a1(w.x-1,w.y,w.z):w)))}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(Tr(this._source.type)){const e=ie.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const u=this._tiles[e];u&&u.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,i)))}}function Jt(h,e){const i=Math.abs(2*h.wrap)-+(h.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||l-i||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function Tr(h){return h==="raster"||h==="image"||h==="video"}cr.maxOverzooming=10,cr.maxUnderzooming=3;class Xr{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=s.ah(e,0,1);let i=1,l=this._distances[i];const u=e*this.paddedLength+this.padding;for(;l<u&&i<this._distances.length;)l=this._distances[++i];const d=i-1,g=this._distances[d],w=l-g,C=w>0?(u-g)/w:0;return this.points[d].mult(1-C).add(this.points[i].mult(C))}}function dn(h,e){let i=!0;return h==="always"||h!=="never"&&e!=="never"||(i=!1),i}class xn{constructor(e,i,l){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(i/l);for(let g=0;g<this.xCellCount*this.yCellCount;g++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,l,u,d){this._forEachCell(i,l,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(e,i,l,u){this._forEachCell(i-u,l-u,i+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,i,l,u,d,g){this.boxCells[d].push(g)}_insertCircleCell(e,i,l,u,d,g){this.circleCells[d].push(g)}_query(e,i,l,u,d,g,w){if(l<0||e>this.width||u<0||i>this.height)return[];const C=[];if(e<=0&&i<=0&&this.width<=l&&this.height<=u){if(d)return[{key:null,x1:e,y1:i,x2:l,y2:u}];for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const A=this.circles[3*P],R=this.circles[3*P+1],D=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:A-D,y1:R-D,x2:A+D,y2:R+D})}}else this._forEachCell(e,i,l,u,this._queryCell,C,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},w);return C}query(e,i,l,u){return this._query(e,i,l,u,!1,null)}hitTest(e,i,l,u,d,g){return this._query(e,i,l,u,!0,d,g).length>0}hitTestCircle(e,i,l,u,d){const g=e-l,w=e+l,C=i-l,P=i+l;if(w<0||g>this.width||P<0||C>this.height)return!1;const A=[];return this._forEachCell(g,C,w,P,this._queryCellCircle,A,{hitTest:!0,overlapMode:u,circle:{x:e,y:i,radius:l},seenUids:{box:{},circle:{}}},d),A.length>0}_queryCell(e,i,l,u,d,g,w,C){const{seenUids:P,hitTest:A,overlapMode:R}=w,D=this.boxCells[d];if(D!==null){const $=this.bboxes;for(const ee of D)if(!P.box[ee]){P.box[ee]=!0;const Q=4*ee,ne=this.boxKeys[ee];if(e<=$[Q+2]&&i<=$[Q+3]&&l>=$[Q+0]&&u>=$[Q+1]&&(!C||C(ne))&&(!A||!dn(R,ne.overlapMode))&&(g.push({key:ne,x1:$[Q],y1:$[Q+1],x2:$[Q+2],y2:$[Q+3]}),A))return!0}}const O=this.circleCells[d];if(O!==null){const $=this.circles;for(const ee of O)if(!P.circle[ee]){P.circle[ee]=!0;const Q=3*ee,ne=this.circleKeys[ee];if(this._circleAndRectCollide($[Q],$[Q+1],$[Q+2],e,i,l,u)&&(!C||C(ne))&&(!A||!dn(R,ne.overlapMode))){const ue=$[Q],_e=$[Q+1],he=$[Q+2];if(g.push({key:ne,x1:ue-he,y1:_e-he,x2:ue+he,y2:_e+he}),A)return!0}}}return!1}_queryCellCircle(e,i,l,u,d,g,w,C){const{circle:P,seenUids:A,overlapMode:R}=w,D=this.boxCells[d];if(D!==null){const $=this.bboxes;for(const ee of D)if(!A.box[ee]){A.box[ee]=!0;const Q=4*ee,ne=this.boxKeys[ee];if(this._circleAndRectCollide(P.x,P.y,P.radius,$[Q+0],$[Q+1],$[Q+2],$[Q+3])&&(!C||C(ne))&&!dn(R,ne.overlapMode))return g.push(!0),!0}}const O=this.circleCells[d];if(O!==null){const $=this.circles;for(const ee of O)if(!A.circle[ee]){A.circle[ee]=!0;const Q=3*ee,ne=this.circleKeys[ee];if(this._circlesCollide($[Q],$[Q+1],$[Q+2],P.x,P.y,P.radius)&&(!C||C(ne))&&!dn(R,ne.overlapMode))return g.push(!0),!0}}}_forEachCell(e,i,l,u,d,g,w,C){const P=this._convertToXCellCoord(e),A=this._convertToYCellCoord(i),R=this._convertToXCellCoord(l),D=this._convertToYCellCoord(u);for(let O=P;O<=R;O++)for(let $=A;$<=D;$++)if(d.call(this,e,i,l,u,this.xCellCount*$+O,g,w,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,l,u,d,g){const w=u-e,C=d-i,P=l+g;return P*P>w*w+C*C}_circleAndRectCollide(e,i,l,u,d,g,w){const C=(g-u)/2,P=Math.abs(e-(u+C));if(P>C+l)return!1;const A=(w-d)/2,R=Math.abs(i-(d+A));if(R>A+l)return!1;if(P<=C||R<=A)return!0;const D=P-C,O=R-A;return D*D+O*O<=l*l}}function mn(h,e,i){const l=s.L();if(!h){const{vecSouth:R,vecEast:D}=Et(e),O=N();O[0]=D[0],O[1]=D[1],O[2]=R[0],O[3]=R[1],u=O,(A=(g=(d=O)[0])*(P=d[3])-(C=d[2])*(w=d[1]))&&(u[0]=P*(A=1/A),u[1]=-w*A,u[2]=-C*A,u[3]=g*A),l[0]=O[0],l[1]=O[1],l[4]=O[2],l[5]=O[3]}var u,d,g,w,C,P,A;return s.N(l,l,[1/i,1/i,1]),l}function jt(h,e,i,l){if(h){const u=s.L();if(!e){const{vecSouth:d,vecEast:g}=Et(i);u[0]=g[0],u[1]=g[1],u[4]=d[0],u[5]=d[1]}return s.N(u,u,[l,l,1]),u}return i.pixelsToClipSpaceMatrix}function Et(h){const e=Math.cos(h.rollInRadians),i=Math.sin(h.rollInRadians),l=Math.cos(h.pitchInRadians),u=Math.cos(h.bearingInRadians),d=Math.sin(h.bearingInRadians),g=s.ar();g[0]=-u*l*i-d*e,g[1]=-d*l*i+u*e;const w=s.as(g);w<1e-9?s.at(g):s.au(g,g,1/w);const C=s.ar();C[0]=u*l*e-d*i,C[1]=d*l*e+u*i;const P=s.as(C);return P<1e-9?s.at(C):s.au(C,C,1/P),{vecEast:C,vecSouth:g}}function hr(h,e,i,l){let u;l?(u=[h,e,l(h,e),1],s.aw(u,u,i)):(u=[h,e,0,1],En(u,u,i));const d=u[3];return{point:new s.P(u[0]/d,u[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function ht(h,e){return .5+h/e*.5}function Hr(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function Yr(h,e,i,l,u,d,g,w,C,P,A,R,D){const O=i?h.textSizeData:h.iconSizeData,$=s.an(O,e.transform.zoom),ee=[256/e.width*2+1,256/e.height*2+1],Q=i?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Q.clear();const ne=h.lineVertexArray,ue=i?h.text.placedSymbolArray:h.icon.placedSymbolArray,_e=e.transform.width/e.transform.height;let he=!1;for(let we=0;we<ue.length;we++){const Pe=ue.get(we);if(Pe.hidden||Pe.writingMode===s.ao.vertical&&!he){sn(Pe.numGlyphs,Q);continue}he=!1;const pe=new s.P(Pe.anchorX,Pe.anchorY),Be={getElevation:D,pitchedLabelPlaneMatrix:l,lineVertexArray:ne,pitchWithMap:d,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:pe,unwrappedTileID:C,width:P,height:A,translation:R},Qe=Er(Pe.anchorX,Pe.anchorY,Be);if(!Hr(Qe.point,ee)){sn(Pe.numGlyphs,Q);continue}const Ue=ht(e.transform.cameraToCenterDistance,Qe.signedDistanceFromCamera),We=s.ap(O,$,Pe),Je=d?We*e.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,C)/Ue:We*Ue,Nt=Ge({projectionContext:Be,pitchedLabelPlaneMatrixInverse:u,symbol:Pe,fontSize:Je,flip:!1,keepUpright:g,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:_e,rotateToLine:w});he=Nt.useVertical,(Nt.notEnoughRoom||he||Nt.needsFlipping&&Ge({projectionContext:Be,pitchedLabelPlaneMatrixInverse:u,symbol:Pe,fontSize:Je,flip:!0,keepUpright:g,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:_e,rotateToLine:w}).notEnoughRoom)&&sn(Pe.numGlyphs,Q)}i?h.text.dynamicLayoutVertexBuffer.updateData(Q):h.icon.dynamicLayoutVertexBuffer.updateData(Q)}function qr(h,e,i,l,u,d,g,w){const C=d.glyphStartIndex+d.numGlyphs,P=d.lineStartIndex,A=d.lineStartIndex+d.lineLength,R=e.getoffsetX(d.glyphStartIndex),D=e.getoffsetX(C-1),O=pn(h*R,i,l,u,d.segment,P,A,w,g);if(!O)return null;const $=pn(h*D,i,l,u,d.segment,P,A,w,g);return $?w.projectionCache.anyProjectionOccluded?null:{first:O,last:$}:null}function _t(h,e,i,l){return h===s.ao.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*l?{useVertical:!0}:(h===s.ao.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function Ge(h){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:l,fontSize:u,flip:d,keepUpright:g,glyphOffsetArray:w,dynamicLayoutVertexArray:C,aspectRatio:P,rotateToLine:A}=h,R=u/24,D=l.lineOffsetX*R,O=l.lineOffsetY*R;let $;if(l.numGlyphs>1){const ee=l.glyphStartIndex+l.numGlyphs,Q=l.lineStartIndex,ne=l.lineStartIndex+l.lineLength,ue=qr(R,w,D,O,d,l,A,e);if(!ue)return{notEnoughRoom:!0};const _e=br(ue.first.point.x,ue.first.point.y,e,i),he=br(ue.last.point.x,ue.last.point.y,e,i);if(g&&!d){const we=_t(l.writingMode,_e,he,P);if(we)return we}$=[ue.first];for(let we=l.glyphStartIndex+1;we<ee-1;we++){const Pe=pn(R*w.getoffsetX(we),D,O,d,l.segment,Q,ne,e,A);if(!Pe)return{notEnoughRoom:!0};$.push(Pe)}$.push(ue.last)}else{if(g&&!d){const Q=Yt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ne=l.lineStartIndex+l.segment+1,ue=new s.P(e.lineVertexArray.getx(ne),e.lineVertexArray.gety(ne)),_e=Yt(ue.x,ue.y,e),he=_e.signedDistanceFromCamera>0?_e.point:At(e.tileAnchorPoint,ue,Q,1,e),we=br(Q.x,Q.y,e,i),Pe=br(he.x,he.y,e,i),pe=_t(l.writingMode,we,Pe,P);if(pe)return pe}const ee=pn(R*w.getoffsetX(l.glyphStartIndex),D,O,d,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,A);if(!ee||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};$=[ee]}for(const ee of $)s.av(C,ee.point,ee.angle);return{}}function At(h,e,i,l,u){const d=h.add(h.sub(e)._unit()),g=Yt(d.x,d.y,u).point,w=i.sub(g);return i.add(w._mult(l/w.mag()))}function Rt(h,e,i){const l=e.projectionCache;if(l.projections[h])return l.projections[h];const u=new s.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),d=Yt(u.x,u.y,e);if(d.signedDistanceFromCamera>0)return l.projections[h]=d.point,l.anyProjectionOccluded=l.anyProjectionOccluded||d.isOccluded,d.point;const g=h-i.direction;return At(i.distanceFromAnchor===0?e.tileAnchorPoint:new s.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),u,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function Yt(h,e,i){const l=h+i.translation[0],u=e+i.translation[1];let d;return i.pitchWithMap?(d=hr(l,u,i.pitchedLabelPlaneMatrix,i.getElevation),d.isOccluded=!1):(d=i.transform.projectTileCoordinates(l,u,i.unwrappedTileID,i.getElevation),d.point.x=(.5*d.point.x+.5)*i.width,d.point.y=(.5*-d.point.y+.5)*i.height),d}function br(h,e,i,l){if(i.pitchWithMap){const u=[h,e,0,1];return s.aw(u,u,l),i.transform.projectTileCoordinates(u[0]/u[3],u[1]/u[3],i.unwrappedTileID,i.getElevation).point}return{x:h/i.width*2-1,y:1-e/i.height*2}}function Er(h,e,i){return i.transform.projectTileCoordinates(h,e,i.unwrappedTileID,i.getElevation)}function ur(h,e,i){return h._unit()._perp()._mult(e*i)}function rn(h,e,i,l,u,d,g,w,C){if(w.projectionCache.offsets[h])return w.projectionCache.offsets[h];const P=i.add(e);if(h+C.direction<l||h+C.direction>=u)return w.projectionCache.offsets[h]=P,P;const A=Rt(h+C.direction,w,C),R=ur(A.sub(i),g,C.direction),D=i.add(R),O=A.add(R);return w.projectionCache.offsets[h]=s.ax(d,P,D,O)||P,w.projectionCache.offsets[h]}function pn(h,e,i,l,u,d,g,w,C){const P=l?h-e:h+e;let A=P>0?1:-1,R=0;l&&(A*=-1,R=Math.PI),A<0&&(R+=Math.PI);let D,O=A>0?d+u:d+u+1;w.projectionCache.cachedAnchorPoint?D=w.projectionCache.cachedAnchorPoint:(D=Yt(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=D);let $,ee,Q=D,ne=D,ue=0,_e=0;const he=Math.abs(P),we=[];let Pe;for(;ue+_e<=he;){if(O+=A,O<d||O>=g)return null;ue+=_e,ne=Q,ee=$;const Qe={absOffsetX:he,direction:A,distanceFromAnchor:ue,previousVertex:ne};if(Q=Rt(O,w,Qe),i===0)we.push(ne),Pe=Q.sub(ne);else{let Ue;const We=Q.sub(ne);Ue=We.mag()===0?ur(Rt(O+A,w,Qe).sub(Q),i,A):ur(We,i,A),ee||(ee=ne.add(Ue)),$=rn(O,Ue,Q,d,g,ee,i,w,Qe),we.push(ee),Pe=$.sub(ee)}_e=Pe.mag()}const pe=Pe._mult((he-ue)/_e)._add(ee||ne),Be=R+Math.atan2(Q.y-ne.y,Q.x-ne.x);return we.push(pe),{point:pe,angle:C?Be:0,path:we}}const _n=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function sn(h,e){for(let i=0;i<h;i++){const l=e.length;e.resize(l+4),e.float32.set(_n,3*l)}}function En(h,e,i){const l=e[0],u=e[1];return h[0]=i[0]*l+i[4]*u+i[12],h[1]=i[1]*l+i[5]*u+i[13],h[3]=i[3]*l+i[7]*u+i[15],h}const dr=100;class In{constructor(e,i=new xn(e.width+200,e.height+200,25),l=new xn(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+dr,this.screenBottomBoundary=e.height+dr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,l,u,d,g,w,C,P,A,R,D){const O=this.projectAndGetPerspectiveRatio(e.anchorPointX+C[0],e.anchorPointY+C[1],d,A,D),$=l*O.perspectiveRatio;let ee;if(g||w)ee=this._projectCollisionBox(e,$,u,d,g,w,C,O,A,R,D);else{const Pe=O.x+(R?R.x*$:0),pe=O.y+(R?R.y*$:0);ee={allPointsOccluded:!1,box:[Pe+e.x1*$,pe+e.y1*$,Pe+e.x2*$,pe+e.y2*$]}}const[Q,ne,ue,_e]=ee.box,he=g?ee.allPointsOccluded:O.isOccluded;let we=he;return we||(we=O.perspectiveRatio<this.perspectiveRatioCutoff),we||(we=!this.isInsideGrid(Q,ne,ue,_e)),we||i!=="always"&&this.grid.hitTest(Q,ne,ue,_e,i,P)?{box:[Q,ne,ue,_e],placeable:!1,offscreen:!1,occluded:he}:{box:[Q,ne,ue,_e],placeable:!0,offscreen:this.isOffscreen(Q,ne,ue,_e),occluded:he}}placeCollisionCircles(e,i,l,u,d,g,w,C,P,A,R,D,O,$){const ee=[],Q=new s.P(i.anchorX,i.anchorY),ne=this.getPerspectiveRatio(Q.x,Q.y,g,$),ue=(P?d*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,g)/ne:d*ne)/s.aB,_e={getElevation:$,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:g,width:this.transform.width,height:this.transform.height,translation:O},he=qr(ue,u,i.lineOffsetX*ue,i.lineOffsetY*ue,!1,i,!1,_e);let we=!1,Pe=!1,pe=!0;if(he){const Be=.5*R*ne+D,Qe=new s.P(-100,-100),Ue=new s.P(this.screenRightBoundary,this.screenBottomBoundary),We=new Xr,Je=he.first,Nt=he.last;let Zt=[];for(let Jr=Je.path.length-1;Jr>=1;Jr--)Zt.push(Je.path[Jr]);for(let Jr=1;Jr<Nt.path.length;Jr++)Zt.push(Nt.path[Jr]);const Tt=2.5*Be;if(P){const Jr=this.projectPathToScreenSpace(Zt,_e);Zt=Jr.some((An=>An.signedDistanceFromCamera<=0))?[]:Jr.map((An=>An.point))}let mr=[];if(Zt.length>0){const Jr=Zt[0].clone(),An=Zt[0].clone();for(let Bn=1;Bn<Zt.length;Bn++)Jr.x=Math.min(Jr.x,Zt[Bn].x),Jr.y=Math.min(Jr.y,Zt[Bn].y),An.x=Math.max(An.x,Zt[Bn].x),An.y=Math.max(An.y,Zt[Bn].y);mr=Jr.x>=Qe.x&&An.x<=Ue.x&&Jr.y>=Qe.y&&An.y<=Ue.y?[Zt]:An.x<Qe.x||Jr.x>Ue.x||An.y<Qe.y||Jr.y>Ue.y?[]:s.ay([Zt],Qe.x,Qe.y,Ue.x,Ue.y)}for(const Jr of mr){We.reset(Jr,.25*Be);let An=0;An=We.length<=.5*Be?1:Math.ceil(We.paddedLength/Tt)+1;for(let Bn=0;Bn<An;Bn++){const Ln=Bn/Math.max(An-1,1),Hn=We.lerp(Ln),Kn=Hn.x+dr,Kr=Hn.y+dr;ee.push(Kn,Kr,Be,0);const Fn=Kn-Be,si=Kr-Be,fi=Kn+Be,Ti=Kr+Be;if(pe=pe&&this.isOffscreen(Fn,si,fi,Ti),Pe=Pe||this.isInsideGrid(Fn,si,fi,Ti),e!=="always"&&this.grid.hitTestCircle(Kn,Kr,Be,e,A)&&(we=!0,!C))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!C&&we||!Pe||ne<this.perspectiveRatioCutoff?[]:ee,offscreen:pe,collisionDetected:we}}projectPathToScreenSpace(e,i){const l=(function(u,d){const g=s.L();return s.aq(g,d.pitchedLabelPlaneMatrix),u.map((w=>{const C=hr(w.x,w.y,g,d.getElevation),P=d.transform.projectTileCoordinates(C.point.x,C.point.y,d.unwrappedTileID,d.getElevation);return P.point.x=(.5*P.point.x+.5)*d.width,P.point.y=(.5*-P.point.y+.5)*d.height,P}))})(e,i);return(function(u){let d=0,g=0,w=0,C=0;for(let P=0;P<u.length;P++)u[P].isOccluded?(w=P+1,C=0):(C++,C>g&&(g=C,d=w));return u.slice(d,d+g)})(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[],l=new s.a2;for(const R of e){const D=new s.P(R.x+dr,R.y+dr);l.extend(D),i.push(D)}const{minX:u,minY:d,maxX:g,maxY:w}=l,C=this.grid.query(u,d,g,w).concat(this.ignoredGrid.query(u,d,g,w)),P={},A={};for(const R of C){const D=R.key;if(P[D.bucketInstanceId]===void 0&&(P[D.bucketInstanceId]={}),P[D.bucketInstanceId][D.featureIndex])continue;const O=[new s.P(R.x1,R.y1),new s.P(R.x2,R.y1),new s.P(R.x2,R.y2),new s.P(R.x1,R.y2)];s.az(i,O)&&(P[D.bucketInstanceId][D.featureIndex]=!0,A[D.bucketInstanceId]===void 0&&(A[D.bucketInstanceId]=[]),A[D.bucketInstanceId].push(D.featureIndex))}return A}insertCollisionBox(e,i,l,u,d,g){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,l,u,d,g){const w=l?this.ignoredGrid:this.grid,C={bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:i};for(let P=0;P<e.length;P+=4)w.insertCircle(C,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,i,l,u,d){if(d){let g;u?(g=[e,i,u(e,i),1],s.aw(g,g,d)):(g=[e,i,0,1],En(g,g,d));const w=g[3];return{x:(g[0]/w+1)/2*this.transform.width+dr,y:(-g[1]/w+1)/2*this.transform.height+dr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const g=this.transform.projectTileCoordinates(e,i,l,u);return{x:(g.point.x+1)/2*this.transform.width+dr,y:(1-g.point.y)/2*this.transform.height+dr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5,isOccluded:g.isOccluded,signedDistanceFromCamera:g.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,l,u){const d=this.transform.projectTileCoordinates(e,i,l,u);return .5+this.transform.cameraToCenterDistance/d.signedDistanceFromCamera*.5}isOffscreen(e,i,l,u){return l<dr||e>=this.screenRightBoundary||u<dr||i>this.screenBottomBoundary}isInsideGrid(e,i,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=s.ag([]);return s.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,l,u,d,g,w,C,P,A,R){let D=1,O=0,$=0,ee=1;const Q=e.anchorPointX+w[0],ne=e.anchorPointY+w[1];if(g&&!d){const Zt=this.projectAndGetPerspectiveRatio(Q+1,ne,u,P,R),Tt=Zt.x-C.x,mr=Math.atan((Zt.y-C.y)/Tt)+(Tt<0?Math.PI:0),Jr=Math.sin(mr),An=Math.cos(mr);D=An,O=Jr,$=-Jr,ee=An}else if(!g&&d){const Zt=Et(this.transform);D=Zt.vecEast[0],O=Zt.vecEast[1],$=Zt.vecSouth[0],ee=Zt.vecSouth[1]}let ue=C.x,_e=C.y,he=i;d&&(ue=Q,_e=ne,he=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),he*=this.transform.getPitchedTextCorrection(Q,ne,u),A||(he*=s.ah(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),A&&(ue+=D*A.x*he+$*A.y*he,_e+=O*A.x*he+ee*A.y*he);const we=e.x1*he,Pe=e.x2*he,pe=(we+Pe)/2,Be=e.y1*he,Qe=e.y2*he,Ue=(Be+Qe)/2,We=[{offsetX:we,offsetY:Be},{offsetX:pe,offsetY:Be},{offsetX:Pe,offsetY:Be},{offsetX:Pe,offsetY:Ue},{offsetX:Pe,offsetY:Qe},{offsetX:pe,offsetY:Qe},{offsetX:we,offsetY:Qe},{offsetX:we,offsetY:Ue}];let Je=[];for(const{offsetX:Zt,offsetY:Tt}of We)Je.push(new s.P(ue+D*Zt+$*Tt,_e+O*Zt+ee*Tt));let Nt=!1;if(d){const Zt=Je.map((Tt=>this.projectAndGetPerspectiveRatio(Tt.x,Tt.y,u,P,R)));Nt=Zt.some((Tt=>!Tt.isOccluded)),Je=Zt.map((Tt=>new s.P(Tt.x,Tt.y)))}else Nt=!0;return{box:s.aA(Je),allPointsOccluded:!Nt}}}class tn{constructor(e,i,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Qr{constructor(e,i,l,u,d){this.text=new tn(e?e.text:null,i,l,d),this.icon=new tn(e?e.icon:null,i,u,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ma{constructor(e,i,l){this.text=e,this.icon=i,this.skipFade=l}}class di{constructor(e,i,l,u,d){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=d}}class Xi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:l=>l.collisionGroupID===i}}return this.collisionGroups[e]}}function Zn(h,e,i,l,u){const{horizontalAlign:d,verticalAlign:g}=s.aH(h);return new s.P(-(d-.5)*e+l[0]*u,-(g-.5)*i+l[1]*u)}class ni{constructor(e,i,l,u,d){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new In(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Xi(u),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(l,u)=>i.getElevation(e,l,u):null}getBucketParts(e,i,l,u){const d=l.getBucket(i),g=l.latestFeatureIndex;if(!d||!g||i.id!==d.layerIds[0])return;const w=l.collisionBoxArray,C=d.layers[0].layout,P=d.layers[0].paint,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/s.$,D=l.tileID.toUnwrapped(),O=C.get("text-rotation-alignment")==="map",$=s.aC(l,1,this.transform.zoom),ee=s.aD(this.collisionIndex.transform,l,P.get("text-translate"),P.get("text-translate-anchor")),Q=s.aD(this.collisionIndex.transform,l,P.get("icon-translate"),P.get("icon-translate-anchor")),ne=mn(O,this.transform,$);this.retainedQueryData[d.bucketInstanceId]=new di(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,l.tileID);const ue={bucket:d,layout:C,translationText:ee,translationIcon:Q,unwrappedTileID:D,pitchedLabelPlaneMatrix:ne,scale:A,textPixelRatio:R,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.an(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const _e of d.sortKeyRanges){const{sortKey:he,symbolInstanceStart:we,symbolInstanceEnd:Pe}=_e;e.push({sortKey:he,symbolInstanceStart:we,symbolInstanceEnd:Pe,parameters:ue})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(e,i,l,u,d,g,w,C,P,A,R,D,O,$,ee,Q,ne,ue,_e,he){const we=s.aE[e.textAnchor],Pe=[e.textOffset0,e.textOffset1],pe=Zn(we,l,u,Pe,d),Be=this.collisionIndex.placeCollisionBox(i,D,C,P,A,w,g,Q,R.predicate,_e,pe,he);if((!ue||this.collisionIndex.placeCollisionBox(ue,D,C,P,A,w,g,ne,R.predicate,_e,pe,he).placeable)&&Be.placeable){let Qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Qe=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:Pe,width:l,height:u,anchor:we,textBoxScale:d,prevAnchor:Qe},this.markUsedJustification($,we,O,ee),$.allowVerticalPlacement&&(this.markUsedOrientation($,ee,O),this.placedOrientations[O.crossTileID]=ee),{shift:pe,placedGlyphBoxes:Be}}}placeLayerBucketPart(e,i,l){const{bucket:u,layout:d,translationText:g,translationIcon:w,unwrappedTileID:C,pitchedLabelPlaneMatrix:P,textPixelRatio:A,holdingForFade:R,collisionBoxArray:D,partiallyEvaluatedTextSize:O,collisionGroup:$}=e.parameters,ee=d.get("text-optional"),Q=d.get("icon-optional"),ne=s.aF(d,"text-overlap","text-allow-overlap"),ue=ne==="always",_e=s.aF(d,"icon-overlap","icon-allow-overlap"),he=_e==="always",we=d.get("text-rotation-alignment")==="map",Pe=d.get("text-pitch-alignment")==="map",pe=d.get("icon-text-fit")!=="none",Be=d.get("symbol-z-order")==="viewport-y",Qe=ue&&(he||!u.hasIconData()||Q),Ue=he&&(ue||!u.hasTextData()||ee);!u.collisionArrays&&D&&u.deserializeCollisionBoxes(D);const We=this.retainedQueryData[u.bucketInstanceId].tileID,Je=this._getTerrainElevationFunc(We),Nt=this.transform.getFastPathSimpleProjectionMatrix(We),Zt=(Tt,mr,Jr)=>{var An,Bn;if(i[Tt.crossTileID])return;if(R)return void(this.placements[Tt.crossTileID]=new ma(!1,!1,!1));let Ln=!1,Hn=!1,Kn=!0,Kr=null,Fn={box:null,placeable:!1,offscreen:null,occluded:!1},si={placeable:!1},fi=null,Ti=null,Ui=null,za=0,go=0,vo=0;mr.textFeatureIndex?za=mr.textFeatureIndex:Tt.useRuntimeCollisionCircles&&(za=Tt.featureIndex),mr.verticalTextFeatureIndex&&(go=mr.verticalTextFeatureIndex);const fs=mr.textBox;if(fs){const ta=li=>{let mi=s.ao.horizontal;if(u.allowVerticalPlacement&&!li&&this.prevPlacement){const ba=this.prevPlacement.placedOrientations[Tt.crossTileID];ba&&(this.placedOrientations[Tt.crossTileID]=ba,mi=ba,this.markUsedOrientation(u,mi,Tt))}return mi},La=(li,mi)=>{if(u.allowVerticalPlacement&&Tt.numVerticalGlyphVertices>0&&mr.verticalTextBox){for(const ba of u.writingModes)if(ba===s.ao.vertical?(Fn=mi(),si=Fn):Fn=li(),Fn&&Fn.placeable)break}else Fn=li()},$i=Tt.textAnchorOffsetStartIndex,yo=Tt.textAnchorOffsetEndIndex;if(yo===$i){const li=(mi,ba)=>{const ci=this.collisionIndex.placeCollisionBox(mi,ne,A,We,C,Pe,we,g,$.predicate,Je,void 0,Nt);return ci&&ci.placeable&&(this.markUsedOrientation(u,ba,Tt),this.placedOrientations[Tt.crossTileID]=ba),ci};La((()=>li(fs,s.ao.horizontal)),(()=>{const mi=mr.verticalTextBox;return u.allowVerticalPlacement&&Tt.numVerticalGlyphVertices>0&&mi?li(mi,s.ao.vertical):{box:null,offscreen:null}})),ta(Fn&&Fn.placeable)}else{let li=s.aE[(Bn=(An=this.prevPlacement)===null||An===void 0?void 0:An.variableOffsets[Tt.crossTileID])===null||Bn===void 0?void 0:Bn.anchor];const mi=(ci,Js,_s)=>{const to=ci.x2-ci.x1,Da=ci.y2-ci.y1,xo=Tt.textBoxScale,Td=pe&&_e==="never"?Js:null;let la=null,Cd=ne==="never"?1:2,_u="never";li&&Cd++;for(let Wl=0;Wl<Cd;Wl++){for(let Xl=$i;Xl<yo;Xl++){const bo=u.textAnchorOffsets.get(Xl);if(li&&bo.textAnchor!==li)continue;const ro=this.attemptAnchorPlacement(bo,ci,to,Da,xo,we,Pe,A,We,C,$,_u,Tt,u,_s,g,w,Td,Je);if(ro&&(la=ro.placedGlyphBoxes,la&&la.placeable))return Ln=!0,Kr=ro.shift,la}li?li=null:_u=ne}return l&&!la&&(la={box:this.collisionIndex.placeCollisionBox(fs,"always",A,We,C,Pe,we,g,$.predicate,Je,void 0,Nt).box,offscreen:!1,placeable:!1,occluded:!1}),la};La((()=>mi(fs,mr.iconBox,s.ao.horizontal)),(()=>{const ci=mr.verticalTextBox;return u.allowVerticalPlacement&&(!Fn||!Fn.placeable)&&Tt.numVerticalGlyphVertices>0&&ci?mi(ci,mr.verticalIconBox,s.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Fn&&(Ln=Fn.placeable,Kn=Fn.offscreen);const ba=ta(Fn&&Fn.placeable);if(!Ln&&this.prevPlacement){const ci=this.prevPlacement.variableOffsets[Tt.crossTileID];ci&&(this.variableOffsets[Tt.crossTileID]=ci,this.markUsedJustification(u,ci.anchor,Tt,ba))}}}if(fi=Fn,Ln=fi&&fi.placeable,Kn=fi&&fi.offscreen,Tt.useRuntimeCollisionCircles){const ta=u.text.placedSymbolArray.get(Tt.centerJustifiedTextSymbolIndex),La=s.ap(u.textSizeData,O,ta),$i=d.get("text-padding");Ti=this.collisionIndex.placeCollisionCircles(ne,ta,u.lineVertexArray,u.glyphOffsetArray,La,C,P,l,Pe,$.predicate,Tt.collisionCircleDiameter,$i,g,Je),Ti.circles.length&&Ti.collisionDetected&&!l&&s.w("Collisions detected, but collision boxes are not shown"),Ln=ue||Ti.circles.length>0&&!Ti.collisionDetected,Kn=Kn&&Ti.offscreen}if(mr.iconFeatureIndex&&(vo=mr.iconFeatureIndex),mr.iconBox){const ta=La=>this.collisionIndex.placeCollisionBox(La,_e,A,We,C,Pe,we,w,$.predicate,Je,pe&&Kr?Kr:void 0,Nt);si&&si.placeable&&mr.verticalIconBox?(Ui=ta(mr.verticalIconBox),Hn=Ui.placeable):(Ui=ta(mr.iconBox),Hn=Ui.placeable),Kn=Kn&&Ui.offscreen}const ms=ee||Tt.numHorizontalGlyphVertices===0&&Tt.numVerticalGlyphVertices===0,qo=Q||Tt.numIconVertices===0;ms||qo?qo?ms||(Hn=Hn&&Ln):Ln=Hn&&Ln:Hn=Ln=Hn&&Ln;const Zo=Hn&&Ui.placeable;if(Ln&&fi.placeable&&this.collisionIndex.insertCollisionBox(fi.box,ne,d.get("text-ignore-placement"),u.bucketInstanceId,si&&si.placeable&&go?go:za,$.ID),Zo&&this.collisionIndex.insertCollisionBox(Ui.box,_e,d.get("icon-ignore-placement"),u.bucketInstanceId,vo,$.ID),Ti&&Ln&&this.collisionIndex.insertCollisionCircles(Ti.circles,ne,d.get("text-ignore-placement"),u.bucketInstanceId,za,$.ID),l&&this.storeCollisionData(u.bucketInstanceId,Jr,mr,fi,Ui,Ti),Tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Tt.crossTileID]=new ma((Ln||Qe)&&!(fi!=null&&fi.occluded),(Hn||Ue)&&!(Ui!=null&&Ui.occluded),Kn||u.justReloaded),i[Tt.crossTileID]=!0};if(Be){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Tt=u.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let mr=Tt.length-1;mr>=0;--mr){const Jr=Tt[mr];Zt(u.symbolInstances.get(Jr),u.collisionArrays[Jr],Jr)}}else for(let Tt=e.symbolInstanceStart;Tt<e.symbolInstanceEnd;Tt++)Zt(u.symbolInstances.get(Tt),u.collisionArrays[Tt],Tt);u.justReloaded=!1}storeCollisionData(e,i,l,u,d,g){if(l.textBox||l.iconBox){let w,C;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(i)?C=w.get(i):(C={text:null,icon:null},w.set(i,C)),l.textBox&&(C.text=u.box),l.iconBox&&(C.icon=d.box)}if(g){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let C=0;C<g.circles.length;C+=4)w.push(g.circles[C+0]-dr),w.push(g.circles[C+1]-dr),w.push(g.circles[C+2]),w.push(g.collisionDetected?1:0)}}markUsedJustification(e,i,l,u){let d;d=u===s.ao.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[s.aG(i)];const g=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of g)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=d>=0&&w!==d?0:l.crossTileID)}markUsedOrientation(e,i,l){const u=i===s.ao.horizontal||i===s.ao.horizontalOnly?i:0,d=i===s.ao.vertical?i:0,g=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of g)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let l=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const u=i?i.symbolFadeChange(e):1,d=i?i.opacities:{},g=i?i.variableOffsets:{},w=i?i.placedOrientations:{};for(const C in this.placements){const P=this.placements[C],A=d[C];A?(this.opacities[C]=new Qr(A,u,P.text,P.icon),l=l||P.text!==A.text.placed||P.icon!==A.icon.placed):(this.opacities[C]=new Qr(null,u,P.text,P.icon,P.skipFade),l=l||P.text||P.icon)}for(const C in d){const P=d[C];if(!this.opacities[C]){const A=new Qr(P,u,!1,!1);A.isHidden()||(this.opacities[C]=A,l=l||P.text.placed||P.icon.placed)}}for(const C in g)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=g[C]);for(const C in w)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=w[C]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const l={};for(const u of i){const d=u.getBucket(e);d&&u.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,i,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],g=d.layout,w=new Qr(null,0,!1,!1,!0),C=g.get("text-allow-overlap"),P=g.get("icon-allow-overlap"),A=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=g.get("text-rotation-alignment")==="map",D=g.get("text-pitch-alignment")==="map",O=g.get("icon-text-fit")!=="none",$=new Qr(null,0,C&&(P||!e.hasIconData()||g.get("icon-optional")),P&&(C||!e.hasTextData()||g.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const ee=(ne,ue,_e)=>{for(let he=0;he<ue/4;he++)ne.opacityVertexArray.emplaceBack(_e);ne.hasVisibleVertices=ne.hasVisibleVertices||_e!==Rr},Q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ne=0;ne<e.symbolInstances.length;ne++){const ue=e.symbolInstances.get(ne),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:he,crossTileID:we}=ue;let Pe=this.opacities[we];l[we]?Pe=w:Pe||(Pe=$,this.opacities[we]=Pe),l[we]=!0;const pe=ue.numIconVertices>0,Be=this.placedOrientations[ue.crossTileID],Qe=Be===s.ao.vertical,Ue=Be===s.ao.horizontal||Be===s.ao.horizontalOnly;if(_e>0||he>0){const Je=Wt(Pe.text);ee(e.text,_e,Qe?Rr:Je),ee(e.text,he,Ue?Rr:Je);const Nt=Pe.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach((mr=>{mr>=0&&(e.text.placedSymbolArray.get(mr).hidden=Nt||Qe?1:0)})),ue.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=Nt||Ue?1:0);const Zt=this.variableOffsets[ue.crossTileID];Zt&&this.markUsedJustification(e,Zt.anchor,ue,Be);const Tt=this.placedOrientations[ue.crossTileID];Tt&&(this.markUsedJustification(e,"left",ue,Tt),this.markUsedOrientation(e,Tt,ue))}if(pe){const Je=Wt(Pe.icon),Nt=!(O&&ue.verticalPlacedIconSymbolIndex&&Qe);ue.placedIconSymbolIndex>=0&&(ee(e.icon,ue.numIconVertices,Nt?Je:Rr),e.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(ee(e.icon,ue.numVerticalIconVertices,Nt?Rr:Je),e.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const We=Q&&Q.has(ne)?Q.get(ne):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Je=e.collisionArrays[ne];if(Je){let Nt=new s.P(0,0);if(Je.textBox||Je.verticalTextBox){let Zt=!0;if(A){const Tt=this.variableOffsets[we];Tt?(Nt=Zn(Tt.anchor,Tt.width,Tt.height,Tt.textOffset,Tt.textBoxScale),R&&Nt._rotate(D?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Zt=!1}if(Je.textBox||Je.verticalTextBox){let Tt;Je.textBox&&(Tt=Qe),Je.verticalTextBox&&(Tt=Ue),qi(e.textCollisionBox.collisionVertexArray,Pe.text.placed,!Zt||Tt,We.text,Nt.x,Nt.y)}}if(Je.iconBox||Je.verticalIconBox){const Zt=!!(!Ue&&Je.verticalIconBox);let Tt;Je.iconBox&&(Tt=Zt),Je.verticalIconBox&&(Tt=!Zt),qi(e.iconCollisionBox.collisionVertexArray,Pe.icon.placed,Tt,We.icon,O?Nt.x:0,O?Nt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const l=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function qi(h,e,i,l,u,d){l&&l.length!==0||(l=[0,0,0,0]);const g=l[0]-dr,w=l[1]-dr,C=l[2]-dr,P=l[3]-dr;h.emplaceBack(e?1:0,i?1:0,u||0,d||0,g,w),h.emplaceBack(e?1:0,i?1:0,u||0,d||0,C,w),h.emplaceBack(e?1:0,i?1:0,u||0,d||0,C,P),h.emplaceBack(e?1:0,i?1:0,u||0,d||0,g,P)}const Yi=Math.pow(2,25),Ei=Math.pow(2,24),zi=Math.pow(2,17),Ki=Math.pow(2,16),oa=Math.pow(2,9),Ta=Math.pow(2,8),xt=Math.pow(2,1);function Wt(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const e=h.placed?1:0,i=Math.floor(127*h.opacity);return i*Yi+e*Ei+i*zi+e*Ki+i*oa+e*Ta+i*xt+e}const Rr=0;class yn{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,l,u,d){const g=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(g,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort(((w,C)=>w.sortKey-C.sortKey)));this._currentPartIndex<g.length;)if(i.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,d())return!0;return!1}}class On{constructor(e,i,l,u,d,g,w,C){this.placement=new ni(e,i,g,w,C),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,i,l){const u=ie.now(),d=()=>!this._forceFullPlacement&&ie.now()-u>2;for(;this._currentPlacementIndex>=0;){const g=i[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=w)&&(!g.maxzoom||g.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new yn(g)),this._inProgressLayer.continuePlacement(l[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Xn=512/s.$/2;class Vn{constructor(e,i,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let d=0;d<i.length;d++){const g=i.get(d),w=g.key,C=u.get(w);C?C.push(g):u.set(w,[g])}for(const[d,g]of u){const w={positions:g.map((C=>({x:Math.floor(C.anchorX*Xn),y:Math.floor(C.anchorY*Xn)}))),crossTileIDs:g.map((C=>C.crossTileID))};if(w.positions.length>128){const C=new s.aI(w.positions.length,16,Uint16Array);for(const{x:P,y:A}of w.positions)C.add(P,A);C.finish(),delete w.positions,w.index=C}this._symbolsByKey[d]=w}}getScaledCoordinates(e,i){const{x:l,y:u,z:d}=this.tileID.canonical,{x:g,y:w,z:C}=i.canonical,P=Xn/Math.pow(2,C-d),A=(w*s.$+e.anchorY)*P,R=u*s.$*Xn;return{x:Math.floor((g*s.$+e.anchorX)*P-l*s.$*Xn),y:Math.floor(A-R)}}findMatches(e,i,l){const u=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let d=0;d<e.length;d++){const g=e.get(d);if(g.crossTileID)continue;const w=this._symbolsByKey[g.key];if(!w)continue;const C=this.getScaledCoordinates(g,i);if(w.index){const P=w.index.range(C.x-u,C.y-u,C.x+u,C.y+u).sort();for(const A of P){const R=w.crossTileIDs[A];if(!l[R]){l[R]=!0,g.crossTileID=R;break}}}else if(w.positions)for(let P=0;P<w.positions.length;P++){const A=w.positions[P],R=w.crossTileIDs[P];if(Math.abs(A.x-C.x)<=u&&Math.abs(A.y-C.y)<=u&&!l[R]){l[R]=!0,g.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class wn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ji{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const l in this.indexes){const u=this.indexes[l],d={};for(const g in u){const w=u[g];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+i),d[w.tileID.key]=w}this.indexes[l]=d}this.lng=e}addBucket(e,i,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<i.symbolInstances.length;d++)i.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>e.overscaledZ)for(const w in g){const C=g[w];C.tileID.isChildOf(e)&&C.findMatches(i.symbolInstances,e,u)}else{const w=g[e.scaledTo(Number(d)).key];w&&w.findMatches(i.symbolInstances,e,u)}}for(let d=0;d<i.symbolInstances.length;d++){const g=i.symbolInstances.get(d);g.crossTileID||(g.crossTileID=l.generate(),u[g.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Vn(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const l of i.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let i=!1;for(const l in this.indexes){const u=this.indexes[l];for(const d in u)e[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[d]),delete u[d],i=!0)}return i}}class sr{constructor(){this.layerIndexes={},this.crossTileIDs=new wn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Ji);let d=!1;const g={};u.handleWrapJump(l);for(const w of i){const C=w.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,C,this.crossTileIDs)&&(d=!0),g[C.bucketInstanceId]=!0)}return u.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(e){const i={};e.forEach((l=>{i[l]=!0}));for(const l in this.layerIndexes)i[l]||delete this.layerIndexes[l]}}var Ut="void main() {fragColor=vec4(1.0);}";const Ur={prelude:lr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:lr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:lr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:lr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:lr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:lr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:lr(Ut,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:lr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:lr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:lr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:lr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:lr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:lr(Ut,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:lr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:lr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:lr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:lr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:lr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:lr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:lr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:lr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:lr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:lr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:lr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:lr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:lr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:lr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:lr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:lr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:lr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function lr(h,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),u=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(u):u,w={};return{fragmentSource:h=h.replace(i,((C,P,A,R,D)=>(w[D]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${A} ${R} ${D};
#else
uniform ${A} ${R} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${A} ${R} ${D} = u_${D};
#endif
`))),vertexSource:e=e.replace(i,((C,P,A,R,D)=>{const O=R==="float"?"vec2":"vec4",$=D.match(/color/)?"color":O;return w[D]?P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${A} ${O} a_${D};
out ${A} ${R} ${D};
#else
uniform ${A} ${R} u_${D};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${A} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${$}(a_${D}, u_${D}_t);
#else
    ${A} ${R} ${D} = u_${D};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${A} ${O} a_${D};
#else
uniform ${A} ${R} u_${D};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${R} ${D} = a_${D};
#else
    ${A} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${R} ${D} = unpack_mix_${$}(a_${D}, u_${D}_t);
#else
    ${A} ${R} ${D} = u_${D};
#endif
`})),staticAttributes:l,staticUniforms:g}}class Tn{constructor(e,i,l){this.vertexBuffer=e,this.indexBuffer=i,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var nn=s.aJ([{name:"a_pos",type:"Int16",components:2}]);const Cn="#define PROJECTION_MERCATOR",$n="mercator";class Pr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return $n}get shaderDefine(){return Cn}get shaderPreludeCode(){return Ur.projectionMercator}get vertexShaderPreludeCode(){return Ur.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,l,u,d){if(this._cachedMesh)return this._cachedMesh;const g=new s.aL;g.emplaceBack(0,0),g.emplaceBack(s.$,0),g.emplaceBack(0,s.$),g.emplaceBack(s.$,s.$);const w=e.createVertexBuffer(g,nn.members),C=s.aM.simpleSegment(0,0,4,2),P=new s.aN;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);const A=e.createIndexBuffer(P);return this._cachedMesh=new Tn(w,A,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Mn{constructor(e=0,i=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=l,this.right=u}interpolate(e,i,l){return i.top!=null&&e.top!=null&&(this.top=s.C.number(e.top,i.top,l)),i.bottom!=null&&e.bottom!=null&&(this.bottom=s.C.number(e.bottom,i.bottom,l)),i.left!=null&&e.left!=null&&(this.left=s.C.number(e.left,i.left,l)),i.right!=null&&e.right!=null&&(this.right=s.C.number(e.right,i.right,l)),this}getCenter(e,i){const l=s.ah((this.left+e-this.right)/2,0,e),u=s.ah((this.top+i-this.bottom)/2,0,i);return new s.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Mn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function bn(h,e){if(!h.renderWorldCopies||h.lngRange)return;const i=e.lng-h.center.lng;e.lng+=i>180?-360:i<-180?360:0}function ln(h){return Math.max(0,Math.floor(h))}class Sn{constructor(e,i,l,u,d,g){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=g===void 0||!!g,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ln(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Mn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ln(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Mn(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=s.aO(e,-180,180)*Math.PI/180;var l,u,d,g,w,C,P,A,R;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=N(),l=this._rotationMatrix,d=-this._bearingInRadians,g=(u=this._rotationMatrix)[0],w=u[1],C=u[2],P=u[3],A=Math.sin(d),R=Math.cos(d),l[0]=g*R+C*A,l[1]=w*R+P*A,l[2]=g*-A+C*R,l[3]=w*-A+P*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=s.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aP(this._fovInRadians)}setFov(e){e=s.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=s.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=s.af(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,l){this._unmodified=!1,this._edgeInsets.interpolate(e,i,l),this._constrain(),this._calcMatrices()}resize(e,i,l=!0){this._width=e,this._height=i,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new mt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-s.ai,s.ai])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{const{minX:l,minY:u,maxX:d,maxY:g}=s.a2.fromPoints(i).extend(e);return[new s.P(l,u),new s.P(d,u),new s.P(d,g),new s.P(l,g),new s.P(l,u)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=s.ag(new Float64Array(16));s.N(e,e,[this._width/2,-this._height/2,1]),s.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=s.ag(new Float64Array(16)),s.N(e,e,[1,-1,1]),s.M(e,e,[-1,-1,0]),s.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,l,u){const d=l!==void 0?l:this.bearing,g=u=u!==void 0?u:this.pitch,w=s.a1.fromLngLat(e,i),C=-Math.cos(s.ae(g)),P=Math.sin(s.ae(g)),A=P*Math.sin(s.ae(d)),R=-P*Math.cos(s.ae(d));let D=this.elevation;const O=i-D;let $;C*O>=0||Math.abs(C)<.1?($=1e4,D=i+$*C):$=-O/C;let ee,Q,ne=s.aQ(1,w.y),ue=0;do{if(ue+=1,ue>10)break;Q=$/ne,ee=new s.a1(w.x+A*Q,w.y+R*Q),ne=1/ee.meterInMercatorCoordinateUnits()}while(Math.abs($-Q*ne)>1e-12);return{center:ee.toLngLat(),elevation:D,zoom:s.ak(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=s.aj(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/i,u=s.a1.fromLngLat(this.center,this.elevation),d=Ie(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const g=this.calculateCenterFromCameraLngLatAlt(d.toLngLat(),s.aQ(d.z,u.y),this.bearing,this.pitch);this._elevation=g.elevation,this._center=g.center,this.setZoom(g.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=s.aj(1,this.center.lat)*this.worldSize;return Ie(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/s.$,1/i/s.$]}}class kn{constructor(e,i){this.min=e,this.max=i,this.center=s.aR([],s.aS([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=s.aT(this.min),u=s.aT(this.max);for(let d=0;d<i.length;d++)l[d]=i[d]?this.min[d]:this.center[d],u[d]=i[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new kn(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let l=0;l<e.planes.length;l++){const u=this.intersectsPlane(e.planes[l]);if(u===0)return 0;u===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],l=e[3];for(let u=0;u<3;u++)e[u]>0?(i+=e[u]*this.min[u],l+=e[u]*this.max[u]):(l+=e[u]*this.min[u],i+=e[u]*this.max[u]);return i>=0?2:l<0?0:1}}class gn{distanceToTile2d(e,i,l,u){const d=u.distanceX([e,i]),g=u.distanceY([e,i]);return Math.hypot(d,g)}getWrap(e,i,l){return l}getTileBoundingVolume(e,i,l,u){var d,g;let w=0,C=0;if(u!=null&&u.terrain){const A=new s.Z(e.z,i,e.z,e.x,e.y),R=u.terrain.getMinMaxElevation(A);w=(d=R.minElevation)!==null&&d!==void 0?d:Math.min(0,l),C=(g=R.maxElevation)!==null&&g!==void 0?g:Math.max(0,l)}const P=1<<e.z;return new kn([i+e.x/P,e.y/P,w],[i+(e.x+1)/P,(e.y+1)/P,C])}allowVariableZoom(e,i){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,u=s.ah(78.5-l/2,0,60);return!!i.terrain||e.pitch>u}allowWorldCopies(){return!0}prepareNextFrame(){}}class fn{constructor(e,i,l){this.points=e,this.planes=i,this.aabb=l}static fromInvProjectionMatrix(e,i=1,l=0,u,d){const g=d?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((D=>(function(O,$,ee,Q){const ne=s.aw([],O,$),ue=1/ne[3]/ee*Q;return s.aY(ne,ne,[ue,ue,1/ne[3],ue])})(D,e,i,w)));u&&(function(D,O,$,ee){const Q=ee?4:0,ne=ee?0:4;let ue=0;const _e=[],he=[];for(let pe=0;pe<4;pe++){const Be=s.aU([],D[pe+ne],D[pe+Q]),Qe=s.aZ(Be);s.aR(Be,Be,1/Qe),_e.push(Qe),he.push(Be)}for(let pe=0;pe<4;pe++){const Be=s.a_(D[pe+Q],he[pe],$);ue=Be!==null&&Be>=0?Math.max(ue,Be):Math.max(ue,_e[pe])}const we=(function(pe,Be){const Qe=s.aU([],pe[Be[0]],pe[Be[1]]),Ue=s.aU([],pe[Be[2]],pe[Be[1]]),We=[0,0,0,0];return s.aV(We,s.aW([],Qe,Ue)),We[3]=-s.aX(We,pe[Be[0]]),We})(D,O),Pe=(function(pe,Be){const Qe=s.a$(pe),Ue=s.b0([],pe,1/Qe),We=s.aU([],Be,s.aR([],Ue,s.aX(Be,Ue))),Je=s.a$(We);if(Je>0){const Nt=Math.sqrt(1-Ue[3]*Ue[3]),Zt=s.aR([],Ue,-Ue[3]),Tt=s.aS([],Zt,s.aR([],We,Nt/Je));return s.b1(Be,Tt)}return null})($,we);if(Pe!==null){const pe=Pe/s.aX(he[0],we);ue=Math.min(ue,pe)}for(let pe=0;pe<4;pe++){const Be=Math.min(ue,_e[pe]);D[pe+ne]=[D[pe+Q][0]+he[pe][0]*Be,D[pe+Q][1]+he[pe][1]*Be,D[pe+Q][2]+he[pe][2]*Be,1]}})(C,g[0],u,d);const P=g.map((D=>{const O=s.aU([],C[D[0]],C[D[1]]),$=s.aU([],C[D[2]],C[D[1]]),ee=s.aV([],s.aW([],O,$)),Q=-s.aX(ee,C[D[1]]);return ee.concat(Q)})),A=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const D of C)for(let O=0;O<3;O++)A[O]=Math.min(A[O],D[O]),R[O]=Math.max(R[O],D[O]);return new fn(C,P,new kn(A,R))}}class an{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,l=!0){this._helper.resize(e,i,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,l,u,d){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Sn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(g,w)=>this.getConstrained(g,w)},e,i,l,u,d),this._coveringTilesDetailsProvider=new gn}clone(){const e=new an;return e.apply(this),e}apply(e,i,l){this._helper.apply(e,i,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new s.b2(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new s.P(0,0)),u=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),d=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),g=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,u.x,d.x,g.x)),C=Math.floor(Math.max(l.x,u.x,d.x,g.x)),P=1;for(let A=w-P;A<=C+P;A++)A!==0&&i.push(new s.b2(A,e))}return i}getCameraFrustum(){return fn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,i){const l=s.aj(this.elevation,this.center.lat),u=this.screenPointToMercatorCoordinateAtZ(i,l),d=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),g=s.a1.fromLngLat(e),w=new s.a1(g.x-(u.x-d.x),g.y-(u.y-d.y));this.setCenter(w==null?void 0:w.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(s.a1.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.a1.fromLngLat(e))}screenPointToLocation(e,i){var l;return(l=this.screenPointToMercatorCoordinate(e,i))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const l=i.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const l=i||0,u=[e.x,e.y,0,1],d=[e.x,e.y,1,1];s.aw(u,u,this._pixelMatrixInverse),s.aw(d,d,this._pixelMatrixInverse);const g=u[3],w=d[3],C=u[1]/g,P=d[1]/w,A=u[2]/g,R=d[2]/w,D=A===R?0:(l-A)/(R-A);return new s.a1(s.C.number(u[0]/g,d[0]/w,D)/this.worldSize,s.C.number(C,P,D)/this.worldSize,l)}coordinatePoint(e,i=0,l=this._pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,i,1];return s.aw(u,u,l),new s.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this._helper._height/2-de(this));return new mt().extend(this.screenPointToLocation(new s.P(0,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-de(this)}calculatePosMatrix(e,i=!1,l){var u;const d=(u=e.key)!==null&&u!==void 0?u:s.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),g=i?this._alignedPosMatrixCache:this._posMatrixCache;if(g.has(d)){const P=g.get(d);return l?P.f32:P.f64}const w=Se(e,this.worldSize);s.O(w,i?this._alignedProjMatrix:this._viewProjMatrix,w);const C={f64:w,f32:new Float32Array(w)};return g.set(d,C),l?C.f32:C.f64}calculateFogMatrix(e){const i=e.key,l=this._fogMatrixCacheF32;if(l.has(i))return l.get(i);const u=Se(e,this.worldSize);return s.O(u,this._fogMatrix,u),l.set(i,new Float32Array(u)),l.get(i)}getConstrained(e,i){i=s.ah(+i,this.minZoom,this.maxZoom);const l={center:new s.S(e.lng,e.lat),zoom:i};let u=this._helper._lngRange;if(!this._helper._renderWorldCopies&&u===null){const _e=179.9999999999;u=[-_e,_e]}const d=this.tileSize*s.af(l.zoom);let g=0,w=d,C=0,P=d,A=0,R=0;const{x:D,y:O}=this.size;if(this._helper._latRange){const _e=this._helper._latRange;g=s.U(_e[1])*d,w=s.U(_e[0])*d,w-g<O&&(A=O/(w-g))}u&&(C=s.aO(s.V(u[0])*d,0,d),P=s.aO(s.V(u[1])*d,0,d),P<C&&(P+=d),P-C<D&&(R=D/(P-C)));const{x:$,y:ee}=X(d,e);let Q,ne;const ue=Math.max(R||0,A||0);if(ue){const _e=new s.P(R?(P+C)/2:$,A?(w+g)/2:ee);return l.center=ae(d,_e).wrap(),l.zoom+=s.ak(ue),l}if(this._helper._latRange){const _e=O/2;ee-_e<g&&(ne=g+_e),ee+_e>w&&(ne=w-_e)}if(u){const _e=(C+P)/2;let he=$;this._helper._renderWorldCopies&&(he=s.aO($,_e-d/2,_e+d/2));const we=D/2;he-we<C&&(Q=C+we),he+we>P&&(Q=P-we)}if(Q!==void 0||ne!==void 0){const _e=new s.P(Q??$,ne??ee);l.center=ae(d,_e).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,i,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,u)}_calculateNearFarZIfNeeded(e,i,l){if(!this._helper.autoCalculateNearFarZ)return;const u=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),d=e-u*this._helper._pixelPerMeter/Math.cos(i),g=u<0?d:e,w=Math.PI/2+this.pitchInRadians,C=s.ae(this.fov)*(Math.abs(Math.cos(s.ae(this.roll)))*this.height+Math.abs(Math.sin(s.ae(this.roll)))*this.width)/this.height*(.5+l.y/this.height),P=Math.sin(C)*g/Math.sin(s.ah(Math.PI-w-C,.01,Math.PI-.01)),A=de(this),R=Math.atan(A/this._helper.cameraToCenterDistance),D=s.ae(.75),O=R>D?2*R*(.5+l.y/(2*A)):D,$=Math.sin(O)*g/Math.sin(s.ah(Math.PI-w-O,.01,Math.PI-.01)),ee=Math.min(P,$);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*ee+g),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=X(this.worldSize,this.center),l=i.x,u=i.y;this._helper._pixelPerMeter=s.aj(1,this.center.lat)*this.worldSize;const d=s.ae(Math.min(this.pitch,Z)),g=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(d));let w;this._calculateNearFarZIfNeeded(g,d,e),w=new Float64Array(16),s.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=s.b5(w),s.N(w,w,[1,-1,1]),s.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),s.b6(w,w,-this.rollInRadians),s.b7(w,w,this.pitchInRadians),s.b6(w,w,-this.bearingInRadians),s.M(w,w,[-l,-u,0]),this._mercatorMatrix=s.N([],w,[this.worldSize,this.worldSize,this.worldSize]),s.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),s.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=s.aq([],w);const C=[0,0,-1,1];s.aw(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),s.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,g,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,s.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.M(this._fogMatrix,this._fogMatrix,[-l,-u,0]),s.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const P=this._helper._width%2/2,A=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),D=Math.sin(-this.bearingInRadians),O=l-Math.round(l)+R*P+D*A,$=u-Math.round(u)+R*A+D*P,ee=new Float64Array(w);if(s.M(ee,ee,[O>.5?O-1:O,$>.5?$-1:$,0]),this._alignedProjMatrix=ee,w=s.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new s.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return s.aw(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=s.aj(1,this.center.lat)*this.worldSize;return Ie(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const l=s.a1.fromLngLat(e),u=[l.x*this.worldSize,l.y*this.worldSize,i,1];return s.aw(u,u,this._viewProjMatrix),u[2]/u[3]}getProjectionData(e){const{overscaledTileID:i,aligned:l,applyTerrainMatrix:u}=e,d=this._helper.getMercatorTileCoordinates(i),g=i?this.calculatePosMatrix(i,l,!0):null;let w;return w=i&&i.terrainRttPosMatrix32f&&u?i.terrainRttPosMatrix32f:g||s.b8(),{mainMatrix:w,tileMercatorCoords:d,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,l){return 1}transformLightDirection(e){return s.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,l,u){const d=this.calculatePosMatrix(l);let g;u?(g=[e,i,u(e,i),1],s.aw(g,g,d)):(g=[e,i,0,1],En(g,g,d));const w=g[3];return{point:new s.P(g[0]/w,g[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const l=s.a1.fromLngLat(e,i),u=l.meterInMercatorCoordinateUnits(),d=s.b9();return s.M(d,d,[l.x,l.y,l.z]),s.b6(d,d,Math.PI),s.b7(d,d,Math.PI/2),s.N(d,d,[-u,u,u]),d}getProjectionDataForCustomLayer(e=!0){const i=new s.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),u=Se(i,this.worldSize);s.O(u,this._viewProjMatrix,u),l.tileMercatorCoords=[0,0,1,1];const d=[s.$,s.$,this.worldSize/this._helper.pixelsPerMeter],g=s.ba();return s.N(g,u,d),l.fallbackMatrix=g,l.mainMatrix=g,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function po(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function pi(h){if(h.useSlerp)if(h.k<1){const e=s.bb(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),i=s.bb(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),l=new Float64Array(4);s.bc(l,e,i,h.k);const u=s.bd(l);h.tr.setRoll(u.roll),h.tr.setPitch(u.pitch),h.tr.setBearing(u.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(s.C.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(s.C.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(s.C.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function Gn(h,e,i,l,u){const d=u.padding,g=X(u.worldSize,i.getNorthWest()),w=X(u.worldSize,i.getNorthEast()),C=X(u.worldSize,i.getSouthEast()),P=X(u.worldSize,i.getSouthWest()),A=s.ae(-l),R=g.rotate(A),D=w.rotate(A),O=C.rotate(A),$=P.rotate(A),ee=new s.P(Math.max(R.x,D.x,$.x,O.x),Math.max(R.y,D.y,$.y,O.y)),Q=new s.P(Math.min(R.x,D.x,$.x,O.x),Math.min(R.y,D.y,$.y,O.y)),ne=ee.sub(Q),ue=(u.width-(d.left+d.right+e.left+e.right))/ne.x,_e=(u.height-(d.top+d.bottom+e.top+e.bottom))/ne.y;if(_e<0||ue<0)return void po();const he=Math.min(s.ak(u.scale*Math.min(ue,_e)),h.maxZoom),we=s.P.convert(h.offset),Pe=new s.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(s.ae(l)),pe=we.add(Pe).mult(u.scale/s.af(he));return{center:ae(u.worldSize,g.add(C).div(2).sub(pe)),zoom:he,bearing:l}}class jn{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,l){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,i,l,u,d){return Gn(e,i,l,u,d)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(s.S.convert(i.center))}handleEaseTo(e,i){const l=e.zoom,u=e.padding,d={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},w=i.zoom!==void 0,C=!e.isPaddingEqual(i.padding);let P=!1;const A=w?+i.zoom:e.zoom;let R=e.centerPoint.add(i.offsetAsPoint);const D=e.screenPointToLocation(R),{center:O,zoom:$}=e.getConstrained(s.S.convert(i.center||D),A??l);bn(e,O);const ee=X(e.worldSize,D),Q=X(e.worldSize,O).sub(ee),ne=s.af($-l);return P=$!==l,{easeFunc:ue=>{if(P&&e.setZoom(s.C.number(l,$,ue)),s.be(d,g)||pi({startEulerAngles:d,endEulerAngles:g,tr:e,k:ue,useSlerp:d.roll!=g.roll}),C&&(e.interpolatePadding(u,i.padding,ue),R=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const _e=s.af(e.zoom-l),he=$>l?Math.min(2,ne):Math.max(.5,ne),we=Math.pow(he,1-ue),Pe=ae(e.worldSize,ee.add(Q.mult(ue*we)).mult(_e));e.setLocationAtPoint(e.renderWorldCopies?Pe.wrap():Pe,R)}},isZooming:P,elevationCenter:O}}handleFlyTo(e,i){const l=i.zoom!==void 0,u=e.zoom,d=e.getConstrained(s.S.convert(i.center||i.locationAtOffset),l?+i.zoom:u),g=d.center,w=d.zoom;bn(e,g);const C=X(e.worldSize,i.locationAtOffset),P=X(e.worldSize,g).sub(C),A=P.mag(),R=s.af(w-u);let D;if(i.minZoom!==void 0){const O=Math.min(+i.minZoom,u,w),$=e.getConstrained(g,O).zoom;D=s.af($-u)}return{easeFunc:(O,$,ee,Q)=>{e.setZoom(O===1?w:u+s.ak($));const ne=O===1?g:ae(e.worldSize,C.add(P.mult(ee)).mult($));e.setLocationAtPoint(e.renderWorldCopies?ne.wrap():ne,Q)},scaleOfZoom:R,targetCenter:g,scaleOfMinZoom:D,pixelPathLength:A}}}class zn{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}zn.Replace=[1,0],zn.disabled=new zn(zn.Replace,s.bf.transparent,[!1,!1,!1,!1]),zn.unblended=new zn(zn.Replace,s.bf.transparent,[!0,!0,!0,!0]),zn.alphaBlended=new zn([1,771],s.bf.transparent,[!0,!0,!0,!0]);const qa=2305;class Lr{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}Lr.disabled=new Lr(!1,1029,qa),Lr.backCCW=new Lr(!0,1029,qa),Lr.frontCCW=new Lr(!0,1028,qa);class $r{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}$r.ReadOnly=!1,$r.ReadWrite=!0,$r.disabled=new $r(519,$r.ReadOnly,[0,1]);const _a=7680;class cn{constructor(e,i,l,u,d,g){this.test=e,this.ref=i,this.mask=l,this.fail=u,this.depthFail=d,this.pass=g}}cn.disabled=new cn({func:519,mask:0},0,0,_a,_a,_a);const Li=new WeakMap;function ga(h){var e;if(Li.has(h))return Li.get(h);{const i=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Li.set(h,i),i}}class sa{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,l=i.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const u=new s.aL;u.emplaceBack(-1,-1),u.emplaceBack(2,-1),u.emplaceBack(-1,2);const d=new s.aN;d.emplaceBack(0,1,2),this._fullscreenTriangle=new Tn(i.createVertexBuffer(u,nn.members),i.createIndexBuffer(d),s.aM.simpleSegment(0,0,u.length,d.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(l.TEXTURE1);const g=l.createTexture();l.bindTexture(l.TEXTURE_2D,g),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(g),ga(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const l=this._cachedRenderContext.context,u=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:s.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,u.TRIANGLES,$r.disabled,cn.disabled,zn.unblended,Lr.disabled,((d,g)=>({u_input:d,u_output_expected:g}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ga(u)){u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.readBuffer(u.COLOR_ATTACHMENT0),u.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);const d=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);u.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:d}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ga(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=sa._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const Ka=s.$/128;function Is(h,e){const i=h.granularity!==void 0?Math.max(h.granularity,1):1,l=i+(h.generateBorders?2:0),u=i+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),d=l+1,g=u+1,w=h.generateBorders?-1:0,C=h.generateBorders||h.extendToNorthPole?-1:0,P=i+(h.generateBorders?1:0),A=i+(h.generateBorders||h.extendToSouthPole?1:0),R=d*g,D=l*u*6,O=d*g>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const $=O||e==="32bit",ee=new Int16Array(2*R);let Q=0;for(let _e=C;_e<=A;_e++)for(let he=w;he<=P;he++){let we=he/i*s.$;he===-1&&(we=-Ka),he===i+1&&(we=s.$+Ka);let Pe=_e/i*s.$;_e===-1&&(Pe=h.extendToNorthPole?s.bh:-Ka),_e===i+1&&(Pe=h.extendToSouthPole?s.bi:s.$+Ka),ee[Q++]=we,ee[Q++]=Pe}const ne=$?new Uint32Array(D):new Uint16Array(D);let ue=0;for(let _e=0;_e<u;_e++)for(let he=0;he<l;he++){const we=he+1+_e*d,Pe=he+(_e+1)*d,pe=he+1+(_e+1)*d;ne[ue++]=he+_e*d,ne[ue++]=Pe,ne[ue++]=we,ne[ue++]=we,ne[ue++]=Pe,ne[ue++]=pe}return{vertices:ee.buffer.slice(0),indices:ne.buffer.slice(0),uses32bitIndices:$}}const Ca=new s.aK({fill:new s.bj(128,2),line:new s.bj(512,0),tile:new s.bj(128,32),stencil:new s.bj(128,1),circle:3});class Ja{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ur.projectionGlobe}get vertexShaderPreludeCode(){return Ur.projectionMercator.vertexSource}get subdivisionGranularity(){return Ca}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new sa(e));const i=s.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,u=this._errorMeasurement.updateErrorLoop(i,l),d=ie.now();u!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=u,this._errorMeasurementLastChangeTime=d);const g=Math.min(Math.max((d-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bl(g))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,l,u,d){const g=(d==="stencil"?Ca.stencil:Ca.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:g,generateBorders:l,extendToNorthPole:i.y===0&&u,extendToSouthPole:i.y===(1<<i.z)-1&&u})}_getMesh(e,i){const l=this._getMeshKey(i);if(l in this._tileMeshCache)return this._tileMeshCache[l];const u=(function(d,g){const w=Is(g,"16bit"),C=s.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),P=s.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Tn(d.createVertexBuffer(C,nn.members),d.createIndexBuffer(P),s.aM.simpleSegment(0,0,C.length,P.length))})(e,i);return this._tileMeshCache[l]=u,u}recalculate(e){}hasTransition(){const e=ie.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Jo=new s.r({type:new s.D(s.v.projection.type)});class gl extends s.E{constructor(e){super(),this._transitionable=new s.t(Jo),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0)),this._mercatorProjection=new Pr,this._verticalPerspectiveProjection=new Ja}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof s.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,l,u,d){return this.currentProjection.getMeshFromTileID(e,i,l,u,d)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function vl(h){const e=Qo(h.worldSize,h.center.lat);return 2*Math.PI*e}function Sa(h,e,i,l,u){const d=1/(1<<u),g=e/s.$*d+l*d,w=s.bo((h/s.$*d+i*d)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI,P=Math.cos(C),A=new Float64Array(3);return A[0]=Math.sin(w)*P,A[1]=Math.sin(C),A[2]=Math.cos(w)*P,A}function wi(h){return(function(e,i){const l=Math.cos(i),u=new Float64Array(3);return u[0]=Math.sin(e)*l,u[1]=Math.sin(i),u[2]=Math.cos(e)*l,u})(h.lng*Math.PI/180,h.lat*Math.PI/180)}function Qo(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ms(h){const e=Math.asin(h[1])/Math.PI*180,i=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(i>1e-6){const l=h[0]/i,u=Math.acos(h[2]/i),d=(l>0?u:-u)/Math.PI*180;return new s.S(s.aO(d,-180,180),e)}return new s.S(0,e)}function ko(h){return Math.cos(h*Math.PI/180)}function ei(h,e){const i=ko(h),l=ko(e);return s.ak(l/i)}function Bh(h,e){const i=h.rotate(e.bearingInRadians),l=e.zoom+ei(e.center.lat,0),u=s.bk(1/ko(e.center.lat),1/ko(Math.min(Math.abs(e.center.lat),60)),s.bn(l,7,3,0,1)),d=360/vl({worldSize:e.worldSize,center:{lat:e.center.lat}});return new s.S(e.center.lng-i.x*d*u,s.ah(e.center.lat+i.y*d,-s.ai,s.ai))}function ks(h){const e=.5*h,i=Math.sin(e),l=Math.cos(e);return Math.log(i+l)-Math.log(l-i)}function Ec(h,e,i,l){const u=h.lat+i*l;if(Math.abs(i)>1){const d=(Math.sign(h.lat+i)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,g=Math.abs(h.lat+i)*Math.PI/180,w=ks(d+l*(g-d)),C=ks(d),P=ks(g);return new s.S(h.lng+e*((w-C)/(P-C)),u)}return new s.S(h.lng+e*l,u)}class xp{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,i,l,u){const d=`${e.z}_${e.x}_${e.y}_${u!=null&&u.terrain?"t":""}`,g=this._cache.get(d);if(g)return g;const w=this._cachePrevious.get(d);if(w)return this._cache.set(d,w),w;const C=this._boundingVolumeFactory(e,i,l,u);return this._cache.set(d,C),this._hadAnyChanges=!0,C}}class es{constructor(e,i,l,u){this.min=l,this.max=u,this.points=e,this.planes=i}static fromAabb(e,i){const l=[];for(let u=0;u<8;u++)l.push([1&~u?e[0]:i[0],(u>>1&1)==1?i[1]:e[1],(u>>2&1)==1?i[2]:e[2]]);return new es(l,[[-1,0,0,i[0]],[1,0,0,-e[0]],[0,-1,0,i[1]],[0,1,0,-e[1]],[0,0,-1,i[2]],[0,0,1,-e[2]]],e,i)}static fromCenterSizeAngles(e,i,l){const u=s.br([],l[0],l[1],l[2]),d=s.bs([],[i[0],0,0],u),g=s.bs([],[0,i[1],0],u),w=s.bs([],[0,0,i[2]],u),C=[...e],P=[...e];for(let R=0;R<8;R++)for(let D=0;D<3;D++){const O=e[D]+d[D]*(1&~R?-1:1)+g[D]*((R>>1&1)==1?1:-1)+w[D]*((R>>2&1)==1?1:-1);C[D]=Math.min(C[D],O),P[D]=Math.max(P[D],O)}const A=[];for(let R=0;R<8;R++){const D=[...e];s.aS(D,D,s.aR([],d,1&~R?-1:1)),s.aS(D,D,s.aR([],g,(R>>1&1)==1?1:-1)),s.aS(D,D,s.aR([],w,(R>>2&1)==1?1:-1)),A.push(D)}return new es(A,[[...d,-s.aX(d,A[0])],[...g,-s.aX(g,A[0])],[...w,-s.aX(w,A[0])],[-d[0],-d[1],-d[2],-s.aX(d,A[7])],[-g[0],-g[1],-g[2],-s.aX(g,A[7])],[-w[0],-w[1],-w[2],-s.aX(w,A[7])]],C,P)}intersectsFrustum(e){let i=!0;const l=this.points.length,u=this.planes.length,d=e.planes.length,g=e.points.length;for(let w=0;w<d;w++){const C=e.planes[w];let P=0;for(let A=0;A<l;A++){const R=this.points[A];C[0]*R[0]+C[1]*R[1]+C[2]*R[2]+C[3]>=0&&P++}if(P===0)return 0;P<l&&(i=!1)}if(i)return 2;for(let w=0;w<u;w++){const C=this.planes[w];let P=0;for(let A=0;A<g;A++){const R=e.points[A];C[0]*R[0]+C[1]*R[1]+C[2]*R[2]+C[3]>=0&&P++}if(P===0)return 0}return 1}intersectsPlane(e){const i=this.points.length;let l=0;for(let u=0;u<i;u++){const d=this.points[u];e[0]*d[0]+e[1]*d[1]+e[2]*d[2]+e[3]>=0&&l++}return l===i?2:l===0?0:1}}function Di(h,e,i){const l=h-e;return l<0?-l:Math.max(0,l-i)}function As(h,e,i,l,u){const d=h-i;let g;return g=d<0?Math.min(-d,1+d-u):d>1?Math.min(Math.max(d-u,0),1-d):0,Math.max(g,Di(e,l,u))}class Za{constructor(){this._boundingVolumeCache=new xp(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,i,l,u){const d=1<<l.z,g=1/d,w=l.x/d,C=l.y/d;let P=2;return P=Math.min(P,As(e,i,w,C,g)),P=Math.min(P,As(e,i,w+.5,-C-g,g)),P=Math.min(P,As(e,i,w+.5,2-C-g,g)),P}getWrap(e,i,l){const u=1<<i.z,d=1/u,g=i.x/u,w=Di(e.x,g,d),C=Di(e.x,g-1,d),P=Di(e.x,g+1,d),A=Math.min(w,C,P);return A===P?1:A===C?-1:0}allowVariableZoom(e,i){return Mt(e,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,i,l,u){return this._boundingVolumeCache.getTileBoundingVolume(e,i,l,u)}_computeTileBoundingVolume(e,i,l,u){var d,g;let w=0,C=0;if(u!=null&&u.terrain){const P=new s.Z(e.z,i,e.z,e.x,e.y),A=u.terrain.getMinMaxElevation(P);w=(d=A.minElevation)!==null&&d!==void 0?d:Math.min(0,l),C=(g=A.maxElevation)!==null&&g!==void 0?g:Math.max(0,l)}if(w/=s.bu,C/=s.bu,w+=1,C+=1,e.z<=0)return es.fromAabb([-C,-C,-C],[C,C,C]);if(e.z===1)return es.fromAabb([e.x===0?-C:0,e.y===0?0:-C,-C],[e.x===0?0:C,e.y===0?C:0,C]);{const P=[Sa(0,0,e.x,e.y,e.z),Sa(s.$,0,e.x,e.y,e.z),Sa(s.$,s.$,e.x,e.y,e.z),Sa(0,s.$,e.x,e.y,e.z)],A=[];for(const We of P)A.push(s.aR([],We,C));if(C!==w)for(const We of P)A.push(s.aR([],We,w));e.y===0&&A.push([0,1,0]),e.y===(1<<e.z)-1&&A.push([0,-1,0]);const R=[1,1,1],D=[-1,-1,-1];for(const We of A)for(let Je=0;Je<3;Je++)R[Je]=Math.min(R[Je],We[Je]),D[Je]=Math.max(D[Je],We[Je]);const O=Sa(s.$/2,s.$/2,e.x,e.y,e.z),$=s.aW([],[0,1,0],O);s.aV($,$);const ee=s.aW([],O,$);s.aV(ee,ee);const Q=s.aW([],P[2],P[1]);s.aV(Q,Q);const ne=s.aW([],P[0],P[3]);s.aV(ne,ne),A.push(s.aR([],O,C)),e.y>=(1<<e.z)/2&&A.push(s.aR([],Sa(s.$/2,0,e.x,e.y,e.z),C)),e.y<(1<<e.z)/2&&A.push(s.aR([],Sa(s.$/2,s.$,e.x,e.y,e.z),C));const ue=Es(O,A),_e=Es(ee,A),he=[-O[0],-O[1],-O[2],ue.max],we=[O[0],O[1],O[2],-ue.min],Pe=[-ee[0],-ee[1],-ee[2],_e.max],pe=[ee[0],ee[1],ee[2],-_e.min],Be=[...Q,0],Qe=[...ne,0],Ue=[];return e.y===0?Ue.push(s.bt(Qe,Be,he),s.bt(Qe,Be,we)):Ue.push(s.bt(Pe,Be,he),s.bt(Pe,Be,we),s.bt(Pe,Qe,he),s.bt(Pe,Qe,we)),e.y===(1<<e.z)-1?Ue.push(s.bt(Qe,Be,he),s.bt(Qe,Be,we)):Ue.push(s.bt(pe,Be,he),s.bt(pe,Be,we),s.bt(pe,Qe,he),s.bt(pe,Qe,we)),new es(Ue,[he,we,Pe,pe,Be,Qe],R,D)}}}function Es(h,e){let i=1/0,l=-1/0;for(const u of e){const d=s.aX(h,u);i=Math.min(i,d),l=Math.max(l,d)}return{min:i,max:l}}class zs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=s.bv(),this._projectionMatrix=s.b9(),this._globeViewProjMatrix32f=s.b8(),this._globeViewProjMatrixNoCorrection=s.b9(),this._globeViewProjMatrixNoCorrectionInverted=s.b9(),this._globeProjMatrixInverted=s.b9(),this._cameraPosition=s.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Sn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new Za}clone(){const e=new zs;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=s.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:l}=e,u=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:u,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,l=this.cameraToCenterDistance/e,u=Math.sin(i)*l,d=Math.cos(i)*l+1,g=1/Math.sqrt(u*u+d*d)*1;let w=-u,C=d;const P=Math.sqrt(w*w+C*C);w/=P,C/=P;const A=[0,w,C];s.bw(A,A,[0,0,0],-this.bearingInRadians),s.bx(A,A,[0,0,0],-1*this.center.lat*Math.PI/180),s.by(A,A,[0,0,0],this.center.lng*Math.PI/180);const R=1/s.aZ(A);return s.aR(A,A,R),[...A,-g*R]}isLocationOccluded(e){return!this.isSurfacePointVisible(wi(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,u=Math.cos(l),d=[Math.sin(i)*u,Math.sin(l),Math.cos(i)*u],g=[d[2],0,-d[0]],w=[0,0,0];s.aW(w,g,d),s.aV(g,g),s.aV(w,w);const C=[0,0,0];return s.aV(C,[g[0]*e[0]+w[0]*e[1]+d[0]*e[2],g[1]*e[0]+w[1]*e[1]+d[1]*e[2],g[2]*e[0]+w[2]*e[1]+d[2]*e[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,l){const u=(function(w,C,P){const A=1/(1<<P.z);return new s.a1(w/s.$*A+P.x*A,C/s.$*A+P.y*A)})(e,i,l.canonical),d=(g=u.y,[s.bo(u.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI]);var g;return this.getCircleRadiusCorrection()/Math.cos(d[1])}projectTileCoordinates(e,i,l,u){const d=l.canonical,g=Sa(e,i,d.x,d.y,d.z),w=1+(u?u(e,i):0)/s.bu,C=[g[0]*w,g[1]*w,g[2]*w,1];s.aw(C,C,this._globeViewProjMatrixNoCorrection);const P=this._cachedClippingPlane,A=P[0]*g[0]+P[1]*g[1]+P[2]*g[2]+P[3]<0;return{point:new s.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:A}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Qo(this.worldSize,this.center.lat),i=s.ba(),l=s.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),s.b4(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const u=this.centerOffset;i[8]=2*-u.x/this._helper._width,i[9]=2*u.y/this._helper._height,this._projectionMatrix=s.b5(i),this._globeProjMatrixInverted=s.ba(),s.aq(this._globeProjMatrixInverted,i),s.M(i,i,[0,0,-this.cameraToCenterDistance]),s.b6(i,i,this.rollInRadians),s.b7(i,i,-this.pitchInRadians),s.b6(i,i,this.bearingInRadians),s.M(i,i,[0,0,-e]);const d=s.bp();d[0]=e,d[1]=e,d[2]=e,s.b7(l,i,this.center.lat*Math.PI/180),s.bz(l,l,-this.center.lng*Math.PI/180),s.N(l,l,d),this._globeViewProjMatrixNoCorrection=l,s.b7(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bz(i,i,-this.center.lng*Math.PI/180),s.N(i,i,d),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=s.ba(),s.aq(this._globeViewProjMatrixNoCorrectionInverted,l);const g=s.bp();this._cameraPosition=s.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,s.bw(this._cameraPosition,this._cameraPosition,g,-this.rollInRadians),s.bx(this._cameraPosition,this._cameraPosition,g,this.pitchInRadians),s.bw(this._cameraPosition,this._cameraPosition,g,-this.bearingInRadians),s.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bx(this._cameraPosition,this._cameraPosition,g,-this.center.lat*Math.PI/180),s.by(this._cameraPosition,this._cameraPosition,g,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=s.b5(this._globeViewProjMatrixNoCorrectionInverted);s.N(w,w,[1,1,-1]),this._cachedFrustum=fn.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){s.w("calculateFogMatrix is not supported on globe projection.");const i=s.ba();return s.ag(i),i}getVisibleUnwrappedCoordinates(e){return[new s.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=wi(e);s.aR(l,l,1+i/s.bu);const u=s.bv();return s.aw(u,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),u[2]/u[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,l=[new s.P(0,0),new s.P(e,0),new s.P(this.width,0),new s.P(this.width,i),new s.P(this.width,this.height),new s.P(e,this.height),new s.P(0,this.height),new s.P(0,i)],u=[];for(const R of l)u.push(this.unprojectScreenPoint(R));let d=0,g=0,w=0,C=0;const P=this.center;for(const R of u){const D=s.bA(P.lng,R.lng),O=s.bA(P.lat,R.lat);D<g&&(g=D),D>d&&(d=D),O<C&&(C=O),O>w&&(w=O)}const A=[P.lng+g,P.lat+C,P.lng+d,P.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(A[3]=90,A[0]=-180,A[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(A[1]=-90,A[0]=-180,A[2]=180),new mt(A)}getConstrained(e,i){const l=s.ah(e.lat,-s.ai,s.ai),u=s.ah(+i,this.minZoom+ei(0,l),this.maxZoom);return{center:new s.S(e.lng,l),zoom:u}}calculateCenterFromCameraLngLatAlt(e,i,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,u)}setLocationAtPoint(e,i){const l=wi(this.unprojectScreenPoint(i)),u=wi(e),d=s.bp();s.bB(d);const g=s.bp();s.by(g,l,d,-this.center.lng*Math.PI/180),s.bx(g,g,d,this.center.lat*Math.PI/180);const w=u[0]*u[0]+u[2]*u[2],C=g[0]*g[0];if(w<C)return;const P=Math.sqrt(w-C),A=-P,R=s.bC(u[0],u[2],g[0],P),D=s.bC(u[0],u[2],g[0],A),O=s.bp();s.by(O,u,d,-R);const $=s.bC(O[1],O[2],g[1],g[2]),ee=s.bp();s.by(ee,u,d,-D);const Q=s.bC(ee[1],ee[2],g[1],g[2]),ne=.5*Math.PI,ue=$>=-ne&&$<=ne,_e=Q>=-ne&&Q<=ne;let he,we;if(ue&&_e){const Qe=this.center.lng*Math.PI/180,Ue=this.center.lat*Math.PI/180;s.bD(R,Qe)+s.bD($,Ue)<s.bD(D,Qe)+s.bD(Q,Ue)?(he=R,we=$):(he=D,we=Q)}else if(ue)he=R,we=$;else{if(!_e)return;he=D,we=Q}const Pe=he/Math.PI*180,pe=we/Math.PI*180,Be=this.center.lat;this.setCenter(new s.S(Pe,s.ah(pe,-90,90))),this.setZoom(this.zoom+ei(Be,this.center.lat))}locationToScreenPoint(e,i){const l=wi(e);if(i){const u=i.getElevationForLngLatZoom(e,this._helper._tileZoom);s.aR(l,l,1+u/s.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const i=s.bv();return s.aw(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new s.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const l=i.pointCoordinate(e);if(l)return l}return s.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var l;return(l=this.screenPointToMercatorCoordinate(e,i))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,i){const l=this._cameraPosition,u=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,u)}getRayDirectionFromPixel(e){const i=s.bv();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,s.aw(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const l=s.bp();l[0]=i[0]-this._cameraPosition[0],l[1]=i[1]-this._cameraPosition[1],l[2]=i[2]-this._cameraPosition[2];const u=s.bp();return s.aV(u,l),u}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=s.bv();return s.aw(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const l=s.aX(e,i),u=s.bp(),d=s.bp();s.aR(d,i,l),s.aU(u,e,d);const g=1-s.aX(u,u);if(g<0)return null;const w=s.aX(e,e)-1,C=-l+(l<0?1:-1)*Math.sqrt(g),P=w/C,A=C;return{tMin:Math.min(P,A),tMax:Math.max(P,A)}}unprojectScreenPoint(e){const i=this._cameraPosition,l=this.getRayDirectionFromPixel(e),u=this.rayPlanetIntersection(i,l);if(u){const A=s.bp();s.aS(A,i,[l[0]*u.tMin,l[1]*u.tMin,l[2]*u.tMin]);const R=s.bp();return s.aV(R,A),Ms(R)}const d=this._cachedClippingPlane,g=d[0]*l[0]+d[1]*l[1]+d[2]*l[2],w=-s.b1(d,i)/g,C=s.bp();if(w>0)s.aS(C,i,[l[0]*w,l[1]*w,l[2]*w]);else{const A=s.bp();s.aS(A,i,[2*l[0],2*l[1],2*l[2]]);const R=s.b1(this._cachedClippingPlane,A);s.aU(C,A,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const P=(function(A){const R=s.bp();return R[0]=A[0]*-A[3],R[1]=A[1]*-A[3],R[2]=A[2]*-A[3],{center:R,radius:Math.sqrt(1-A[3]*A[3])}})(d);return Ms((function(A,R,D){const O=s.bp();s.aU(O,D,A);const $=s.bp();return s.bq($,A,O,R/s.a$(O)),$})(P.center,P.radius,C))}getMatrixForModel(e,i){const l=s.S.convert(e),u=1/s.bu,d=s.b9();return s.bz(d,d,l.lng/180*Math.PI),s.b7(d,d,-l.lat/180*Math.PI),s.M(d,d,[0,0,1+i/s.bu]),s.b7(d,d,.5*Math.PI),s.N(d,d,[u,u,u]),d}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new s.Z(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Ls{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,l=!0){this._helper.resize(e,i,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Sn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new an,this._verticalPerspectiveTransform=new zs}clone(){const e=new Ls;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:i.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return s.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,l){const u=this._mercatorTransform.getPitchedTextCorrection(e,i,l),d=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,l);return s.bk(u,d,this._globeness)}projectTileCoordinates(e,i,l,u){return this.currentTransform.projectTileCoordinates(e,i,l,u)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,u)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=i.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Ni{get useGlobeControls(){return!0}handlePanInertia(e,i){const l=Bh(e,i);return Math.abs(l.lng-i.center.lng)>180&&(l.lng=i.center.lng+179.5*Math.sign(l.lng-i.center.lng)),{easingCenter:l,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const l=e.around,u=i.screenPointToLocation(l);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const d=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const g=i.zoom-d;if(g===0)return;const w=s.bA(i.center.lng,u.lng),C=w/(Math.abs(w/180)+1),P=s.bA(i.center.lat,u.lat),A=i.getRayDirectionFromPixel(l),R=i.cameraPosition,D=-1*s.aX(R,A),O=s.bp();s.aS(O,R,[A[0]*D,A[1]*D,A[2]*D]);const $=s.aZ(O)-1,ee=Math.exp(.5*-Math.max($-.3,0)),Q=Qo(i.worldSize,i.center.lat)/Math.min(i.width,i.height),ne=s.bn(Q,.9,.5,1,.25),ue=(1-s.af(-g))*Math.min(ee,ne),_e=i.center.lat,he=i.zoom,we=new s.S(i.center.lng+C*ue,s.ah(i.center.lat+P*ue,-s.ai,s.ai));i.setLocationAtPoint(u,l);const Pe=i.center,pe=s.bn(Math.abs(w),45,85,0,1),Be=s.bn(Q,.75,.35,0,1),Qe=Math.pow(Math.max(pe,Be),.25),Ue=s.bA(Pe.lng,we.lng),We=s.bA(Pe.lat,we.lat);i.setCenter(new s.S(Pe.lng+Ue*Qe,Pe.lat+We*Qe).wrap()),i.setZoom(he+ei(_e,i.center.lat))}handleMapControlsPan(e,i,l){if(!e.panDelta)return;const u=i.center.lat,d=i.zoom;i.setCenter(Bh(e.panDelta,i).wrap()),i.setZoom(d+ei(u,i.center.lat))}cameraForBoxAndBearing(e,i,l,u,d){const g=Gn(e,i,l,u,d),w=i.left/d.width*2-1,C=(d.width-i.right)/d.width*2-1,P=i.top/d.height*-2+1,A=(d.height-i.bottom)/d.height*-2+1,R=s.bA(l.getWest(),l.getEast())<0,D=R?l.getEast():l.getWest(),O=R?l.getWest():l.getEast(),$=Math.max(l.getNorth(),l.getSouth()),ee=Math.min(l.getNorth(),l.getSouth()),Q=D+.5*s.bA(D,O),ne=$+.5*s.bA($,ee),ue=d.clone();ue.setCenter(g.center),ue.setBearing(g.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(g.zoom);const _e=ue.modelViewProjectionMatrix,he=[wi(l.getNorthWest()),wi(l.getNorthEast()),wi(l.getSouthWest()),wi(l.getSouthEast()),wi(new s.S(O,ne)),wi(new s.S(D,ne)),wi(new s.S(Q,$)),wi(new s.S(Q,ee))],we=wi(g.center);let Pe=Number.POSITIVE_INFINITY;for(const pe of he)w<0&&(Pe=Ni.getLesserNonNegativeNonNull(Pe,Ni.solveVectorScale(pe,we,_e,"x",w))),C>0&&(Pe=Ni.getLesserNonNegativeNonNull(Pe,Ni.solveVectorScale(pe,we,_e,"x",C))),P>0&&(Pe=Ni.getLesserNonNegativeNonNull(Pe,Ni.solveVectorScale(pe,we,_e,"y",P))),A<0&&(Pe=Ni.getLesserNonNegativeNonNull(Pe,Ni.solveVectorScale(pe,we,_e,"y",A)));if(Number.isFinite(Pe)&&Pe!==0)return g.zoom=ue.zoom+s.ak(Pe),g;po()}handleJumpToCenterZoom(e,i){const l=e.center.lat,u=e.getConstrained(i.center?s.S.convert(i.center):e.center,e.zoom).center;e.setCenter(u.wrap());const d=i.zoom!==void 0?+i.zoom:e.zoom+ei(l,u.lat);e.zoom!==d&&e.setZoom(d)}handleEaseTo(e,i){const l=e.zoom,u=e.center,d=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},C=i.zoom!==void 0,P=!e.isPaddingEqual(i.padding);let A=!1;const R=i.center?s.S.convert(i.center):u,D=e.getConstrained(R,l).center;bn(e,D);const O=e.clone();O.setCenter(D),O.setZoom(C?+i.zoom:l+ei(u.lat,R.lat)),O.setBearing(i.bearing);const $=new s.P(s.ah(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),s.ah(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(D,$);const ee=(i.offset&&i.offsetAsPoint.mag())>0?O.center:D,Q=C?+i.zoom:l+ei(u.lat,ee.lat),ne=l+ei(u.lat,0),ue=Q+ei(ee.lat,0),_e=s.bA(u.lng,ee.lng),he=s.bA(u.lat,ee.lat),we=s.af(ue-ne);return A=Q!==l,{easeFunc:Pe=>{if(s.be(g,w)||pi({startEulerAngles:g,endEulerAngles:w,tr:e,k:Pe,useSlerp:g.roll!=w.roll}),P&&e.interpolatePadding(d,i.padding,Pe),i.around)s.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const pe=ue>ne?Math.min(2,we):Math.max(.5,we),Be=Math.pow(pe,1-Pe),Qe=Ec(u,_e,he,Pe*Be);e.setCenter(Qe.wrap())}if(A){const pe=s.C.number(ne,ue,Pe)+ei(0,e.center.lat);e.setZoom(pe)}},isZooming:A,elevationCenter:ee}}handleFlyTo(e,i){const l=i.zoom!==void 0,u=e.center,d=e.zoom,g=e.padding,w=!e.isPaddingEqual(i.padding),C=e.getConstrained(s.S.convert(i.center||i.locationAtOffset),d).center,P=l?+i.zoom:e.zoom+ei(e.center.lat,C.lat),A=e.clone();A.setCenter(C),A.setZoom(P),A.setBearing(i.bearing);const R=new s.P(s.ah(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),s.ah(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));A.setLocationAtPoint(C,R);const D=A.center;bn(e,D);const O=(function(he,we,Pe){const pe=wi(we),Be=wi(Pe),Qe=s.aX(pe,Be),Ue=Math.acos(Qe),We=vl(he);return Ue/(2*Math.PI)*We})(e,u,D),$=d+ei(u.lat,0),ee=P+ei(D.lat,0),Q=s.af(ee-$);let ne;if(typeof i.minZoom=="number"){const he=+i.minZoom+ei(D.lat,0),we=Math.min(he,$,ee)+ei(0,D.lat),Pe=e.getConstrained(D,we).zoom+ei(D.lat,0);ne=s.af(Pe-$)}const ue=s.bA(u.lng,D.lng),_e=s.bA(u.lat,D.lat);return{easeFunc:(he,we,Pe,pe)=>{const Be=Ec(u,ue,_e,Pe);w&&e.interpolatePadding(g,i.padding,he);const Qe=he===1?D:Be;e.setCenter(Qe.wrap());const Ue=$+s.ak(we);e.setZoom(he===1?P:Ue+ei(0,Qe.lat))},scaleOfZoom:Q,targetCenter:D,scaleOfMinZoom:ne,pixelPathLength:O}}static solveVectorScale(e,i,l,u,d){const g=u==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],C=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],P=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],A=i[0]*g[0]+i[1]*g[1]+i[2]*g[2],R=i[0]*w[0]+i[1]*w[1]+i[2]*w[2];return A+d*P===C+d*R||w[3]*(C-A)+g[3]*(R-P)+C*R==A*P?null:(A+g[3]-d*R-d*w[3])/(A-C-d*R+d*P)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class Fh{constructor(e){this._globe=e,this._mercatorCameraHelper=new jn,this._verticalPerspectiveCameraHelper=new Ni}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,l){this.currentHelper.handleMapControlsPan(e,i,l)}cameraForBoxAndBearing(e,i,l,u,d){return this.currentHelper.cameraForBoxAndBearing(e,i,l,u,d)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const yl=(h,e)=>s.y(h,e&&e.filter((i=>i.identifier!=="source.canvas"))),bp=s.bE();class zc extends s.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new Bt(St(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((l,u)=>this.getGlyphs(l,u))),this.dispatcher.registerMessageHandler("GI",((l,u)=>this.getImages(l,u))),this.imageManager=new et,this.imageManager.setEventedParent(this),this.glyphManager=new Ze(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new oe(256,512),this.crossTileSymbolIndex=new sr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",s.bG()),Dr().on(Kt,this._rtlPluginLoaded),this.on("data",(l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const d=u.getSource();if(d&&d.vectorLayerIds)for(const g in this._layers){const w=this._layers[g];w.source===d.id&&this._validateLayer(w)}}))}setGlobalStateProperty(e,i){var l,u,d;this._checkLoaded();const g=i===null?(d=(u=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||u===void 0?void 0:u.default)!==null&&d!==void 0?d:null:i;if(s.bH(g,this._globalState[e]))return this;this._globalState[e]=g;const w=this._findGlobalStateAffectedSources([e]);for(const C in this.sourceCaches)w.has(C)&&(this._reloadSource(C),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const i=[];for(const u in e)!s.bH(this._globalState[u],e[u].default)&&(i.push(u),this._globalState[u]=e[u].default);const l=this._findGlobalStateAffectedSources(i);for(const u in this.sourceCaches)l.has(u)&&(this._reloadSource(u),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const i=new Set;for(const l in this._layers){const u=this._layers[l],d=u.getLayoutAffectingGlobalStateRefs();for(const g of e)d.has(g)&&i.add(u.source)}return i}loadURL(e,i={},l){this.fire(new s.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;s.j(u,this._loadStyleRequest).then((g=>{this._loadStyleRequest=null,this._load(g.data,i,l)})).catch((g=>{this._loadStyleRequest=null,g&&!d.signal.aborted&&this.fire(new s.k(g))}))}loadJSON(e,i={},l){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ie.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,l)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(bp,{validate:!1})}_load(e,i,l){var u,d,g;const w=i.transformStyle?i.transformStyle(l,e):e;if(!i.validate||!yl(this,s.z(w))){this._loaded=!0,this.stylesheet=w;for(const C in w.sources)this.addSource(C,w.sources[C],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new te(this.stylesheet.light),this._setProjectionInternal(((u=this.stylesheet.projection)===null||u===void 0?void 0:u.type)||"mercator"),this.sky=new ge(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.setGlobalState((g=this.stylesheet.state)!==null&&g!==void 0?g:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){const e=s.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((i=>i.id)),this._layers={},this._serializedLayers=null;for(const i of e){const l=s.bJ(i);l.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=l}}_loadSprite(e,i=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(d,g,w,C){return s._(this,void 0,void 0,(function*(){const P=rt(d),A=w>1?"@2x":"",R={},D={};for(const{id:O,url:$}of P){const ee=g.transformRequest(qe($,A,".json"),"SpriteJSON");R[O]=s.j(ee,C);const Q=g.transformRequest(qe($,A,".png"),"SpriteImage");D[O]=Fe.getImage(Q,C)}return yield Promise.all([...Object.values(R),...Object.values(D)]),(function(O,$){return s._(this,void 0,void 0,(function*(){const ee={};for(const Q in O){ee[Q]={};const ne=ie.getImageCanvasContext((yield $[Q]).data),ue=(yield O[Q]).data;for(const _e in ue){const{width:he,height:we,x:Pe,y:pe,sdf:Be,pixelRatio:Qe,stretchX:Ue,stretchY:We,content:Je,textFitWidth:Nt,textFitHeight:Zt}=ue[_e];ee[Q][_e]={data:null,pixelRatio:Qe,sdf:Be,stretchX:Ue,stretchY:We,content:Je,textFitWidth:Nt,textFitHeight:Zt,spriteData:{width:he,height:we,x:Pe,y:pe,context:ne}}}}return ee}))})(R,D)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((d=>{if(this._spriteRequest=null,d)for(const g in d){this._spritesImagesIds[g]=[];const w=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter((C=>!(C in d))):[];for(const C of w)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in d[g]){const P=g==="default"?C:`${g}:${C}`;this._spritesImagesIds[g].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,d[g][C],!1):this.imageManager.addImage(P,d[g][C]),i&&(this._changedImages[P]=!0)}}})).catch((d=>{this._spriteRequest=null,u=d,this.fire(new s.k(u))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),l&&l(u)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const l=e.sourceLayer;if(!l)return;const u=i.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new s.k(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?s.bK(l):l);const u=[];for(const d of e)if(l[d]){const g=i?s.bK(l[d]):l[d];u.push(g)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const l of i){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){var e,i,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const g in this._updatedSources){const w=this._updatedSources[g];if(w==="reload")this._reloadSource(g);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const d=this.sourceCaches[u];l[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const u in l){const d=this.sourceCaches[u];!!l[u]!=!!d.used&&d.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var l;this._checkLoaded();const u=this.serialize();if(e=i.transformStyle?i.transformStyle(u,e):e,((l=i.validate)===null||l===void 0||l)&&yl(this,s.z(e)))return!1;(e=s.bK(e)).layers=s.bI(e.layers);const d=s.bL(u,e),g=this._getOperationsToPerform(d);if(g.unimplemented.length>0)throw new Error(`Unimplemented: ${g.unimplemented.join(", ")}.`);if(g.operations.length===0)return!1;for(const w of g.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push((()=>this.addLayer.apply(this,u.args)));break;case"removeLayer":i.push((()=>this.removeLayer.apply(this,u.args)));break;case"setPaintProperty":i.push((()=>this.setPaintProperty.apply(this,u.args)));break;case"setLayoutProperty":i.push((()=>this.setLayoutProperty.apply(this,u.args)));break;case"setFilter":i.push((()=>this.setFilter.apply(this,u.args)));break;case"addSource":i.push((()=>this.addSource.apply(this,u.args)));break;case"removeSource":i.push((()=>this.removeSource.apply(this,u.args)));break;case"setLayerZoomRange":i.push((()=>this.setLayerZoomRange.apply(this,u.args)));break;case"setLight":i.push((()=>this.setLight.apply(this,u.args)));break;case"setGeoJSONSourceData":i.push((()=>this.setGeoJSONSourceData.apply(this,u.args)));break;case"setGlyphs":i.push((()=>this.setGlyphs.apply(this,u.args)));break;case"setSprite":i.push((()=>this.setSprite.apply(this,u.args)));break;case"setTerrain":i.push((()=>this.map.setTerrain.apply(this,u.args)));break;case"setSky":i.push((()=>this.setSky.apply(this,u.args)));break;case"setProjection":this.setProjection.apply(this,u.args);break;case"setGlobalState":i.push((()=>this.setGlobalState.apply(this,u.args)));break;case"setTransition":i.push((()=>{}));break;default:l.push(u.command)}return{operations:i,unimplemented:l}}addImage(e,i){if(this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(s.z.source,`sources.${e}`,i,null,l))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const u=this.sourceCaches[e]=new cr(e,i,this.dispatcher);u.style=this,u.setEventedParent(this,(()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e}))),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new s.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new s.k(new Error(`Layer "${u}" already exists on this map.`)));let d;if(e.type==="custom"){if(yl(this,s.bM(e)))return;d=s.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=s.bK(e),e=s.e(e,{source:u})),this._validate(s.z.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;d=s.bJ(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}})}const g=i?this._order.indexOf(i):this._order.length;if(i&&g===-1)this.fire(new s.k(new Error(`Cannot add layer "${u}" before non-existing layer "${i}".`)));else{if(this._order.splice(g,0,u),this._layerOrderChanged=!0,this._layers[u]=d,this._removedLayers[u]&&d.source&&d.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new s.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=i?this._order.indexOf(i):this._order.length;i&&u===-1?this.fire(new s.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===i&&u.maxzoom===l||(i!=null&&(u.minzoom=i),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!s.bH(u.filter,i))return i==null?(u.setFilter(void 0),void this._updateLayer(u)):void(this._validate(s.z.filter,`layers.${u.id}.filter`,i,null,l)||(u.setFilter(s.bK(i)),this._updateLayer(u)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return s.bK(this.getLayer(e).filter)}setLayoutProperty(e,i,l,u={}){this._checkLoaded();const d=this.getLayer(e);d?s.bH(d.getLayoutProperty(i),l)||(d.setLayoutProperty(i,l,u),this._updateLayer(d)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const l=this.getLayer(e);if(l)return l.getLayoutProperty(i);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,l,u={}){this._checkLoaded();const d=this.getLayer(e);d?s.bH(d.getPaintProperty(i),l)||(d.setPaintProperty(i,l,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const l=e.source,u=e.sourceLayer,d=this.sourceCaches[l];if(d===void 0)return void this.fire(new s.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&u?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||u?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),d.setFeatureState(u,e.id,i)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new s.k(new Error(`The source '${l}' does not exist in the map's style.`)));const d=u.getSource().type,g=d==="vector"?e.sourceLayer:void 0;d!=="vector"||g?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(g,e.id,i):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,l=e.sourceLayer,u=this.sourceCaches[i];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=s.bN(this.sourceCaches,(d=>d.serialize())),i=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return s.bO({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,projection:u.projection,sources:e,layers:i,terrain:l},(d=>d!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=g=>this._layers[g].type==="fill-extrusion",l={},u=[];for(let g=this._order.length-1;g>=0;g--){const w=this._order[g];if(i(w)){l[w]=g;for(const C of e){const P=C[w];if(P)for(const A of P)u.push(A)}}}u.sort(((g,w)=>w.intersectionZ-g.intersectionZ));const d=[];for(let g=this._order.length-1;g>=0;g--){const w=this._order[g];if(i(w))for(let C=u.length-1;C>=0;C--){const P=u[C].feature;if(l[P.layer.id]<g)break;d.push(P),u.pop()}else for(const C of e){const P=C[w];if(P)for(const A of P)d.push(A.feature)}}return d}queryRenderedFeatures(e,i,l){i&&i.filter&&this._validate(s.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);const u={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const P of i.layers){const A=this._layers[P];if(!A)return this.fire(new s.k(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];u[A.source]=!0}}const d=[];i.availableImages=this._availableImages;const g=this._serializedAllLayers(),w=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,C=Object.assign(Object.assign({},i),{layers:w});for(const P in this.sourceCaches)i.layers&&!u[P]||d.push(vt(this.sourceCaches[P],this._layers,g,e,C,l,this.map.terrain?(A,R,D)=>this.map.terrain.getElevation(A,R,D):void 0));return this.placement&&d.push((function(P,A,R,D,O,$,ee){const Q={},ne=$.queryRenderedSymbols(D),ue=[];for(const _e of Object.keys(ne).map(Number))ue.push(ee[_e]);ue.sort(yt);for(const _e of ue){const he=_e.featureIndex.lookupSymbolFeatures(ne[_e.bucketInstanceId],A,_e.bucketIndex,_e.sourceLayerIndex,O.filter,O.layers,O.availableImages,P);for(const we in he){const Pe=Q[we]=Q[we]||[],pe=he[we];pe.sort(((Be,Qe)=>{const Ue=_e.featureSortOrder;if(Ue){const We=Ue.indexOf(Be.featureIndex);return Ue.indexOf(Qe.featureIndex)-We}return Qe.featureIndex-Be.featureIndex}));for(const Be of pe)Pe.push(Be)}}return(function(_e,he,we){for(const Pe in _e)for(const pe of _e[Pe])It(pe,we[he[Pe].source]);return _e})(Q,P,R)})(this._layers,g,this.sourceCaches,e,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,i){i&&i.filter&&this._validate(s.z.filter,"querySourceFeatures.filter",i.filter,null,i);const l=this.sourceCaches[e];return l?(function(u,d){const g=u.getRenderableIds().map((P=>u.getTileByID(P))),w=[],C={};for(let P=0;P<g.length;P++){const A=g[P],R=A.tileID.canonical.key;C[R]||(C[R]=!0,A.querySourceFeatures(w,d))}return w})(l,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const g in e)if(!s.bH(e[g],l[g])){u=!0;break}if(!u)return;const d={now:ie.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(d)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const g in e)if(!s.bH(e[g],l[g])){u=!0;break}if(!u)return;const d={now:ie.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(d)}_setProjectionInternal(e){const i=(function(l){if(Array.isArray(l)){const u=new gl({type:l});return{projection:u,transform:new Ls,cameraHelper:new Fh(u)}}switch(l){case"mercator":return{projection:new Pr,transform:new an,cameraHelper:new jn};case"globe":{const u=new gl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:u,transform:new Ls,cameraHelper:new Fh(u)}}case"vertical-perspective":return{projection:new Ja,transform:new zs,cameraHelper:new Ni};default:return s.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Pr,transform:new an,cameraHelper:new jn}}})(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,i,l,u,d={}){return(!d||d.validate!==!1)&&yl(this,e.call(s.z,s.e({key:i,style:this.serialize(),value:l,styleSpec:s.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Dr().off(Kt,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const l=this.sourceCaches[i];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,l,u,d=!1){let g=!1,w=!1;const C={};for(const P of this._order){const A=this._layers[P];if(A.type!=="symbol")continue;if(!C[A.source]){const D=this.sourceCaches[A.source];C[A.source]=D.getRenderableIds(!0).map((O=>D.getTileByID(O))).sort(((O,$)=>$.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan($.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(A,C[A.source],e.center.lng);g=g||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ie.now(),e.zoom))&&(this.pauseablePlacement=new On(e,this.map.terrain,this._order,d,i,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ie.now()),w=!0),g&&this.pauseablePlacement.placement.setStale()),w||g)for(const P of this._order){const A=this._layers[P];A.type==="symbol"&&this.placement.updateLayerOpacities(A,C[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ie.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return s._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[i.source];return u&&u.setDependencies(i.tileID.key,i.type,i.icons),l}))}getGlyphs(e,i){return s._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(i.stacks),u=this.sourceCaches[i.source];return u&&u.setDependencies(i.tileID.key,i.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(s.z.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,l={},u){this._checkLoaded();const d=[{id:e,url:i}],g=[...rt(this.stylesheet.sprite),...d];this._validate(s.z.sprite,"sprite",g,null,l)||(this.stylesheet.sprite=g,this._loadSprite(d,!0,u))}removeSprite(e){this._checkLoaded();const i=rt(this.stylesheet.sprite);if(i.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;i.splice(i.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return rt(this.stylesheet.sprite)}setSprite(e,i={},l){this._checkLoaded(),e&&this._validate(s.z.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var wp=s.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,l,u,d,g,w,C,P){this.context=e;let A=this.boundPaintVertexBuffers.length!==u.length;for(let R=0;!A&&R<u.length;R++)this.boundPaintVertexBuffers[R]!==u[R]&&(A=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==d||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==P?this.freshBind(i,l,u,d,g,w,C,P):(e.bindVertexArray.set(this.vao),w&&w.bind(),d&&d.dynamicDraw&&d.bind(),C&&C.bind(),P&&P.bind())}freshBind(e,i,l,u,d,g,w,C){const P=e.numAttributes,A=this.context,R=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=C,i.enableAttributes(R,e);for(const D of l)D.enableAttributes(R,e);g&&g.enableAttributes(R,e),w&&w.enableAttributes(R,e),C&&C.enableAttributes(R,e),i.bind(),i.setVertexAttribPointers(R,e,d);for(const D of l)D.bind(),D.setVertexAttribPointers(R,e,d);g&&(g.bind(),g.setVertexAttribPointers(R,e,d)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,e,d)),C&&(C.bind(),C.setVertexAttribPointers(R,e,d)),A.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const xl=(h,e,i,l,u)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):s.bf.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?0:i?i.calculateFogBlendOpacity(l):0,u_horizon_color:i?i.properties.get("horizon-color"):s.bf.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:u?1:0}),Lc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ao(h){const e=[];for(let i=0;i<h.length;i++){if(h[i]===null)continue;const l=h[i].split(" ");e.push(l.pop())}return e}class Dc{constructor(e,i,l,u,d,g,w,C,P=[]){const A=e.gl;this.program=A.createProgram();const R=Ao(i.staticAttributes),D=l?l.getBinderAttributes():[],O=R.concat(D),$=Ur.prelude.staticUniforms?Ao(Ur.prelude.staticUniforms):[],ee=w.staticUniforms?Ao(w.staticUniforms):[],Q=i.staticUniforms?Ao(i.staticUniforms):[],ne=l?l.getBinderUniforms():[],ue=$.concat(ee).concat(Q).concat(ne),_e=[];for(const Ue of ue)_e.indexOf(Ue)<0&&_e.push(Ue);const he=l?l.defines():[];ga(A)&&he.unshift("#version 300 es"),d&&he.push("#define OVERDRAW_INSPECTOR;"),g&&he.push("#define TERRAIN3D;"),C&&he.push(C),P&&he.push(...P);let we=he.concat(Ur.prelude.fragmentSource,w.fragmentSource,i.fragmentSource).join(`
`),Pe=he.concat(Ur.prelude.vertexSource,w.vertexSource,i.vertexSource).join(`
`);ga(A)||(we=(function(Ue){return Ue.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(we),Pe=(function(Ue){return Ue.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Pe));const pe=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(pe,we),A.compileShader(pe),!A.getShaderParameter(pe,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(pe)}`);A.attachShader(this.program,pe);const Be=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Be,Pe),A.compileShader(Be),!A.getShaderParameter(Be,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(Be)}`);A.attachShader(this.program,Be),this.attributes={};const Qe={};this.numAttributes=O.length;for(let Ue=0;Ue<this.numAttributes;Ue++)O[Ue]&&(A.bindAttribLocation(this.program,Ue,O[Ue]),this.attributes[O[Ue]]=Ue);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(Be),A.deleteShader(pe);for(let Ue=0;Ue<_e.length;Ue++){const We=_e[Ue];if(We&&!Qe[We]){const Je=A.getUniformLocation(this.program,We);Je&&(Qe[We]=Je)}}this.fixedUniforms=u(e,Qe),this.terrainUniforms=((Ue,We)=>({u_depth:new s.bP(Ue,We.u_depth),u_terrain:new s.bP(Ue,We.u_terrain),u_terrain_dim:new s.bg(Ue,We.u_terrain_dim),u_terrain_matrix:new s.bR(Ue,We.u_terrain_matrix),u_terrain_unpack:new s.bS(Ue,We.u_terrain_unpack),u_terrain_exaggeration:new s.bg(Ue,We.u_terrain_exaggeration)}))(e,Qe),this.projectionUniforms=((Ue,We)=>({u_projection_matrix:new s.bR(Ue,We.u_projection_matrix),u_projection_tile_mercator_coords:new s.bS(Ue,We.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bS(Ue,We.u_projection_clipping_plane),u_projection_transition:new s.bg(Ue,We.u_projection_transition),u_projection_fallback_matrix:new s.bR(Ue,We.u_projection_fallback_matrix)}))(e,Qe),this.binderUniforms=l?l.getUniforms(e,Qe):[]}draw(e,i,l,u,d,g,w,C,P,A,R,D,O,$,ee,Q,ne,ue,_e){const he=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(d),e.setCullFace(g),C){e.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,C.depthTexture),e.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,C.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(C[Pe])}if(P)for(const Pe in P)this.projectionUniforms[Lc[Pe]].set(P[Pe]);if(w)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(w[Pe]);Q&&Q.setUniforms(e,this.binderUniforms,$,{zoom:ee});let we=0;switch(i){case he.LINES:we=2;break;case he.TRIANGLES:we=3;break;case he.LINE_STRIP:we=1}for(const Pe of O.get()){const pe=Pe.vaos||(Pe.vaos={});(pe[A]||(pe[A]=new Tp)).bind(e,this,R,Q?Q.getPaintVertexBuffers():[],D,Pe.vertexOffset,ne,ue,_e),he.drawElements(i,Pe.primitiveLength*we,he.UNSIGNED_SHORT,Pe.primitiveOffset*we*2)}}}function bl(h,e,i){const l=1/s.aC(i,1,e.transform.tileZoom),u=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,e.transform.tileZoom)/u,g=d*(i.tileID.canonical.x+i.tileID.wrap*u),w=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[l,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[g>>16,w>>16],u_pixel_coord_lower:[65535&g,65535&w]}}const Pa=(h,e,i,l)=>{const u=h.style.light,d=u.properties.get("position"),g=[d.x,d.y,d.z],w=s.bV();u.properties.get("anchor")==="viewport"&&s.bW(w,h.transform.bearingInRadians),s.bX(g,g,w);const C=h.transform.transformLightDirection(g),P=u.properties.get("color");return{u_lightpos:g,u_lightpos_globe:C,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:l}},Cp=(h,e,i,l,u,d,g)=>s.e(Pa(h,e,i,l),bl(d,h,g),{u_height_factor:-Math.pow(2,u.overscaledZ)/g.tileSize/8}),wl=(h,e,i,l)=>s.e(bl(e,h,i),{u_fill_translate:l}),Ds=(h,e)=>({u_world:h,u_fill_translate:e}),Rs=(h,e,i,l,u)=>s.e(wl(h,e,i,u),{u_world:l}),Sp=(h,e,i,l,u)=>{const d=h.transform;let g,w,C=0;if(i.paint.get("circle-pitch-alignment")==="map"){const P=s.aC(e,1,d.zoom);g=!0,w=[P,P],C=P/(s.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*u}else g=!1,w=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+g,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:C,u_translate:l}},Tl=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),Pp=h=>({u_viewport_size:[h.width,h.height]}),Eo=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),Oh=(h,e,i,l)=>{const u=s.aC(h,1,e)/(s.$*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:s.aC(h,1,e),u_intensity:i,u_globe_extrude_scale:u}},Rc=(h,e,i,l)=>{const u=s.L();s.bY(u,0,h.width,h.height,0,0,1);const d=h.context.gl;return{u_matrix:u,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:i,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Ip=(h,e,i)=>{const l=i.paint.get("hillshade-accent-color");let u;switch(i.paint.get("hillshade-method")){case"basic":u=4;break;case"combined":u=1;break;case"igor":u=2;break;case"multidirectional":u=3;break;default:u=0}const d=i.getIlluminationProperties();for(let g=0;g<d.directionRadians.length;g++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(d.directionRadians[g]+=h.transform.bearingInRadians);return{u_image:0,u_latrange:Bc(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:d.altitudeRadians,u_azimuths:d.directionRadians,u_accent:l,u_method:u,u_highlights:d.highlightColor,u_shadows:d.shadowColor}},Nh=(h,e)=>{const i=e.stride,l=s.L();return s.bY(l,0,s.$,-s.$,0,0,1),s.M(l,l,[0,-s.$,0]),{u_matrix:l,u_image:1,u_dimension:[i,i],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function Bc(h,e){const i=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new s.a1(0,l/i).toLngLat().lat,new s.a1(0,(l+1)/i).toLngLat().lat]}const jh=(h,e,i=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:i,u_opacity:h.paint.get("color-relief-opacity")}),Cl=(h,e,i,l)=>{const u=h.transform;return{u_translation:Oc(h,e,i),u_ratio:l/s.aC(e,1,u.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Vh=(h,e,i,l,u)=>s.e(Cl(h,e,i,l),{u_image:0,u_image_height:u}),qh=(h,e,i,l,u)=>{const d=h.transform,g=Fc(e,d);return{u_translation:Oc(h,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:l/s.aC(e,1,d.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[g,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},zo=(h,e,i,l,u,d)=>{const g=h.lineAtlas,w=Fc(e,h.transform),C=i.layout.get("line-cap")==="round",P=g.getDash(u.from,C),A=g.getDash(u.to,C),R=P.width*d.fromScale,D=A.width*d.toScale;return s.e(Cl(h,e,i,l),{u_patternscale_a:[w/R,-P.height/2],u_patternscale_b:[w/D,-A.height/2],u_sdfgamma:g.width/(256*Math.min(R,D)*h.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:A.y,u_mix:d.t})};function Fc(h,e){return 1/s.aC(h,1,e.tileZoom)}function Oc(h,e,i){return s.aD(h.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Bs=(h,e,i,l,u)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(g=l.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=l.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Mp(l.paint.get("raster-hue-rotate")),u_coords_top:[u[0].x,u[0].y,u[1].x,u[1].y],u_coords_bottom:[u[3].x,u[3].y,u[2].x,u[2].y]};var d,g};function Mp(h){h*=Math.PI/180;const e=Math.sin(h),i=Math.cos(h);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Fs=(h,e,i,l,u,d,g,w,C,P,A,R,D)=>{const O=g.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:O.width/O.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:C,u_is_text:+A,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:d,u_texsize:R,u_texture:0,u_translation:P,u_pitched_scale:D}},Zh=(h,e,i,l,u,d,g,w,C,P,A,R,D,O)=>{const $=g.transform;return s.e(Fs(h,e,i,l,u,d,g,w,C,P,A,R,O),{u_gamma_scale:l?Math.cos($.pitch*Math.PI/180)*$.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:1})},kp=(h,e,i,l,u,d,g,w,C,P,A,R,D)=>s.e(Zh(h,e,i,l,u,d,g,w,C,P,!0,A,0,D),{u_texsize_icon:R,u_texture_icon:1}),Uh=(h,e)=>({u_opacity:h,u_color:e}),$h=(h,e,i,l,u)=>s.e((function(d,g,w,C){const P=w.imageManager.getPattern(d.from.toString()),A=w.imageManager.getPattern(d.to.toString()),{width:R,height:D}=w.imageManager.getPixelSize(),O=Math.pow(2,C.tileID.overscaledZ),$=C.tileSize*Math.pow(2,w.transform.tileZoom)/O,ee=$*(C.tileID.canonical.x+C.tileID.wrap*O),Q=$*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[R,D],u_mix:g.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/s.aC(C,1,w.transform.tileZoom),u_pixel_coord_upper:[ee>>16,Q>>16],u_pixel_coord_lower:[65535&ee,65535&Q]}})(i,u,e,l),{u_opacity:h}),Nc=(h,e)=>{},jc={fillExtrusion:(h,e)=>({u_lightpos:new s.bT(h,e.u_lightpos),u_lightpos_globe:new s.bT(h,e.u_lightpos_globe),u_lightintensity:new s.bg(h,e.u_lightintensity),u_lightcolor:new s.bT(h,e.u_lightcolor),u_vertical_gradient:new s.bg(h,e.u_vertical_gradient),u_opacity:new s.bg(h,e.u_opacity),u_fill_translate:new s.bU(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new s.bT(h,e.u_lightpos),u_lightpos_globe:new s.bT(h,e.u_lightpos_globe),u_lightintensity:new s.bg(h,e.u_lightintensity),u_lightcolor:new s.bT(h,e.u_lightcolor),u_vertical_gradient:new s.bg(h,e.u_vertical_gradient),u_height_factor:new s.bg(h,e.u_height_factor),u_opacity:new s.bg(h,e.u_opacity),u_fill_translate:new s.bU(h,e.u_fill_translate),u_image:new s.bP(h,e.u_image),u_texsize:new s.bU(h,e.u_texsize),u_pixel_coord_upper:new s.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(h,e.u_pixel_coord_lower),u_scale:new s.bT(h,e.u_scale),u_fade:new s.bg(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new s.bU(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new s.bP(h,e.u_image),u_texsize:new s.bU(h,e.u_texsize),u_pixel_coord_upper:new s.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(h,e.u_pixel_coord_lower),u_scale:new s.bT(h,e.u_scale),u_fade:new s.bg(h,e.u_fade),u_fill_translate:new s.bU(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new s.bU(h,e.u_world),u_fill_translate:new s.bU(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new s.bU(h,e.u_world),u_image:new s.bP(h,e.u_image),u_texsize:new s.bU(h,e.u_texsize),u_pixel_coord_upper:new s.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(h,e.u_pixel_coord_lower),u_scale:new s.bT(h,e.u_scale),u_fade:new s.bg(h,e.u_fade),u_fill_translate:new s.bU(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new s.bg(h,e.u_camera_to_center_distance),u_scale_with_map:new s.bP(h,e.u_scale_with_map),u_pitch_with_map:new s.bP(h,e.u_pitch_with_map),u_extrude_scale:new s.bU(h,e.u_extrude_scale),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new s.bg(h,e.u_globe_extrude_scale),u_translate:new s.bU(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new s.bU(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new s.bU(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new s.bQ(h,e.u_color),u_overlay:new s.bP(h,e.u_overlay),u_overlay_scale:new s.bg(h,e.u_overlay_scale)}),depth:Nc,clippingMask:Nc,heatmap:(h,e)=>({u_extrude_scale:new s.bg(h,e.u_extrude_scale),u_intensity:new s.bg(h,e.u_intensity),u_globe_extrude_scale:new s.bg(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new s.bR(h,e.u_matrix),u_world:new s.bU(h,e.u_world),u_image:new s.bP(h,e.u_image),u_color_ramp:new s.bP(h,e.u_color_ramp),u_opacity:new s.bg(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new s.bP(h,e.u_image),u_latrange:new s.bU(h,e.u_latrange),u_exaggeration:new s.bg(h,e.u_exaggeration),u_altitudes:new s.b_(h,e.u_altitudes),u_azimuths:new s.b_(h,e.u_azimuths),u_accent:new s.bQ(h,e.u_accent),u_method:new s.bP(h,e.u_method),u_shadows:new s.bZ(h,e.u_shadows),u_highlights:new s.bZ(h,e.u_highlights)}),hillshadePrepare:(h,e)=>({u_matrix:new s.bR(h,e.u_matrix),u_image:new s.bP(h,e.u_image),u_dimension:new s.bU(h,e.u_dimension),u_zoom:new s.bg(h,e.u_zoom),u_unpack:new s.bS(h,e.u_unpack)}),colorRelief:(h,e)=>({u_image:new s.bP(h,e.u_image),u_unpack:new s.bS(h,e.u_unpack),u_dimension:new s.bU(h,e.u_dimension),u_elevation_stops:new s.bP(h,e.u_elevation_stops),u_color_stops:new s.bP(h,e.u_color_stops),u_color_ramp_size:new s.bP(h,e.u_color_ramp_size),u_opacity:new s.bg(h,e.u_opacity)}),line:(h,e)=>({u_translation:new s.bU(h,e.u_translation),u_ratio:new s.bg(h,e.u_ratio),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new s.bU(h,e.u_translation),u_ratio:new s.bg(h,e.u_ratio),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(h,e.u_units_to_pixels),u_image:new s.bP(h,e.u_image),u_image_height:new s.bg(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new s.bU(h,e.u_translation),u_texsize:new s.bU(h,e.u_texsize),u_ratio:new s.bg(h,e.u_ratio),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_image:new s.bP(h,e.u_image),u_units_to_pixels:new s.bU(h,e.u_units_to_pixels),u_scale:new s.bT(h,e.u_scale),u_fade:new s.bg(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new s.bU(h,e.u_translation),u_ratio:new s.bg(h,e.u_ratio),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new s.bU(h,e.u_units_to_pixels),u_patternscale_a:new s.bU(h,e.u_patternscale_a),u_patternscale_b:new s.bU(h,e.u_patternscale_b),u_sdfgamma:new s.bg(h,e.u_sdfgamma),u_image:new s.bP(h,e.u_image),u_tex_y_a:new s.bg(h,e.u_tex_y_a),u_tex_y_b:new s.bg(h,e.u_tex_y_b),u_mix:new s.bg(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new s.bU(h,e.u_tl_parent),u_scale_parent:new s.bg(h,e.u_scale_parent),u_buffer_scale:new s.bg(h,e.u_buffer_scale),u_fade_t:new s.bg(h,e.u_fade_t),u_opacity:new s.bg(h,e.u_opacity),u_image0:new s.bP(h,e.u_image0),u_image1:new s.bP(h,e.u_image1),u_brightness_low:new s.bg(h,e.u_brightness_low),u_brightness_high:new s.bg(h,e.u_brightness_high),u_saturation_factor:new s.bg(h,e.u_saturation_factor),u_contrast_factor:new s.bg(h,e.u_contrast_factor),u_spin_weights:new s.bT(h,e.u_spin_weights),u_coords_top:new s.bS(h,e.u_coords_top),u_coords_bottom:new s.bS(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new s.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(h,e.u_is_size_feature_constant),u_size_t:new s.bg(h,e.u_size_t),u_size:new s.bg(h,e.u_size),u_camera_to_center_distance:new s.bg(h,e.u_camera_to_center_distance),u_pitch:new s.bg(h,e.u_pitch),u_rotate_symbol:new s.bP(h,e.u_rotate_symbol),u_aspect_ratio:new s.bg(h,e.u_aspect_ratio),u_fade_change:new s.bg(h,e.u_fade_change),u_label_plane_matrix:new s.bR(h,e.u_label_plane_matrix),u_coord_matrix:new s.bR(h,e.u_coord_matrix),u_is_text:new s.bP(h,e.u_is_text),u_pitch_with_map:new s.bP(h,e.u_pitch_with_map),u_is_along_line:new s.bP(h,e.u_is_along_line),u_is_variable_anchor:new s.bP(h,e.u_is_variable_anchor),u_texsize:new s.bU(h,e.u_texsize),u_texture:new s.bP(h,e.u_texture),u_translation:new s.bU(h,e.u_translation),u_pitched_scale:new s.bg(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new s.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(h,e.u_is_size_feature_constant),u_size_t:new s.bg(h,e.u_size_t),u_size:new s.bg(h,e.u_size),u_camera_to_center_distance:new s.bg(h,e.u_camera_to_center_distance),u_pitch:new s.bg(h,e.u_pitch),u_rotate_symbol:new s.bP(h,e.u_rotate_symbol),u_aspect_ratio:new s.bg(h,e.u_aspect_ratio),u_fade_change:new s.bg(h,e.u_fade_change),u_label_plane_matrix:new s.bR(h,e.u_label_plane_matrix),u_coord_matrix:new s.bR(h,e.u_coord_matrix),u_is_text:new s.bP(h,e.u_is_text),u_pitch_with_map:new s.bP(h,e.u_pitch_with_map),u_is_along_line:new s.bP(h,e.u_is_along_line),u_is_variable_anchor:new s.bP(h,e.u_is_variable_anchor),u_texsize:new s.bU(h,e.u_texsize),u_texture:new s.bP(h,e.u_texture),u_gamma_scale:new s.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_is_halo:new s.bP(h,e.u_is_halo),u_translation:new s.bU(h,e.u_translation),u_pitched_scale:new s.bg(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new s.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(h,e.u_is_size_feature_constant),u_size_t:new s.bg(h,e.u_size_t),u_size:new s.bg(h,e.u_size),u_camera_to_center_distance:new s.bg(h,e.u_camera_to_center_distance),u_pitch:new s.bg(h,e.u_pitch),u_rotate_symbol:new s.bP(h,e.u_rotate_symbol),u_aspect_ratio:new s.bg(h,e.u_aspect_ratio),u_fade_change:new s.bg(h,e.u_fade_change),u_label_plane_matrix:new s.bR(h,e.u_label_plane_matrix),u_coord_matrix:new s.bR(h,e.u_coord_matrix),u_is_text:new s.bP(h,e.u_is_text),u_pitch_with_map:new s.bP(h,e.u_pitch_with_map),u_is_along_line:new s.bP(h,e.u_is_along_line),u_is_variable_anchor:new s.bP(h,e.u_is_variable_anchor),u_texsize:new s.bU(h,e.u_texsize),u_texsize_icon:new s.bU(h,e.u_texsize_icon),u_texture:new s.bP(h,e.u_texture),u_texture_icon:new s.bP(h,e.u_texture_icon),u_gamma_scale:new s.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new s.bg(h,e.u_device_pixel_ratio),u_is_halo:new s.bP(h,e.u_is_halo),u_translation:new s.bU(h,e.u_translation),u_pitched_scale:new s.bg(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new s.bg(h,e.u_opacity),u_color:new s.bQ(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new s.bg(h,e.u_opacity),u_image:new s.bP(h,e.u_image),u_pattern_tl_a:new s.bU(h,e.u_pattern_tl_a),u_pattern_br_a:new s.bU(h,e.u_pattern_br_a),u_pattern_tl_b:new s.bU(h,e.u_pattern_tl_b),u_pattern_br_b:new s.bU(h,e.u_pattern_br_b),u_texsize:new s.bU(h,e.u_texsize),u_mix:new s.bg(h,e.u_mix),u_pattern_size_a:new s.bU(h,e.u_pattern_size_a),u_pattern_size_b:new s.bU(h,e.u_pattern_size_b),u_scale_a:new s.bg(h,e.u_scale_a),u_scale_b:new s.bg(h,e.u_scale_b),u_pixel_coord_upper:new s.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bg(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new s.bP(h,e.u_texture),u_ele_delta:new s.bg(h,e.u_ele_delta),u_fog_matrix:new s.bR(h,e.u_fog_matrix),u_fog_color:new s.bQ(h,e.u_fog_color),u_fog_ground_blend:new s.bg(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bg(h,e.u_fog_ground_blend_opacity),u_horizon_color:new s.bQ(h,e.u_horizon_color),u_horizon_fog_blend:new s.bg(h,e.u_horizon_fog_blend),u_is_globe_mode:new s.bg(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new s.bg(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new s.bP(h,e.u_texture),u_terrain_coords_id:new s.bg(h,e.u_terrain_coords_id),u_ele_delta:new s.bg(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new s.bg(h,e.u_input),u_output_expected:new s.bg(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new s.bT(h,e.u_sun_pos),u_atmosphere_blend:new s.bg(h,e.u_atmosphere_blend),u_globe_position:new s.bT(h,e.u_globe_position),u_globe_radius:new s.bg(h,e.u_globe_radius),u_inv_proj_matrix:new s.bR(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new s.bQ(h,e.u_sky_color),u_horizon_color:new s.bQ(h,e.u_horizon_color),u_horizon:new s.bU(h,e.u_horizon),u_horizon_normal:new s.bU(h,e.u_horizon_normal),u_sky_horizon_blend:new s.bg(h,e.u_sky_horizon_blend),u_sky_blend:new s.bg(h,e.u_sky_blend)})};class Gh{constructor(e,i,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qa{constructor(e,i,l,u){this.length=i.length,this.attributes=l,this.itemSize=i.bytesPerElement,this.dynamicDraw=u,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let l=0;l<this.attributes.length;l++){const u=i.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,i,l){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],g=i.attributes[d.name];g!==void 0&&e.vertexAttribPointer(g,d.components,e[Sl[d.type]],!1,this.itemSize,d.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vc extends Pn{getDefault(){return s.bf.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class qc extends Pn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Hh extends Pn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Zc extends Pn{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Lo extends Pn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Uc extends Pn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ap extends Pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ep extends Pn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class zp extends Pn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class Lp extends Pn{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Wh extends Pn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Dp extends Pn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Xh extends Pn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class Pl extends Pn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Il extends Pn{getDefault(){return s.bf.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ml extends Pn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class $c extends Pn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class Do extends Pn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Os extends Pn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ts extends Pn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class va extends Pn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Yh extends Pn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Kh extends Pn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Gc extends Pn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ro extends Pn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class kl extends Pn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Al extends Pn{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ns extends Pn{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const l=this.gl;ga(l)?l.bindVertexArray(e):(i=l.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class El extends Pn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Jh extends Pn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class rs extends Pn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class fo extends Pn{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class Qh extends fo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Hc extends fo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class on extends fo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const js="Framebuffer is not complete";class Rp{constructor(e,i,l,u,d){this.context=e,this.width=i,this.height=l;const g=e.gl,w=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new Qh(e,w),u)this.depthAttachment=d?new on(e,w):new Hc(e,w);else if(d)throw new Error("Stencil cannot be set without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error(js)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class ed{constructor(e){var i,l;if(this.gl=e,this.clearColor=new Vc(this),this.clearDepth=new qc(this),this.clearStencil=new Hh(this),this.colorMask=new Zc(this),this.depthMask=new Lo(this),this.stencilMask=new Uc(this),this.stencilFunc=new Ap(this),this.stencilOp=new Ep(this),this.stencilTest=new zp(this),this.depthRange=new Lp(this),this.depthTest=new Wh(this),this.depthFunc=new Dp(this),this.blend=new Xh(this),this.blendFunc=new Pl(this),this.blendColor=new Il(this),this.blendEquation=new Ml(this),this.cullFace=new $c(this),this.cullFaceSide=new Do(this),this.frontFace=new Os(this),this.program=new ts(this),this.activeTexture=new va(this),this.viewport=new Yh(this),this.bindFramebuffer=new Kh(this),this.bindRenderbuffer=new Gc(this),this.bindTexture=new Ro(this),this.bindVertexBuffer=new kl(this),this.bindElementBuffer=new Al(this),this.bindVertexArray=new Ns(this),this.pixelStoreUnpack=new El(this),this.pixelStoreUnpackPremultiplyAlpha=new Jh(this),this.pixelStoreUnpackFlipY=new rs(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ga(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new Gh(this,e,i)}createVertexBuffer(e,i,l){return new Qa(this,e,i,l)}createRenderbuffer(e,i,l){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,e,i,l),this.bindRenderbuffer.set(null),d}createFramebuffer(e,i,l,u){return new Rp(this,e,i,l,u)}clear({color:e,depth:i,stencil:l}){const u=this.gl;let d=0;e&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),l!==void 0&&(d|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){s.bH(e.blendFunction,zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ga(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return ga(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let mo;function td(h,e,i,l,u){const d=h.context,g=h.transform,w=d.gl,C=h.useProgram("collisionBox"),P=[];let A=0,R=0;for(let ne=0;ne<l.length;ne++){const ue=l[ne],_e=e.getTile(ue).getBucket(i);if(!_e)continue;const he=u?_e.textCollisionBox:_e.iconCollisionBox,we=_e.collisionCircleArray;we.length>0&&(P.push({circleArray:we,circleOffset:R,coord:ue}),A+=we.length/4,R=A),he&&C.draw(d,w.LINES,$r.disabled,cn.disabled,h.colorModeForRenderPass(),Lr.disabled,Tl(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(ue),g.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,h.transform.zoom,null,null,he.collisionVertexBuffer)}if(!u||!P.length)return;const D=h.useProgram("collisionCircle"),O=new s.b$;O.resize(4*A),O._trim();let $=0;for(const ne of P)for(let ue=0;ue<ne.circleArray.length/4;ue++){const _e=4*ue,he=ne.circleArray[_e+0],we=ne.circleArray[_e+1],Pe=ne.circleArray[_e+2],pe=ne.circleArray[_e+3];O.emplace($++,he,we,Pe,pe,0),O.emplace($++,he,we,Pe,pe,1),O.emplace($++,he,we,Pe,pe,2),O.emplace($++,he,we,Pe,pe,3)}(!mo||mo.length<2*A)&&(mo=(function(ne){const ue=2*ne,_e=new s.c1;_e.resize(ue),_e._trim();for(let he=0;he<ue;he++){const we=6*he;_e.uint16[we+0]=4*he+0,_e.uint16[we+1]=4*he+1,_e.uint16[we+2]=4*he+2,_e.uint16[we+3]=4*he+2,_e.uint16[we+4]=4*he+3,_e.uint16[we+5]=4*he+0}return _e})(A));const ee=d.createIndexBuffer(mo,!0),Q=d.createVertexBuffer(O,s.c0.members,!0);for(const ne of P){const ue=Pp(h.transform);D.draw(d,w.TRIANGLES,$r.disabled,cn.disabled,h.colorModeForRenderPass(),Lr.disabled,ue,h.style.map.terrain&&h.style.map.terrain.getTerrainData(ne.coord),null,i.id,Q,ee,s.aM.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,h.transform.zoom,null,null,null)}Q.destroy(),ee.destroy()}const Bp=s.ag(new Float32Array(16));function rd(h,e,i,l,u,d){const{horizontalAlign:g,verticalAlign:w}=s.aH(h);return new s.P((-(g-.5)*e/u+l[0])*d,(-(w-.5)*i/u+l[1])*d)}function Fp(h,e,i,l,u,d){const g=e.tileAnchorPoint.add(new s.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(d);i||(w=w.rotate(-u));const C=g.add(w);return hr(C.x,C.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const w=Yt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),C=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return h.add(l.rotate(C))}return h.add(l)}function Wc(h,e,i,l,u,d,g,w,C,P,A,R){const D=h.text.placedSymbolArray,O=h.text.dynamicLayoutVertexArray,$=h.icon.dynamicLayoutVertexArray,ee={};O.clear();for(let Q=0;Q<D.length;Q++){const ne=D.get(Q),ue=ne.hidden||!ne.crossTileID||h.allowVerticalPlacement&&!ne.placedOrientation?null:l[ne.crossTileID];if(ue){const _e=new s.P(ne.anchorX,ne.anchorY),he={getElevation:R,width:u.width,height:u.height,pitchedLabelPlaneMatrix:d,pitchWithMap:i,transform:u,tileAnchorPoint:_e,translation:P,unwrappedTileID:A},we=i?Er(_e.x,_e.y,he):Yt(_e.x,_e.y,he),Pe=ht(u.cameraToCenterDistance,we.signedDistanceFromCamera);let pe=s.ap(h.textSizeData,w,ne)*Pe/s.aB;i&&(pe*=h.tilePixelRatio/g);const{width:Be,height:Qe,anchor:Ue,textOffset:We,textBoxScale:Je}=ue,Nt=rd(Ue,Be,Qe,We,Je,pe),Zt=u.getPitchedTextCorrection(_e.x+P[0],_e.y+P[1],A),Tt=Fp(we.point,he,e,Nt,-u.bearingInRadians,Zt),mr=h.allowVerticalPlacement&&ne.placedOrientation===s.ao.vertical?Math.PI/2:0;for(let Jr=0;Jr<ne.numGlyphs;Jr++)s.av(O,Tt,mr);C&&ne.associatedIconIndex>=0&&(ee[ne.associatedIconIndex]={shiftedAnchor:Tt,angle:mr})}else sn(ne.numGlyphs,O)}if(C){$.clear();const Q=h.icon.placedSymbolArray;for(let ne=0;ne<Q.length;ne++){const ue=Q.get(ne);if(ue.hidden)sn(ue.numGlyphs,$);else{const _e=ee[ne];if(_e)for(let he=0;he<ue.numGlyphs;he++)s.av($,_e.shiftedAnchor,_e.angle);else sn(ue.numGlyphs,$)}}h.icon.dynamicLayoutVertexBuffer.updateData($)}h.text.dynamicLayoutVertexBuffer.updateData(O)}function zl(h,e,i){return i.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Vs(h,e,i,l,u,d,g,w,C,P,A,R,D){const O=h.context,$=O.gl,ee=h.transform,Q=w==="map",ne=C==="map",ue=w!=="viewport"&&i.layout.get("symbol-placement")!=="point",_e=Q&&!ne&&!ue,he=!i.layout.get("symbol-sort-key").isConstant();let we=!1;const Pe=h.getDepthModeForSublayer(0,$r.ReadOnly),pe=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[],Qe=ee.getCircleRadiusCorrection();for(const Ue of l){const We=e.getTile(Ue),Je=We.getBucket(i);if(!Je)continue;const Nt=u?Je.text:Je.icon;if(!Nt||!Nt.segments.get().length||!Nt.hasVisibleVertices)continue;const Zt=Nt.programConfigurations.get(i.id),Tt=u||Je.sdfIcons,mr=u?Je.textSizeData:Je.iconSizeData,Jr=ne||ee.pitch!==0,An=h.useProgram(zl(Tt,u,Je),Zt),Bn=s.an(mr,ee.zoom),Ln=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Ue);let Hn,Kn,Kr,Fn,si=[0,0],fi=null;if(u)Kn=We.glyphAtlasTexture,Kr=$.LINEAR,Hn=We.glyphAtlasTexture.size,Je.iconsInText&&(si=We.imageAtlasTexture.size,fi=We.imageAtlasTexture,Fn=Jr||h.options.rotating||h.options.zooming||mr.kind==="composite"||mr.kind==="camera"?$.LINEAR:$.NEAREST);else{const li=i.layout.get("icon-size").constantOr(0)!==1||Je.iconsNeedLinear;Kn=We.imageAtlasTexture,Kr=Tt||h.options.rotating||h.options.zooming||li||Jr?$.LINEAR:$.NEAREST,Hn=We.imageAtlasTexture.size}const Ti=s.aC(We,1,h.transform.zoom),Ui=mn(Q,h.transform,Ti),za=s.L();s.aq(za,Ui);const go=jt(ne,Q,h.transform,Ti),vo=s.aD(ee,We,d,g),fs=ee.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),ms=pe&&Je.hasTextData(),qo=i.layout.get("icon-text-fit")!=="none"&&ms&&Je.hasIconData();if(ue){const li=h.style.map.terrain?(ba,ci)=>h.style.map.terrain.getElevation(Ue,ba,ci):null,mi=i.layout.get("text-rotation-alignment")==="map";Yr(Je,h,u,Ui,za,ne,P,mi,Ue.toUnwrapped(),ee.width,ee.height,vo,li)}const Zo=u&&pe||qo,ta=ue||Zo?Bp:ne?Ui:h.transform.clipSpaceToPixelsMatrix,La=Tt&&i.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $i;$i=Tt?Je.iconsInText?kp(mr.kind,Bn,_e,ne,ue,Zo,h,ta,go,vo,Hn,si,Qe):Zh(mr.kind,Bn,_e,ne,ue,Zo,h,ta,go,vo,u,Hn,0,Qe):Fs(mr.kind,Bn,_e,ne,ue,Zo,h,ta,go,vo,u,Hn,Qe);const yo={program:An,buffers:Nt,uniformValues:$i,projectionData:fs,atlasTexture:Kn,atlasTextureIcon:fi,atlasInterpolation:Kr,atlasInterpolationIcon:Fn,isSDF:Tt,hasHalo:La};if(he&&Je.canOverlap){we=!0;const li=Nt.segments.get();for(const mi of li)Be.push({segments:new s.aM([mi]),sortKey:mi.sortKey,state:yo,terrainData:Ln})}else Be.push({segments:Nt.segments,sortKey:0,state:yo,terrainData:Ln})}we&&Be.sort(((Ue,We)=>Ue.sortKey-We.sortKey));for(const Ue of Be){const We=Ue.state;if(O.activeTexture.set($.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,$.CLAMP_TO_EDGE),We.atlasTextureIcon&&(O.activeTexture.set($.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),We.isSDF){const Je=We.uniformValues;We.hasHalo&&(Je.u_is_halo=1,qs(We.buffers,Ue.segments,i,h,We.program,Pe,A,R,Je,We.projectionData,Ue.terrainData)),Je.u_is_halo=0}qs(We.buffers,Ue.segments,i,h,We.program,Pe,A,R,We.uniformValues,We.projectionData,Ue.terrainData)}}function qs(h,e,i,l,u,d,g,w,C,P,A){const R=l.context;u.draw(R,R.gl.TRIANGLES,d,g,w,Lr.backCCW,C,A,P,i.id,h.layoutVertexBuffer,h.indexBuffer,e,i.paint,l.transform.zoom,h.programConfigurations.get(i.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Xc(h,e,i,l,u){const d=h.context,g=d.gl,w=cn.disabled,C=new zn([g.ONE,g.ONE],s.bf.transparent,[!0,!0,!0,!0]),P=e.getBucket(i);if(!P)return;const A=l.key;let R=i.heatmapFbos.get(A);R||(R=Zs(d,e.tileSize,e.tileSize),i.heatmapFbos.set(A,R)),d.bindFramebuffer.set(R.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:s.bf.transparent});const D=P.programConfigurations.get(i.id),O=h.useProgram("heatmap",D,!u),$=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ee=h.style.map.terrain.getTerrainData(l);O.draw(d,g.TRIANGLES,$r.disabled,w,C,Lr.disabled,Oh(e,h.transform.zoom,i.paint.get("heatmap-intensity"),1),ee,$,i.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,i.paint,h.transform.zoom,D)}function nd(h,e,i,l,u){const d=h.context,g=d.gl,w=h.transform;d.setColorMode(h.colorModeForRenderPass());const C=Us(d,e),P=i.key,A=e.heatmapFbos.get(P);if(!A)return;d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,A.colorAttachment.get()),d.activeTexture.set(g.TEXTURE1),C.bind(g.LINEAR,g.CLAMP_TO_EDGE);const R=w.getProjectionData({overscaledTileID:i,applyTerrainMatrix:u,applyGlobeMatrix:!l});h.useProgram("heatmapTexture").draw(d,g.TRIANGLES,$r.disabled,cn.disabled,h.colorModeForRenderPass(),Lr.disabled,Rc(h,e,0,1),null,R,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,w.zoom),A.destroy(),e.heatmapFbos.delete(P)}function Zs(h,e,i){var l,u;const d=h.gl,g=d.createTexture();d.bindTexture(d.TEXTURE_2D,g),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const w=(l=h.HALF_FLOAT)!==null&&l!==void 0?l:d.UNSIGNED_BYTE,C=(u=h.RGBA16F)!==null&&u!==void 0?u:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,C,e,i,0,d.RGBA,w,null);const P=h.createFramebuffer(e,i,!1,!1);return P.colorAttachment.set(g),P}function Us(h,e){return e.colorRampTexture||(e.colorRampTexture=new s.T(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function $s(h,e,i,l,u){if(!i||!l||!l.imageAtlas)return;const d=l.imageAtlas.patternPositions;let g=d[i.to.toString()],w=d[i.from.toString()];if(!g&&w&&(g=w),!w&&g&&(w=g),!g||!w){const C=u.getPaintProperty(e);g=d[C],w=d[C]}g&&w&&h.setConstantPatternPositions(g,w)}function Ll(h,e,i,l,u,d,g,w){const C=h.context.gl,P="fill-pattern",A=i.paint.get(P),R=A&&A.constantOr(1),D=i.getCrossfadeParameters();let O,$,ee,Q,ne;const ue=h.transform,_e=i.paint.get("fill-translate"),he=i.paint.get("fill-translate-anchor");g?($=R&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=C.LINES):($=R?"fillPattern":"fill",O=C.TRIANGLES);const we=A.constantOr(null);for(const Pe of l){const pe=e.getTile(Pe);if(R&&!pe.patternsLoaded())continue;const Be=pe.getBucket(i);if(!Be)continue;const Qe=Be.programConfigurations.get(i.id),Ue=h.useProgram($,Qe),We=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Pe);R&&(h.context.activeTexture.set(C.TEXTURE0),pe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Qe.updatePaintBuffers(D)),$s(Qe,P,we,pe,i);const Je=ue.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),Nt=s.aD(ue,pe,_e,he);if(g){Q=Be.indexBuffer2,ne=Be.segments2;const Tt=[C.drawingBufferWidth,C.drawingBufferHeight];ee=$==="fillOutlinePattern"&&R?Rs(h,D,pe,Tt,Nt):Ds(Tt,Nt)}else Q=Be.indexBuffer,ne=Be.segments,ee=R?wl(h,D,pe,Nt):{u_fill_translate:Nt};const Zt=h.stencilModeForClipping(Pe);Ue.draw(h.context,O,u,Zt,d,Lr.backCCW,ee,We,Je,i.id,Be.layoutVertexBuffer,Q,ne,i.paint,h.transform.zoom,Qe)}}function Yc(h,e,i,l,u,d,g,w){const C=h.context,P=C.gl,A="fill-extrusion-pattern",R=i.paint.get(A),D=R.constantOr(1),O=i.getCrossfadeParameters(),$=i.paint.get("fill-extrusion-opacity"),ee=R.constantOr(null),Q=h.transform;for(const ne of l){const ue=e.getTile(ne),_e=ue.getBucket(i);if(!_e)continue;const he=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ne),we=_e.programConfigurations.get(i.id),Pe=h.useProgram(D?"fillExtrusionPattern":"fillExtrusion",we);D&&(h.context.activeTexture.set(P.TEXTURE0),ue.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),we.updatePaintBuffers(O));const pe=Q.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!w,applyTerrainMatrix:!0});$s(we,A,ee,ue,i);const Be=s.aD(Q,ue,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Qe=i.paint.get("fill-extrusion-vertical-gradient"),Ue=D?Cp(h,Qe,$,Be,ne,O,ue):Pa(h,Qe,$,Be);Pe.draw(C,C.gl.TRIANGLES,u,d,g,Lr.backCCW,Ue,he,pe,i.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,i.paint,h.transform.zoom,we,h.style.map.terrain&&_e.centroidVertexBuffer)}}function Bo(h,e,i,l,u,d,g,w,C){var P;const A=h.style.projection,R=h.context,D=h.transform,O=R.gl,$=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],ee=h.useProgram("hillshade",null,!1,$),Q=!h.options.moving;for(const ne of l){const ue=e.getTile(ne),_e=ue.fbo;if(!_e)continue;const he=A.getMeshFromTileID(R,ne.canonical,w,!0,"raster"),we=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(ne);R.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,_e.colorAttachment.get());const Pe=D.getProjectionData({overscaledTileID:ne,aligned:Q,applyGlobeMatrix:!C,applyTerrainMatrix:!0});ee.draw(R,O.TRIANGLES,d,u[ne.overscaledZ],g,Lr.backCCW,Ip(h,ue,i),we,Pe,i.id,he.vertexBuffer,he.indexBuffer,he.segments)}}function Kc(h,e,i,l,u,d,g,w,C){var P;const A=h.style.projection,R=h.context,D=h.transform,O=R.gl,$=h.useProgram("colorRelief"),ee=!h.options.moving;let Q=!0,ne=0;for(const ue of l){const _e=e.getTile(ue),he=_e.dem;if(Q){const Ue=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:We,colorTexture:Je}=i.getColorRampTextures(R,Ue,he.getUnpackVector());R.activeTexture.set(O.TEXTURE1),We.bind(O.NEAREST,O.CLAMP_TO_EDGE),R.activeTexture.set(O.TEXTURE4),Je.bind(O.LINEAR,O.CLAMP_TO_EDGE),Q=!1,ne=We.size[0]}if(!he||!he.data)continue;const we=he.stride,Pe=he.getPixels();if(R.activeTexture.set(O.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),_e.demTexture=_e.demTexture||h.getTileTexture(we),_e.demTexture){const Ue=_e.demTexture;Ue.update(Pe,{premultiply:!1}),Ue.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else _e.demTexture=new s.T(R,Pe,O.RGBA,{premultiply:!1}),_e.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const pe=A.getMeshFromTileID(R,ue.canonical,w,!0,"raster"),Be=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(ue),Qe=D.getProjectionData({overscaledTileID:ue,aligned:ee,applyGlobeMatrix:!C,applyTerrainMatrix:!0});$.draw(R,O.TRIANGLES,d,u[ue.overscaledZ],g,Lr.backCCW,jh(i,_e.dem,ne),Be,Qe,i.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}const Dl=[new s.P(0,0),new s.P(s.$,0),new s.P(s.$,s.$),new s.P(0,s.$)];function Fo(h,e,i,l,u,d,g,w,C=!1,P=!1){const A=l[l.length-1].overscaledZ,R=h.context,D=R.gl,O=h.useProgram("raster"),$=h.transform,ee=h.style.projection,Q=h.colorModeForRenderPass(),ne=!h.options.moving;for(const ue of l){const _e=h.getDepthModeForSublayer(ue.overscaledZ-A,i.paint.get("raster-opacity")===1?$r.ReadWrite:$r.ReadOnly,D.LESS),he=e.getTile(ue);he.registerFadeDuration(i.paint.get("raster-fade-duration"));const we=e.findLoadedParent(ue,0),Pe=e.findLoadedSibling(ue),pe=Jc(he,we||Pe||null,e,i,h.transform,h.style.map.terrain);let Be,Qe;const Ue=i.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;R.activeTexture.set(D.TEXTURE0),he.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(D.TEXTURE1),we?(we.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),Be=Math.pow(2,we.tileID.overscaledZ-he.tileID.overscaledZ),Qe=[he.tileID.canonical.x*Be%1,he.tileID.canonical.y*Be%1]):he.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),he.texture.useMipmap&&R.extTextureFilterAnisotropic&&h.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const We=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ue),Je=$.getProjectionData({overscaledTileID:ue,aligned:ne,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Nt=Bs(Qe||[0,0],Be||1,pe,i,w),Zt=ee.getMeshFromTileID(R,ue.canonical,d,g,"raster");O.draw(R,D.TRIANGLES,_e,u?u[ue.overscaledZ]:cn.disabled,Q,C?Lr.frontCCW:Lr.backCCW,Nt,We,Je,i.id,Zt.vertexBuffer,Zt.indexBuffer,Zt.segments)}}function Jc(h,e,i,l,u,d){const g=l.paint.get("raster-fade-duration");if(!d&&g>0){const w=ie.now(),C=(w-h.timeAdded)/g,P=e?(w-e.timeAdded)/g:-1,A=i.getSource(),R=Mt(u,{tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(h.tileID.overscaledZ-R),O=D&&h.refreshedUponExpiration?1:s.ah(D?C:1-P,0,1);return h.refreshedUponExpiration&&C>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const id=new s.bf(1,0,0,1),ad=new s.bf(0,1,0,1),Rl=new s.bf(0,0,1,1),Qc=new s.bf(1,0,1,1),Op=new s.bf(0,1,1,1);function eu(h,e,i,l){Ua(h,0,e+i/2,h.transform.width,i,l)}function Yn(h,e,i,l){Ua(h,e-i/2,0,i,h.transform.height,l)}function Ua(h,e,i,l,u,d){const g=h.context,w=g.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*h.pixelRatio,i*h.pixelRatio,l*h.pixelRatio,u*h.pixelRatio),g.clear({color:d}),w.disable(w.SCISSOR_TEST)}function ya(h,e,i){const l=h.context,u=l.gl,d=h.useProgram("debug"),g=$r.disabled,w=cn.disabled,C=h.colorModeForRenderPass(),P="$debug",A=h.style.map.terrain&&h.style.map.terrain.getTerrainData(i);l.activeTexture.set(u.TEXTURE0);const R=e.getTileByID(i.key).latestRawTileData,D=Math.floor((R&&R.byteLength||0)/1024),O=e.getTile(i).tileSize,$=512/Math.min(O,512)*(i.overscaledZ/h.transform.zoom)*.5;let ee=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(ee+=` => ${i.overscaledZ}`),(function(ne,ue){ne.initDebugOverlayCanvas();const _e=ne.debugOverlayCanvas,he=ne.context.gl,we=ne.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,_e.width,_e.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(ue,5,5),we.strokeText(ue,5,5),ne.debugOverlayTexture.update(_e),ne.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)})(h,`${ee} ${D}kB`);const Q=h.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(l,u.TRIANGLES,g,w,zn.alphaBlended,Lr.disabled,Eo(s.bf.transparent,$),null,Q,P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),d.draw(l,u.LINE_STRIP,g,w,C,Lr.disabled,Eo(s.bf.red),A,Q,P,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function Bl(h,e,i,l){const{isRenderingGlobe:u}=l,d=h.context,g=d.gl,w=h.transform,C=h.colorModeForRenderPass(),P=h.getDepthModeFor3D(),A=h.useProgram("terrain");d.bindFramebuffer.set(null),d.viewport.set([0,0,h.width,h.height]);for(const R of i){const D=e.getTerrainMesh(R.tileID),O=h.renderToTexture.getTexture(R),$=e.getTerrainData(R.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,O.texture);const ee=e.getMeshFrameDelta(w.zoom),Q=w.calculateFogMatrix(R.tileID.toUnwrapped()),ne=xl(ee,Q,h.style.sky,w.pitch,u),ue=w.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});A.draw(d,g.TRIANGLES,P,cn.disabled,C,Lr.backCCW,ne,$,ue,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}function Gs(h,e){if(!e.mesh){const i=new s.aL;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const l=new s.aN;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Tn(h.createVertexBuffer(i,nn.members),h.createIndexBuffer(l),s.aM.simpleSegment(0,0,i.length,l.length))}return e.mesh}class od{constructor(e,i){this.context=new ed(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=cr.maxUnderzooming+cr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sr}resize(e,i,l){if(this.width=Math.floor(e*l),this.height=Math.floor(i*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,i=new s.aL;i.emplaceBack(0,0),i.emplaceBack(s.$,0),i.emplaceBack(0,s.$),i.emplaceBack(s.$,s.$),this.tileExtentBuffer=e.createVertexBuffer(i,nn.members),this.tileExtentSegments=s.aM.simpleSegment(0,0,4,2);const l=new s.aL;l.emplaceBack(0,0),l.emplaceBack(s.$,0),l.emplaceBack(0,s.$),l.emplaceBack(s.$,s.$),this.debugBuffer=e.createVertexBuffer(l,nn.members),this.debugSegments=s.aM.simpleSegment(0,0,4,5);const u=new s.c6;u.emplaceBack(0,0,0,0),u.emplaceBack(s.$,0,s.$,0),u.emplaceBack(0,s.$,0,s.$),u.emplaceBack(s.$,s.$,s.$,s.$),this.rasterBoundsBuffer=e.createVertexBuffer(u,wp.members),this.rasterBoundsSegments=s.aM.simpleSegment(0,0,4,2);const d=new s.aL;d.emplaceBack(0,0),d.emplaceBack(s.$,0),d.emplaceBack(0,s.$),d.emplaceBack(s.$,s.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(d,nn.members),this.rasterBoundsSegmentsPosOnly=s.aM.simpleSegment(0,0,4,5);const g=new s.aL;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(g,nn.members),this.viewportSegments=s.aM.simpleSegment(0,0,4,2);const w=new s.c7;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const C=new s.aN;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(C);const P=this.context.gl;this.stencilClearMode=new cn({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new Tn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=s.L();s.bY(l,0,this.width,this.height,0,0,1),s.N(l,l,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const u={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,$r.disabled,this.stencilClearMode,zn.disabled,Lr.disabled,null,null,u,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const u=this.context;u.setColorMode(zn.disabled),u.setDepthMode($r.disabled);const d={};for(const g of i)d[g.key]=this.nextStencilID++;this._renderTileMasks(d,i,l,!0),this._renderTileMasks(d,i,l,!1),this._tileClippingMaskIDs=d}_renderTileMasks(e,i,l,u){const d=this.context,g=d.gl,w=this.style.projection,C=this.transform,P=this.useProgram("clippingMask");for(const A of i){const R=e[A.key],D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),O=w.getMeshFromTileID(this.context,A.canonical,u,!0,"stencil"),$=C.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!l,applyTerrainMatrix:!0});P.draw(d,g.TRIANGLES,$r.disabled,new cn({func:g.ALWAYS,mask:0},R,255,g.KEEP,g.KEEP,g.REPLACE),zn.disabled,l?Lr.disabled:Lr.backCCW,null,D,$,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,l=this.style.projection,u=this.transform,d=this.useProgram("depth"),g=this.getDepthModeFor3D(),w=xe(u,{tileSize:u.tileSize});for(const C of w){const P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),A=l.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),R=u.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(e,i.TRIANGLES,g,cn.disabled,zn.disabled,Lr.backCCW,null,P,R,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new cn({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new cn({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,l=e.sort(((g,w)=>w.overscaledZ-g.overscaledZ)),u=l[l.length-1].overscaledZ,d=l[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let w=0;w<d;w++)g[w+u]=new cn({func:i.GEQUAL,mask:255},w+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=d,[g,l]}return[{[u]:cn.disabled},l]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,l=e.sort(((g,w)=>w.overscaledZ-g.overscaledZ)),u=l[l.length-1].overscaledZ,d=l[0].overscaledZ-u+1;if(this.clearStencil(),d>1){const g={},w={};for(let C=0;C<d;C++)g[C+u]=new cn({func:i.GREATER,mask:255},d+1+C,255,i.KEEP,i.KEEP,i.REPLACE),w[C+u]=new cn({func:i.GREATER,mask:255},1+C,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*d+1,[g,w,l]}return this.nextStencilID=3,[{[u]:new cn({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[u]:new cn({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new zn([e.CONSTANT_COLOR,e.ONE],new s.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zn.unblended:zn.alphaBlended}getDepthModeForSublayer(e,i,l){if(!this.opaquePassEnabledForLayer())return $r.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new $r(l||this.context.gl.LEQUAL,i,[u,u])}getDepthModeFor3D(){return new $r(this.context.gl.LEQUAL,$r.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var l,u;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ie.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,w={},C={},P={},A={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const D in g){const O=g[D];O.used&&O.prepare(this.context),w[D]=O.getVisibleCoordinates(!1),C[D]=w[D].slice().reverse(),P[D]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<d.length;D++)if(this.style._layers[d[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of d){const O=this.style._layers[D];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const $=C[O.source];(O.type==="custom"||$.length)&&this.renderLayer(this,g[O.source],O,$,A)}if((u=this.style.projection)===null||u===void 0||u.updateGPUdependent({context:this.context,useProgram:D=>this.useProgram(D)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?s.bf.black:s.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(D,O){const $=D.context,ee=$.gl,Q=((Pe,pe,Be)=>{const Qe=Math.cos(pe.rollInRadians),Ue=Math.sin(pe.rollInRadians),We=de(pe),Je=pe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(pe.width/2-We*Ue)*Be,(pe.height/2+We*Qe)*Be],u_horizon_normal:[-Ue,Qe],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*pe.height/2*Be,u_sky_blend:Je}})(O,D.style.map.transform,D.pixelRatio),ne=new $r(ee.LEQUAL,$r.ReadWrite,[0,1]),ue=cn.disabled,_e=D.colorModeForRenderPass(),he=D.useProgram("sky"),we=Gs($,O);he.draw($,ee.TRIANGLES,ne,ue,_e,Lr.disabled,Q,null,void 0,"sky",we.vertexBuffer,we.indexBuffer,we.segments)})(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[d[this.currentLayer]],O=g[D.source],$=w[D.source];this._renderTileClippingMasks(D,$,!1),this.renderLayer(this,O,D,$,A)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const D=this.style._layers[d[this.currentLayer]],O=g[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D,A))continue;this.opaquePassEnabledForLayer()||R||(R=!0,A.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const $=(D.type==="symbol"?P:C)[D.source];this._renderTileClippingMasks(D,w[D.source],!!this.renderToTexture),this.renderLayer(this,O,D,$,A)}if(A.isRenderingGlobe&&(function(D,O,$){const ee=D.context,Q=ee.gl,ne=D.useProgram("atmosphere"),ue=new $r(Q.LEQUAL,$r.ReadOnly,[0,1]),_e=D.transform,he=(function(Je,Nt){const Zt=Je.properties.get("position"),Tt=[-Zt.x,-Zt.y,-Zt.z],mr=s.ag(new Float64Array(16));return Je.properties.get("anchor")==="map"&&(s.b6(mr,mr,Nt.rollInRadians),s.b7(mr,mr,-Nt.pitchInRadians),s.b6(mr,mr,Nt.bearingInRadians),s.b7(mr,mr,Nt.center.lat*Math.PI/180),s.bz(mr,mr,-Nt.center.lng*Math.PI/180)),s.c5(Tt,Tt,mr),Tt})($,D.transform),we=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=O.properties.get("atmosphere-blend")*we.projectionTransition;if(Pe===0)return;const pe=Qo(_e.worldSize,_e.center.lat),Be=_e.inverseProjectionMatrix,Qe=new Float64Array(4);Qe[3]=1,s.aw(Qe,Qe,_e.modelViewProjectionMatrix),Qe[0]/=Qe[3],Qe[1]/=Qe[3],Qe[2]/=Qe[3],Qe[3]=1,s.aw(Qe,Qe,Be),Qe[0]/=Qe[3],Qe[1]/=Qe[3],Qe[2]/=Qe[3],Qe[3]=1;const Ue=((Je,Nt,Zt,Tt,mr)=>({u_sun_pos:Je,u_atmosphere_blend:Nt,u_globe_position:Zt,u_globe_radius:Tt,u_inv_proj_matrix:mr}))(he,Pe,[Qe[0],Qe[1],Qe[2]],pe,Be),We=Gs(ee,O);ne.draw(ee,Q.TRIANGLES,ue,cn.disabled,zn.alphaBlended,Lr.disabled,Ue,null,null,"atmosphere",We.vertexBuffer,We.indexBuffer,We.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const D=(function(O,$){let ee=null;const Q=Object.values(O._layers).flatMap((he=>he.source&&!he.isHidden($)?[O.sourceCaches[he.source]]:[])),ne=Q.filter((he=>he.getSource().type==="vector")),ue=Q.filter((he=>he.getSource().type!=="vector")),_e=he=>{(!ee||ee.getSource().maxzoom<he.getSource().maxzoom)&&(ee=he)};return ne.forEach((he=>_e(he))),ee||ue.forEach((he=>_e(he))),ee})(this.style,this.transform.zoom);D&&(function(O,$,ee){for(let Q=0;Q<ee.length;Q++)ya(O,$,ee[Q])})(this,D,D.getVisibleCoordinates())}this.options.showPadding&&(function(D){const O=D.transform.padding;eu(D,D.transform.height-(O.top||0),3,id),eu(D,O.bottom||0,3,ad),Yn(D,O.left||0,3,Rl),Yn(D,D.transform.width-(O.right||0),3,Qc);const $=D.transform.centerPoint;(function(ee,Q,ne,ue){Ua(ee,Q-1,ne-10,2,20,ue),Ua(ee,Q-10,ne-1,20,2,ue)})(D,$.x,D.transform.height-$.y,Op)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!s.c8(i,l):!s.c9(i,l)),u||(u=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),u&&(s.ca(i,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(d,g){const w=d.context,C=w.gl,P=d.transform,A=zn.unblended,R=new $r(C.LEQUAL,$r.ReadWrite,[0,1]),D=g.sourceCache.getRenderableTiles(),O=d.useProgram("terrainDepth");w.bindFramebuffer.set(g.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:s.bf.transparent,depth:1});for(const $ of D){const ee=g.getTerrainMesh($.tileID),Q=g.getTerrainData($.tileID),ne=P.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:g.getMeshFrameDelta(P.zoom)};O.draw(w,C.TRIANGLES,R,cn.disabled,A,Lr.backCCW,ue,Q,ne,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])})(this,this.style.map.terrain),(function(d,g){const w=d.context,C=w.gl,P=d.transform,A=zn.unblended,R=new $r(C.LEQUAL,$r.ReadWrite,[0,1]),D=g.getCoordsTexture(),O=g.sourceCache.getRenderableTiles(),$=d.useProgram("terrainCoords");w.bindFramebuffer.set(g.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:s.bf.transparent,depth:1}),g.coordsIndex=[];for(const ee of O){const Q=g.getTerrainMesh(ee.tileID),ne=g.getTerrainData(ee.tileID);w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.texture);const ue={u_terrain_coords_id:(255-g.coordsIndex.length)/255,u_texture:0,u_ele_delta:g.getMeshFrameDelta(P.zoom)},_e=P.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});$.draw(w,C.TRIANGLES,R,cn.disabled,A,Lr.backCCW,ue,ne,_e,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),g.coordsIndex.push(ee.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])})(this,this.style.map.terrain))}renderLayer(e,i,l,u,d){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(u||[]).length)&&(this.id=l.id,s.cb(l)?(function(g,w,C,P,A,R){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:D}=R,O=cn.disabled,$=g.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ee,Q,ne,ue,_e,he,we,Pe,pe){const Be=Q.transform,Qe=Q.style.map.terrain,Ue=_e==="map",We=he==="map";for(const Je of ee){const Nt=ue.getTile(Je),Zt=Nt.getBucket(ne);if(!Zt||!Zt.text||!Zt.text.segments.get().length)continue;const Tt=s.an(Zt.textSizeData,Be.zoom),mr=s.aC(Nt,1,Q.transform.zoom),Jr=mn(Ue,Q.transform,mr),An=ne.layout.get("icon-text-fit")!=="none"&&Zt.hasIconData();if(Tt){const Bn=Math.pow(2,Be.zoom-Nt.tileID.overscaledZ),Ln=Qe?(Hn,Kn)=>Qe.getElevation(Je,Hn,Kn):null;Wc(Zt,Ue,We,pe,Be,Jr,Bn,Tt,An,s.aD(Be,Nt,we,Pe),Je.toUnwrapped(),Ln)}}})(P,g,C,w,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),A),C.paint.get("icon-opacity").constantOr(1)!==0&&Vs(g,w,C,P,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),O,$,D),C.paint.get("text-opacity").constantOr(1)!==0&&Vs(g,w,C,P,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),O,$,D),w.map.showCollisionBoxes&&(td(g,w,C,P,!0),td(g,w,C,P,!1))})(e,i,l,u,this.style.placement.variableOffsets,d):s.cc(l)?(function(g,w,C,P,A){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:R}=A,D=C.paint.get("circle-opacity"),O=C.paint.get("circle-stroke-width"),$=C.paint.get("circle-stroke-opacity"),ee=!C.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(O.constantOr(1)===0||$.constantOr(1)===0))return;const Q=g.context,ne=Q.gl,ue=g.transform,_e=g.getDepthModeForSublayer(0,$r.ReadOnly),he=cn.disabled,we=g.colorModeForRenderPass(),Pe=[],pe=ue.getCircleRadiusCorrection();for(let Be=0;Be<P.length;Be++){const Qe=P[Be],Ue=w.getTile(Qe),We=Ue.getBucket(C);if(!We)continue;const Je=C.paint.get("circle-translate"),Nt=C.paint.get("circle-translate-anchor"),Zt=s.aD(ue,Ue,Je,Nt),Tt=We.programConfigurations.get(C.id),mr=g.useProgram("circle",Tt),Jr=We.layoutVertexBuffer,An=We.indexBuffer,Bn=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Qe),Ln={programConfiguration:Tt,program:mr,layoutVertexBuffer:Jr,indexBuffer:An,uniformValues:Sp(g,Ue,C,Zt,pe),terrainData:Bn,projectionData:ue.getProjectionData({overscaledTileID:Qe,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(ee){const Hn=We.segments.get();for(const Kn of Hn)Pe.push({segments:new s.aM([Kn]),sortKey:Kn.sortKey,state:Ln})}else Pe.push({segments:We.segments,sortKey:0,state:Ln})}ee&&Pe.sort(((Be,Qe)=>Be.sortKey-Qe.sortKey));for(const Be of Pe){const{programConfiguration:Qe,program:Ue,layoutVertexBuffer:We,indexBuffer:Je,uniformValues:Nt,terrainData:Zt,projectionData:Tt}=Be.state;Ue.draw(Q,ne.TRIANGLES,_e,he,we,Lr.backCCW,Nt,Zt,Tt,C.id,We,Je,Be.segments,C.paint,g.transform.zoom,Qe)}})(e,i,l,u,d):s.cd(l)?(function(g,w,C,P,A){if(C.paint.get("heatmap-opacity")===0)return;const R=g.context,{isRenderingToTexture:D,isRenderingGlobe:O}=A;if(g.style.map.terrain){for(const $ of P){const ee=w.getTile($);w.hasRenderableParent($)||(g.renderPass==="offscreen"?Xc(g,ee,C,$,O):g.renderPass==="translucent"&&nd(g,C,$,D,O))}R.viewport.set([0,0,g.width,g.height])}else g.renderPass==="offscreen"?(function($,ee,Q,ne){const ue=$.context,_e=ue.gl,he=$.transform,we=cn.disabled,Pe=new zn([_e.ONE,_e.ONE],s.bf.transparent,[!0,!0,!0,!0]);(function(pe,Be,Qe){const Ue=pe.gl;pe.activeTexture.set(Ue.TEXTURE1),pe.viewport.set([0,0,Be.width/4,Be.height/4]);let We=Qe.heatmapFbos.get(s.c2);We?(Ue.bindTexture(Ue.TEXTURE_2D,We.colorAttachment.get()),pe.bindFramebuffer.set(We.framebuffer)):(We=Zs(pe,Be.width/4,Be.height/4),Qe.heatmapFbos.set(s.c2,We))})(ue,$,Q),ue.clear({color:s.bf.transparent});for(let pe=0;pe<ne.length;pe++){const Be=ne[pe];if(ee.hasRenderableParent(Be))continue;const Qe=ee.getTile(Be),Ue=Qe.getBucket(Q);if(!Ue)continue;const We=Ue.programConfigurations.get(Q.id),Je=$.useProgram("heatmap",We),Nt=he.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Zt=he.getCircleRadiusCorrection();Je.draw(ue,_e.TRIANGLES,$r.disabled,we,Pe,Lr.backCCW,Oh(Qe,he.zoom,Q.paint.get("heatmap-intensity"),Zt),null,Nt,Q.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,Q.paint,he.zoom,We)}ue.viewport.set([0,0,$.width,$.height])})(g,w,C,P):g.renderPass==="translucent"&&(function($,ee){const Q=$.context,ne=Q.gl;Q.setColorMode($.colorModeForRenderPass());const ue=ee.heatmapFbos.get(s.c2);ue&&(Q.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,ue.colorAttachment.get()),Q.activeTexture.set(ne.TEXTURE1),Us(Q,ee).bind(ne.LINEAR,ne.CLAMP_TO_EDGE),$.useProgram("heatmapTexture").draw(Q,ne.TRIANGLES,$r.disabled,cn.disabled,$.colorModeForRenderPass(),Lr.disabled,Rc($,ee,0,1),null,null,ee.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments,ee.paint,$.transform.zoom))})(g,C)})(e,i,l,u,d):s.ce(l)?(function(g,w,C,P,A){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:R}=A,D=C.paint.get("line-opacity"),O=C.paint.get("line-width");if(D.constantOr(1)===0||O.constantOr(1)===0)return;const $=g.getDepthModeForSublayer(0,$r.ReadOnly),ee=g.colorModeForRenderPass(),Q=C.paint.get("line-dasharray"),ne=C.paint.get("line-pattern"),ue=ne.constantOr(1),_e=C.paint.get("line-gradient"),he=C.getCrossfadeParameters(),we=ue?"linePattern":Q?"lineSDF":_e?"lineGradient":"line",Pe=g.context,pe=Pe.gl,Be=g.transform;let Qe=!0;for(const Ue of P){const We=w.getTile(Ue);if(ue&&!We.patternsLoaded())continue;const Je=We.getBucket(C);if(!Je)continue;const Nt=Je.programConfigurations.get(C.id),Zt=g.context.program.get(),Tt=g.useProgram(we,Nt),mr=Qe||Tt.program!==Zt,Jr=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ue),An=ne.constantOr(null);if(An&&We.imageAtlas){const Kr=We.imageAtlas,Fn=Kr.patternPositions[An.to.toString()],si=Kr.patternPositions[An.from.toString()];Fn&&si&&Nt.setConstantPatternPositions(Fn,si)}const Bn=Be.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ln=Be.getPixelScale(),Hn=ue?qh(g,We,C,Ln,he):Q?zo(g,We,C,Ln,Q,he):_e?Vh(g,We,C,Ln,Je.lineClipsArray.length):Cl(g,We,C,Ln);if(ue)Pe.activeTexture.set(pe.TEXTURE0),We.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Nt.updatePaintBuffers(he);else if(Q&&(mr||g.lineAtlas.dirty))Pe.activeTexture.set(pe.TEXTURE0),g.lineAtlas.bind(Pe);else if(_e){const Kr=Je.gradients[C.id];let Fn=Kr.texture;if(C.gradientVersion!==Kr.version){let si=256;if(C.stepInterpolant){const fi=w.getSource().maxzoom,Ti=Ue.canonical.z===fi?Math.ceil(1<<g.transform.maxZoom-Ue.canonical.z):1;si=s.ah(s.c3(Je.maxLineLength/s.$*1024*Ti),256,Pe.maxTextureSize)}Kr.gradient=s.c4({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:Kr.gradient||void 0,clips:Je.lineClipsArray}),Kr.texture?Kr.texture.update(Kr.gradient):Kr.texture=new s.T(Pe,Kr.gradient,pe.RGBA),Kr.version=C.gradientVersion,Fn=Kr.texture}Pe.activeTexture.set(pe.TEXTURE0),Fn.bind(C.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}const Kn=g.stencilModeForClipping(Ue);Tt.draw(Pe,pe.TRIANGLES,$,Kn,ee,Lr.disabled,Hn,Jr,Bn,C.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,C.paint,g.transform.zoom,Nt,Je.layoutVertexBuffer2),Qe=!1}})(e,i,l,u,d):s.cf(l)?(function(g,w,C,P,A){const R=C.paint.get("fill-color"),D=C.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const{isRenderingToTexture:O}=A,$=g.colorModeForRenderPass(),ee=C.paint.get("fill-pattern"),Q=g.opaquePassEnabledForLayer()&&!ee.constantOr(1)&&R.constantOr(s.bf.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===Q){const ne=g.getDepthModeForSublayer(1,g.renderPass==="opaque"?$r.ReadWrite:$r.ReadOnly);Ll(g,w,C,P,ne,$,!1,O)}if(g.renderPass==="translucent"&&C.paint.get("fill-antialias")){const ne=g.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,$r.ReadOnly);Ll(g,w,C,P,ne,$,!0,O)}})(e,i,l,u,d):s.cg(l)?(function(g,w,C,P,A){const R=C.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:D}=A;if(g.renderPass==="translucent"){const O=new $r(g.context.gl.LEQUAL,$r.ReadWrite,g.depthRangeFor3D);if(R!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))Yc(g,w,C,P,O,cn.disabled,zn.disabled,D),Yc(g,w,C,P,O,g.stencilModeFor3D(),g.colorModeForRenderPass(),D);else{const $=g.colorModeForRenderPass();Yc(g,w,C,P,O,cn.disabled,$,D)}}})(e,i,l,u,d):s.ch(l)?(function(g,w,C,P,A){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const{isRenderingToTexture:R}=A,D=g.context,O=g.style.projection.useSubdivision,$=g.getDepthModeForSublayer(0,$r.ReadOnly),ee=g.colorModeForRenderPass();if(g.renderPass==="offscreen")(function(Q,ne,ue,_e,he,we,Pe){const pe=Q.context,Be=pe.gl;for(const Qe of ue){const Ue=ne.getTile(Qe),We=Ue.dem;if(!We||!We.data||!Ue.needsHillshadePrepare)continue;const Je=We.dim,Nt=We.stride,Zt=We.getPixels();if(pe.activeTexture.set(Be.TEXTURE1),pe.pixelStoreUnpackPremultiplyAlpha.set(!1),Ue.demTexture=Ue.demTexture||Q.getTileTexture(Nt),Ue.demTexture){const mr=Ue.demTexture;mr.update(Zt,{premultiply:!1}),mr.bind(Be.NEAREST,Be.CLAMP_TO_EDGE)}else Ue.demTexture=new s.T(pe,Zt,Be.RGBA,{premultiply:!1}),Ue.demTexture.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);pe.activeTexture.set(Be.TEXTURE0);let Tt=Ue.fbo;if(!Tt){const mr=new s.T(pe,{width:Je,height:Je,data:null},Be.RGBA);mr.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Tt=Ue.fbo=pe.createFramebuffer(Je,Je,!0,!1),Tt.colorAttachment.set(mr.texture)}pe.bindFramebuffer.set(Tt.framebuffer),pe.viewport.set([0,0,Je,Je]),Q.useProgram("hillshadePrepare").draw(pe,Be.TRIANGLES,he,we,Pe,Lr.disabled,Nh(Ue.tileID,We),null,null,_e.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),Ue.needsHillshadePrepare=!1}})(g,w,P,C,$,cn.disabled,ee),D.viewport.set([0,0,g.width,g.height]);else if(g.renderPass==="translucent")if(O){const[Q,ne,ue]=g.stencilConfigForOverlapTwoPass(P);Bo(g,w,C,ue,Q,$,ee,!1,R),Bo(g,w,C,ue,ne,$,ee,!0,R)}else{const[Q,ne]=g.getStencilConfigForOverlapAndUpdateStencilID(P);Bo(g,w,C,ne,Q,$,ee,!1,R)}})(e,i,l,u,d):s.ci(l)?(function(g,w,C,P,A){if(g.renderPass!=="translucent"||!P.length)return;const{isRenderingToTexture:R}=A,D=g.style.projection.useSubdivision,O=g.getDepthModeForSublayer(0,$r.ReadOnly),$=g.colorModeForRenderPass();if(D){const[ee,Q,ne]=g.stencilConfigForOverlapTwoPass(P);Kc(g,w,C,ne,ee,O,$,!1,R),Kc(g,w,C,ne,Q,O,$,!0,R)}else{const[ee,Q]=g.getStencilConfigForOverlapAndUpdateStencilID(P);Kc(g,w,C,Q,ee,O,$,!1,R)}})(e,i,l,u,d):s.cj(l)?(function(g,w,C,P,A){if(g.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!P.length)return;const{isRenderingToTexture:R}=A,D=w.getSource(),O=g.style.projection.useSubdivision;if(D instanceof Ot)Fo(g,w,C,P,null,!1,!1,D.tileCoords,D.flippedWindingOrder,R);else if(O){const[$,ee,Q]=g.stencilConfigForOverlapTwoPass(P);Fo(g,w,C,Q,$,!1,!0,Dl,!1,R),Fo(g,w,C,Q,ee,!0,!0,Dl,!1,R)}else{const[$,ee]=g.getStencilConfigForOverlapAndUpdateStencilID(P);Fo(g,w,C,ee,$,!1,!0,Dl,!1,R)}})(e,i,l,u,d):s.ck(l)?(function(g,w,C,P,A){const R=C.paint.get("background-color"),D=C.paint.get("background-opacity");if(D===0)return;const{isRenderingToTexture:O}=A,$=g.context,ee=$.gl,Q=g.style.projection,ne=g.transform,ue=ne.tileSize,_e=C.paint.get("background-pattern");if(g.isPatternMissing(_e))return;const he=!_e&&R.a===1&&D===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==he)return;const we=cn.disabled,Pe=g.getDepthModeForSublayer(0,he==="opaque"?$r.ReadWrite:$r.ReadOnly),pe=g.colorModeForRenderPass(),Be=g.useProgram(_e?"backgroundPattern":"background"),Qe=P||xe(ne,{tileSize:ue,terrain:g.style.map.terrain});_e&&($.activeTexture.set(ee.TEXTURE0),g.imageManager.bind(g.context));const Ue=C.getCrossfadeParameters();for(const We of Qe){const Je=ne.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Nt=_e?$h(D,g,_e,{tileID:We,tileSize:ue},Ue):Uh(D,R),Zt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(We),Tt=Q.getMeshFromTileID($,We.canonical,!1,!0,"raster");Be.draw($,ee.TRIANGLES,Pe,we,pe,Lr.backCCW,Nt,Zt,Je,C.id,Tt.vertexBuffer,Tt.indexBuffer,Tt.segments)}})(e,0,l,u,d):s.cl(l)&&(function(g,w,C,P){const{isRenderingGlobe:A}=P,R=g.context,D=C.implementation,O=g.style.projection,$=g.transform,ee=$.getProjectionDataForCustomLayer(A),Q={farZ:$.farZ,nearZ:$.nearZ,fov:$.fov*Math.PI/180,modelViewProjectionMatrix:$.modelViewProjectionMatrix,projectionMatrix:$.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:ee},ne=D.renderingMode?D.renderingMode:"2d";if(g.renderPass==="offscreen"){const ue=D.prerender;ue&&(g.setCustomLayerDefaults(),R.setColorMode(g.colorModeForRenderPass()),ue.call(D,R.gl,Q),R.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),R.setColorMode(g.colorModeForRenderPass()),R.setStencilMode(cn.disabled);const ue=ne==="3d"?g.getDepthModeFor3D():g.getDepthModeForSublayer(0,$r.ReadOnly);R.setDepthMode(ue),D.render(R.gl,Q),R.setDirty(),g.setBaseState(),R.bindFramebuffer.set(null)}})(e,0,l,d))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!i||!l}useProgram(e,i,l=!1,u=[]){this.cache=this.cache||{};const d=!!this.style.map.terrain,g=this.style.projection,w=l?Ur.projectionMercator:g.shaderPreludeCode,C=l?Cn:g.shaderDefine,P=e+(i?i.cacheKey:"")+`/${l?$n:g.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(d?"/terrain":"")+(u?`/${u.join("/")}`:"");return this.cache[P]||(this.cache[P]=new Dc(this.context,Ur[e],i,jc[e],this._showOverdrawInspector,d,w,C,u)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function Oo(h,e){let i,l=!1,u=null,d=null;const g=()=>{u=null,l&&(h.apply(d,i),u=setTimeout(g,e),l=!1)};return(...w)=>(l=!0,d=this,i=w,u||g(),u)}class Fl{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(l=u)})),(l&&l[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:l,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const l=i.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let d=window.location.hash.replace(u,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let g=window.location.href.replace(/(#.+)?$/,d);g=g.replace("&&","&"),window.history.replaceState(window.history.state,null,g)},this._updateHash=Oo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),g=Math.round(i.lng*d)/d,w=Math.round(i.lat*d)/d,C=this._map.getBearing(),P=this._map.getPitch();let A="";if(A+=e?`/${g}/${w}/${l}`:`${l}/${w}/${g}`,(C||P)&&(A+="/"+Math.round(10*C)/10),P&&(A+=`/${Math.round(P)}`),this._hashName){const R=this._hashName;let D=!1;const O=window.location.hash.slice(1).split("&").map(($=>{const ee=$.split("=")[0];return ee===R?(D=!0,`${ee}=${A}`):$})).filter(($=>$));return D||O.push(`${R}=${A}`),`#${O.join("&")}`}return`#${A}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new s.S(+e[2],+e[1])}catch{return!1}const i=+e[0],l=+(e[3]||0),u=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&l>=-180&&l<=180&&u>=this._map.getMinPitch()&&u<=this._map.getMaxPitch()}}const eo={linearity:.3,easing:s.cm(0,0,.3,1)},tu=s.e({deceleration:2500,maxSpeed:1400},eo),sd=s.e({deceleration:20,maxSpeed:1400},eo),ld=s.e({deceleration:1e3,maxSpeed:360},eo),cd=s.e({deceleration:1e3,maxSpeed:90},eo),ud=s.e({deceleration:1e3,maxSpeed:360},eo);class hd{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ie.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=ie.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)i.zoom+=d.zoomDelta||0,i.bearing+=d.bearingDelta||0,i.pitch+=d.pitchDelta||0,i.roll+=d.rollDelta||0,d.panDelta&&i.pan._add(d.panDelta),d.around&&(i.around=d.around),d.pinchAround&&(i.pinchAround=d.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(i.pan.mag()){const d=ns(i.pan.mag(),l,s.e({},tu,e||{})),g=i.pan.mult(d.amount/i.pan.mag()),w=this._map.cameraHelper.handlePanInertia(g,this._map.transform);u.center=w.easingCenter,u.offset=w.easingOffset,Ia(u,d)}if(i.zoom){const d=ns(i.zoom,l,sd);u.zoom=this._map.transform.zoom+d.amount,Ia(u,d)}if(i.bearing){const d=ns(i.bearing,l,ld);u.bearing=this._map.transform.bearing+s.ah(d.amount,-179,179),Ia(u,d)}if(i.pitch){const d=ns(i.pitch,l,cd);u.pitch=this._map.transform.pitch+d.amount,Ia(u,d)}if(i.roll){const d=ns(i.roll,l,ud);u.roll=this._map.transform.roll+s.ah(d.amount,-179,179),Ia(u,d)}if(u.zoom||u.bearing){const d=i.pinchAround===void 0?i.around:i.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),s.e(u,{noMoveStart:!0})}}function Ia(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function ns(h,e,i){const{maxSpeed:l,linearity:u,deceleration:d}=i,g=s.ah(h*u/(e/1e3),-l,l),w=Math.abs(g)/(d*u);return{easing:i.easing,duration:1e3*w,amount:g*(w/2)}}class Qi extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l,u={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const d=H.mousePos(i.getCanvas(),l),g=i.unproject(d);super(e,s.e({point:d,lngLat:g,originalEvent:l},u)),this._defaultPrevented=!1,this.target=i}}class is extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l){const u=e==="touchend"?l.changedTouches:l.touches,d=H.touchPos(i.getCanvasContainer(),u),g=d.map((C=>i.unproject(C))),w=d.reduce(((C,P,A,R)=>C.add(P.div(R.length))),new s.P(0,0));super(e,{points:d,point:w,lngLats:g,lngLat:i.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class ru extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class dd{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ru(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new Qi(e.type,this._map,e))}mouseup(e){this._map.fire(new Qi(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new Qi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Qi(e.type,this._map,e))}mouseover(e){this._map.fire(new Qi(e.type,this._map,e))}mouseout(e){this._map.fire(new Qi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new is(e.type,this._map,e))}touchmove(e){this._map.fire(new is(e.type,this._map,e))}touchend(e){this._map.fire(new is(e.type,this._map,e))}touchcancel(e){this._map.fire(new is(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Qi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Qi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class as{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(s.P.convert(e),this._map.terrain)}}class nu{constructor(e,i){this._map=e,this._tr=new as(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(H.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const l=i;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=H.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(u.x,l.x),g=Math.max(u.x,l.x),w=Math.min(u.y,l.y),C=Math.max(u.y,l.y);H.setTransform(this._box,`translate(${d}px,${w}px)`),this._box.style.width=g-d+"px",this._box.style.height=C-w+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const l=this._startPos,u=i;if(this.reset(),H.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new s.l(e,{originalEvent:i}))}}function os(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);const i={};for(let l=0;l<h.length;l++)i[h[l].identifier]=e[l];return i}class fd{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(u){const d=new s.P(0,0);for(const g of u)d._add(g);return d.div(u.length)})(i),this.touches=os(l,i)))}touchmove(e,i,l){if(this.aborted||!this.centroid)return;const u=os(l,i);for(const d in this.touches){const g=u[d];(!g||g.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,i,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class ea{constructor(e){this.singleTap=new fd(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,l){this.singleTap.touchstart(e,i,l)}touchmove(e,i,l){this.singleTap.touchmove(e,i,l)}touchend(e,i,l){const u=this.singleTap.touchend(e,i,l);if(u){const d=e.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(u)<30;if(d&&g||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Ma{constructor(e){this._tr=new as(e),this._zoomIn=new ea({numTouches:1,numTaps:2}),this._zoomOut=new ea({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,l){this._zoomIn.touchstart(e,i,l),this._zoomOut.touchstart(e,i,l)}touchmove(e,i,l){this._zoomIn.touchmove(e,i,l),this._zoomOut.touchmove(e,i,l)}touchend(e,i,l){const u=this._zoomIn.touchend(e,i,l),d=this._zoomOut.touchend(e,i,l),g=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(u)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ss{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=Array.isArray(i)?i[0]:i;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&H.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ka=0,ls=2,Np={[ka]:1,[ls]:2};class Hs{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=H.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(i,l){const u=Np[l];return i.buttons===void 0||(i.buttons&u)!==u})(e,this._eventButton)}isValidEndEvent(e){return H.mouseButton(e)===this._eventButton}}class jp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Vp{constructor(e=new Hs({checkCorrectEvent:()=>!0}),i=new jp){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,l){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.startMove(i)),(i=>this.oneFingerTouchMoveStateManager.startMove(i)))}endMove(e){this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.endMove(i)),(i=>this.oneFingerTouchMoveStateManager.endMove(i)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.isValidStartEvent(i)),(i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.isValidMoveEvent(i)),(i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(i=>this.mouseMoveStateManager.isValidEndEvent(i)),(i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i)))}}const Ws=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class Xs{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,l){return this._calculateTransform(e,i,l)}touchmove(e,i,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,i,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,l){this._calculateTransform(e,i,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,l){l.length>0&&(this._active=!0);const u=os(l,i),d=new s.P(0,0),g=new s.P(0,0);let w=0;for(const P in u){const A=u[P],R=this._touches[P];R&&(d._add(A),g._add(A.sub(R)),w++,u[P]=A)}if(this._touches=u,this._shouldBePrevented(w)||!g.mag())return;const C=g.div(w);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(w),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,d]=this._firstTwoTouches,g=nr(l,i,u),w=nr(l,i,d);if(!g||!w)return;const C=this._aroundCenter?null:g.add(w).div(2);return this._move([g,w],C,e)}touchend(e,i,l){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,g=nr(l,i,u),w=nr(l,i,d);g&&w||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function nr(h,e,i){for(let l=0;l<h.length;l++)if(h[l].identifier===i)return e[l]}function iu(h,e){return Math.log(h/e)/Math.LN2}class Ol extends Aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:iu(this._distance,l),pinchAround:i}}}function au(h,e){return 180*h.angleWith(e)/Math.PI}class cs extends Aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:au(this._vector,u),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,l=au(e,this._startVector);return Math.abs(l)<i}}function No(h){return Math.abs(h.y)>Math.abs(h.x)}class Nl extends Aa{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,l){super.touchstart(e,i,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,No(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,d,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,d=i.mag()>=2;if(!u&&!d)return;if(!u||!d)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const g=e.y>0==i.y>0;return No(e)&&No(i)&&g}}const un={panStep:100,bearingStep:15,pitchStep:10};class jl{constructor(e){this._tr=new as(e);const i=un;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,l=0,u=0,d=0,g=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),g=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const C=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:qp,zoom:i?Math.round(C.zoom)+i*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+l*this._bearingStep,pitch:C.pitch+u*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qp(h){return h*(2-h)}const Vl=4.000244140625,Zp=1/450;class md{constructor(e,i){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new as(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Zp}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=ie.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,i!==0&&i%Vl==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=H.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(s.S.convert(l.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Vl?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&C!==0&&(C=1/C);const P=typeof this._targetZoom!="number"?e.scale:s.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),s.ak(P*C)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,u=this._easing;let d,g=!1;if(this._type==="wheel"&&l&&u){const w=ie.now()-this._lastWheelEventTime,C=Math.min((w+5)/200,1),P=u(C);d=s.C.number(l,i,P),C<1?this._frameId||(this._frameId=!0):g=!0}else d=i,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=d,{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=s.co;if(this._prevEase){const l=this._prevEase,u=(ie.now()-l.start)/l.duration,d=l.easing(u+.01)-l.easing(u),g=.27/Math.sqrt(d*d+1e-4)*.01,w=Math.sqrt(.0729-g*g);i=s.cm(g,w,.25,1)}return this._prevEase={start:ie.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ou{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class su{constructor(e){this._tr=new as(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _d{constructor(){this._tap=new ea({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,l){if(!this._swipePoint)if(this._tapTime){const u=i[0],d=e.timeStamp-this._tapTime<500,g=this._tapPoint.dist(u)<30;d&&g?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,i,l)}touchmove(e,i,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=i[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,i,l)}touchend(e,i,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,i,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gd{constructor(e,i,l){this._el=e,this._mousePan=i,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lu{constructor(e,i,l,u){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=l,this._mouseRoll=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class vd{constructor(e,i,l,u){this._el=e,this._touchZoom=i,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class yd{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=H.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=i,this._container.appendChild(u);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=l,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(H.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Ea=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class Un extends s.l{}function us(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class cu{constructor(e,i){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,d)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},C={},P={};for(const{handlerName:D,handler:O,allowed:$}of this._handlers){if(!O.isEnabled())continue;let ee;if(this._blockedByActive(P,$,D))O.reset();else if(O[d||u.type]){if(s.cp(u,d||u.type)){const Q=H.mousePos(this._map.getCanvas(),u);ee=O[d||u.type](u,Q)}else if(s.cq(u,d||u.type)){const Q=this._getMapTouches(u.touches),ne=H.touchPos(this._map.getCanvas(),Q);ee=O[d||u.type](u,ne,Q)}else s.cr(d||u.type)||(ee=O[d||u.type](u));this.mergeHandlerResult(w,C,ee,D,g),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()}(ee||O.isActive())&&(P[D]=O)}const A={};for(const D in this._previousActiveHandlers)P[D]||(A[D]=g);this._previousActiveHandlers=P,(Object.keys(A).length||us(w))&&(this._changes.push([w,C,A]),this._triggerRenderFrame()),(Object.keys(P).length||us(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=w;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hd(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,d,g]of this._listeners)H.addEventListener(u,d,u===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[e,i,l]of this._listeners)H.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const i=this._map,l=i.getCanvasContainer();this._add("mapEvent",new dd(i,e));const u=i.boxZoom=new nu(i,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const d=i.cooperativeGestures=new yd(i,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const g=new Ma(i),w=new su(i);i.doubleClickZoom=new ou(w,g),this._add("tapZoom",g),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const C=new _d;this._add("tapDragZoom",C);const P=i.touchPitch=new Nl(i);this._add("touchPitch",P),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const A=()=>i.project(i.getCenter()),R=(function({enable:he,clickTolerance:we,aroundCenter:Pe=!0,minPixelCenterThreshold:pe=100,rotateDegreesPerPixelMoved:Be=.8},Qe){const Ue=new Hs({checkCorrectEvent:We=>H.mouseButton(We)===0&&We.ctrlKey||H.mouseButton(We)===2&&!We.ctrlKey});return new ss({clickTolerance:we,move:(We,Je)=>{const Nt=Qe();if(Pe&&Math.abs(Nt.y-We.y)>pe)return{bearingDelta:s.cn(new s.P(We.x,Je.y),Je,Nt)};let Zt=(Je.x-We.x)*Be;return Pe&&Je.y<Nt.y&&(Zt=-Zt),{bearingDelta:Zt}},moveStateManager:Ue,enable:he,assignEvents:Ws})})(e,A),D=(function({enable:he,clickTolerance:we,pitchDegreesPerPixelMoved:Pe=-.5}){const pe=new Hs({checkCorrectEvent:Be=>H.mouseButton(Be)===0&&Be.ctrlKey||H.mouseButton(Be)===2});return new ss({clickTolerance:we,move:(Be,Qe)=>({pitchDelta:(Qe.y-Be.y)*Pe}),moveStateManager:pe,enable:he,assignEvents:Ws})})(e),O=(function({enable:he,clickTolerance:we,rollDegreesPerPixelMoved:Pe=.3},pe){const Be=new Hs({checkCorrectEvent:Qe=>H.mouseButton(Qe)===2&&Qe.ctrlKey});return new ss({clickTolerance:we,move:(Qe,Ue)=>{const We=pe();let Je=(Ue.x-Qe.x)*Pe;return Ue.y<We.y&&(Je=-Je),{rollDelta:Je}},moveStateManager:Be,enable:he,assignEvents:Ws})})(e,A);i.dragRotate=new lu(e,R,D,O),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const $=(function({enable:he,clickTolerance:we}){const Pe=new Hs({checkCorrectEvent:pe=>H.mouseButton(pe)===0&&!pe.ctrlKey});return new ss({clickTolerance:we,move:(pe,Be)=>({around:Be,panDelta:Be.sub(pe)}),activateOnStart:!0,moveStateManager:Pe,enable:he,assignEvents:Ws})})(e),ee=new Xs(e,i);i.dragPan=new gd(l,$,ee),this._add("mousePan",$),this._add("touchPan",ee,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const Q=new cs,ne=new Ol;i.touchZoomRotate=new vd(l,ne,Q,C),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const ue=i.scrollZoom=new md(i,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ue,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const _e=i.keyboard=new jl(i);this._add("keyboard",_e),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new pd(i))}_add(e,i,l){this._handlers.push({handlerName:e,handler:i,allowed:l}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ea(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,l){for(const u in e)if(u!==l&&(!i||i.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const l of e)this._el.contains(l.target)&&i.push(l);return i}mergeHandlerResult(e,i,l,u,d){if(!l)return;s.e(e,l);const g={handlerName:u,originalEvent:l.originalEvent||d};l.zoomDelta!==void 0&&(i.zoom=g),l.panDelta!==void 0&&(i.drag=g),l.rollDelta!==void 0&&(i.roll=g),l.pitchDelta!==void 0&&(i.pitch=g),l.bearingDelta!==void 0&&(i.rotate=g)}_applyChanges(){const e={},i={},l={};for(const[u,d,g]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new s.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.rollDelta&&(e.rollDelta=(e.rollDelta||0)+u.rollDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),s.e(i,d),s.e(l,g);this._updateMapTransform(e,i,l),this._changes=[]}_updateMapTransform(e,i,l){const u=this._map,d=u._getTransformForUpdate(),g=u.terrain;if(!(us(e)||g&&this._terrainMovement))return this._fireEvents(i,l,!0);u._stop(!0);let{panDelta:w,zoomDelta:C,bearingDelta:P,pitchDelta:A,rollDelta:R,around:D,pinchAround:O}=e;O!==void 0&&(D=O),D=D||u.transform.centerPoint,g&&!d.isPointOnMapSurface(D)&&(D=d.centerPoint);const $={panDelta:w,zoomDelta:C,rollDelta:R,pitchDelta:A,bearingDelta:P,around:D};this._map.cameraHelper.useGlobeControls&&!d.isPointOnMapSurface(D)&&(D=d.centerPoint);const ee=D.distSqr(d.centerPoint)<.01?d.center:d.screenPointToLocation(w?D.sub(w):D);g?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom($,d),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(w))):this._map.cameraHelper.handleMapControlsPan($,d,ee):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan($,d,ee))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom($,d),this._map.cameraHelper.handleMapControlsPan($,d,ee)),u._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,l,!0)}_fireEvents(e,i,l){const u=Ea(this._eventsInProgress),d=Ea(e),g={};for(const R in e){const{originalEvent:D}=e[R];this._eventsInProgress[R]||(g[`${R}start`]=D),this._eventsInProgress[R]=e[R]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const R in g)this._fireEvent(R,g[R]);d&&this._fireEvent("move",d.originalEvent);for(const R in e){const{originalEvent:D}=e[R];this._fireEvent(R,D)}const w={};let C;for(const R in this._eventsInProgress){const{handlerName:D,originalEvent:O}=this._eventsInProgress[R];this._handlersById[D].isActive()||(delete this._eventsInProgress[R],C=i[D]||O,w[`${R}end`]=C)}for(const R in w)this._fireEvent(R,w[R]);const P=Ea(this._eventsInProgress),A=(u||d)&&!P;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&A){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!R||!R.essential&&ie.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:C})),D(this._map.getBearing())&&this._map.resetNorth()):(D(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new s.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Un("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xd extends s.E{constructor(e,i,l){super(),this._renderFrameCallback=()=>{const u=Math.min((ie.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=i,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new s.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,l){return e=s.P.convert(e).mult(-1),this.panTo(this.transform.center,s.e({offset:e},i),l)}panTo(e,i,l){return this.easeTo(s.e({center:e},i),l)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,l){return this.easeTo(s.e({zoom:e},i),l)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new s.l("movestart",i)).fire(new s.l("move",i)).fire(new s.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,l){return this.easeTo(s.e({bearing:e},i),l)}resetNorth(e,i){return this.rotateTo(0,s.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=mt.convert(e).adjustAntiMeridian();const l=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,i)}_cameraForBoxAndBearing(e,i,l,u){const d={top:0,bottom:0,right:0,left:0};if(typeof(u=s.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const P=u.padding;u.padding={top:P,bottom:P,right:P,left:P}}const g=s.e(d,u.padding);u.padding=g;const w=this.transform,C=new mt(e,i);return this.cameraHelper.cameraForBoxAndBearing(u,g,C,l,w)}fitBounds(e,i,l){return this._fitInternal(this.cameraForBounds(e,i),i,l)}fitScreenCoordinates(e,i,l,u,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(e)),this.transform.screenPointToLocation(s.P.convert(i)),l,u),u,d)}_fitInternal(e,i,l){return e?(delete(i=s.e(e,i)).padding,i.linear?this.easeTo(i,l):this.flyTo(i,l)):this}jumpTo(e,i){this.stop();const l=this._getTransformForUpdate();let u=!1,d=!1,g=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const C=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(u=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(d=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(g=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new s.l("movestart",i)).fire(new s.l("move",i)),C&&this.fire(new s.l("zoomstart",i)).fire(new s.l("zoom",i)).fire(new s.l("zoomend",i)),u&&this.fire(new s.l("rotatestart",i)).fire(new s.l("rotate",i)).fire(new s.l("rotateend",i)),d&&this.fire(new s.l("pitchstart",i)).fire(new s.l("pitch",i)).fire(new s.l("pitchend",i)),g&&this.fire(new s.l("rollstart",i)).fire(new s.l("roll",i)).fire(new s.l("rollend",i)),this.fire(new s.l("moveend",i))}calculateCameraOptionsFromTo(e,i,l,u=0){const d=s.a1.fromLngLat(e,i),g=s.a1.fromLngLat(l,u),w=g.x-d.x,C=g.y-d.y,P=g.z-d.z,A=Math.hypot(w,C,P);if(A===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(w,C),D=s.ak(this.transform.cameraToCenterDistance/A/this.transform.tileSize),O=180*Math.atan2(w,-C)/Math.PI;let $=180*Math.acos(R/A)/Math.PI;return $=P<0?90-$:90+$,{center:g.toLngLat(),elevation:u,zoom:D,pitch:$,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,l,u,d){const g=this.transform.calculateCenterFromCameraLngLatAlt(e,i,l,u);return{center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:l,pitch:u,roll:d}}easeTo(e,i){this._stop(!1,e.easeId),((e=s.e({offset:[0,0],duration:500,easing:s.co},e)).animate===!1||!e.essential&&ie.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),u=this.getBearing(),d=l.pitch,g=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,u):u,C="pitch"in e?+e.pitch:d,P="roll"in e?this._normalizeBearing(e.roll,g):g,A="padding"in e?e.padding:l.padding,R=s.P.convert(e.offset);let D,O;e.around&&(D=s.S.convert(e.around),O=l.locationToScreenPoint(D));const $={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ee=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:C,roll:P,padding:A,around:D,aroundPoint:O,offsetAsPoint:R,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||u!==w,this._pitching=this._pitching||C!==d,this._rolling=this._rolling||P!==g,this._padding=!l.isPaddingEqual(A),this._zooming=this._zooming||ee.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,$),this.terrain&&this._prepareElevation(ee.elevationCenter),this._ease((Q=>{ee.easeFunc(Q),this.terrain&&!e.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(l),this._fireMoveEvents(i)}),(Q=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,Q)}),e),this}_prepareEase(e,i,l={}){this._moving=!0,i||l.moving||this.fire(new s.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new s.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new s.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new s.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new s.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(i-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(s.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),l=e.getCameraAltitude(),u=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(l<u){const d=this.calculateCameraOptionsFromTo(i,u,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push((u=>this._elevateCameraIfInsideTerrain(u))),this.transformCameraUpdate&&i.push((u=>this.transformCameraUpdate(u))),!i.length)return;const l=e.clone();for(const u of i){const d=l.clone(),{center:g,zoom:w,roll:C,pitch:P,bearing:A,elevation:R}=u(d);g&&d.setCenter(g),R!==void 0&&d.setElevation(R),w!==void 0&&d.setZoom(w),C!==void 0&&d.setRoll(C),P!==void 0&&d.setPitch(P),A!==void 0&&d.setBearing(A),l.apply(d)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new s.l("move",e)),this._zooming&&this.fire(new s.l("zoom",e)),this._rotating&&this.fire(new s.l("rotate",e)),this._pitching&&this.fire(new s.l("pitch",e)),this._rolling&&this.fire(new s.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const l=this._zooming,u=this._rotating,d=this._pitching,g=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new s.l("zoomend",e)),u&&this.fire(new s.l("rotateend",e)),d&&this.fire(new s.l("pitchend",e)),g&&this.fire(new s.l("rollend",e)),this.fire(new s.l("moveend",e))}flyTo(e,i){if(!e.essential&&ie.prefersReducedMotion){const Je=s.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Je,i)}this.stop(),e=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.co},e);const l=this._getTransformForUpdate(),u=l.bearing,d=l.pitch,g=l.roll,w=l.padding,C="bearing"in e?this._normalizeBearing(e.bearing,u):u,P="pitch"in e?+e.pitch:d,A="roll"in e?this._normalizeBearing(e.roll,g):g,R="padding"in e?e.padding:l.padding,D=s.P.convert(e.offset);let O=l.centerPoint.add(D);const $=l.screenPointToLocation(O),ee=this.cameraHelper.handleFlyTo(l,{bearing:C,pitch:P,roll:A,padding:R,locationAtOffset:$,offsetAsPoint:D,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let Q=e.curve;const ne=Math.max(l.width,l.height),ue=ne/ee.scaleOfZoom,_e=ee.pixelPathLength;typeof ee.scaleOfMinZoom=="number"&&(Q=Math.sqrt(ne/ee.scaleOfMinZoom/_e*2));const he=Q*Q;function we(Je){const Nt=(ue*ue-ne*ne+(Je?-1:1)*he*he*_e*_e)/(2*(Je?ue:ne)*he*_e);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Pe(Je){return(Math.exp(Je)-Math.exp(-Je))/2}function pe(Je){return(Math.exp(Je)+Math.exp(-Je))/2}const Be=we(!1);let Qe=function(Je){return pe(Be)/pe(Be+Q*Je)},Ue=function(Je){return ne*((pe(Be)*(Pe(Nt=Be+Q*Je)/pe(Nt))-Pe(Be))/he)/_e;var Nt},We=(we(!0)-Be)/Q;if(Math.abs(_e)<2e-6||!isFinite(We)){if(Math.abs(ne-ue)<1e-6)return this.easeTo(e,i);const Je=ue<ne?-1:1;We=Math.abs(Math.log(ue/ne))/Q,Ue=()=>0,Qe=Nt=>Math.exp(Je*Q*Nt)}return e.duration="duration"in e?+e.duration:1e3*We/("screenSpeed"in e?+e.screenSpeed/Q:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=u!==C,this._pitching=P!==d,this._rolling=A!==g,this._padding=!l.isPaddingEqual(R),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(ee.targetCenter),this._ease((Je=>{const Nt=Je*We,Zt=1/Qe(Nt),Tt=Ue(Nt);this._rotating&&l.setBearing(s.C.number(u,C,Je)),this._pitching&&l.setPitch(s.C.number(d,P,Je)),this._rolling&&l.setRoll(s.C.number(g,A,Je)),this._padding&&(l.interpolatePadding(w,R,Je),O=l.centerPoint.add(D)),ee.easeFunc(Je,Zt,Tt,O),this.terrain&&!e.freezeElevation&&this._updateElevation(Je),this._applyUpdatedTransform(l),this._fireMoveEvents(i)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,i)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,i,l){l.animate===!1||l.duration===0?(e(1),i()):(this._easeStart=ie.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=s.aO(e,-180,180);const l=Math.abs(e-i);return Math.abs(e-360-i)<l&&(e-=360),Math.abs(e+360-i)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(s.S.convert(e),this.transform.tileZoom):null}}const uu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class hu{constructor(e=uu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const l=this._map._getUIString(`AttributionControl.${i}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((u=>typeof u!="string"?"":u))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const i=this._map.style.sourceCaches;for(const u in i){const d=i[u];if(d.used||d.usedForTerrain){const g=d.getSource();g.attribution&&e.indexOf(g.attribution)<0&&e.push(g.attribution)}}e=e.filter((u=>String(u).trim())),e.sort(((u,d)=>u.length-d.length)),e=e.filter(((u,d)=>{for(let g=d+1;g<e.length;g++)if(e[g].indexOf(u)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=H.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class bd{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl");const i=H.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class $a{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,l=i?this._queue.concat(i):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const l of i)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ql=s.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class yr extends s.E{constructor(e){super(),this._lastTilesetChange=ie.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const l={};for(const u of xe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.terrainRttPosMatrix32f=new Float64Array(16),s.bY(u.terrainRttPosMatrix32f,0,s.$,s.$,0,0,1),this._tiles[u.key]=new Zr(u,this.tileSize),this._lastTilesetChange=ie.now());for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const i in this._tiles){const l=this._tiles[i];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID,d=e.clone(),g=s.ba();if(u.canonical.equals(e.canonical))s.bY(g,0,s.$,s.$,0,0,1);else if(u.canonical.isChildOf(e.canonical)){const w=u.canonical.z-e.canonical.z,C=u.canonical.x-(u.canonical.x>>w<<w),P=u.canonical.y-(u.canonical.y>>w<<w),A=s.$>>w;s.bY(g,0,A,A,0,0,1),s.M(g,g,[-C*A,-P*A,0])}else{if(!e.canonical.isChildOf(u.canonical))continue;{const w=e.canonical.z-u.canonical.z,C=e.canonical.x-(e.canonical.x>>w<<w),P=e.canonical.y-(e.canonical.y>>w<<w),A=s.$>>w;s.bY(g,0,s.$,s.$,0,0,1),s.M(g,g,[C*A,P*A,0]),s.N(g,g,[1/2**w,1/2**w,0])}}d.terrainRttPosMatrix32f=new Float32Array(g),i[l]=d}return i}_getTerrainCoordsForTileRanges(e,i){const l={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(!this._isWithinTileRanges(d,i))continue;const g=e.clone(),w=s.ba();if(d.canonical.z===e.canonical.z){const C=e.canonical.x-d.canonical.x,P=e.canonical.y-d.canonical.y;s.bY(w,0,s.$,s.$,0,0,1),s.M(w,w,[C*s.$,P*s.$,0])}else if(d.canonical.z>e.canonical.z){const C=d.canonical.z-e.canonical.z,P=d.canonical.x-(d.canonical.x>>C<<C),A=d.canonical.y-(d.canonical.y>>C<<C),R=e.canonical.x-(d.canonical.x>>C),D=e.canonical.y-(d.canonical.y>>C),O=s.$>>C;s.bY(w,0,O,O,0,0,1),s.M(w,w,[-P*O+R*s.$,-A*O+D*s.$,0])}else{const C=e.canonical.z-d.canonical.z,P=e.canonical.x-(e.canonical.x>>C<<C),A=e.canonical.y-(e.canonical.y>>C<<C),R=(e.canonical.x>>C)-d.canonical.x,D=(e.canonical.y>>C)-d.canonical.y,O=s.$<<C;s.bY(w,0,O,O,0,0,1),s.M(w,w,[P*s.$+R*O,A*s.$+D*O,0])}g.terrainRttPosMatrix32f=new Float32Array(w),l[u]=g}return l}getSourceTile(e,i){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&i)for(;u>=l.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(u--).key);return d}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class Or{constructor(e,i,l){this._meshCache={},this.painter=e,this.sourceCache=new yr(i),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,l,u=s.$){var d;if(!(i>=0&&i<u&&l>=0&&l<u))return 0;const g=this.getTerrainData(e),w=(d=g.tile)===null||d===void 0?void 0:d.dem;if(!w)return 0;const C=s.cs([],[i/u*s.$,l/u*s.$],g.u_terrain_matrix),P=[C[0]*w.dim,C[1]*w.dim],A=Math.floor(P[0]),R=Math.floor(P[1]),D=P[0]-A,O=P[1]-R;return w.get(A,R)*(1-D)*(1-O)+w.get(A+1,R)*D*(1-O)+w.get(A,R+1)*(1-D)*O+w.get(A+1,R+1)*D*O}getElevationForLngLatZoom(e,i){if(!s.ct(i,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(l,u%s.$,d%s.$,s.$)}getElevation(e,i,l,u=s.$){return this.getDEMElevation(e,i,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,d=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(u,d,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(u,new s.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ag([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const u=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new s.T(u,i.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),i.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const l=i&&i+i.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?d=e.canonical.z-u:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=e.canonical.x-(e.canonical.x>>d<<d),w=e.canonical.y-(e.canonical.y>>d<<d),C=s.cu(new Float64Array(16),[1/(s.$<<d),1/(s.$<<d),0]);s.M(C,C,[g*s.$,w*s.$,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,l=i.width/devicePixelRatio,u=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(i.context,{width:l,height:u,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(i.context,{width:l,height:u,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,g=0;d<this._coordsTextureSize;d++)for(let w=0;w<this._coordsTextureSize;w++,g+=4)i[g+0]=255&w,i[g+1]=255&d,i[g+2]=w>>8<<4|d>>8,i[g+3]=0;const l=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),u=new s.T(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),l=this.painter.context,u=l.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),g=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(d,w-g-1,1,1,u.RGBA,u.UNSIGNED_BYTE,i),l.bindFramebuffer.set(null);const C=i[0]+(i[2]>>4<<8),P=i[1]+((15&i[2])<<8),A=this.coordsIndex[255-i[3]],R=A&&this.sourceCache.getTileByID(A);if(!R)return null;const D=this._coordsTextureSize,O=(1<<R.tileID.canonical.z)*D;return new s.a1((R.tileID.canonical.x*D+C)/O+R.tileID.wrap,(R.tileID.canonical.y*D+P)/O,this.getElevation(R.tileID,C,P,D))}depthAtPoint(e){const i=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,i),l.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const l=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,u=l&&e.canonical.y===0,d=l&&e.canonical.y===(1<<e.canonical.z)-1,g=`m_${u?"n":""}_${d?"s":""}`;if(this._meshCache[g])return this._meshCache[g];const w=this.painter.context,C=new s.cv,P=new s.aN,A=this.meshSize,R=s.$/A,D=A*A;for(let pe=0;pe<=A;pe++)for(let Be=0;Be<=A;Be++)C.emplaceBack(Be*R,pe*R,0);for(let pe=0;pe<D;pe+=A+1)for(let Be=0;Be<A;Be++)P.emplaceBack(Be+pe,A+Be+pe+1,A+Be+pe+2),P.emplaceBack(Be+pe,A+Be+pe+2,Be+pe+1);const O=C.length,$=O+(A+1),ee=(A+1)*A,Q=u?s.bh:0,ne=u?0:1,ue=d?s.bi:s.$,_e=d?0:1;for(let pe=0;pe<=A;pe++)C.emplaceBack(pe*R,Q,ne);for(let pe=0;pe<=A;pe++)C.emplaceBack(pe*R,ue,_e);for(let pe=0;pe<A;pe++)P.emplaceBack(ee+pe,$+pe,$+pe+1),P.emplaceBack(ee+pe,$+pe+1,ee+pe+1),P.emplaceBack(0+pe,O+pe+1,O+pe),P.emplaceBack(0+pe,0+pe+1,O+pe+1);const he=C.length,we=he+2*(A+1);for(const pe of[0,1])for(let Be=0;Be<=A;Be++)for(const Qe of[0,1])C.emplaceBack(pe*s.$,Be*R,Qe);for(let pe=0;pe<2*A;pe+=2)P.emplaceBack(he+pe,he+pe+1,he+pe+3),P.emplaceBack(he+pe,he+pe+3,he+pe+2),P.emplaceBack(we+pe,we+pe+3,we+pe+1),P.emplaceBack(we+pe,we+pe+2,we+pe+3);const Pe=new Tn(w.createVertexBuffer(C,ql.members),w.createIndexBuffer(P),s.aM.simpleSegment(0,0,C.length,P.length));return this._meshCache[g]=Pe,Pe}getMeshFrameDelta(e){return 2*Math.PI*s.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return i&&i.dem&&(l.minElevation=i.dem.min*this.exaggeration,l.maxElevation=i.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,i){const l=s.a1.fromLngLat(e.wrap()),u=(1<<i)*s.$,d=l.x*u,g=l.y*u,w=Math.floor(d/s.$),C=Math.floor(g/s.$);return{tileID:new s.Z(i,0,i,w,C),mercatorX:d,mercatorY:g}}}class Zl{constructor(e,i,l){this._context=e,this._size=i,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(l.texture),{id:e,fbo:i,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((i=>e.id!==i)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const _o={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ul{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new Zl(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(i))),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const u=e.sourceCaches[l].getVisibleCoordinates(),d=e.sourceCaches[l].getSource(),g=d instanceof Ot?d.terrainTileRanges:null;for(const w of u){const C=this.terrain.sourceCache.getTerrainCoords(w,g);for(const P in C)this._coordsAscending[l][P]||(this._coordsAscending[l][P]=[]),this._coordsAscending[l][P].push(C[P])}}this._coordsAscendingStr={};for(const l of e._order){const u=e._layers[l],d=u.source;if(_o[u.type]&&!this._coordsAscendingStr[d]){this._coordsAscendingStr[d]={};for(const g in this._coordsAscending[d])this._coordsAscendingStr[d][g]=this._coordsAscending[d][g].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsAscendingStr){const d=this._coordsAscendingStr[u][l.tileID.key];d&&d!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),u=e.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(_o[u]&&(this._prevType&&_o[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(e.id),!g))return!0;if(_o[this._prevType]||_o[u]&&g){this._prevType=u;const w=this._stacks.length-1,C=this._stacks[w]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(Bl(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[w]){const R=this.pool.getObjectForId(P.rtt[w].id);if(R.stamp===P.rtt[w].stamp){this.pool.useObject(R);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),P.rtt[w]={id:A.id,stamp:A.stamp},d.context.bindFramebuffer.set(A.fbo.framebuffer),d.context.clear({color:s.bf.transparent,stencil:0}),d.currentStencilSource=void 0;for(let R=0;R<C.length;R++){const D=d.style._layers[C[R]],O=D.source?this._coordsAscending[D.source][P.tileID.key]:[P.tileID];d.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),d._renderTileClippingMasks(D,O,!0),d.renderLayer(d,d.style.sourceCaches[D.source],D,O,l),D.source&&(P.rttCoords[D.source]=this._coordsAscendingStr[D.source][P.tileID.key])}}return Bl(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),_o[u]}return!1}}const Zi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use âŒ˜ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},wd=B,xa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:uu,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Up={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ys{constructor(e,i,l=!1){this.mousedown=d=>{this.startMove(d,H.mousePos(this.element,d)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=d=>{this.move(d,H.mousePos(this.element,d))},this.mouseup=d=>{this._rotatePitchHandler.dragEnd(d),this.offTemp()},this.touchstart=d=>{d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,d.targetTouches)[0],this.startMove(d,this._startPos),H.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.addEventListener(window,"touchend",this.touchend))},this.touchmove=d=>{d.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,d.targetTouches)[0],this.move(d,this._lastPos))},this.touchend=d=>{d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const u=new Vp;this._rotatePitchHandler=new ss({clickTolerance:3,move:(d,g)=>{const w=i.getBoundingClientRect(),C=new s.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:s.cn(new s.P(d.x,g.y),g,C),pitchDelta:l?-.5*(g.y-d.y):void 0}},moveStateManager:u,enable:!0,assignEvents:()=>{}}),this.map=e,H.addEventListener(i,"mousedown",this.mousedown),H.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHandler.dragStart(e,i),H.disableDrag()}move(e,i){const l=this.map,{bearingDelta:u,pitchDelta:d}=this._rotatePitchHandler.dragMove(e,i)||{};u&&l.setBearing(l.getBearing()+u),d&&l.setPitch(l.getPitch()+d)}off(){const e=this.element;H.removeEventListener(e,"mousedown",this.mousedown),H.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend),H.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend)}}let Rn;function ti(h,e,i,l=!1){if(l||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return h==null?void 0:h.wrap();const u=new s.S(h.lng,h.lat);if(h=new s.S(h.lng,h.lat),e){const d=new s.S(h.lng-360,h.lat),g=new s.S(h.lng+360,h.lat),w=i.locationToScreenPoint(h).distSqr(e);i.locationToScreenPoint(d).distSqr(e)<w?h=d:i.locationToScreenPoint(g).distSqr(e)<w&&(h=g)}for(;Math.abs(h.lng-i.center.lng)>180;){const d=i.locationToScreenPoint(h);if(d.x>=0&&d.y>=0&&d.x<=i.width&&d.y<=i.height)break;h.lng>i.center.lng?h.lng-=360:h.lng+=360}return h.lng!==u.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(h))?h:u}const $l={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hs(h,e,i){const l=h.classList;for(const u in $l)l.remove(`maplibregl-${i}-anchor-${u}`);l.add(`maplibregl-${i}-anchor-${e}`)}class ds extends s.E{constructor(e){if(super(),this._onKeyPress=i=>{const l=i.code,u=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=i=>{const l=i.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=ti(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${$l[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${u}`),ie.frameAsync(new AbortController).then((()=>{this._updateOpacity(i&&i.type==="moveend")})).catch((()=>{}))},this._onMove=i=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=s.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div");const i=H.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${l}px`),i.setAttributeNS(null,"width",`${u}px`),i.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const d=H.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const g=H.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const w=H.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ne of C){const ue=H.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",ne.rx),ue.setAttributeNS(null,"ry",ne.ry),w.appendChild(ue)}const P=H.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const A=H.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(A);const R=H.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const D=H.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(D);const O=H.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");const $=H.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=H.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const Q=H.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),$.appendChild(ee),$.appendChild(Q),g.appendChild(w),g.appendChild(P),g.appendChild(R),g.appendChild(O),g.appendChild($),i.appendChild(g),i.setAttributeNS(null,"height",l*this._scale+"px"),i.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(i),this._offset=s.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(i=>{i.preventDefault()})),this._element.addEventListener("mousedown",(i=>{i.preventDefault()})),hs(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=s.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,l;const u=(i=this._map)===null||i===void 0?void 0:i.terrain,d=this._map.transform.isLocationOccluded(this._lngLat);if(!u||d){const O=d?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const g=this._map,w=g.terrain.depthAtPoint(this._pos),C=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,C)-w<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/g.transform.pixelsPerMeter,A=Math.sin(g.getPitch()*Math.PI/180)*P,R=g.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),D=g.transform.lngLatToCameraDepth(this._lngLat,C+A)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=s.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const du={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ps=0,jo=!1;const Ks={maxWidth:100,unit:"metric"};function Gl(h,e,i){const l=i&&i.maxWidth||100,u=h._container.clientHeight/2,d=h._container.clientWidth/2,g=h.unproject([d-l/2,u]),w=h.unproject([d+l/2,u]),C=Math.round(h.project(w).x-h.project(g).x),P=Math.min(l,C,h._container.clientWidth),A=g.distanceTo(w);if(i&&i.unit==="imperial"){const R=3.2808*A;R>5280?Vo(e,P,R/5280,h._getUIString("ScaleControl.Miles")):Vo(e,P,R,h._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Vo(e,P,A/1852,h._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Vo(e,P,A/1e3,h._getUIString("ScaleControl.Kilometers")):Vo(e,P,A,h._getUIString("ScaleControl.Meters"))}function Vo(h,e,i,l){const u=(function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let w=d/g;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(C){const P=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*P)/P})(w),g*w})(i);h.style.width=e*(u/i)+"px",h.innerHTML=`${u}&nbsp;${l}`}const pu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},fu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hl(h){if(h){if(typeof h=="number"){const e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,h),"top-left":new s.P(e,e),"top-right":new s.P(-e,e),bottom:new s.P(0,-h),"bottom-left":new s.P(e,-e),"bottom-right":new s.P(-e,-e),left:new s.P(h,0),right:new s.P(-h,0)}}if(h instanceof s.P||Array.isArray(h)){const e=s.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:s.P.convert(h.center||[0,0]),top:s.P.convert(h.top||[0,0]),"top-left":s.P.convert(h["top-left"]||[0,0]),"top-right":s.P.convert(h["top-right"]||[0,0]),bottom:s.P.convert(h.bottom||[0,0]),"bottom-left":s.P.convert(h["bottom-left"]||[0,0]),"bottom-right":s.P.convert(h["bottom-right"]||[0,0]),left:s.P.convert(h.left||[0,0]),right:s.P.convert(h.right||[0,0])}}return Hl(new s.P(0,0))}const mu=B;T.AJAXError=s.cz,T.Event=s.l,T.Evented=s.E,T.LngLat=s.S,T.MercatorCoordinate=s.a1,T.Point=s.P,T.addProtocol=s.cA,T.config=s.a,T.removeProtocol=s.cB,T.AttributionControl=hu,T.BoxZoomHandler=nu,T.CanvasSource=kr,T.CooperativeGesturesHandler=yd,T.DoubleClickZoomHandler=ou,T.DragPanHandler=gd,T.DragRotateHandler=lu,T.EdgeInsets=Mn,T.FullscreenControl=class extends s.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=Qt,T.GeolocateControl=class extends s.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new s.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),d=s.e({bearing:u},this.options.fitBoundsOptions),g=mt.fromLngLat(i,l);this._map.fitBounds(g,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new s.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&jo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ds({element:this._dotElement}),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ds({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(i=>{const l=(i==null?void 0:i[0])instanceof ResizeObserverEntry;i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},du,h)}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(e=!1){if(Rn!==void 0&&!e)return Rn;if(window.navigator.permissions===void 0)return Rn=!!window.navigator.geolocation,Rn;try{Rn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Rn=!!window.navigator.geolocation}return Rn}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ps=0,jo=!1}_isOutOfMapMaxBounds(h){const e=this._map.getMaxBounds(),i=h.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),e=h.getSouthEast(),i=h.getNorthEast(),l=e.distanceTo(i),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ps--,jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ps++,ps>1?(h={maximumAge:6e5,timeout:0},jo=!0):(h=this.options.positionOptions,jo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;const e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=H.create("button","maplibregl-ctrl-globe",this._container),H.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=Fl,T.ImageSource=Ot,T.KeyboardHandler=jl,T.LngLatBounds=mt,T.LogoControl=bd,T.Map=class extends xd{constructor(h){var e,i;s.cw.mark(s.cx.create);const l=Object.assign(Object.assign(Object.assign({},xa),h),{canvasContextAttributes:Object.assign(Object.assign({},xa.canvasContextAttributes),h.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const u=new an,d=new jn;if(l.minZoom!==void 0&&u.setMinZoom(l.minZoom),l.maxZoom!==void 0&&u.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&u.setMinPitch(l.minPitch),l.maxPitch!==void 0&&u.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&u.setRenderWorldCopies(l.renderWorldCopies),super(u,d,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new $a,this._controls=[],this._mapId=s.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Zi),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Fe.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ke(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const C=Oo((P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())}),50);this._resizeObserver=new ResizeObserver((P=>{w?C(P):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new cu(this,l),this._hash=l.hash&&new Fl(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,s.e({},l.fitBoundsOptions,{duration:0}))));const g=typeof l.style=="string"||((i=(e=l.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,g),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new hu(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new bd,l.logoPosition),this.on("style.load",(()=>{if(g||this._resizeTransform(),this.transform.unmodified){const w=s.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new s.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new s.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new s.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(h,e){return this.style.setGlobalStateProperty(h,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=h.onAdd(this);this._controls.push(h);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(i,l.firstChild):l.appendChild(i),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,i,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,i,l)}resize(h,e=!0){const[i,l]=this._containerDimensions(),u=this._getClampedPixelRatio(i,l);if(this._resizeCanvas(i,l,u),this.painter.resize(i,l,u),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const w=this._getClampedPixelRatio(i,l);this._resizeCanvas(i,l,w),this.painter.resize(i,l,w)}this._resizeTransform(e);const d=!this._moving;return d&&(this.stop(),this.fire(new s.l("movestart",h)).fire(new s.l("move",h))),this.fire(new s.l("resize",h)),d&&this.fire(new s.l("moveend",h)),this}_resizeTransform(h=!0){var e;const[i,l]=this._containerDimensions();this.transform.resize(i,l,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,l,h)}_getClampedPixelRatio(h,e){const{0:i,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),d=h*u,g=e*u;return Math.min(d>i?i/d:1,g>l?l/g:1)*u}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(mt.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(s.S.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(s.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,i){if(h==="mouseenter"||h==="mouseover"){let l=!1;return{layers:e,listener:i,delegates:{mousemove:d=>{const g=e.filter((C=>this.getLayer(C))),w=g.length!==0?this.queryRenderedFeatures(d.point,{layers:g}):[];w.length?l||(l=!0,i.call(this,new Qi(h,this,d.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(h==="mouseleave"||h==="mouseout"){let l=!1;return{layers:e,listener:i,delegates:{mousemove:g=>{const w=e.filter((C=>this.getLayer(C)));(w.length!==0?this.queryRenderedFeatures(g.point,{layers:w}):[]).length?l=!0:l&&(l=!1,i.call(this,new Qi(h,this,g.originalEvent)))},mouseout:g=>{l&&(l=!1,i.call(this,new Qi(h,this,g.originalEvent)))}}}}{const l=u=>{const d=e.filter((w=>this.getLayer(w))),g=d.length!==0?this.queryRenderedFeatures(u.point,{layers:d}):[];g.length&&(u.features=g,i.call(this,u),delete u.features)};return{layers:e,listener:i,delegates:{[h]:l}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,i){if(!this._delegatedListeners||!this._delegatedListeners[h])return;const l=this._delegatedListeners[h];for(let u=0;u<l.length;u++){const d=l[u];if(d.listener===i&&d.layers.length===e.length&&d.layers.every((g=>e.includes(g)))){for(const g in d.delegates)this.off(g,d.delegates[g]);return void l.splice(u,1)}}}on(h,e,i){if(i===void 0)return super.on(h,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(h,l,i);this._saveDelegatedListener(h,u);for(const d in u.delegates)this.on(d,u.delegates[d]);return{unsubscribe:()=>{this._removeDelegatedListener(h,l,i)}}}once(h,e,i){if(i===void 0)return super.once(h,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(h,l,i);for(const d in u.delegates){const g=u.delegates[d];u.delegates[d]=(...w)=>{this._removeDelegatedListener(h,l,i),g(...w)}}this._saveDelegatedListener(h,u);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(h,e,i){return i===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let i;const l=h instanceof s.P||Array.isArray(h),u=l?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:h)||{},u instanceof s.P||typeof u[0]=="number")i=[s.P.convert(u)];else{const d=s.P.convert(u[0]),g=s.P.convert(u[1]);i=[d,new s.P(g.x,d.y),g,new s.P(d.x,g.y),d]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var i,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(h,e)));const u=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new zc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,u):this.style.loadJSON(h,e,u),this):((l=(i=this.style)===null||i===void 0?void 0:i.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){const i=this._requestManager.transformRequest(h,"Style");s.j(i,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new s.k(l))}))}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(i){s.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){const e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new s.k(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const l=this.style._layers[i];l.type==="hillshade"&&l.source===h.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===h.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Or(this.painter,e,h),this.painter.renderToTexture=new Ul(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var l;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=i.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const e in h){const i=h[e]._tiles;for(const l in i){const u=i[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}setSourceTileLodParams(h,e,i){if(i){const l=this.getSource(i);if(!l)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);l.calculateTileZoom=st(Math.max(1,h),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=st(Math.max(1,h),Math.max(1,e));return this._update(!0),this}refreshTiles(h,e){const i=this.style.sourceCaches[h];if(!i)throw new Error(`There is no source cache with ID "${h}", cannot refresh tile`);e===void 0?i.reload(!0):i.refreshTiles(e.map((l=>new s.a4(l.z,l.x,l.y))))}addImage(h,e,i={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:d,stretchY:g,content:w,textFitWidth:C,textFitHeight:P}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||s.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:R,data:D}=e,O=e;return this.style.addImage(h,{data:new s.R({width:A,height:R},new Uint8Array(D)),pixelRatio:l,stretchX:d,stretchY:g,content:w,textFitWidth:C,textFitHeight:P,sdf:u,version:0,userImage:O}),O.onAdd&&O.onAdd(this,h),this}}{const{width:A,height:R,data:D}=ie.getImageData(e);this.style.addImage(h,{data:new s.R({width:A,height:R},D),pixelRatio:l,stretchX:d,stretchY:g,content:w,textFitWidth:C,textFitHeight:P,sdf:u,version:0})}}updateImage(h,e){const i=this.style.getImage(h);if(!i)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||s.b(e)?ie.getImageData(e):e,{width:u,height:d,data:g}=l;if(u===void 0||d===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==i.data.width||d!==i.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||s.b(e));return i.data.replace(g,w),this.style.updateImage(h,i),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return Fe.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,i){return this.style.setLayerZoomRange(h,e,i),this._update(!0)}setFilter(h,e,i={}){return this.style.setFilter(h,e,i),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,i,l={}){return this.style.setPaintProperty(h,e,i,l),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,i,l={}){return this.style.setLayoutProperty(h,e,i,l),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,i,(l=>{l||this._update(!0)})),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,(i=>{i||this._update(!0)})),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const e=this._canvasContainer=H.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),l=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],l);const u=this._controlContainer=H.create("div","maplibregl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((g=>{d[g]=H.create("div",`maplibregl-ctrl-${g} `,u)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,i){this._canvas.width=Math.floor(i*h),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:h},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!i){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new od(i,this.transform),me.testSupport(i)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,i,l,u,d;const g=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,D=ie.now();this.style.zoomHistory.update(R,D);const O=new s.F(R,{now:D,fadeDuration:g,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),$=O.crossFadingFactor();$===1&&$===this._crossFadingFactor||(C=!0,this._crossFadingFactor=$),this.style.update(O)}const P=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((u=this.style.projection)===null||u===void 0?void 0:u.transitionState,(d=this.style.projection)===null||d===void 0?void 0:d.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cw.mark(s.cx.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,s.cw.mark(s.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Fe.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cw.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ie.frame(this._frameRequest,(h=>{s.cw.frame(h),this._frameRequest=null;try{this._render(h)}catch(e){if(!s.cy(e)&&!(function(i){return i.message===js})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return wd}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},T.MapMouseEvent=Qi,T.MapTouchEvent=is,T.MapWheelEvent=ru,T.Marker=ds,T.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const l=this._map._getUIString(`NavigationControl.${i}`);e.title=l,e.setAttribute("aria-label",l)},this.options=s.e({},Up,h),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),H.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),H.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=H.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ys(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){const i=H.create("button",h,this._container);return i.type="button",i.addEventListener("click",e),i}},T.Popup=class extends s.E{constructor(h){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=H.create("div","maplibregl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ti(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const u=Hl(this.options.offset);if(!l){const g=this._container.offsetWidth,w=this._container.offsetHeight;let C;C=i.y+u.bottom.y<w?["top"]:i.y>this._map.transform.height-w?["bottom"]:[],i.x<g/2?C.push("left"):i.x>this._map.transform.width-g/2&&C.push("right"),l=C.length===0?"bottom":C.join("-")}let d=i.add(u[l]);this.options.subpixelPositioning||(d=d.round()),H.setTransform(this._container,`${$l[l]} translate(${d.x}px,${d.y}px)`),hs(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(pu),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=s.S.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const e=document.createDocumentFragment(),i=document.createElement("body");let l;for(i.innerHTML=h;l=i.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(fu);h&&h.focus()}},T.RasterDEMTileSource=tr,T.RasterTileSource=qt,T.ScaleControl=class{constructor(h){this._onMove=()=>{Gl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Gl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ks),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=md,T.Style=zc,T.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=Nl,T.TwoFingersTouchRotateHandler=cs,T.TwoFingersTouchZoomHandler=Ol,T.TwoFingersTouchZoomRotateHandler=vd,T.VectorTileSource=zt,T.VideoSource=fr,T.addSourceType=(h,e)=>s._(void 0,void 0,void 0,(function*(){if(rr(h))throw new Error(`A source type called "${h}" already exists.`);((i,l)=>{Ar[i]=l})(h,e)})),T.clearPrewarmedResources=function(){const h=ot;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Ae),ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=Is,T.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Dr().getRTLTextPluginStatus()},T.getVersion=function(){return mu},T.getWorkerCount=function(){return Ne.workerCount},T.getWorkerUrl=function(){return s.a.WORKER_URL},T.importScriptInWorkers=function(h){return at().broadcast("IS",h)},T.prewarm=function(){St().acquire(Ae)},T.setMaxParallelImageRequests=function(h){s.a.MAX_PARALLEL_IMAGE_REQUESTS=h},T.setRTLTextPlugin=function(h,e){return Dr().setRTLTextPlugin(h,e)},T.setWorkerCount=function(h){Ne.workerCount=h},T.setWorkerUrl=function(h){s.a.WORKER_URL=h}}));var z=f;return z}))})(Wd)),Wd.exports}var zI=EI();const Vd=qm(zI);class ev{constructor(o){gr(this,"gm");gr(this,"markers",new Map);gr(this,"canvases",new Map);gr(this,"canvasSize");gr(this,"canvasOpacity",.8);this.input=o,this.gm=new fl(this.input.tileSize);const f=r0(o.img);this.canvasSize=Math.ceil(2e3/f)}place([o,f]){const y=this.gm.latLonToPixelsFloor(o,f,this.input.zoom),M=this.getMarkerId(y),z=this.gm.latLonToPixelBoundsLatLon(o,f,this.input.zoom),T=this.input.map;if(this.input.markerFn&&!this.markers.has(M)){const K=this.input.markerFn();K.setLngLat({lat:z.min[0],lng:(z.max[1]+z.min[1])/2}).addTo(T),this.markers.set(M,K)}const{key:s,pos:B,innerPos:N}=this.getCanvasPos(y);let Y=this.canvases.get(s);if(!Y){const K=this.canvasSize,ie=B.x*K,H=B.y*K,me=ie+K-1,ve=H+K-1,Me=this.gm.pixelsToLatLon(ie,ve+1,this.input.zoom),Ee=this.gm.pixelsToLatLon(me+1,H,this.input.zoom);Y=new LI({id:`${this.input.id}-${s}`,img:this.input.img,canvasSize:this.canvasSize,coordinates:jm({min:Me,max:Ee}),layerPaint:{"raster-resampling":"nearest","raster-opacity":this.canvasOpacity}}),Y.addTo(this.input.map),this.canvases.set(s,Y)}Y.place(N.x,N.y)}clear(){const o=this.input.map;for(const f of this.canvases.values())f.removeFrom(o),f.removeDOM();this.canvases.clear();for(const f of this.markers.values())f.remove();this.markers.clear()}clearAndPlace(o){this.clear(),this.place(o)}remove([o,f]){let y=!1;const M=this.gm.latLonToPixelsFloor(o,f,this.input.zoom),{key:z,innerPos:T}=this.getCanvasPos(M),s=this.canvases.get(z);s&&(y=s.remove(T.x,T.y),s.annotationsCount()===0&&(this.canvases.delete(z),s.removeFrom(this.input.map),s.removeDOM()));const B=this.getMarkerId(M),N=this.markers.get(B);return N==null||N.remove(),this.markers.delete(B),y}setCanvasOpacity(o){this.canvasOpacity=o;for(const f of this.canvases.values())f.setOpacity(o)}getMarkerId([o,f]){return`${this.input.id}:${o},${f}`}getCanvasPos([o,f]){const y={x:Math.floor(o/this.canvasSize),y:Math.floor(f/this.canvasSize)},M={x:o%this.canvasSize,y:f%this.canvasSize},z=`${y.x},${y.y}`;return{pos:y,innerPos:M,key:z}}}class LI{constructor(o){gr(this,"annotations",new Set);gr(this,"canvas");gr(this,"imgSize");gr(this,"maps",new Set);this.input=o,this.imgSize=r0(o.img),this.canvas=document.createElement("canvas"),this.canvas.width=this.input.canvasSize*this.imgSize,this.canvas.height=this.input.canvasSize*this.imgSize}place(o,f){const y=this.getPixelKey(o,f);if(this.annotations.has(y))return!1;const M=this.canvas.getContext("2d");if(M){const z=o*this.imgSize,T=f*this.imgSize;M.drawImage(this.input.img,z,T)}return this.annotations.add(y),!0}remove(o,f){const y=this.getPixelKey(o,f);if(!this.annotations.has(y))return!1;const M=this.canvas.getContext("2d");if(M){const z=o*this.imgSize,T=f*this.imgSize;M.clearRect(z,T,this.imgSize,this.imgSize)}return this.annotations.delete(y),!0}addTo(o){const f=this.input.id;o.getSource(f)||o.addSource(f,{type:"canvas",canvas:this.canvas,coordinates:this.input.coordinates}),o.getLayer(f)||o.addLayer({id:f,type:"raster",source:f,paint:this.input.layerPaint}),this.maps.add(o)}removeFrom(o){const{id:f}=this.input;o.getLayer(f)&&o.removeLayer(f),o.getSource(f)&&o.removeSource(f),this.maps.delete(o)}removeDOM(){this.canvas.remove()}annotationsCount(){return this.annotations.size}setOpacity(o){for(const f of this.maps.values())f.setPaintProperty(this.input.id,"raster-opacity",o)}getPixelKey(o,f){return`${o},${f}`}}function r0(m){return Math.max(m.naturalWidth,m.naturalHeight)}function DI(){return window.matchMedia("(display-mode: standalone)").matches||"standalone"in window.navigator&&window.navigator.standalone===!0}function xc(m,o){return o.includes(m)}function RI(m){const o={opaque:!0},f=m.searchParams.get("lat"),y=m.searchParams.get("lng");f&&y&&(o.pos={lat:parseFloat(f),lng:parseFloat(y)});const M=m.searchParams.get("zoom");M&&(o.zoom=parseFloat(M));const z=m.searchParams.get("season");z&&(o.season=parseInt(z));const T=m.searchParams.get("opaque");return T&&(o.opaque=T!=="0"),m.searchParams.get("select")&&(o.select=!0),o.newUser=!!m.searchParams.get("new-user"),o.discordLinked=!!m.searchParams.get("discord-linked"),o.alliance=!!m.searchParams.get("alliance"),o}function BI(m,o){return m=new URL(m),o.pos!==void 0&&(m.searchParams.set("lat",o.pos.lat.toString()),m.searchParams.set("lng",o.pos.lng.toString())),o.zoom!==void 0&&m.searchParams.set("zoom",o.zoom.toString()),o.season!==void 0&&m.searchParams.set("season",o.season.toString()),o.opaque!==void 0&&m.searchParams.set("opaque",o.opaque?"1":"0"),o.newUser!==void 0&&m.searchParams.set("new-user",o.newUser?"1":"0"),o.alliance!==void 0&&m.searchParams.set("alliance",o.alliance?"1":"0"),o.select&&m.searchParams.set("alliance","1"),m}const Xd=xi({shouldReload:!0});var FI=(m,o)=>{var f;(f=o())==null||f.close()},OI=Te('<dialog class="modal"><div class="modal-box max-w-2xl"><h3 class="flex items-center gap-1.5 text-lg font-bold"> </h3> <form><div class="mb-4 mt-2"><!></div> <div class="flex w-full justify-end gap-2"><button type="button" class="btn btn-soft"> </button> <button class="btn btn-primary"> </button></div></form></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function NI(m,o){Br(o,!0);let f=Lt(o,"ref",15),y=ct(!1),M=ct(xi(o.description)),z=ct(void 0);Dn(()=>{const Re=ze=>{var Fe;ze.key==="Escape"&&((Fe=f())==null||Fe.close())};return document.addEventListener("keydown",Re),()=>document.removeEventListener("keydown",Re)});var T=OI(),s=E(T),B=E(s),N=E(B,!0);k(B);var Y=q(B,2),K=E(Y),ie=E(K);{let Re=ft(()=>Gv());gx(ie,{class:"h-24 rounded-lg",get placeholder(){return x(Re)},max:512,get value(){return x(M)},set value(ze){ce(M,ze,!0)},get validate(){return x(z)},set validate(ze){ce(z,ze,!0)}})}k(K);var H=q(K,2),me=E(H);me.__click=[FI,f];var ve=E(me,!0);k(me);var Me=q(me,2),Ee=E(Me,!0);k(Me),k(H),k(Y),k(s),vn(2),k(T),Po(T,Re=>f(Re),()=>f()),Ye((Re,ze,Fe)=>{fe(N,Re),me.disabled=x(y),fe(ve,ze),Me.disabled=x(y),fe(Ee,Fe)},[()=>yx(),()=>up(),()=>NT()]),Ai("submit",Y,async()=>{var Re,ze,Fe;try{if(!((Re=x(z))!=null&&Re()))return;ce(y,!0),o.description!==x(M)&&await en.updateAllianceDescription(x(M)),await((ze=o.onsuccess)==null?void 0:ze.call(o,x(M))),(Fe=f())==null||Fe.close()}catch(Ke){Nr.error(Ke.message)}finally{ce(y,!1)}}),G(m,T),Fr()}Qn(["click"]);var jI=(m,o,f)=>{navigator.clipboard.writeText(x(o).toString()),ce(f,!0),setTimeout(()=>{ce(f,!1)},1e3)},VI=Te('<span class="loading loading-spinner loading-md center-absolute absolute"></span>'),qI=Te('<dialog class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <h3 class="flex items-center gap-1.5 text-lg font-bold"> </h3> <span class="text-base-content/80 text-sm"> </span> <div class="relative mt-4"><div><input class="text-base-content/80 min-w-10 grow text-sm font-medium" readonly=""/> <div class="h-10"><button> </button></div></div> <!></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function ZI(m,o){Br(o,!0);let f=Lt(o,"open",15),y=ct(""),M=ct(!1);const z=ft(()=>vi.url.origin+`/join?id=${x(y)}`);Wr(()=>{f()&&en.getAllianceInvites().then(rt=>{ce(y,rt[0],!0)}).catch(rt=>{Nr.error(rt.message)})}),Dn(()=>{const rt=qe=>{qe.key==="Escape"&&f(!1)};return document.addEventListener("keydown",rt),()=>document.removeEventListener("keydown",rt)});var T=qI(),s=E(T),B=q(E(s),2),N=E(B,!0);k(B);var Y=q(B,2),K=E(Y,!0);k(Y);var ie=q(Y,2),H=E(ie);let me;var ve=E(H);uo(ve);var Me=q(ve,2),Ee=E(Me);let Re;Ee.__click=[jI,z,M];var ze=E(Ee,!0);k(Ee),k(Me),k(H);var Fe=q(H,2);{var Ke=rt=>{var qe=VI();G(rt,qe)};je(Fe,rt=>{x(y)||rt(Ke)})}k(ie),k(s),vn(2),k(T),Wi(T,()=>rt=>{Wr(()=>{f()?rt.show():rt.close()})}),Ye((rt,qe,He,et,De,tt)=>{fe(N,rt),fe(K,qe),me=zr(H,1,"border-base-content/20 rounded-field relative flex w-full items-center gap-1 border-2 py-1.5 pl-4 pr-2.5",null,me,He),Av(ve,et),Re=zr(Ee,1,"btn btn-primary",null,Re,De),fe(ze,tt)},[()=>j3(),()=>Z3(),()=>({invisible:!x(y)}),()=>x(z).toString(),()=>({"btn-success":x(M)}),()=>x(M)?Bm():Hf()]),Ai("close",T,()=>f(!1)),G(m,T),Fr()}Qn(["click"]);var UI=Cr('<svg><path d="M216.856 16.597A208.502 208.502 0 0 0 164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.4-4.55-9.933-6.846-14.046a207.809 207.809 0 0 0-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193A161.094 161.094 0 0 0 79.735 175.3a136.413 136.413 0 0 1-21.846-10.632 108.636 108.636 0 0 0 5.356-4.237c42.122 19.702 87.89 19.702 129.51 0a131.66 131.66 0 0 0 5.355 4.237 136.07 136.07 0 0 1-21.886 10.653c4.006 8.02 8.638 15.67 13.873 22.848 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36ZM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2c12.867 0 23.236 11.804 23.015 26.2.02 14.375-10.148 26.18-23.015 26.18Zm85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.804 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18Z" fill="#5865F2"></path></svg>');function Kf(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=UI();ar(y,()=>({viewBox:"0 0 256 199",width:"256",height:"199",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid",...f})),G(m,y)}var $I=Te('<span class="text-success">(Verified)</span>'),GI=Te('<a target="_blank" rel="noreferer" aria-label="Discord"><!></a>'),HI=async(m,o)=>{await navigator.clipboard.writeText(o.username),Nr.info(GC())},WI=Te("<button><!></button>"),XI=Te('<span class="tooltip h-4"><div class="tooltip-content"><span> </span> <!></div> <!></span>');function Ah(m,o){Br(o,!0);const f=!!o.id;var y=XI(),M=E(y),z=E(M),T=E(z);k(z);var s=q(z,2);{var B=ie=>{var H=$I();G(ie,H)};je(s,ie=>{f&&ie(B)})}k(M);var N=q(M,2);{var Y=ie=>{var H=GI(),me=E(H);Kf(me,{class:"size-4 opacity-70"}),k(H),Ye(ve=>xr(H,"href",ve),[()=>`https://discord.com/users/${encodeURIComponent(o.id)}`]),G(ie,H)},K=ie=>{var H=WI();H.__click=[HI,o];var me=E(H);Kf(me,{class:"size-4 opacity-70"}),k(H),G(ie,H)};je(N,ie=>{f?ie(Y):ie(K,!1)})}k(y),Ye(()=>fe(T,`Discord: ${o.username??""}`)),G(m,y),Fr()}Qn(["click"]);var YI=Te('<input type="radio" class="tab max-[380px]:px-3"/>'),KI=Te('<div class="tabs tabs-border w-max font-medium"></div>');function Zm(m,o){Br(o,!0);const f=[];let y=Lt(o,"value",15,"today"),M=[{value:"today",label:gp()},{value:"week",label:nT()},{value:"month",label:oT()},{value:"all-time",label:cT()}];var z=KI();hi(z,21,()=>M,T=>T.value,(T,s)=>{var B=YI();uo(B);var N;Ye(()=>{xr(B,"aria-label",x(s).label),N!==(N=x(s).value)&&(B.value=(B.__value=x(s).value)??"")}),Em(f,[],B,()=>(x(s).value,y()),y),G(T,B)}),k(z),G(m,z),Fr()}const JI=typeof window<"u"?window:void 0;function QI(m){let o=m.activeElement;for(;o!=null&&o.shadowRoot;){const f=o.shadowRoot.activeElement;if(f===o)break;o=f}return o}var bc,Xu,Pv;let e4=(Pv=class{constructor(o={}){Mr(this,bc);Mr(this,Xu);const{window:f=JI,document:y=f==null?void 0:f.document}=o;f!==void 0&&(na(this,bc,y),na(this,Xu,Ev(M=>{const z=Nu(f,"focusin",M),T=Nu(f,"focusout",M);return()=>{z(),T()}})))}get current(){var o;return(o=it(this,Xu))==null||o.call(this),it(this,bc)?QI(it(this,bc)):null}},bc=new WeakMap,Xu=new WeakMap,Pv);new e4;function t4(m,o){switch(m){case"post":Wr(o);break;case"pre":Pm(o);break}}function n0(m,o,f,y={}){const{lazy:M=!1}=y;let z=!M,T=Array.isArray(m)?[]:void 0;t4(o,()=>{const s=Array.isArray(m)?m.map(N=>N()):m();if(!z){z=!0,T=s;return}const B=ul(()=>f(s,T));return T=s,B})}function dl(m,o,f){n0(m,"post",o,f)}function r4(m,o,f){n0(m,"pre",o,f)}dl.pre=r4;var n4=Te('<span class="loading loading-spinner loading-lg mt-18 mx-auto flex items-center"></span>'),i4=Te('<div class="text-base-content/80 mt-20 text-center text-sm"> <!></div>'),a4=Te('<span class="font-flag tooltip ml-0.5"> </span>'),o4=(m,o,f)=>{o.onlastpixelclick({lat:x(f).lastLatitude??0,lng:x(f).lastLongitude??0})},s4=Te("<button><!></button>"),l4=Te('<tr><td class="text-base-content/80 font-medium max-[400px]:hidden"> </td><td><div class="flex items-center gap-2"><!> <span> <span class="ml-0.5"> </span></span> <!> <!></div></td><td class="text-base-content/80 relative text-center font-medium"> <!></td></tr>'),c4=Te('<table class="table"><thead class="text-base-content/80"><tr><th class="max-[400px]:hidden"></th><th> </th><th class="text-center max-sm:px-1"> </th></tr></thead><tbody></tbody></table>'),u4=Te('<div><!> <div class="mt-4"><!></div></div>');function h4(m,o){Br(o,!0);let f=Lt(o,"reload",15),y=ct(!0),M=ct([]),z=ct(0),T=ct("today"),s={};f(B);function B(){const ve=x(T);en.allianceLeaderboard(ve).then(Me=>{ce(M,Me),s={[ve]:Me},ce(y,!1)}).catch(Me=>{Nr.error(Me.message)})}dl(()=>[x(T)],()=>{const ve=x(T),Me=s[ve];if(Me){ce(M,Me),ce(y,!1);return}ce(y,!0),en.allianceLeaderboard(ve).then(Ee=>{ce(M,Ee),s[ve]=Ee,ce(y,!1)}).catch(Ee=>{Nr.error(Ee.message)})});var N=u4(),Y=E(N);Zm(Y,{get value(){return x(T)},set value(ve){ce(T,ve,!0)}});var K=q(Y,2),ie=E(K);{var H=ve=>{var Me=n4();G(ve,Me)},me=ve=>{var Me=er(),Ee=Ct(Me);{var Re=Fe=>{var Ke=i4(),rt=E(Ke),qe=q(rt);{var He=De=>{var tt=bi();Ye(nt=>fe(tt,nt),[()=>gp().toLowerCase()]),G(De,tt)},et=De=>{var tt=er(),nt=Ct(tt);{var Ze=bt=>{var te=bi();Ye(re=>fe(te,re),[()=>Om()]),G(bt,te)},ke=bt=>{var te=er(),re=Ct(te);{var ge=oe=>{var Ae=bi();Ye(Ne=>fe(Ae,Ne),[()=>Nm()]),G(oe,Ae)};je(re,oe=>{x(T)==="month"&&oe(ge)},!0)}G(bt,te)};je(nt,bt=>{x(T)==="week"?bt(Ze):bt(ke,!1)},!0)}G(De,tt)};je(qe,De=>{x(T)==="today"?De(He):De(et,!1)})}k(Ke),Ye(De=>fe(rt,`${De??""} `),[()=>Fm()]),G(Fe,Ke)},ze=Fe=>{var Ke=c4(),rt=E(Ke),qe=E(rt),He=q(E(qe)),et=E(He,!0);k(He);var De=q(He),tt=E(De,!0);k(De),k(qe),k(rt);var nt=q(rt);hi(nt,31,()=>x(M),Ze=>Ze.userId,(Ze,ke,bt)=>{const te=ft(()=>{var qt;return((qt=kt.data)==null?void 0:qt.id)===x(ke).userId});var re=l4();let ge;var oe=E(re),Ae=E(oe,!0);k(oe);var Ne=q(oe),pt=E(Ne),ot=E(pt);lo(ot,{class:"size-10 border",get userId(){return x(ke).userId},get pictureUrl(){return x(ke).picture}});var ut=q(ot,2),St=E(ut),Bt=q(St),at=E(Bt);k(Bt),k(ut);var dt=q(ut,2);{var vt=qt=>{const tr=ft(()=>So(x(ke).equippedFlag));var Qt=a4(),Ot=E(Qt,!0);k(Qt),Ye(()=>{xr(Qt,"data-tip",x(tr).name),fe(Ot,x(tr).flag)}),G(qt,Qt)};je(dt,qt=>{x(ke).equippedFlag&&qt(vt)})}var yt=q(dt,2);{var It=qt=>{Ah(qt,{get username(){return x(ke).discord},get id(){return x(ke).discordId}})};je(yt,qt=>{x(ke).discord&&qt(It)})}k(pt),k(Ne);var wt=q(Ne),mt=E(wt),Dt=q(mt);{var zt=qt=>{var tr=s4();let Qt;tr.__click=[o4,o,ke];var Ot=E(tr);km(Ot,{class:"size-4"}),k(tr),Ye((fr,kr)=>{Qt=zr(tr,1,"btn btn-sm btn-ghost absolute -right-2 top-1/2 !-translate-y-1/2 sm:right-4",null,Qt,fr),xr(tr,"data-tip",kr)},[()=>({tooltip:x(z)>640}),()=>Px()]),G(qt,tr)};je(Dt,qt=>{x(ke).lastLatitude&&x(ke).lastLongitude&&qt(zt)})}k(wt),k(re),Ye((qt,tr,Qt)=>{var Ot;ge=zr(re,1,"",null,ge,qt),fe(Ae,x(bt)+1),zr(ut,1,`font-semibold ${tr??""} flex gap-1`),fe(St,`${(x(te)?((Ot=kt.data)==null?void 0:Ot.name)??x(ke).name:x(ke).name)??""} `),fe(at,`#${x(ke).userId??""}`),fe(mt,`${Qt??""} `)},[()=>({"bg-base-200":x(te)}),()=>Oi(x(ke).userId),()=>x(ke).pixelsPainted.toLocaleString("en-US")]),sl(re,()=>ll,()=>({duration:200})),G(Ze,re)}),k(nt),k(Ke),Ye((Ze,ke)=>{fe(et,Ze),fe(tt,ke)},[()=>Lm(),()=>Am()]),G(Fe,Ke)};je(Ee,Fe=>{x(M).length===0?Fe(Re):Fe(ze,!1)},!0)}G(ve,Me)};je(ie,ve=>{x(y)?ve(H):ve(me,!1)})}k(K),k(N),fp("innerWidth",ve=>ce(z,ve,!0)),G(m,N),Fr()}Qn(["click"]);var d4=Cr('<svg><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"></path></svg>');function Um(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=d4();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var p4=(m,o)=>o.onclickback(),f4=Te('<div class="badge badge-primary badge-sm badge-soft">ADMIN</div>'),m4=async(m,o)=>{try{x(o).loading=!0,await en.giveAllianceAdmin(x(o).id),x(o).role="admin"}catch{Nr.error(_S())}finally{x(o).loading=!1}},_4=async(m,o,f)=>{try{x(o).loading=!0,await en.banAllianceUser(x(o).id),f.data=f.data.filter(y=>y.id!==x(o).id)}catch{Nr.error(qT())}finally{x(o).loading=!1}},g4=Te('<li><button class="btn btn-ghost"> </button></li> <li><button class="btn btn-ghost btn-error not-hover:text-error"> </button></li>',1),v4=Te('<li><button class="btn btn-ghost text-base-content/80"> </button></li>'),y4=Te('<tr><td class="w-full"><div class="flex items-center gap-2"><!> <span> </span> <!></div></td><td class="px-0"><div class="dropdown"><div tabindex="0" role="button" class="btn btn-ghost"><!></div> <ul class="dropdown-content menu bg-base-100 rounded-box z-1 border-base-200 right-0 w-44 translate-y-1 gap-1 border p-2 shadow-sm"><!></ul></div></td></tr>'),x4=Te('<div class="mt-2 flex justify-center"><span class="loading loading-dots"></span></div>'),b4=(m,o,f)=>{en.unbanAllianceUser(x(o).id).then(()=>{f.data=f.data.filter(y=>y.id!==x(o).id)}).catch(y=>Nr.error(y.message)).finally(()=>{x(o).loading=!1})},w4=Te('<tr><td class="w-full"><div class="flex items-center gap-2"><!> <span> </span></div></td><td class="px-0"><button class="btn btn-error"> </button></td></tr>'),T4=Te('<div class="text-base-content/80 mt-4 flex justify-center"> </div>'),C4=Te('<div class="mt-2 flex justify-center"><span class="loading loading-dots"></span></div>'),S4=Te('<div><section class="mt-2 flex items-center gap-1"><button class="btn btn-ghost btn-circle"><!></button> <h2 class="text-xl font-semibold"> </h2></section> <div class="tabs tabs-border mt-2"><input type="radio" name="members_tabs" class="tab" checked/> <div class="tab-content py-4"><table class="table"><tbody></tbody></table> <!></div> <input type="radio" name="members_tabs" class="tab"/> <div class="tab-content py-4"><table class="table"><tbody></tbody></table> <!> <!></div></div></div>');function P4(m,o){Br(o,!0);let f=xi({data:[],page:0,hasNextPage:!0,loading:!1}),y=xi({data:[],page:0,hasNextPage:!0,loading:!1});var M=S4(),z=E(M),T=E(z);T.__click=[p4,o];var s=E(T);zx(s,{class:"size-5"}),k(T);var B=q(T,2),N=E(B,!0);k(B),k(z);var Y=q(z,2),K=E(Y);uo(K);var ie=q(K,2),H=E(ie),me=E(H);hi(me,21,()=>f.data,et=>et.id,(et,De,tt)=>{const nt=ft(()=>{var vt;return((vt=kt.data)==null?void 0:vt.id)===x(De).id});var Ze=y4(),ke=E(Ze),bt=E(ke),te=E(bt);lo(te,{class:"size-10 border",get userId(){return x(De).id},get pictureUrl(){return x(De).picture}});var re=q(te,2),ge=E(re);k(re);var oe=q(re,2);{var Ae=vt=>{var yt=f4();G(vt,yt)};je(oe,vt=>{x(De).role==="admin"&&vt(Ae)})}k(bt),k(ke);var Ne=q(ke),pt=E(Ne),ot=E(pt),ut=E(ot);Um(ut,{class:"size-4"}),k(ot);var St=q(ot,2),Bt=E(St);{var at=vt=>{var yt=g4(),It=Ct(yt),wt=E(It);wt.__click=[m4,De];var mt=E(wt,!0);k(wt),k(It);var Dt=q(It,2),zt=E(Dt);zt.__click=[_4,De,f];var qt=E(zt,!0);k(zt),k(Dt),Ye((tr,Qt)=>{wt.disabled=x(De).loading,fe(mt,tr),zt.disabled=x(De).loading,fe(qt,Qt)},[()=>ST(),()=>Hv()]),G(vt,yt)},dt=vt=>{var yt=v4(),It=E(yt);It.disabled=!0;var wt=E(It,!0);k(It),k(yt),Ye(mt=>fe(wt,mt),[()=>AT()]),G(vt,yt)};je(Bt,vt=>{x(De).role==="member"?vt(at):vt(dt,!1)})}k(St),k(pt),k(Ne),k(Ze),Ye(vt=>{var yt;zr(re,1,`font-semibold ${vt??""}`),fe(ge,`${(x(nt)?((yt=kt.data)==null?void 0:yt.name)??x(De).name:x(De).name)??""} #${x(De).id??""}`)},[()=>Oi(x(De).id)]),G(et,Ze)}),k(me),k(H);var ve=q(H,2);{var Me=et=>{var De=er(),tt=Ct(De);ju(tt,()=>f.page,nt=>{var Ze=x4();Wi(Ze,()=>ke=>{const bt=new IntersectionObserver(te=>{te[0].isIntersecting&&!f.loading&&(f.loading=!0,en.getAllianceMembers(f.page).then(re=>{f.data=[...f.data,...re.data],f.hasNextPage=re.hasNext,f.page++}).catch(re=>{Nr.error(re.message)}).finally(()=>{f.loading=!1}))});return bt.observe(ke),()=>{bt.disconnect()}}),G(nt,Ze)}),G(et,De)};je(ve,et=>{f.hasNextPage&&et(Me)})}k(ie);var Ee=q(ie,2),Re=q(Ee,2),ze=E(Re),Fe=E(ze);hi(Fe,21,()=>y.data,et=>et.id,(et,De,tt)=>{var nt=w4(),Ze=E(nt),ke=E(Ze),bt=E(ke);lo(bt,{class:"size-10 border",get userId(){return x(De).id},get pictureUrl(){return x(De).picture}});var te=q(bt,2),re=E(te);k(te),k(ke),k(Ze);var ge=q(Ze),oe=E(ge);oe.__click=[b4,De,y];var Ae=E(oe,!0);k(oe),k(ge),k(nt),Ye((Ne,pt)=>{zr(te,1,`font-semibold ${Ne??""}`),fe(re,`${x(De).name??""} #${x(De).id??""}`),oe.disabled=x(De).loading,fe(Ae,pt)},[()=>Oi(x(De).id),()=>LT()]),G(et,nt)}),k(Fe),k(ze);var Ke=q(ze,2);{var rt=et=>{var De=T4(),tt=E(De,!0);k(De),Ye(nt=>fe(tt,nt),[()=>BT()]),G(et,De)};je(Ke,et=>{!y.hasNextPage&&y.data.length===0&&et(rt)})}var qe=q(Ke,2);{var He=et=>{var De=er(),tt=Ct(De);ju(tt,()=>y.page,nt=>{var Ze=C4();Wi(Ze,()=>ke=>{const bt=new IntersectionObserver(te=>{te[0].isIntersecting&&!y.loading&&(y.loading=!0,en.getAllianceBannedMembers(y.page).then(re=>{y.data=[...y.data,...re.data],y.hasNextPage=re.hasNext,y.page++}).catch(re=>{Nr.error(re.message)}).finally(()=>{y.loading=!1}))});return bt.observe(ke),()=>{bt.disconnect()}}),G(nt,Ze)}),G(et,De)};je(qe,et=>{y.hasNextPage&&et(He)})}k(Re),k(Y),k(M),Ye((et,De,tt)=>{fe(N,et),xr(K,"aria-label",De),xr(Ee,"aria-label",tt)},[()=>Dv(),()=>$T(),()=>Wv()]),G(m,M),Fr()}Qn(["click"]);var I4=Te('<span class="label"> </span>'),M4=Te('<span class="hidden px-1 text-[10px] peer-focus:block"> </span>'),k4=Te('<p class="text-error ml-3 text-sm"> </p>'),A4=Te('<div><label><!> <input class="peer" type="text"/> <!></label> <!></div>');function Jf(m,o){Br(o,!0);let f=Lt(o,"value",15),y=Lt(o,"validate",15),M=ct("");const z=ft(()=>{var Ee;return((Ee=f())==null?void 0:Ee.length)??0});y(T);function T(){return o.min!==void 0&&x(z)<o.min?(ce(M,x(z)===0?"Required":`Min. characters: ${o.min}`,!0),!1):o.max!==void 0&&x(z)>o.max?(ce(M,`Max. characters: ${o.max}`),!1):!0}Wr(()=>{var Ee;o.max!==void 0&&x(z)>o.max&&f((Ee=f())==null?void 0:Ee.substring(0,o.max))});var s=A4(),B=E(s);let N;var Y=E(B);{var K=Ee=>{var Re=I4(),ze=E(Re,!0);k(Re),Ye(()=>fe(ze,o.label)),G(Ee,Re)};je(Y,Ee=>{o.label&&Ee(K)})}var ie=q(Y,2);uo(ie);var H=q(ie,2);{var me=Ee=>{var Re=M4(),ze=E(Re,!0);k(Re),Ye(()=>fe(ze,o.max-x(z))),G(Ee,Re)};je(H,Ee=>{o.max!==void 0&&Ee(me)})}k(B);var ve=q(B,2);{var Me=Ee=>{var Re=k4(),ze=E(Re,!0);k(Re),Ye(()=>fe(ze,x(M))),G(Ee,Re)};je(ve,Ee=>{x(M)&&Ee(Me)})}k(s),Ye(Ee=>{N=zr(B,1,"input w-full",null,N,Ee),xr(ie,"placeholder",o.placeholder),xr(ie,"maxlength",o.max)},[()=>({"input-error":!!x(M)})]),zm(ie,f),G(m,s),Fr()}var E4=(m,o)=>{var f;(f=o())==null||f.close()},z4=Te('<dialog class="modal"><div class="modal-box"><h3 class="flex items-center gap-1.5 text-lg font-bold"> </h3> <form><div class="my-4"><!></div> <div class="flex w-full justify-end gap-2"><button type="button" class="btn btn-soft"> </button> <button class="btn btn-primary"> </button></div></form></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function L4(m,o){Br(o,!0);let f=Lt(o,"ref",15),y=ct(!1),M=ct(""),z=ct(void 0);Dn(()=>{const Re=ze=>{var Fe;ze.key==="Escape"&&((Fe=f())==null||Fe.close())};return document.addEventListener("keydown",Re),()=>document.removeEventListener("keydown",Re)});var T=z4(),s=E(T),B=E(s),N=E(B,!0);k(B);var Y=q(B,2),K=E(Y),ie=E(K);{let Re=ft(()=>Xf()),ze=ft(()=>yT());Jf(ie,{get label(){return x(Re)},get placeholder(){return x(ze)},min:1,max:16,get value(){return x(M)},set value(Fe){ce(M,Fe,!0)},get validate(){return x(z)},set validate(Fe){ce(z,Fe,!0)}})}k(K);var H=q(K,2),me=E(H);me.__click=[E4,f];var ve=E(me,!0);k(me);var Me=q(me,2),Ee=E(Me,!0);k(Me),k(H),k(Y),k(s),vn(2),k(T),Po(T,Re=>f(Re),()=>f()),Ye((Re,ze,Fe)=>{fe(N,Re),me.disabled=x(y),fe(ve,ze),Me.disabled=x(y),fe(Ee,Fe)},[()=>_T(),()=>up(),()=>wT()]),Ai("submit",Y,async()=>{var Re,ze;try{if(!((Re=x(z))!=null&&Re()))return;ce(y,!0);const{id:Fe}=await en.createAlliance(x(M));await o.onsuccess(Fe),(ze=f())==null||ze.close()}catch(Fe){Nr.error(Fe.message)}finally{ce(y,!1)}}),G(m,T),Fr()}Qn(["click"]);var D4=Cr('<svg><path d="M240-120q-45 0-89-22t-71-58q26 0 53-20.5t27-59.5q0-50 35-85t85-35q50 0 85 35t35 85q0 66-47 113t-113 47Zm230-240L360-470l358-358q11-11 27.5-11.5T774-828l54 54q12 12 12 28t-12 28L470-360Z"></path></svg>');function Eh(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=D4();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var R4=Cr('<svg><path d="M160-160v-100.77l527.23-527.77q6.15-5.48 13.57-8.47 7.43-2.99 15.49-2.99t15.62 2.54q7.55 2.54 13.94 9.15l42.69 42.93q6.61 6.38 9.04 14 2.42 7.63 2.42 15.25 0 8.13-2.74 15.56-2.74 7.42-8.72 13.57L260.77-160H160Zm540.15-496.46L760-715.54 715.54-760l-59.08 59.85 43.69 43.69Z"></path></svg>'),B4=Cr('<svg><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"></path></svg>');function Qf(m,o){let f=ir(o,["$$slots","$$events","$$legacy","filled"]);var y=er(),M=Ct(y);{var z=s=>{var B=R4();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)},T=s=>{var B=B4();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)};je(M,s=>{o.filled?s(z):s(T,!1)})}G(m,y)}var F4=Cr('<svg><path d="M360-440h80v-110h80v110h80v-190l-120-80-120 80v190ZM480-80Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Z"></path></svg>');function O4(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=F4();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var N4=Cr('<svg><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm320-280L160-640v400h640v-400L480-440Zm0-80 320-200H160l320 200ZM160-640v-80 480-400Z"></path></svg>');function j4(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=N4();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var V4=Cr('<svg><path d="M720-400v-120H600v-80h120v-120h80v120h120v80H800v120h-80Zm-360-80q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Z"></path></svg>');function q4(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=V4();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var Z4=Cr('<svg><path d="M480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM160-160v-112q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q66 0 130 15.5T736-378q29 15 46.5 43.5T800-272v112H160Z"></path></svg>');function vp(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=Z4();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}function U4(m,o="_blank"){return m.replaceAll(/https?:\/\/[^\s]+/g,f=>`<a href="${f}"${o?` target="${o}"`:""}>${f}</a>`)}var $4=Te('<div class="flex h-full items-center justify-center"><span class="loading loading-spinner loading-xl"></span></div>'),G4=async(m,o,f,y)=>{try{ce(o,!0),await en.leaveAlliance(),ce(f,!0),await y()}catch(M){Nr.error(M.message)}finally{ce(o,!1)}},H4=(m,o)=>{ce(o,!0)},W4=Te('<div class="tooltip"><button class="btn"><!></button></div>'),X4=(m,o)=>{var f;(f=x(o))==null||f.show()},Y4=Te('<button class="text-base-content/50 translate-y-0.5 p-1"><!></button>'),K4=Te('<section class="text-base-content/80 highlight-link"><!> <!></section>'),J4=Te('<span class="font-semibold"> </span>'),Q4=(m,o)=>ce(o,!0),eM=Te('<button class="text-primary font-semibold underline"> </button>'),tM=(m,o,f)=>{var y;(y=x(o))!=null&&y.hq?f.onhqclick({lat:x(o).hq.latitude,lng:x(o).hq.longitude}):f.onhqchange()},rM=Te('<span class="text-primary underline"> </span>'),nM=Te('<span class="text-primary underline"> </span>'),iM=Te('<button class="text-base-content/80 p-1"><!></button>'),aM=Te('<div class="flex items-center gap-1"><!> <span> <button class="font-semibold"><!></button></span> <!></div>'),oM=Te('<section class="flex items-center justify-between"><h2 class="text-xl font-semibold sm:text-3xl"> </h2> <div class="flex items-center gap-1"><div class="dropdown"><div tabindex="0" role="button" class="btn btn-ghost"><!></div> <ul class="dropdown-content menu bg-base-100 rounded-box z-1 border-base-200 right-0 w-44 translate-y-1 border p-2 shadow-sm"><li><button class="btn btn-soft btn-error"> </button></li></ul></div> <!></div></section> <!> <section class="mt-3"><div class="flex items-center gap-1"><!> <span> <span class="font-semibold"> </span></span></div> <div class="flex items-center gap-1"><!> <span> <!></span></div> <!></section> <section class="mt-6"><h3 class="text-lg font-semibold"> </h3> <div class="mt-1 pb-2"><!></div></section> <!> <!>',1),sM=(m,o)=>{var f;(f=x(o))==null||f.show()},lM=Te('<div class="flex h-[90%] flex-col items-center justify-center gap-3"><span class="text-base-content/80"> </span> <span class="mt-8 flex items-center gap-2 text-xl font-semibold"><!> </span> <div class="flex w-full justify-center"><div class="divider w-full max-w-sm"> </div></div> <button class="btn btn-xl btn-soft mb-6"><!> </button></div> <!>',1),cM=Te('<div class="h-full"><!></div>');function uM(m,o){Br(o,!0);let f=ct(void 0),y=ct(!0),M=ct(void 0),z=ct(!1),T=ct(void 0),s=ct(!1),B=ct(!1),N=ct(()=>{});dl(()=>o.open,()=>{o.open&&Xd.shouldReload&&Y()}),Dn(()=>{const ve=setInterval(()=>{Xd.shouldReload=!0},1e4);return()=>{clearTimeout(ve)}});async function Y(){try{ce(f,await en.getAlliance(),!0),x(f)&&x(N)(),ce(y,!1),Xd.shouldReload=!1}catch(ve){Nr.error(ve.message)}}var K=cM(),ie=E(K);{var H=ve=>{var Me=$4();G(ve,Me)},me=ve=>{var Me=er(),Ee=Ct(Me);{var Re=Fe=>{P4(Fe,{onclickback:()=>ce(B,!1)})},ze=Fe=>{var Ke=er(),rt=Ct(Ke);{var qe=et=>{var De=oM(),tt=Ct(De),nt=E(tt),Ze=E(nt,!0);k(nt);var ke=q(nt,2),bt=E(ke),te=E(bt),re=E(te);Um(re,{class:"size-4"}),k(te);var ge=q(te,2),oe=E(ge),Ae=E(oe);Ae.__click=[G4,z,y,Y];var Ne=E(Ae,!0);k(Ae),k(oe),k(ge),k(bt);var pt=q(bt,2);{var ot=se=>{var j=W4(),Z=E(j);Z.__click=[H4,s];var X=E(Z);q4(X,{class:"size-4"}),k(Z),k(j),Ye(ae=>xr(j,"data-tip",ae),[()=>Y3()]),G(se,j)};je(pt,se=>{x(f).role=="admin"&&se(ot)})}k(ke),k(tt);var ut=q(tt,2);{var St=se=>{var j=K4(),Z=E(j);Mm(Z,()=>U4(x(f).description||Gv()));var X=q(Z,2);{var ae=de=>{var Se=Y4();Se.__click=[X4,T];var Ie=E(Se);Qf(Ie,{class:"size-4"}),k(Se),G(de,Se)};je(X,de=>{x(f).role==="admin"&&de(ae)})}k(j),G(se,j)};je(ut,se=>{(x(f).description||x(f).role==="admin")&&se(St)})}var Bt=q(ut,2),at=E(Bt),dt=E(at);Eh(dt,{class:"inline size-4"});var vt=q(dt,2),yt=E(vt),It=q(yt),wt=E(It,!0);k(It),k(vt),k(at);var mt=q(at,2),Dt=E(mt);vp(Dt,{class:"inline size-4"});var zt=q(Dt,2),qt=E(zt),tr=q(qt);{var Qt=se=>{var j=J4(),Z=E(j,!0);k(j),Ye(X=>fe(Z,X),[()=>x(f).members.toLocaleString("en-US")]),G(se,j)},Ot=se=>{var j=eM();j.__click=[Q4,B];var Z=E(j,!0);k(j),Ye(X=>fe(Z,X),[()=>x(f).members.toLocaleString("en-US")]),G(se,j)};je(tr,se=>{x(f).role==="member"?se(Qt):se(Ot,!1)})}k(zt),k(mt);var fr=q(mt,2);{var kr=se=>{var j=aM(),Z=E(j);O4(Z,{class:"inline size-4"});var X=q(Z,2),ae=E(X),de=q(ae);de.__click=[tM,f,o];var Se=E(de);{var Ie=$e=>{var Mt=rM(),xe=E(Mt);k(Mt),Ye((Ft,cr)=>fe(xe,`${Ft??""}, ${cr??""}`),[()=>x(f).hq.latitude.toFixed(3),()=>x(f).hq.longitude.toFixed(3)]),G($e,Mt)},be=$e=>{var Mt=nM(),xe=E(Mt,!0);k(Mt),Ye(Ft=>fe(xe,Ft),[()=>S3()]),G($e,Mt)};je(Se,$e=>{x(f).hq?$e(Ie):$e(be,!1)})}k(de),k(X);var Oe=q(X,2);{var st=$e=>{var Mt=iM();Mt.__click=function(...Ft){var cr;(cr=o.onhqchange)==null||cr.apply(this,Ft)};var xe=E(Mt);Qf(xe,{class:"text-base-content/50 size-4"}),k(Mt),G($e,Mt)};je(Oe,$e=>{x(f).role==="admin"&&$e(st)})}k(j),Ye($e=>fe(ae,`${$e??""}: `),[()=>w3()]),G(se,j)};je(fr,se=>{(x(f).hq||x(f).role==="admin")&&se(kr)})}k(Bt);var Ar=q(Bt,2),rr=E(Ar),Kt=E(rr,!0);k(rr);var or=q(rr,2),Sr=E(or);h4(Sr,{get allianceId(){return x(f).id},get onlastpixelclick(){return o.onlastpixelclick},get reload(){return x(N)},set reload(se){ce(N,se,!0)}}),k(or),k(Ar);var Dr=q(Ar,2);NI(Dr,{get description(){return x(f).description},onsuccess:async se=>{x(f)&&(x(f).description=se)},get ref(){return x(T)},set ref(se){ce(T,se,!0)}});var Zr=q(Dr,2);ZI(Zr,{get open(){return x(s)},set open(se){ce(s,se,!0)}}),Ye((se,j,Z,X,ae)=>{fe(Ze,x(f).name),Ae.disabled=x(z),fe(Ne,se),fe(yt,`${j??""}: `),fe(wt,Z),fe(qt,`${X??""}: `),fe(Kt,ae)},[()=>y3(),()=>Am(),()=>x(f).pixelsPainted.toLocaleString("en-US"),()=>Dv(),()=>Rm()]),G(et,De)},He=et=>{var De=lM(),tt=Ct(De),nt=E(tt),Ze=E(nt);k(nt);var ke=q(nt,2),bt=E(ke);j4(bt,{class:"size-5"});var te=q(bt,1,!0);k(ke);var re=q(ke,2),ge=E(re),oe=E(ge,!0);k(ge),k(re);var Ae=q(re,2);Ae.__click=[sM,M];var Ne=E(Ae);Rv(Ne,{class:"size-6"});var pt=q(Ne);k(Ae),k(tt);var ot=q(tt,2);L4(ot,{onsuccess:Y,get ref(){return x(M)},set ref(ut){ce(M,ut,!0)}}),Ye((ut,St,Bt,at)=>{fe(Ze,`${ut??""}:`),fe(te,St),fe(oe,Bt),fe(pt,` ${at??""}`)},[()=>M3(),()=>E3(),()=>D3(),()=>F3()]),G(et,De)};je(rt,et=>{x(f)?et(qe):et(He,!1)},!0)}G(Fe,Ke)};je(Ee,Fe=>{x(B)?Fe(Re):Fe(ze,!1)},!0)}G(ve,Me)};je(ie,ve=>{x(y)?ve(H):ve(me,!1)})}k(K),G(m,K),Fr()}Qn(["click"]);var hM=Cr('<svg><path d="M40-160v-160q0-34 23.5-57t56.5-23h131q20 0 38 10t29 27q29 39 71.5 61t90.5 22q49 0 91.5-22t70.5-61q13-17 30.5-27t36.5-10h131q34 0 57 23t23 57v160H640v-91q-35 25-75.5 38T480-200q-43 0-84-13.5T320-252v92H40Zm440-160q-38 0-72-17.5T351-386q-17-25-42.5-39.5T253-440q22-37 93-58.5T480-520q63 0 134 21.5t93 58.5q-29 0-55 14.5T609-386q-22 32-56 49t-73 17ZM160-440q-50 0-85-35t-35-85q0-51 35-85.5t85-34.5q51 0 85.5 34.5T280-560q0 50-34.5 85T160-440Zm640 0q-50 0-85-35t-35-85q0-51 35-85.5t85-34.5q51 0 85.5 34.5T920-560q0 50-34.5 85T800-440ZM480-560q-50 0-85-35t-35-85q0-51 35-85.5t85-34.5q51 0 85.5 34.5T600-680q0 50-34.5 85T480-560Z"></path></svg>');function yp(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=hM();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var dM=Te('<dialog class="modal"><div class="modal-box sm:h-11/12 flex max-w-3xl flex-col max-sm:size-full max-sm:rounded-none max-sm:px-3 max-sm:py-5"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <div class="flex items-center gap-1.5"><!> <h3 class="text-lg font-bold max-sm:text-xl"> </h3></div> <div class="mt-1 grow"><!></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function pM(m,o){Br(o,!0);let f=Lt(o,"open",15);Dn(()=>{const K=ie=>{ie.key==="Escape"&&f(!1)};return document.addEventListener("keydown",K),()=>document.removeEventListener("keydown",K)});var y=dM(),M=E(y),z=q(E(M),2),T=E(z);yp(T,{class:"size-5 max-sm:size-6"});var s=q(T,2),B=E(s,!0);k(s),k(z);var N=q(z,2),Y=E(N);uM(Y,{get open(){return f()},get onhqchange(){return o.onhqchange},get onhqclick(){return o.onhqclick},get onlastpixelclick(){return o.onlastpixelclick}}),k(N),k(M),vn(2),k(y),Wi(y,()=>K=>{Wr(()=>{f()?(K.show(),vi.url.searchParams.get("alliance")&&(vi.url.searchParams.delete("alliance"),Im(vi.url.toString()))):K.close()})}),Ye(K=>fe(B,K),[()=>mp()]),Ai("close",y,()=>f(!1)),ki(2,N,()=>ia,()=>({duration:300})),G(m,y),Fr()}function fM(m,o,f){return new Promise((y,M)=>{m.once("render",()=>{const z=m.getCanvas().toDataURL(),T=document.createElement("img");T.src=z,T.onload=()=>{const s=document.createElement("canvas");s.width=T.width,s.height=T.height;const B=s.getContext("2d");if(B){B.drawImage(T,0,0);const[N,Y,K,ie]=B.getImageData(o,f,1,1).data;y([N,Y,K,ie])}else M(new Error("Could not get 2d context from canvas"));T.remove(),s.remove()}}),m.triggerRepaint()})}function i0(m,o){return new Promise((f,y)=>{m.once("render",()=>{const M=m.getCanvas();let z=M;if(o!=null&&o.maxWidth||o!=null&&o.maxHeight){const T=M.width,s=M.height,B=(o==null?void 0:o.maxWidth)??T,N=(o==null?void 0:o.maxHeight)??s;z=document.createElement("canvas");const Y=Math.min(B/T,N/s);z.width=Math.floor(T*Y),z.height=Math.floor(s*Y);const K=z.getContext("2d");K&&K.drawImage(M,0,0,z.width,z.height)}try{z.toBlob(T=>{T&&f(T)},(o==null?void 0:o.type)??"image/png",(o==null?void 0:o.quality)??1)}catch(T){y(T)}finally{z!==M&&z.remove()}})})}var mM=Cr('<svg><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm40-80h480L570-480 450-320l-90-120-120 160Zm-40 80v-560 560Z"></path></svg>');function _M(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=mM();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"currentColor",...f})),G(m,y)}var gM=Cr('<svg><path d="M680-80q-50 0-85-35t-35-85q0-6 3-28L282-392q-16 15-37 23.5t-45 8.5q-50 0-85-35t-35-85q0-50 35-85t85-35q24 0 45 8.5t37 23.5l281-164q-2-7-2.5-13.5T560-760q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35q-24 0-45-8.5T598-672L317-508q2 7 2.5 13.5t.5 14.5q0 8-.5 14.5T317-452l281 164q16-15 37-23.5t45-8.5q50 0 85 35t35 85q0 50-35 85t-85 35Z"></path></svg>');function a0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=gM();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}const gc={hour:3600*1e3,min:60*1e3,sec:1e3};function tp(m){const o=Math.floor(m/gc.hour);m-=o*gc.hour;const f=Math.floor(m/gc.min);m-=f*gc.min;const M=Math.floor(m/gc.sec).toString().padStart(2,"0");return o>0?`${o}:${f.toString().padStart(2,"0")}:${M}`:`${f}:${M}`}function vM(m){const o=new Date,f=o.getFullYear(),y=String(o.getMonth()+1).padStart(2,"0"),M=String(o.getDate()).padStart(2,"0"),z=String(o.getHours()).padStart(2,"0"),T=String(o.getMinutes()).padStart(2,"0"),s=String(o.getSeconds()).padStart(2,"0");return`${f}-${y}-${M} ${z}:${T}:${s}`}var yM=(m,o,f)=>{navigator.clipboard.writeText(o.url.toString()),ce(f,!0),setTimeout(()=>{ce(f,!1)},1e3)},xM=Te('<img class="border-base-content/20 border" alt="Screenshot"/>'),bM=Te('<div class="flex w-full items-center justify-center"><span class="loading loading-spinner"></span></div>'),wM=async(m,o)=>{x(o)&&(await navigator.clipboard.write([new ClipboardItem({"image/png":x(o)})]),Nr.info(wP()))},TM=Te('<div><h3 class="mb-1 mt-5 flex items-center gap-1 text-xl font-semibold"><!> </h3> <!> <div class="mt-3 flex items-end justify-end gap-2"><button class="btn"><!> </button> <a class="btn btn-primary"><!> </a></div></div>'),CM=Te('<dialog class="modal"><div class="modal-box max-h-11/12"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <h3 class="flex items-center gap-1.5 text-xl font-bold"><!> </h3> <div class="border-base-content/20 rounded-field mt-3 flex w-full items-center gap-1 border-2 py-1.5 pl-4 pr-2.5"><input class="text-base-content/80 min-w-10 grow text-sm font-medium" readonly=""/> <div class="h-10"><button> </button></div></div> <!></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function SM(m,o){Br(o,!0);let f=Lt(o,"open",15),y=ct(!1);Dn(()=>{const ze=Fe=>{Fe.key==="Escape"&&f(!1)};return document.addEventListener("keydown",ze),()=>document.removeEventListener("keydown",ze)});let M=ct(null),z=ct("");Wr(()=>{f()?(o.hideHover(),setTimeout(async()=>{i0(o.map).then(ze=>{ce(M,ze,!0),ce(z,URL.createObjectURL(x(M)),!0)}).finally(()=>{o.showHover()})},500)):x(z)&&(URL.revokeObjectURL(x(z)),ce(M,null),ce(z,""))});var T=CM(),s=E(T),B=q(E(s),2),N=E(B);a0(N,{class:"size-5"});var Y=q(N);k(B);var K=q(B,2),ie=E(K);uo(ie);var H=q(ie,2),me=E(H);let ve;me.__click=[yM,o,y];var Me=E(me,!0);k(me),k(H),k(K);var Ee=q(K,2);{var Re=ze=>{const Fe=ft(()=>{var oe;return(oe=o.map)==null?void 0:oe.getCanvas()});var Ke=TM(),rt=E(Ke),qe=E(rt);_M(qe,{class:"inline size-5"});var He=q(qe);k(rt);var et=q(rt,2);{var De=oe=>{var Ae=xM();Ye(()=>{xr(Ae,"src",x(z)),xr(Ae,"width",x(Fe).width),xr(Ae,"height",x(Fe).height)}),G(oe,Ae)},tt=oe=>{var Ae=bM();Ye(()=>kc(Ae,`aspect-ratio: ${x(Fe).width/x(Fe).height}`)),G(oe,Ae)};je(et,oe=>{x(z)?oe(De):oe(tt,!1)})}var nt=q(et,2),Ze=E(nt);Ze.__click=[wM,M];var ke=E(Ze);Dm(ke,{class:"size-5"});var bt=q(ke);k(Ze);var te=q(Ze,2),re=E(te);zv(re,{class:"size-5"});var ge=q(re);k(te),k(nt),k(Ke),Ye((oe,Ae,Ne,pt)=>{fe(He,` ${oe??""}`),fe(bt,` ${Ae??""}`),xr(te,"href",x(z)),xr(te,"download",`wplace_${Ne??""}.png`),fe(ge,` ${pt??""}`)},[()=>_P(),()=>Hf(),()=>vM().replaceAll(" ","_").replaceAll(":","-"),()=>yP()]),ki(2,Ke,()=>ia,()=>({duration:300})),G(ze,Ke)};je(Ee,ze=>{f()&&ze(Re)})}k(s),vn(2),k(T),Wi(T,()=>ze=>{Wr(()=>{f()?ze.show():ze.close()})}),Ye((ze,Fe,Ke,rt)=>{fe(Y,` ${ze??""}`),Av(ie,Fe),ve=zr(me,1,"btn btn-primary",null,ve,Ke),fe(Me,rt)},[()=>EC(),()=>o.url.toString(),()=>({"btn-success":x(y)}),()=>x(y)?Bm():Hf()]),Ai("close",T,()=>f(!1)),G(m,T),Fr()}Qn(["click"]);var PM=Cr('<svg><path d="m576-160-56-56 104-104-104-104 56-56 104 104 104-104 56 56-104 104 104 104-56 56-104-104-104 104Zm79-360L513-662l56-56 85 85 170-170 56 57-225 226ZM80-280v-80h360v80H80Zm0-320v-80h360v80H80Z"></path></svg>');function IM(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=PM();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var MM=Te('<li class="bg-base-200 border-base-content/10 rounded-xl border-2 p-3"> </li>'),kM=Te('<div><div class="flex items-center gap-1"><!> <h3 class="text-xl font-bold"> <span class="badge badge-sm badge-error badge-soft ml-1"> </span></h3></div> <div class="text-sm sm:text-base"><ul class="my-3 flex flex-col gap-2 font-medium"></ul> <p class="text-base-content/80 mt-2 text-sm"> </p></div></div>');function $m(m,o){Br(o,!1);const f=[Qw(),Yw(),r5(),a5(),l5(),h5(),f5()];Nv();var y=kM(),M=E(y),z=E(M);IM(z,{class:"size-5"});var T=q(z,2),s=E(T),B=q(s),N=E(B,!0);k(B),k(T),k(M);var Y=q(M,2),K=E(Y);hi(K,5,()=>f,hp,(me,ve)=>{var Me=MM(),Ee=E(Me,!0);k(Me),Ye(()=>fe(Ee,x(ve))),G(me,Me)}),k(K);var ie=q(K,2),H=E(ie,!0);k(ie),k(Y),k(y),Ye((me,ve,Me)=>{fe(s,`${me??""} `),fe(N,ve),fe(H,Me)},[()=>Uw(),()=>Hw(),()=>g5()]),G(m,y),Fr()}var AM=(m,o)=>{o(!1)},EM=Te('<dialog class="modal"><div class="modal-box sm:max-h-11/12"><form method="dialog"><button class="btn btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <div class="flex h-full flex-col gap-6"><h2 class="text-xl font-semibold">ðŸ“‘ Updated rules</h2> <section><!></section> <button class="btn btn-primary">Close</button></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function zM(m,o){Br(o,!0);let f=Lt(o,"open",15);Dn(()=>{const N=Y=>{Y.key==="Escape"&&f(!1)};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)});var y=EM(),M=E(y),z=q(E(M),2),T=q(E(z),2),s=E(T);$m(s,{}),k(T);var B=q(T,2);B.__click=[AM,f],k(z),k(M),vn(2),k(y),Wi(y,()=>N=>{Wr(()=>{f()?N.show():N.close()})}),Ai("close",y,()=>f(!1)),G(m,y),Fr()}Qn(["click"]);var LM=()=>{vi.url.searchParams.delete("new-user"),Im(vi.url.toString())},DM=Te('<dialog class="modal"><div class="modal-box max-h-11/12"><section class="mb-6 flex justify-center"><h2 class="font-pixel flex flex-col justify-center"><span class="text-center text-2xl"> </span> <!></h2></section> <section class="my-2"><!></section> <form class="mt-6 flex justify-center" method="dialog"><button class="btn btn-primary sm:btn-lg"> </button></form></div></dialog>');function RM(m,o){Br(o,!0);let f=Lt(o,"open",15);Dn(()=>{const ve=Me=>{Me.key==="Escape"&&f(!1)};return document.addEventListener("keydown",ve),()=>document.removeEventListener("keydown",ve)});var y=DM(),M=E(y),z=E(M),T=E(z),s=E(T),B=E(s,!0);k(s);var N=q(s,2);jv(N,{hasText:!0,size:"medium"}),k(T),k(z);var Y=q(z,2),K=E(Y);$m(K,{}),k(Y);var ie=q(Y,2),H=E(ie);H.__click=[LM];var me=E(H,!0);k(H),k(ie),k(M),k(y),Wi(y,()=>ve=>{Wr(()=>{f()?ve.show():ve.close()})}),Ye((ve,Me)=>{fe(B,ve),fe(me,Me)},[()=>Vw(),()=>x5()]),Ai("close",y,()=>f(!1)),G(m,y),Fr()}Qn(["click"]);function BM(){const m=navigator.userAgent,o=navigator.vendor;return/Chrome/.test(m)&&/Google Inc/.test(o)?"Chrome":/Safari/.test(m)&&/Apple Computer/.test(o)?"Safari":/Firefox/.test(m)?"Firefox":/Edge/.test(m)?"Edge":/Opera|OPR/.test(m)?"Opera":"Unknown"}var FM=Cr('<svg><path d="M358.939 44C384.805 44 405.773 64.9683 405.773 90.834C405.773 116.7 384.805 137.668 358.939 137.668C335.282 137.668 315.725 120.127 312.558 97.3418C311.882 97.5076 311.068 97.7132 310.139 97.9658C307.227 98.7577 303.219 99.9781 298.844 101.688C289.898 105.186 280.227 110.425 274.75 117.568C269.021 125.042 265.37 135.158 263.158 143.737C262.067 147.97 261.355 151.71 260.917 154.385C260.789 155.166 260.687 155.855 260.604 156.437C304.314 157.147 344.347 169.064 375.81 188.514C386.896 180.117 400.712 175.135 415.691 175.135C452.208 175.135 481.811 204.738 481.811 241.254C481.81 267.527 466.485 290.221 444.287 300.885C441.861 377.201 358.696 438.508 256.456 438.508C154.451 438.508 71.4321 377.482 68.6426 301.409C45.8419 290.978 30.0001 267.967 30 241.254C30 204.738 59.6021 175.135 96.1182 175.135C111.321 175.135 125.325 180.267 136.494 188.892C167.617 169.488 207.216 157.484 250.507 156.473C250.517 156.392 250.528 156.307 250.539 156.218C250.646 155.398 250.811 154.224 251.049 152.771C251.524 149.867 252.293 145.823 253.475 141.24C255.808 132.188 259.872 120.54 266.814 111.484C274.011 102.098 285.828 96.04 295.202 92.375C299.987 90.5044 304.348 89.1775 307.514 88.3164C309.099 87.8852 310.394 87.568 311.302 87.3574C311.69 87.2673 312.009 87.1968 312.249 87.1445C314.13 63.0035 334.316 44.0001 358.939 44ZM255.905 334.922C234.07 334.922 213.107 336.328 193.621 338.913C190.267 341.144 188.408 343.008 187.698 344.95C187.085 346.63 187.361 348.283 188.093 350.118C200.137 369.374 217.021 383.431 236.377 389.255C237.939 389.694 239.551 390.118 241.216 390.527C246.165 391.641 251.258 392.225 256.456 392.225C283.556 392.224 307.779 376.436 323.849 351.639C325.103 348.78 325.526 346.501 324.943 344.546C324.28 342.322 322.364 340.66 319.327 339.067C299.52 336.385 278.166 334.922 255.905 334.922ZM167.196 240.151C148.634 240.151 133.586 257.42 133.586 278.721C133.586 300.022 148.634 317.29 167.196 317.29C185.759 317.29 200.806 300.022 200.806 278.721C200.806 257.42 185.759 240.152 167.196 240.151ZM343.512 240.151C324.949 240.152 309.901 257.42 309.901 278.721C309.901 300.022 324.949 317.29 343.512 317.29C362.074 317.29 377.122 300.022 377.122 278.721C377.122 257.42 362.074 240.151 343.512 240.151Z"></path></svg>');function OM(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=FM();ar(y,()=>({viewBox:"0 0 512 512",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...f})),G(m,y)}var NM=Cr('<svg><path d="M216.856 16.597A208.502 208.502 0 0 0 164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.4-4.55-9.933-6.846-14.046a207.809 207.809 0 0 0-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193A161.094 161.094 0 0 0 79.735 175.3a136.413 136.413 0 0 1-21.846-10.632 108.636 108.636 0 0 0 5.356-4.237c42.122 19.702 87.89 19.702 129.51 0a131.66 131.66 0 0 0 5.355 4.237 136.07 136.07 0 0 1-21.886 10.653c4.006 8.02 8.638 15.67 13.873 22.848 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36ZM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2c12.867 0 23.236 11.804 23.015 26.2.02 14.375-10.148 26.18-23.015 26.18Zm85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.804 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18Z"></path></svg>');function em(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=NM();ar(y,()=>({viewBox:"0 0 256 199",width:"256",height:"199",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid",fill:"currentColor",...f})),G(m,y)}var jM=Cr('<svg><path fill="#0A0A08" d="M128 23.064c34.177 0 38.225.13 51.722.745 12.48.57 19.258 2.655 23.769 4.408 5.974 2.322 10.238 5.096 14.717 9.575 4.48 4.479 7.253 8.743 9.575 14.717 1.753 4.511 3.838 11.289 4.408 23.768.615 13.498.745 17.546.745 51.723 0 34.178-.13 38.226-.745 51.723-.57 12.48-2.655 19.257-4.408 23.768-2.322 5.974-5.096 10.239-9.575 14.718-4.479 4.479-8.743 7.253-14.717 9.574-4.511 1.753-11.289 3.839-23.769 4.408-13.495.616-17.543.746-51.722.746-34.18 0-38.228-.13-51.723-.746-12.48-.57-19.257-2.655-23.768-4.408-5.974-2.321-10.239-5.095-14.718-9.574-4.479-4.48-7.253-8.744-9.574-14.718-1.753-4.51-3.839-11.288-4.408-23.768-.616-13.497-.746-17.545-.746-51.723 0-34.177.13-38.225.746-51.722.57-12.48 2.655-19.258 4.408-23.769 2.321-5.974 5.095-10.238 9.574-14.717 4.48-4.48 8.744-7.253 14.718-9.575 4.51-1.753 11.288-3.838 23.768-4.408 13.497-.615 17.545-.745 51.723-.745M128 0C93.237 0 88.878.147 75.226.77c-13.625.622-22.93 2.786-31.071 5.95-8.418 3.271-15.556 7.648-22.672 14.764C14.367 28.6 9.991 35.738 6.72 44.155 3.555 52.297 1.392 61.602.77 75.226.147 88.878 0 93.237 0 128c0 34.763.147 39.122.77 52.774.622 13.625 2.785 22.93 5.95 31.071 3.27 8.417 7.647 15.556 14.763 22.672 7.116 7.116 14.254 11.492 22.672 14.763 8.142 3.165 17.446 5.328 31.07 5.95 13.653.623 18.012.77 52.775.77s39.122-.147 52.774-.77c13.624-.622 22.929-2.785 31.07-5.95 8.418-3.27 15.556-7.647 22.672-14.763 7.116-7.116 11.493-14.254 14.764-22.672 3.164-8.142 5.328-17.446 5.95-31.07.623-13.653.77-18.012.77-52.775s-.147-39.122-.77-52.774c-.622-13.624-2.786-22.929-5.95-31.07-3.271-8.418-7.648-15.556-14.764-22.672C227.4 14.368 220.262 9.99 211.845 6.72c-8.142-3.164-17.447-5.328-31.071-5.95C167.122.147 162.763 0 128 0Zm0 62.27C91.698 62.27 62.27 91.7 62.27 128c0 36.302 29.428 65.73 65.73 65.73 36.301 0 65.73-29.428 65.73-65.73 0-36.301-29.429-65.73-65.73-65.73Zm0 108.397c-23.564 0-42.667-19.103-42.667-42.667S104.436 85.333 128 85.333s42.667 19.103 42.667 42.667-19.103 42.667-42.667 42.667Zm83.686-110.994c0 8.484-6.876 15.36-15.36 15.36-8.483 0-15.36-6.876-15.36-15.36 0-8.483 6.877-15.36 15.36-15.36 8.484 0 15.36 6.877 15.36 15.36Z"></path></svg>');function VM(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=jM();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid",viewBox:"0 0 260 260",...f})),G(m,y)}var qM=Cr('<svg><path d="M240-640h360v-80q0-50-35-85t-85-35q-50 0-85 35t-35 85h-80q0-83 58.5-141.5T480-920q83 0 141.5 58.5T680-720v80h40q33 0 56.5 23.5T800-560v400q0 33-23.5 56.5T720-80H240q-33 0-56.5-23.5T160-160v-400q0-33 23.5-56.5T240-640Zm0 480h480v-400H240v400Zm240-120q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM240-160v-400 400Z"></path></svg>');function rp(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=qM();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var ZM=Cr(`<svg><path d="M12.75 2c.39 0 .708.316.75.704a5.735 5.735 0 0 0 
  4.112 4.751c.257.077.523.127.801.149.394.028.713.35.713.744v2.289a.75.75 
  0 0 1-.826.746 8.89 8.89 0 0 1-3.546-1.239v6.43a5.465 5.465 0 
  1 1-5.465-5.465c.388 0 .765.042 1.128.122a.75.75 0 0 
  1 .593.732v2.289a.75.75 0 0 1-.979.715 1.549 1.549 0 0 
  0-.482-.077 1.962 1.962 0 1 0 1.962 1.962V2.75a.75.75 0 0 1 
  .75-.75h1.239Z"></path></svg>`);function UM(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=ZM();ar(y,()=>({viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","aria-label":"Tiktok",...f})),G(m,y)}var $M=Cr(`<svg><path d="M23.498 6.186a2.986 2.986 0 0 0-2.103-2.115C19.505 
    3.5 12 3.5 12 3.5s-7.505 0-9.395.571a2.986 2.986 0 0 0-2.103 
    2.115C0 8.082 0 12 0 12s0 3.918.502 5.814a2.986 2.986 0 0 0 
    2.103 2.115C4.495 20.5 12 20.5 12 20.5s7.505 0 9.395-.571a2.986 
    2.986 0 0 0 2.103-2.115C24 15.918 24 12 24 12s0-3.918-.502-5.814zM9.75 
    15.021v-6.042L15.5 12l-5.75 3.021z"></path></svg>`);function GM(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=$M();ar(y,()=>({viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","aria-label":"YouTube",...f})),G(m,y)}var HM=Te(' <a class="link" href="https://help.constructiononline.com/en/scheduling-webgl-and-hardware-acceleration">link</a>',1),WM=Te('<span class="link cursor-auto">chrome://settings/system</span>.',1),XM=Te('<span class="link cursor-auto">edge://settings/system/manageSystem</span>.',1),YM=Te(' <kbd class="kbd kbd-sm"> </kbd> <!>',1),KM=Te('<div class="flex h-full flex-col gap-5"><section class="mb-2 flex flex-col items-center justify-center gap-2"><!> <div class="text-center text-sm max-sm:mt-1"> <a class="link" href="https://maplibre.org/" target="_blank">MapLibre</a> | <a class="link" href="https://openfreemap.org/" target="_blank">OpenFreeMap</a> <a class="link" href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a></div> <div class="w-full text-center text-sm"><p><a class="link" href="https://www.reddit.com/r/WplaceLive/comments/1lhzmmq/bug_reports_and_feature_requests/" target="_blank"> </a> <span class="mx-0.5">|</span> <a href="https://discord.gg/wplacelive" target="_blank"><!> <span class="link">Discord</span></a> <span class="mx-0.5">|</span> <a href="https://www.reddit.com/r/WplaceLive/" target="_blank"><!> <span class="link">Reddit</span></a> <span class="mx-0.5">|</span> <a href="https://www.instagram.com/wplace.live/" target="_blank"><!> <span class="link">Instagram</span></a> <span class="mx-0.5">|</span> <a href="https://www.youtube.com/@WplaceLive" target="_blank"><!> <span class="link">Youtube</span></a> <span class="mx-0.5">|</span> <a href="https://www.tiktok.com/@wplace5" target="_blank"><!> <span class="link">Tiktok</span></a></p></div></section> <section><h3 class="text-lg font-semibold"> </h3> <iframe class="mt-1 aspect-video w-full bg-black" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe></section> <section><h3 class="text-lg font-semibold"> </h3> <p class="not-touchscreen:hidden text-sm"> <button class="btn btn-square shadow-md"><!></button> </p> <p class="touchscreen:hidden text-sm"> <span class="kbd kbd-xs text-base-content rounded-md"> </span> </p></section> <section><h3 class="text-lg font-semibold"> </h3> <p class="text-sm"><!></p></section> <section><!></section> <div class="grow"></div> <section class="text-base-content/80 w-full text-center text-sm"><span>Email: <a class="link" href="mailto:contact@wplace.live">contact@wplace.live</a></span> Â· <a class="link" target="_blank"> </a> Â· <a class="link" target="_blank"> </a> Â· <a class="link" target="_blank"> </a></section></div>'),JM=Te('<dialog class="modal"><div class="modal-box sm:max-h-11/12 max-sm:size-full max-sm:rounded-none max-sm:px-4 sm:max-w-5xl"><form method="dialog"><button class="btn btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <!></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog>');function QM(m,o){Br(o,!0);let f=Lt(o,"open",15);Dn(()=>{const K=ie=>{ie.key==="Escape"&&f(!1)};return document.addEventListener("keydown",K),()=>document.removeEventListener("keydown",K)});const y=BM();var M=JM(),z=E(M),T=q(E(z),2);{var s=K=>{var ie=KM(),H=E(ie),me=E(H);jv(me,{hasText:!0,size:"medium"});var ve=q(me,2),Me=E(ve),Ee=q(Me,4);vn(),k(ve);var Re=q(ve,2),ze=E(Re),Fe=E(ze),Ke=E(Fe,!0);k(Fe);var rt=q(Fe,4),qe=E(rt);em(qe,{class:"text-base-content mr-0.5 inline size-4"}),vn(2),k(rt);var He=q(rt,4),et=E(He);OM(et,{class:"size-4.5 mr-0.5 inline"}),vn(2),k(He);var De=q(He,4),tt=E(De);VM(tt,{class:"mr-0.5 inline size-3.5"}),vn(2),k(De);var nt=q(De,4),Ze=E(nt);GM(Ze,{class:"mr-0.5 inline size-3.5"}),vn(2),k(nt);var ke=q(nt,4),bt=E(ke);UM(bt,{class:"mr-0.5 inline size-3.5"}),vn(2),k(ke),k(ze),k(Re),k(H);var te=q(H,2),re=E(te),ge=E(re,!0);k(re);var oe=q(re,2);k(te);var Ae=q(te,2),Ne=E(Ae),pt=E(Ne,!0);k(Ne);var ot=q(Ne,2),ut=E(ot),St=q(ut),Bt=E(St);rp(Bt,{class:"size-5"}),k(St);var at=q(St);k(ot);var dt=q(ot,2),vt=E(dt),yt=q(vt),It=E(yt,!0);k(yt);var wt=q(yt);k(dt),k(Ae);var mt=q(Ae,2),Dt=E(mt),zt=E(Dt,!0);k(Dt);var qt=q(Dt,2),tr=E(qt);{var Qt=se=>{var j=HM(),Z=Ct(j);vn(),Ye(X=>fe(Z,`${X??""}: `),[()=>FP()]),G(se,j)},Ot=se=>{var j=YM(),Z=Ct(j),X=q(Z),ae=E(X,!0);k(X);var de=q(X),Se=q(de);{var Ie=Oe=>{var st=WM();vn(),G(Oe,st)},be=Oe=>{var st=er(),$e=Ct(st);{var Mt=xe=>{var Ft=XM();vn(),G(xe,Ft)};je($e,xe=>{y==="Edge"&&xe(Mt)},!0)}G(Oe,st)};je(Se,Oe=>{y==="Chrome"?Oe(Ie):Oe(be,!1)})}Ye((Oe,st,$e)=>{fe(Z,`${Oe??""} `),fe(ae,st),fe(de,` ${$e??""} `)},[()=>MP(),()=>EP(),()=>DP()]),G(se,j)};je(tr,se=>{y!=="Chrome"&&y!=="Edge"?se(Qt):se(Ot,!1)})}k(qt),k(mt);var fr=q(mt,2),kr=E(fr);$m(kr,{}),k(fr);var Ar=q(fr,4),rr=q(E(Ar),2),Kt=E(rr,!0);k(rr);var or=q(rr,2),Sr=E(or,!0);k(or);var Dr=q(or,2),Zr=E(Dr,!0);k(Dr),k(Ar),k(ie),Ye((se,j,Z,X,ae,de,Se,Ie,be,Oe,st,$e,Mt,xe,Ft)=>{fe(Me,`${se??""} `),fe(Ee,` Â©
						${j??""} `),fe(Ke,Z),fe(ge,X),xr(oe,"src",ai.language==="pt"?"https://www.youtube.com/embed/AcE85QM4iPQ?si=wbeZD8vxOzvlB_Z9":"https://www.youtube.com/embed/xOXtd-WzRxA?si=fHz8Z6ecXGYrDhkN"),fe(pt,ae),fe(ut,`${de??""} `),fe(at,` ${Se??""}`),fe(vt,`${Ie??""} `),fe(It,be),fe(wt,` ${Oe??""}`),fe(zt,st),xr(rr,"href",`${vi.url.origin??""}/terms/terms-of-service`),fe(Kt,$e),xr(or,"href",`${vi.url.origin??""}/terms/privacy`),fe(Sr,Mt),xr(Dr,"href",xe),fe(Zr,Ft)},[()=>Ob(),()=>Vb(),()=>Ub(),()=>Hb(),()=>Yb(),()=>Qb(),()=>r2(),()=>a2(),()=>l2(),()=>h2(),()=>SP(),()=>ZP(),()=>GP(),()=>Bv(vi.url.origin),()=>Kv()]),ki(2,ie,()=>ia,()=>({duration:300})),G(K,ie)};je(T,K=>{f()&&K(s)})}k(z);var B=q(z,2),N=E(B),Y=E(N,!0);k(N),k(B),k(M),Wi(M,()=>K=>{Wr(()=>{f()?K.show():K.close()})}),Ye(K=>fe(Y,K),[()=>cl()]),Ai("close",M,()=>f(!1)),G(m,M),Fr()}function e6(m){return typeof m=="function"}function zh(m){return m!==null&&typeof m=="object"}const t6=["string","number","bigint","boolean"];function tm(m){return m==null||t6.includes(typeof m)?!0:Array.isArray(m)?m.every(o=>tm(o)):typeof m=="object"?Object.getPrototypeOf(m)===Object.prototype:!1}const Vu=Symbol("box"),Gm=Symbol("is-writable");function r6(m){return zh(m)&&Vu in m}function n6(m){return vr.isBox(m)&&Gm in m}function vr(m){let o=ct(xi(m));return{[Vu]:!0,[Gm]:!0,get current(){return x(o)},set current(f){ce(o,f,!0)}}}function i6(m,o){const f=ft(m);return o?{[Vu]:!0,[Gm]:!0,get current(){return x(f)},set current(y){o(y)}}:{[Vu]:!0,get current(){return m()}}}function a6(m){return vr.isBox(m)?m:e6(m)?vr.with(m):vr(m)}function o6(m){return Object.entries(m).reduce((o,[f,y])=>vr.isBox(y)?(vr.isWritableBox(y)?Object.defineProperty(o,f,{get(){return y.current},set(M){y.current=M}}):Object.defineProperty(o,f,{get(){return y.current}}),o):Object.assign(o,{[f]:y}),{})}function s6(m){return vr.isWritableBox(m)?{[Vu]:!0,get current(){return m.current}}:m}vr.from=a6;vr.with=i6;vr.flatten=o6;vr.readonly=s6;vr.isBox=r6;vr.isWritableBox=n6;function l6(...m){return function(o){var f;for(const y of m)if(y){if(o.defaultPrevented)return;typeof y=="function"?y.call(this,o):(f=y.current)==null||f.call(this,o)}}}var hc={},Df,tv;function c6(){if(tv)return Df;tv=1;var m=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,o=/\n/g,f=/^\s*/,y=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,M=/^:\s*/,z=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,T=/^[;\s]*/,s=/^\s+|\s+$/g,B=`
`,N="/",Y="*",K="",ie="comment",H="declaration";Df=function(ve,Me){if(typeof ve!="string")throw new TypeError("First argument must be a string");if(!ve)return[];Me=Me||{};var Ee=1,Re=1;function ze(Ze){var ke=Ze.match(o);ke&&(Ee+=ke.length);var bt=Ze.lastIndexOf(B);Re=~bt?Ze.length-bt:Re+Ze.length}function Fe(){var Ze={line:Ee,column:Re};return function(ke){return ke.position=new Ke(Ze),He(),ke}}function Ke(Ze){this.start=Ze,this.end={line:Ee,column:Re},this.source=Me.source}Ke.prototype.content=ve;function rt(Ze){var ke=new Error(Me.source+":"+Ee+":"+Re+": "+Ze);if(ke.reason=Ze,ke.filename=Me.source,ke.line=Ee,ke.column=Re,ke.source=ve,!Me.silent)throw ke}function qe(Ze){var ke=Ze.exec(ve);if(ke){var bt=ke[0];return ze(bt),ve=ve.slice(bt.length),ke}}function He(){qe(f)}function et(Ze){var ke;for(Ze=Ze||[];ke=De();)ke!==!1&&Ze.push(ke);return Ze}function De(){var Ze=Fe();if(!(N!=ve.charAt(0)||Y!=ve.charAt(1))){for(var ke=2;K!=ve.charAt(ke)&&(Y!=ve.charAt(ke)||N!=ve.charAt(ke+1));)++ke;if(ke+=2,K===ve.charAt(ke-1))return rt("End of comment missing");var bt=ve.slice(2,ke-2);return Re+=2,ze(bt),ve=ve.slice(ke),Re+=2,Ze({type:ie,comment:bt})}}function tt(){var Ze=Fe(),ke=qe(y);if(ke){if(De(),!qe(M))return rt("property missing ':'");var bt=qe(z),te=Ze({type:H,property:me(ke[0].replace(m,K)),value:bt?me(bt[0].replace(m,K)):K});return qe(T),te}}function nt(){var Ze=[];et(Ze);for(var ke;ke=tt();)ke!==!1&&(Ze.push(ke),et(Ze));return Ze}return He(),nt()};function me(ve){return ve?ve.replace(s,K):K}return Df}var rv;function u6(){if(rv)return hc;rv=1;var m=hc&&hc.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(hc,"__esModule",{value:!0}),hc.default=f;var o=m(c6());function f(y,M){var z=null;if(!y||typeof y!="string")return z;var T=(0,o.default)(y),s=typeof M=="function";return T.forEach(function(B){if(B.type==="declaration"){var N=B.property,Y=B.value;s?M(N,Y,B):Y&&(z=z||{},z[N]=Y)}}),z}return hc}var h6=u6();const nv=qm(h6),d6=nv.default||nv,p6=/\d/,f6=["-","_","/","."];function m6(m=""){if(!p6.test(m))return m!==m.toLowerCase()}function _6(m){const o=[];let f="",y,M;for(const z of m){const T=f6.includes(z);if(T===!0){o.push(f),f="",y=void 0;continue}const s=m6(z);if(M===!1){if(y===!1&&s===!0){o.push(f),f=z,y=s;continue}if(y===!0&&s===!1&&f.length>1){const B=f.at(-1);o.push(f.slice(0,Math.max(0,f.length-1))),f=B+z,y=s;continue}}f+=z,y=s,M=T}return o.push(f),o}function o0(m){return m?_6(m).map(o=>v6(o)).join(""):""}function g6(m){return y6(o0(m||""))}function v6(m){return m?m[0].toUpperCase()+m.slice(1):""}function y6(m){return m?m[0].toLowerCase()+m.slice(1):""}function qd(m){if(!m)return{};const o={};function f(y,M){if(y.startsWith("-moz-")||y.startsWith("-webkit-")||y.startsWith("-ms-")||y.startsWith("-o-")){o[o0(y)]=M;return}if(y.startsWith("--")){o[y]=M;return}o[g6(y)]=M}return d6(m,f),o}function x6(...m){return(...o)=>{for(const f of m)typeof f=="function"&&f(...o)}}function b6(m,o){const f=RegExp(m,"g");return y=>{if(typeof y!="string")throw new TypeError(`expected an argument of type string, but got ${typeof y}`);return y.match(f)?y.replace(f,o):y}}const w6=b6(/[A-Z]/,m=>`-${m.toLowerCase()}`);function T6(m){if(!m||typeof m!="object"||Array.isArray(m))throw new TypeError(`expected an argument of type object, but got ${typeof m}`);return Object.keys(m).map(o=>`${w6(o)}: ${m[o]};`).join(`
`)}function s0(m={}){return T6(m).replace(`
`," ")}const l0={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};s0(l0);const C6=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],S6=new Set(C6);function P6(m){return S6.has(m)}function Va(...m){const o={...m[0]};for(let f=1;f<m.length;f++){const y=m[f];if(y){for(const M of Object.keys(y)){const z=o[M],T=y[M],s=typeof z=="function",B=typeof T=="function";if(s&&P6(M)){const N=z,Y=T;o[M]=l6(N,Y)}else if(s&&B)o[M]=x6(z,T);else if(M==="class"){const N=tm(z),Y=tm(T);N&&Y?o[M]=Ou(z,T):N?o[M]=Ou(z):Y&&(o[M]=Ou(T))}else if(M==="style"){const N=typeof z=="object",Y=typeof T=="object",K=typeof z=="string",ie=typeof T=="string";if(N&&Y)o[M]={...z,...T};else if(N&&ie){const H=qd(T);o[M]={...z,...H}}else if(K&&Y){const H=qd(z);o[M]={...H,...T}}else if(K&&ie){const H=qd(z),me=qd(T);o[M]={...H,...me}}else N?o[M]=z:Y?o[M]=T:K?o[M]=z:ie&&(o[M]=T)}else o[M]=T!==void 0?T:z}for(const M of Object.getOwnPropertySymbols(y)){const z=o[M],T=y[M];o[M]=T!==void 0?T:z}}}return typeof o.style=="object"&&(o.style=s0(o.style).replaceAll(`
`," ")),o.hidden!==!0&&(o.hidden=void 0,delete o.hidden),o.disabled!==!0&&(o.disabled=void 0,delete o.disabled),o}const I6=typeof window<"u"?window:void 0;function M6(m){let o=m.activeElement;for(;o!=null&&o.shadowRoot;){const f=o.shadowRoot.activeElement;if(f===o)break;o=f}return o}var wc,Yu;class k6{constructor(o={}){Mr(this,wc);Mr(this,Yu);const{window:f=I6,document:y=f==null?void 0:f.document}=o;f!==void 0&&(na(this,wc,y),na(this,Yu,Ev(M=>{const z=Nu(f,"focusin",M),T=Nu(f,"focusout",M);return()=>{z(),T()}})))}get current(){var o;return(o=it(this,Yu))==null||o.call(this),it(this,wc)?M6(it(this,wc)):null}}wc=new WeakMap,Yu=new WeakMap;new k6;var Ku,Wo;class Hm{constructor(o){Mr(this,Ku);Mr(this,Wo);na(this,Ku,o),na(this,Wo,Symbol(o))}get key(){return it(this,Wo)}exists(){return Q1(it(this,Wo))}get(){const o=$g(it(this,Wo));if(o===void 0)throw new Error(`Context "${it(this,Ku)}" not found`);return o}getOr(o){const f=$g(it(this,Wo));return f===void 0?o:f}set(o){return ex(it(this,Wo),o)}}Ku=new WeakMap,Wo=new WeakMap;function A6(m,o){switch(m){case"post":Wr(o);break;case"pre":Pm(o);break}}function c0(m,o,f,y={}){const{lazy:M=!1}=y;let z=!M,T=Array.isArray(m)?[]:void 0;A6(o,()=>{const s=Array.isArray(m)?m.map(N=>N()):m();if(!z){z=!0,T=s;return}const B=ul(()=>f(s,T));return T=s,B})}function Ss(m,o,f){c0(m,"post",o,f)}function E6(m,o,f){c0(m,"pre",o,f)}Ss.pre=E6;var Tc;class z6{constructor(o,f){Mr(this,Tc,ct(void 0));f!==void 0&&ce(it(this,Tc),f,!0),Ss(()=>o(),(y,M)=>{ce(it(this,Tc),M,!0)})}get current(){return x(it(this,Tc))}}Tc=new WeakMap;function L6(m,o){return setTimeout(o,m)}function dc(m){Iv().then(m)}const D6=1,R6=9,B6=11;function F6(m){return zh(m)&&m.nodeType===D6&&typeof m.nodeName=="string"}function u0(m){return zh(m)&&m.nodeType===R6}function O6(m){var o;return zh(m)&&((o=m.constructor)==null?void 0:o.name)==="VisualViewport"}function N6(m){return zh(m)&&m.nodeType!==void 0}function j6(m){return N6(m)&&m.nodeType===B6&&"host"in m}function V6(m){return u0(m)?m:O6(m)?m.document:(m==null?void 0:m.ownerDocument)??document}function h0(m){var o;return j6(m)?h0(m.host):u0(m)?m.defaultView??window:F6(m)?((o=m.ownerDocument)==null?void 0:o.defaultView)??window:window}function q6(m){let o=m.activeElement;for(;o!=null&&o.shadowRoot;){const f=o.shadowRoot.activeElement;if(f===o)break;o=f}return o}var Ju;class Z6{constructor(o){gr(this,"element");Mr(this,Ju,ft(()=>this.element.current?this.element.current.getRootNode()??document:document));gr(this,"getDocument",()=>V6(this.root));gr(this,"getWindow",()=>this.getDocument().defaultView??window);gr(this,"getActiveElement",()=>q6(this.root));gr(this,"isActiveElement",o=>o===this.getActiveElement());gr(this,"querySelector",o=>this.root?this.root.querySelector(o):null);gr(this,"querySelectorAll",o=>this.root?this.root.querySelectorAll(o):[]);gr(this,"setTimeout",(o,f)=>this.getWindow().setTimeout(o,f));gr(this,"clearTimeout",o=>this.getWindow().clearTimeout(o));typeof o=="function"?this.element=vr.with(o):this.element=o}get root(){return x(it(this,Ju))}set root(o){ce(it(this,Ju),o)}getElementById(o){return this.root.getElementById(o)}}Ju=new WeakMap;function Xa(m,o){return{[Hx()]:f=>vr.isBox(m)?(m.current=f,ul(()=>o==null?void 0:o(f)),()=>{"isConnected"in f&&f.isConnected||(m.current=null,o==null||o(null))}):(m(f),ul(()=>o==null?void 0:o(f)),()=>{"isConnected"in f&&f.isConnected||(m(null),o==null||o(null))})}}function U6(m){return m?"true":"false"}function $6(m){return m?"true":"false"}function G6(m){return m?"":void 0}function H6(m){return m?"true":"false"}function W6(m){return m?"":void 0}function X6(m){return m?!0:void 0}var Cc,Qu;class Y6{constructor(o){Mr(this,Cc);Mr(this,Qu);gr(this,"attrs");na(this,Cc,o.getVariant?o.getVariant():null),na(this,Qu,it(this,Cc)?`data-${it(this,Cc)}-`:`data-${o.component}-`),this.getAttr=this.getAttr.bind(this),this.selector=this.selector.bind(this),this.attrs=Object.fromEntries(o.parts.map(f=>[f,this.getAttr(f)]))}getAttr(o,f){return f?`data-${f}-${o}`:`${it(this,Qu)}${o}`}selector(o,f){return`[${this.getAttr(o,f)}]`}}Cc=new WeakMap,Qu=new WeakMap;function d0(m){const o=new Y6(m);return{...o.attrs,selector:o.selector,getAttr:o.getAttr}}const K6="ArrowDown",J6="ArrowLeft",Q6="ArrowRight",ek="ArrowUp",tk="End",rk="Enter",nk="Home",ik="p",ak="n",ok="j",sk="k",lk="h",ck="l";function qu(){}function Ya(m,o){return`bits-${m}`}function uk(m){if(!m)return null;for(const o of m.childNodes)if(o.nodeType!==Node.COMMENT_NODE)return o;return null}globalThis.bitsIdCounter??(globalThis.bitsIdCounter={current:0});function hk(m="bits"){return globalThis.bitsIdCounter.current++,`${m}-${globalThis.bitsIdCounter.current}`}function dk(m,o){let f=m.nextElementSibling;for(;f;){if(f.matches(o))return f;f=f.nextElementSibling}}function pk(m,o){let f=m.previousElementSibling;for(;f;){if(f.matches(o))return f;f=f.previousElementSibling}}function p0(m){if(typeof CSS<"u"&&typeof CSS.escape=="function")return CSS.escape(m);const o=m.length;let f=-1,y,M="";const z=m.charCodeAt(0);if(o===1&&z===45)return"\\"+m;for(;++f<o;){if(y=m.charCodeAt(f),y===0){M+="ï¿½";continue}if(y>=1&&y<=31||y===127||f===0&&y>=48&&y<=57||f===1&&y>=48&&y<=57&&z===45){M+="\\"+y.toString(16)+" ";continue}if(y>=128||y===45||y===95||y>=48&&y<=57||y>=65&&y<=90||y>=97&&y<=122){M+=m.charAt(f);continue}M+="\\"+m.charAt(f)}return M}const ol="data-value",wa=d0({component:"command",parts:["root","list","input","separator","loading","empty","group","group-items","group-heading","item","viewport","input-label"]}),pc=wa.selector("group"),Rf=wa.selector("group-items"),iv=wa.selector("group-heading"),f0=wa.selector("item"),Bf=`${wa.selector("item")}:not([aria-disabled="true"])`,ml=new Hm("Command.Root"),fk=new Hm("Command.List"),Zu=new Hm("Command.Group"),av={search:"",value:"",filtered:{count:0,items:new Map,groups:new Set}};var Sc,eh,th,rh,nh,ih,ah,oh,pr,m0,Yd,nm,Kd,Jd,Qd,ws,_0,g0,im,Du,am,om,v0,Ru,sm,lm,y0,Bu,Fu,sh;const Qm=class Qm{constructor(o){Mr(this,pr);gr(this,"opts");gr(this,"attachment");Mr(this,Sc,!1);Mr(this,eh,!0);gr(this,"sortAfterTick",!1);gr(this,"sortAndFilterAfterTick",!1);gr(this,"allItems",new Set);gr(this,"allGroups",new Map);gr(this,"allIds",new Map);Mr(this,th,ct(0));Mr(this,rh,ct(null));Mr(this,nh,ct(null));Mr(this,ih,ct(null));Mr(this,ah,ct(av));Mr(this,oh,ct(xi(av)));Mr(this,sh,ft(()=>({id:this.opts.id.current,role:"application",[wa.root]:"",tabindex:-1,onkeydown:this.onkeydown,...this.attachment})));this.opts=o,this.attachment=Xa(this.opts.ref);const f={...this._commandState,value:this.opts.value.current??""};this._commandState=f,this.commandState=f,this.onkeydown=this.onkeydown.bind(this)}static create(o){return ml.set(new Qm(o))}get key(){return x(it(this,th))}set key(o){ce(it(this,th),o,!0)}get viewportNode(){return x(it(this,rh))}set viewportNode(o){ce(it(this,rh),o,!0)}get inputNode(){return x(it(this,nh))}set inputNode(o){ce(it(this,nh),o,!0)}get labelNode(){return x(it(this,ih))}set labelNode(o){ce(it(this,ih),o,!0)}get commandState(){return x(it(this,ah))}set commandState(o){ce(it(this,ah),o)}get _commandState(){return x(it(this,oh))}set _commandState(o){ce(it(this,oh),o,!0)}setState(o,f,y){Object.is(this._commandState[o],f)||(this._commandState[o]=f,o==="search"?(Vr(this,pr,Qd).call(this),Vr(this,pr,Kd).call(this)):o==="value"&&(y||Vr(this,pr,_0).call(this)),Vr(this,pr,Yd).call(this))}setValue(o,f){o!==this.opts.value.current&&o===""&&dc(()=>{this.key++}),this.setState("value",o,f),this.opts.value.current=o}getValidItems(){const o=this.opts.ref.current;return o?Array.from(o.querySelectorAll(Bf)).filter(y=>!!y):[]}getVisibleItems(){const o=this.opts.ref.current;return o?Array.from(o.querySelectorAll(f0)).filter(y=>!!y):[]}get itemsGrid(){var s,B,N,Y;if(!this.isGrid)return[];const o=this.opts.columns.current??1,f=this.getVisibleItems(),y=[[]];let M=(s=f[0])==null?void 0:s.getAttribute("data-group"),z=0,T=0;for(let K=0;K<f.length;K++){const ie=f[K],H=ie==null?void 0:ie.getAttribute("data-group");M!==H?(M=H,z=1,T++,y.push([{index:K,firstRowOfGroup:!0,ref:ie}])):(z++,z>o&&(T++,z=1,y.push([])),(Y=y[T])==null||Y.push({index:K,firstRowOfGroup:((N=(B=y[T])==null?void 0:B[0])==null?void 0:N.firstRowOfGroup)??K===0,ref:ie}))}return y}updateSelectedToIndex(o){const f=this.getValidItems()[o];f&&this.setValue(f.getAttribute(ol)??"")}updateSelectedByItem(o){const f=Vr(this,pr,ws).call(this),y=this.getValidItems(),M=y.findIndex(T=>T===f);let z=y[M+o];this.opts.loop.current&&(z=M+o<0?y[y.length-1]:M+o===y.length?y[0]:y[M+o]),z&&this.setValue(z.getAttribute(ol)??"")}updateSelectedByGroup(o){const f=Vr(this,pr,ws).call(this);let y=f==null?void 0:f.closest(pc),M;for(;y&&!M;)y=o>0?dk(y,pc):pk(y,pc),M=y==null?void 0:y.querySelector(Bf);M?this.setValue(M.getAttribute(ol)??""):this.updateSelectedByItem(o)}registerValue(o,f){var y;return o&&o===((y=this.allIds.get(o))==null?void 0:y.value)||this.allIds.set(o,{value:o,keywords:f}),this._commandState.filtered.items.set(o,Vr(this,pr,nm).call(this,o,f)),this.sortAfterTick||(this.sortAfterTick=!0,dc(()=>{Vr(this,pr,Kd).call(this),this.sortAfterTick=!1})),()=>{this.allIds.delete(o)}}registerItem(o,f){return this.allItems.add(o),f&&(this.allGroups.has(f)?this.allGroups.get(f).add(o):this.allGroups.set(f,new Set([o]))),this.sortAndFilterAfterTick||(this.sortAndFilterAfterTick=!0,dc(()=>{Vr(this,pr,Qd).call(this),Vr(this,pr,Kd).call(this),this.sortAndFilterAfterTick=!1})),Vr(this,pr,Yd).call(this),()=>{const y=Vr(this,pr,ws).call(this);this.allIds.delete(o),this.allItems.delete(o),this.commandState.filtered.items.delete(o),Vr(this,pr,Qd).call(this),(y==null?void 0:y.getAttribute("id"))===o&&Vr(this,pr,Jd).call(this),Vr(this,pr,Yd).call(this)}}registerGroup(o){return this.allGroups.has(o)||this.allGroups.set(o,new Set),()=>{this.allIds.delete(o),this.allGroups.delete(o)}}get isGrid(){return this.opts.columns.current!==null}onkeydown(o){const f=this.opts.vimBindings.current&&o.ctrlKey;switch(o.key){case ak:case ok:{f&&(this.isGrid?Vr(this,pr,am).call(this,o):Vr(this,pr,Du).call(this,o));break}case ck:{f&&this.isGrid&&Vr(this,pr,Du).call(this,o);break}case K6:this.isGrid?Vr(this,pr,am).call(this,o):Vr(this,pr,Du).call(this,o);break;case Q6:if(!this.isGrid)break;Vr(this,pr,Du).call(this,o);break;case ik:case sk:{f&&(this.isGrid?Vr(this,pr,lm).call(this,o):Vr(this,pr,Fu).call(this,o));break}case lk:{f&&this.isGrid&&Vr(this,pr,Fu).call(this,o);break}case ek:this.isGrid?Vr(this,pr,lm).call(this,o):Vr(this,pr,Fu).call(this,o);break;case J6:if(!this.isGrid)break;Vr(this,pr,Fu).call(this,o);break;case nk:o.preventDefault(),this.updateSelectedToIndex(0);break;case tk:o.preventDefault(),Vr(this,pr,im).call(this);break;case rk:if(!o.isComposing&&o.keyCode!==229){o.preventDefault();const y=Vr(this,pr,ws).call(this);y&&(y==null||y.click())}}}get props(){return x(it(this,sh))}set props(o){ce(it(this,sh),o)}};Sc=new WeakMap,eh=new WeakMap,th=new WeakMap,rh=new WeakMap,nh=new WeakMap,ih=new WeakMap,ah=new WeakMap,oh=new WeakMap,pr=new WeakSet,m0=function(){return Gx(this._commandState)},Yd=function(){it(this,Sc)||(na(this,Sc,!0),dc(()=>{var y,M;na(this,Sc,!1);const o=Vr(this,pr,m0).call(this);!Object.is(this.commandState,o)&&(this.commandState=o,(M=(y=this.opts.onStateChange)==null?void 0:y.current)==null||M.call(y,o))}))},nm=function(o,f){const y=this.opts.filter.current??w0;return o?y(o,this._commandState.search,f):0},Kd=function(){var T;if(!this._commandState.search||this.opts.shouldFilter.current===!1){Vr(this,pr,Jd).call(this);return}const o=this._commandState.filtered.items,f=[];for(const s of this._commandState.filtered.groups){const B=this.allGroups.get(s);let N=0;if(!B){f.push([s,N]);continue}for(const Y of B){const K=o.get(Y);N=Math.max(K??0,N)}f.push([s,N])}const y=this.viewportNode,M=this.getValidItems().sort((s,B)=>{const N=s.getAttribute("data-value"),Y=B.getAttribute("data-value"),K=o.get(N)??0;return(o.get(Y)??0)-K});for(const s of M){const B=s.closest(Rf);if(B){const N=s.parentElement===B?s:s.closest(`${Rf} > *`);N&&B.appendChild(N)}else{const N=s.parentElement===y?s:s.closest(`${Rf} > *`);N&&(y==null||y.appendChild(N))}}const z=f.sort((s,B)=>B[1]-s[1]);for(const s of z){const B=y==null?void 0:y.querySelector(`${pc}[${ol}="${p0(s[0])}"]`);(T=B==null?void 0:B.parentElement)==null||T.appendChild(B)}Vr(this,pr,Jd).call(this)},Jd=function(){dc(()=>{const o=this.getValidItems().find(M=>M.getAttribute("aria-disabled")!=="true"),f=o==null?void 0:o.getAttribute(ol),y=it(this,eh)&&this.opts.disableInitialScroll.current;this.setValue(f??"",y),na(this,eh,!1)})},Qd=function(){var f,y;if(!this._commandState.search||this.opts.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let o=0;for(const M of this.allItems){const z=((f=this.allIds.get(M))==null?void 0:f.value)??"",T=((y=this.allIds.get(M))==null?void 0:y.keywords)??[],s=Vr(this,pr,nm).call(this,z,T);this._commandState.filtered.items.set(M,s),s>0&&o++}for(const[M,z]of this.allGroups)for(const T of z){const s=this._commandState.filtered.items.get(T);if(s&&s>0){this._commandState.filtered.groups.add(M);break}}this._commandState.filtered.count=o},ws=function(){const o=this.opts.ref.current;if(!o)return;const f=o.querySelector(`${Bf}[data-selected]`);if(f)return f},_0=function(){dc(()=>{var y,M,z,T,s;const o=Vr(this,pr,ws).call(this);if(!o)return;const f=(y=o.parentElement)==null?void 0:y.parentElement;if(f){if(this.isGrid){const B=Vr(this,pr,g0).call(this,o);if(o.scrollIntoView({block:"nearest"}),B){const N=(M=o==null?void 0:o.closest(pc))==null?void 0:M.querySelector(iv);N==null||N.scrollIntoView({block:"nearest"});return}}else{const B=uk(f);if(B&&((z=B.dataset)==null?void 0:z.value)===((T=o.dataset)==null?void 0:T.value)){const N=(s=o==null?void 0:o.closest(pc))==null?void 0:s.querySelector(iv);N==null||N.scrollIntoView({block:"nearest"});return}}o.scrollIntoView({block:"nearest"})}})},g0=function(o){const f=this.itemsGrid;if(f.length===0)return!1;for(let y=0;y<f.length;y++){const M=f[y];if(M!==void 0)for(let z=0;z<M.length;z++){const T=M[z];if(!(T===void 0||T.ref!==o))return T.firstRowOfGroup}}return!1},im=function(){return this.updateSelectedToIndex(this.getValidItems().length-1)},Du=function(o){o.preventDefault(),o.metaKey?Vr(this,pr,im).call(this):o.altKey?this.updateSelectedByGroup(1):this.updateSelectedByItem(1)},am=function(o){this.opts.columns.current!==null&&(o.preventDefault(),o.metaKey?this.updateSelectedByGroup(1):this.updateSelectedByItem(Vr(this,pr,v0).call(this,o)))},om=function(o,f){if(f.length===0)return null;for(let y=0;y<f.length;y++){const M=f[y];if(M!==void 0)for(let z=0;z<M.length;z++){const T=M[z];if(!(T===void 0||T.ref!==o))return{columnIndex:z,rowIndex:y}}}return null},v0=function(o){const f=this.itemsGrid,y=Vr(this,pr,ws).call(this);if(!y)return 0;const M=Vr(this,pr,om).call(this,y,f);if(!M)return 0;let z=null;const T=o.altKey?1:0;if(o.altKey&&M.rowIndex===f.length-2&&!this.opts.loop.current)z=Vr(this,pr,Ru).call(this,{start:f.length-1,end:f.length,expectedColumnIndex:M.columnIndex,grid:f});else if(M.rowIndex===f.length-1){if(!this.opts.loop.current)return 0;z=Vr(this,pr,Ru).call(this,{start:0+T,end:M.rowIndex,expectedColumnIndex:M.columnIndex,grid:f})}else z=Vr(this,pr,Ru).call(this,{start:M.rowIndex+1+T,end:f.length,expectedColumnIndex:M.columnIndex,grid:f}),z===null&&this.opts.loop.current&&(z=Vr(this,pr,Ru).call(this,{start:0,end:M.rowIndex,expectedColumnIndex:M.columnIndex,grid:f}));return Vr(this,pr,sm).call(this,y,z)},Ru=function({start:o,end:f,grid:y,expectedColumnIndex:M}){var T;let z=null;for(let s=o;s<f;s++){const B=y[s];if(z=((T=B[M])==null?void 0:T.ref)??null,z!==null&&Zd(z)){z=null;continue}if(z===null)for(let N=B.length-1;N>=0;N--){const Y=B[B.length-1];if(!(Y===void 0||Zd(Y.ref))){z=Y.ref;break}}break}return z},sm=function(o,f){if(f===null)return 0;const y=this.getValidItems(),M=y.findIndex(T=>T===o);return y.findIndex(T=>T===f)-M},lm=function(o){this.opts.columns.current!==null&&(o.preventDefault(),o.metaKey?this.updateSelectedByGroup(-1):this.updateSelectedByItem(Vr(this,pr,y0).call(this,o)))},y0=function(o){const f=this.itemsGrid,y=Vr(this,pr,ws).call(this);if(y===void 0)return 0;const M=Vr(this,pr,om).call(this,y,f);if(M===null)return 0;let z=null;const T=o.altKey?1:0;if(o.altKey&&M.rowIndex===1&&this.opts.loop.current===!1)z=Vr(this,pr,Bu).call(this,{start:0,end:0,expectedColumnIndex:M.columnIndex,grid:f});else if(M.rowIndex===0){if(this.opts.loop.current===!1)return 0;z=Vr(this,pr,Bu).call(this,{start:f.length-1-T,end:M.rowIndex+1,expectedColumnIndex:M.columnIndex,grid:f})}else z=Vr(this,pr,Bu).call(this,{start:M.rowIndex-1-T,end:0,expectedColumnIndex:M.columnIndex,grid:f}),z===null&&this.opts.loop.current&&(z=Vr(this,pr,Bu).call(this,{start:f.length-1,end:M.rowIndex+1,expectedColumnIndex:M.columnIndex,grid:f}));return Vr(this,pr,sm).call(this,y,z)},Bu=function({start:o,end:f,grid:y,expectedColumnIndex:M}){var T;let z=null;for(let s=o;s>=f;s--){const B=y[s];if(B!==void 0){if(z=((T=B[M])==null?void 0:T.ref)??null,z!==null&&Zd(z)){z=null;continue}if(z===null)for(let N=B.length-1;N>=0;N--){const Y=B[B.length-1];if(!(Y===void 0||Zd(Y.ref))){z=Y.ref;break}}break}}return z},Fu=function(o){o.preventDefault(),o.metaKey?this.updateSelectedToIndex(0):o.altKey?this.updateSelectedByGroup(-1):this.updateSelectedByItem(-1)},sh=new WeakMap;let rm=Qm;function Zd(m){return m.getAttribute("aria-disabled")==="true"}var lh,ch,uh;const e_=class e_{constructor(o,f){gr(this,"opts");gr(this,"root");gr(this,"attachment");Mr(this,lh,ft(()=>this.root._commandState.filtered.count===0&&it(this,ch)===!1||this.opts.forceMount.current));Mr(this,ch,!0);Mr(this,uh,ft(()=>({id:this.opts.id.current,role:"presentation",[wa.empty]:"",...this.attachment})));this.opts=o,this.root=f,this.attachment=Xa(this.opts.ref),Pm(()=>{na(this,ch,!1)})}static create(o){return new e_(o,ml.get())}get shouldRender(){return x(it(this,lh))}set shouldRender(o){ce(it(this,lh),o)}get props(){return x(it(this,uh))}set props(o){ce(it(this,uh),o)}};lh=new WeakMap,ch=new WeakMap,uh=new WeakMap;let cm=e_;var hh,dh,ph,fh;const t_=class t_{constructor(o,f){gr(this,"opts");gr(this,"root");gr(this,"attachment");Mr(this,hh,ft(()=>this.opts.forceMount.current||this.root.opts.shouldFilter.current===!1||!this.root.commandState.search?!0:this.root._commandState.filtered.groups.has(this.trueValue)));Mr(this,dh,ct(null));Mr(this,ph,ct(""));Mr(this,fh,ft(()=>({id:this.opts.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[wa.group]:"",...this.attachment})));this.opts=o,this.root=f,this.attachment=Xa(this.opts.ref),this.trueValue=o.value.current??o.id.current,Ss(()=>this.trueValue,()=>this.root.registerGroup(this.trueValue)),Wr(()=>this.opts.value.current?(this.trueValue=this.opts.value.current,this.root.registerValue(this.opts.value.current)):this.headingNode&&this.headingNode.textContent?(this.trueValue=this.headingNode.textContent.trim().toLowerCase(),this.root.registerValue(this.trueValue)):(this.trueValue=`-----${this.opts.id.current}`,this.root.registerValue(this.trueValue)))}static create(o){return Zu.set(new t_(o,ml.get()))}get shouldRender(){return x(it(this,hh))}set shouldRender(o){ce(it(this,hh),o)}get headingNode(){return x(it(this,dh))}set headingNode(o){ce(it(this,dh),o,!0)}get trueValue(){return x(it(this,ph))}set trueValue(o){ce(it(this,ph),o,!0)}get props(){return x(it(this,fh))}set props(o){ce(it(this,fh),o)}};hh=new WeakMap,dh=new WeakMap,ph=new WeakMap,fh=new WeakMap;let um=t_;var mh;const r_=class r_{constructor(o,f){gr(this,"opts");gr(this,"group");gr(this,"attachment");Mr(this,mh,ft(()=>({id:this.opts.id.current,[wa["group-heading"]]:"",...this.attachment})));this.opts=o,this.group=f,this.attachment=Xa(this.opts.ref,y=>this.group.headingNode=y)}static create(o){return new r_(o,Zu.get())}get props(){return x(it(this,mh))}set props(o){ce(it(this,mh),o)}};mh=new WeakMap;let hm=r_;var _h;const n_=class n_{constructor(o,f){gr(this,"opts");gr(this,"group");gr(this,"attachment");Mr(this,_h,ft(()=>{var o;return{id:this.opts.id.current,role:"group",[wa["group-items"]]:"","aria-labelledby":((o=this.group.headingNode)==null?void 0:o.id)??void 0,...this.attachment}}));this.opts=o,this.group=f,this.attachment=Xa(this.opts.ref)}static create(o){return new n_(o,Zu.get())}get props(){return x(it(this,_h))}set props(o){ce(it(this,_h),o)}};_h=new WeakMap;let dm=n_;var ip,gh;const i_=class i_{constructor(o,f){gr(this,"opts");gr(this,"root");gr(this,"attachment");Mr(this,ip,ft(()=>{var f;const o=(f=this.root.viewportNode)==null?void 0:f.querySelector(`${f0}[${ol}="${p0(this.root.opts.value.current)}"]`);if(o!=null)return o.getAttribute("id")??void 0}));Mr(this,gh,ft(()=>{var o,f;return{id:this.opts.id.current,type:"text",[wa.input]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":$6(!0),"aria-controls":((o=this.root.viewportNode)==null?void 0:o.id)??void 0,"aria-labelledby":((f=this.root.labelNode)==null?void 0:f.id)??void 0,"aria-activedescendant":x(it(this,ip)),...this.attachment}}));this.opts=o,this.root=f,this.attachment=Xa(this.opts.ref,y=>this.root.inputNode=y),Ss(()=>this.opts.ref.current,()=>{const y=this.opts.ref.current;y&&this.opts.autofocus.current&&L6(10,()=>y.focus())}),Ss(()=>this.opts.value.current,()=>{this.root.commandState.search!==this.opts.value.current&&this.root.setState("search",this.opts.value.current)})}static create(o){return new i_(o,ml.get())}get props(){return x(it(this,gh))}set props(o){ce(it(this,gh),o)}};ip=new WeakMap,gh=new WeakMap;let pm=i_;var Ts,ap,vh,yh,xh,pl,x0,mm,bh;const a_=class a_{constructor(o,f){Mr(this,pl);gr(this,"opts");gr(this,"root");gr(this,"attachment");Mr(this,Ts,null);Mr(this,ap,ft(()=>{var o;return this.opts.forceMount.current||((o=it(this,Ts))==null?void 0:o.opts.forceMount.current)===!0}));Mr(this,vh,ft(()=>{if(this.opts.ref.current,x(it(this,ap))||this.root.opts.shouldFilter.current===!1||!this.root.commandState.search)return!0;const o=this.root.commandState.filtered.items.get(this.trueValue);return o===void 0?!1:o>0}));Mr(this,yh,ft(()=>this.root.opts.value.current===this.trueValue&&this.trueValue!==""));Mr(this,xh,ct(""));Mr(this,bh,ft(()=>{var o;return{id:this.opts.id.current,"aria-disabled":U6(this.opts.disabled.current),"aria-selected":H6(this.isSelected),"data-disabled":G6(this.opts.disabled.current),"data-selected":W6(this.isSelected),"data-value":this.trueValue,"data-group":(o=it(this,Ts))==null?void 0:o.trueValue,[wa.item]:"",role:"option",onpointermove:this.onpointermove,onclick:this.onclick,...this.attachment}}));this.opts=o,this.root=f,na(this,Ts,Zu.getOr(null)),this.trueValue=o.value.current,this.attachment=Xa(this.opts.ref),Ss([()=>this.trueValue,()=>{var y;return(y=it(this,Ts))==null?void 0:y.trueValue},()=>this.opts.forceMount.current],()=>{var y;if(!this.opts.forceMount.current)return this.root.registerItem(this.trueValue,(y=it(this,Ts))==null?void 0:y.trueValue)}),Ss([()=>this.opts.value.current,()=>this.opts.ref.current],()=>{var y,M;!this.opts.value.current&&((y=this.opts.ref.current)!=null&&y.textContent)&&(this.trueValue=this.opts.ref.current.textContent.trim()),this.root.registerValue(this.trueValue,o.keywords.current.map(z=>z.trim())),(M=this.opts.ref.current)==null||M.setAttribute(ol,this.trueValue)}),this.onclick=this.onclick.bind(this),this.onpointermove=this.onpointermove.bind(this)}static create(o){const f=Zu.getOr(null);return new a_({...o,group:f},ml.get())}get shouldRender(){return x(it(this,vh))}set shouldRender(o){ce(it(this,vh),o)}get isSelected(){return x(it(this,yh))}set isSelected(o){ce(it(this,yh),o)}get trueValue(){return x(it(this,xh))}set trueValue(o){ce(it(this,xh),o,!0)}onpointermove(o){this.opts.disabled.current||this.root.opts.disablePointerSelection.current||Vr(this,pl,mm).call(this)}onclick(o){this.opts.disabled.current||Vr(this,pl,x0).call(this)}get props(){return x(it(this,bh))}set props(o){ce(it(this,bh),o)}};Ts=new WeakMap,ap=new WeakMap,vh=new WeakMap,yh=new WeakMap,xh=new WeakMap,pl=new WeakSet,x0=function(){var o;this.opts.disabled.current||(Vr(this,pl,mm).call(this),(o=this.opts.onSelect)==null||o.current())},mm=function(){this.opts.disabled.current||this.root.setValue(this.trueValue,!0)},bh=new WeakMap;let fm=a_;var wh;const o_=class o_{constructor(o,f){gr(this,"opts");gr(this,"root");gr(this,"attachment");Mr(this,wh,ft(()=>({id:this.opts.id.current,role:"listbox","aria-label":this.opts.ariaLabel.current,[wa.list]:"",...this.attachment})));this.opts=o,this.root=f,this.attachment=Xa(this.opts.ref)}static create(o){return fk.set(new o_(o,ml.get()))}get props(){return x(it(this,wh))}set props(o){ce(it(this,wh),o)}};wh=new WeakMap;let _m=o_;var Th;const s_=class s_{constructor(o,f){gr(this,"opts");gr(this,"root");gr(this,"attachment");Mr(this,Th,ft(()=>{var o;return{id:this.opts.id.current,[wa["input-label"]]:"",for:(o=this.opts.for)==null?void 0:o.current,style:l0,...this.attachment}}));this.opts=o,this.root=f,this.attachment=Xa(this.opts.ref,y=>this.root.labelNode=y)}static create(o){return new s_(o,ml.get())}get props(){return x(it(this,Th))}set props(o){ce(it(this,Th),o)}};Th=new WeakMap;let gm=s_;var mk=Te("<label><!></label>");function _k(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=ir(o,["$$slots","$$events","$$legacy","id","ref","children"]);const T=gm.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),Y=>M(Y))}),s=ft(()=>Va(z,T.props));var B=mk();ar(B,()=>({...x(s)}));var N=E(B);oi(N,()=>o.children??pa),k(B),G(m,B),Fr()}var gk=Te("<!> <!>",1),vk=Te("<div><!> <!></div>");function yk(m,o){const f=co();Br(o,!0);const y=nt=>{_k(nt,{children:(Ze,ke)=>{vn();var bt=bi();Ye(()=>fe(bt,ie())),G(Ze,bt)},$$slots:{default:!0}})};let M=Lt(o,"id",19,()=>Ya(f)),z=Lt(o,"ref",15,null),T=Lt(o,"value",15,""),s=Lt(o,"onValueChange",3,qu),B=Lt(o,"onStateChange",3,qu),N=Lt(o,"loop",3,!1),Y=Lt(o,"shouldFilter",3,!0),K=Lt(o,"filter",3,w0),ie=Lt(o,"label",3,""),H=Lt(o,"vimBindings",3,!0),me=Lt(o,"disablePointerSelection",3,!1),ve=Lt(o,"disableInitialScroll",3,!1),Me=Lt(o,"columns",3,null),Ee=ir(o,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","onStateChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","disableInitialScroll","columns","children","child"]);const Re=rm.create({id:vr.with(()=>M()),ref:vr.with(()=>z(),nt=>z(nt)),filter:vr.with(()=>K()),shouldFilter:vr.with(()=>Y()),loop:vr.with(()=>N()),value:vr.with(()=>T(),nt=>{T()!==nt&&(T(nt),s()(nt))}),vimBindings:vr.with(()=>H()),disablePointerSelection:vr.with(()=>me()),disableInitialScroll:vr.with(()=>ve()),onStateChange:vr.with(()=>B()),columns:vr.with(()=>Me())}),ze=nt=>Re.updateSelectedToIndex(nt),Fe=nt=>Re.updateSelectedByGroup(nt),Ke=nt=>Re.updateSelectedByItem(nt),rt=()=>Re.getValidItems(),qe=ft(()=>Va(Ee,Re.props));var He=er(),et=Ct(He);{var De=nt=>{var Ze=gk(),ke=Ct(Ze);y(ke);var bt=q(ke,2);oi(bt,()=>o.child,()=>({props:x(qe)})),G(nt,Ze)},tt=nt=>{var Ze=vk();ar(Ze,()=>({...x(qe)}));var ke=E(Ze);y(ke);var bt=q(ke,2);oi(bt,()=>o.children??pa),k(Ze),G(nt,Ze)};je(et,nt=>{o.child?nt(De):nt(tt,!1)})}return G(m,He),Fr({updateSelectedToIndex:ze,updateSelectedByGroup:Fe,updateSelectedByItem:Ke,getValidItems:rt})}var xk=Te("<div><!></div>");function bk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=Lt(o,"forceMount",3,!1),T=ir(o,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const s=cm.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),ie=>M(ie)),forceMount:vr.with(()=>z())}),B=ft(()=>Va(s.props,T));var N=er(),Y=Ct(N);{var K=ie=>{var H=er(),me=Ct(H);{var ve=Ee=>{var Re=er(),ze=Ct(Re);oi(ze,()=>o.child,()=>({props:x(B)})),G(Ee,Re)},Me=Ee=>{var Re=xk();ar(Re,()=>({...x(B)}));var ze=E(Re);oi(ze,()=>o.children??pa),k(Re),G(Ee,Re)};je(me,Ee=>{o.child?Ee(ve):Ee(Me,!1)})}G(ie,H)};je(Y,ie=>{s.shouldRender&&ie(K)})}G(m,N),Fr()}var wk=Te("<div><!></div>");function Tk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=Lt(o,"value",3,""),T=Lt(o,"forceMount",3,!1),s=ir(o,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const B=um.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),me=>M(me)),forceMount:vr.with(()=>T()),value:vr.with(()=>z())}),N=ft(()=>Va(s,B.props));var Y=er(),K=Ct(Y);{var ie=me=>{var ve=er(),Me=Ct(ve);oi(Me,()=>o.child,()=>({props:x(N)})),G(me,ve)},H=me=>{var ve=wk();ar(ve,()=>({...x(N)}));var Me=E(ve);oi(Me,()=>o.children??pa),k(ve),G(me,ve)};je(K,me=>{o.child?me(ie):me(H,!1)})}G(m,Y),Fr()}var Ck=Te("<div><!></div>");function Sk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=ir(o,["$$slots","$$events","$$legacy","id","ref","children","child"]);const T=hm.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),ie=>M(ie))}),s=ft(()=>Va(z,T.props));var B=er(),N=Ct(B);{var Y=ie=>{var H=er(),me=Ct(H);oi(me,()=>o.child,()=>({props:x(s)})),G(ie,H)},K=ie=>{var H=Ck();ar(H,()=>({...x(s)}));var me=E(H);oi(me,()=>o.children??pa),k(H),G(ie,H)};je(N,ie=>{o.child?ie(Y):ie(K,!1)})}G(m,B),Fr()}var Pk=Te("<div><!></div>"),Ik=Te('<div style="display: contents;"><!></div>');function Mk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=ir(o,["$$slots","$$events","$$legacy","id","ref","children","child"]);const T=dm.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),ie=>M(ie))}),s=ft(()=>Va(z,T.props));var B=Ik(),N=E(B);{var Y=ie=>{var H=er(),me=Ct(H);oi(me,()=>o.child,()=>({props:x(s)})),G(ie,H)},K=ie=>{var H=Pk();ar(H,()=>({...x(s)}));var me=E(H);oi(me,()=>o.children??pa),k(H),G(ie,H)};je(N,ie=>{o.child?ie(Y):ie(K,!1)})}k(B),G(m,B),Fr()}var kk=Te("<input/>");function Ak(m,o){const f=co();Br(o,!0);let y=Lt(o,"value",15,""),M=Lt(o,"autofocus",3,!1),z=Lt(o,"id",19,()=>Ya(f)),T=Lt(o,"ref",15,null),s=ir(o,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const B=pm.create({id:vr.with(()=>z()),ref:vr.with(()=>T(),me=>T(me)),value:vr.with(()=>y(),me=>{y(me)}),autofocus:vr.with(()=>M()??!1)}),N=ft(()=>Va(s,B.props));var Y=er(),K=Ct(Y);{var ie=me=>{var ve=er(),Me=Ct(ve);oi(Me,()=>o.child,()=>({props:x(N)})),G(me,ve)},H=me=>{var ve=kk();uo(ve),ar(ve,()=>({...x(N)})),zm(ve,y),G(me,ve)};je(K,me=>{o.child?me(ie):me(H,!1)})}G(m,Y),Fr()}var Ek=Te("<div><!></div>"),zk=Te('<div style="display: contents;" data-item-wrapper=""><!></div>');function Lk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=Lt(o,"value",3,""),T=Lt(o,"disabled",3,!1),s=Lt(o,"onSelect",3,qu),B=Lt(o,"forceMount",3,!1),N=Lt(o,"keywords",19,()=>[]),Y=ir(o,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const K=fm.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),ve=>M(ve)),value:vr.with(()=>z()),disabled:vr.with(()=>T()),onSelect:vr.with(()=>s()),forceMount:vr.with(()=>B()),keywords:vr.with(()=>N())}),ie=ft(()=>Va(Y,K.props));var H=er(),me=Ct(H);ju(me,()=>K.root.key,ve=>{var Me=zk(),Ee=E(Me);{var Re=ze=>{var Fe=er(),Ke=Ct(Fe);{var rt=He=>{var et=er(),De=Ct(et);oi(De,()=>o.child,()=>({props:x(ie)})),G(He,et)},qe=He=>{var et=Ek();ar(et,()=>({...x(ie)}));var De=E(et);oi(De,()=>o.children??pa),k(et),G(He,et)};je(Ke,He=>{o.child?He(rt):He(qe,!1)})}G(ze,Fe)};je(Ee,ze=>{K.shouldRender&&ze(Re)})}k(Me),Ye(()=>xr(Me,"data-value",K.trueValue)),G(ve,Me)}),G(m,H),Fr()}var Dk=Te("<div><!></div>");function Rk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=ir(o,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const T=_m.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),Y=>M(Y)),ariaLabel:vr.with(()=>o["aria-label"]??"Suggestions...")}),s=ft(()=>Va(z,T.props));var B=er(),N=Ct(B);ju(N,()=>T.root._commandState.search==="",Y=>{var K=er(),ie=Ct(K);{var H=ve=>{var Me=er(),Ee=Ct(Me);oi(Ee,()=>o.child,()=>({props:x(s)})),G(ve,Me)},me=ve=>{var Me=Dk();ar(Me,()=>({...x(s)}));var Ee=E(Me);oi(Ee,()=>o.children??pa),k(Me),G(ve,Me)};je(ie,ve=>{o.child?ve(H):ve(me,!1)})}G(Y,K)}),G(m,B),Fr()}const ov=1,Bk=.9,Fk=.8,Ok=.17,Ff=.1,Of=.999,Nk=.9999,jk=.99,Vk=/[\\/_+.#"@[({&]/,qk=/[\\/_+.#"@[({&]/g,Zk=/[\s-]/,b0=/[\s-]/g;function vm(m,o,f,y,M,z,T){if(z===o.length)return M===m.length?ov:jk;const s=`${M},${z}`;if(T[s]!==void 0)return T[s];const B=y.charAt(z);let N=f.indexOf(B,M),Y=0,K,ie,H,me;for(;N>=0;)K=vm(m,o,f,y,N+1,z+1,T),K>Y&&(N===M?K*=ov:Vk.test(m.charAt(N-1))?(K*=Fk,H=m.slice(M,N-1).match(qk),H&&M>0&&(K*=Of**H.length)):Zk.test(m.charAt(N-1))?(K*=Bk,me=m.slice(M,N-1).match(b0),me&&M>0&&(K*=Of**me.length)):(K*=Ok,M>0&&(K*=Of**(N-M))),m.charAt(N)!==o.charAt(z)&&(K*=Nk)),(K<Ff&&f.charAt(N-1)===y.charAt(z+1)||y.charAt(z+1)===y.charAt(z)&&f.charAt(N-1)!==y.charAt(z))&&(ie=vm(m,o,f,y,N+1,z+2,T),ie*Ff>K&&(K=ie*Ff)),K>Y&&(Y=K),N=f.indexOf(B,N+1);return T[s]=Y,Y}function sv(m){return m.toLowerCase().replace(b0," ")}function w0(m,o,f){return m=f&&f.length>0?`${`${m} ${f==null?void 0:f.join(" ")}`}`:m,vm(m,o,sv(m),sv(o),0,0,{})}const Uk=18,T0=40,$k=`${T0}px`,Gk=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function Hk({containerRef:m,inputRef:o,pushPasswordManagerStrategy:f,isFocused:y,domContext:M}){let z=ct(!1),T=ct(!1),s=ct(!1);function B(){const Y=f.current;return Y==="none"?!1:Y==="increase-width"&&x(z)&&x(T)}function N(){const Y=m.current,K=o.current;if(!Y||!K||x(s)||f.current==="none")return;const ie=Y,H=ie.getBoundingClientRect().left+ie.offsetWidth,me=ie.getBoundingClientRect().top+ie.offsetHeight/2,ve=H-Uk,Me=me;M.querySelectorAll(Gk).length===0&&M.getDocument().elementFromPoint(ve,Me)===Y||(ce(z,!0),ce(s,!0))}return Wr(()=>{const Y=m.current;if(!Y||f.current==="none")return;function K(){const me=h0(Y).innerWidth-Y.getBoundingClientRect().right;ce(T,me>=T0)}K();const ie=setInterval(K,1e3);return()=>{clearInterval(ie)}}),Wr(()=>{const Y=y.current||M.getActiveElement()===o.current;if(f.current==="none"||!Y)return;const K=setTimeout(N,0),ie=setTimeout(N,2e3),H=setTimeout(N,5e3),me=setTimeout(()=>{ce(s,!0)},6e3);return()=>{clearTimeout(K),clearTimeout(ie),clearTimeout(H),clearTimeout(me)}}),{get hasPwmBadge(){return x(z)},get willPushPwmBadge(){return B()},PWM_BADGE_SPACE_WIDTH:$k}}const C0=d0({component:"pin-input",parts:["root","cell"]}),Wk=["Backspace","Delete","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Escape","Enter","Tab","Shift","Control","Meta"];var Ha,Pc,Xo,ja,Wa,Ic,To,Yo,Cs,Mc,op,Ch,Sh,sp,lp,S0,Ph,Ih,cp,Mh;const l_=class l_{constructor(o){Mr(this,lp);gr(this,"opts");gr(this,"attachment");Mr(this,Ha,vr(null));Mr(this,Pc,ct(!1));gr(this,"inputAttachment",Xa(it(this,Ha)));Mr(this,Xo,vr(!1));Mr(this,ja,ct(null));Mr(this,Wa,ct(null));Mr(this,Ic,new z6(()=>this.opts.value.current??""));Mr(this,To,ft(()=>typeof this.opts.pattern.current=="string"?new RegExp(this.opts.pattern.current):this.opts.pattern.current));Mr(this,Yo,ct(xi({prev:[null,null,"none"],willSyntheticBlur:!1})));Mr(this,Cs);Mr(this,Mc);gr(this,"domContext");gr(this,"onkeydown",o=>{const f=o.key;Wk.includes(f)||o.ctrlKey||o.metaKey||f&&x(it(this,To))&&!x(it(this,To)).test(f)&&o.preventDefault()});Mr(this,op,ft(()=>({position:"relative",cursor:this.opts.disabled.current?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"})));Mr(this,Ch,ft(()=>({id:this.opts.id.current,[C0.root]:"",style:x(it(this,op)),...this.attachment})));Mr(this,Sh,ft(()=>({style:{position:"absolute",inset:0,pointerEvents:"none"}})));Mr(this,sp,ft(()=>({position:"absolute",inset:0,width:it(this,Cs).willPushPwmBadge?`calc(100% + ${it(this,Cs).PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:it(this,Cs).willPushPwmBadge?`inset(0 ${it(this,Cs).PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:this.opts.textAlign.current,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--bits-pin-input-root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"})));Mr(this,Ph,()=>{var ve;const o=it(this,Ha).current,f=this.opts.ref.current;if(!o||!f)return;if(this.domContext.getActiveElement()!==o){ce(it(this,ja),null),ce(it(this,Wa),null);return}const y=o.selectionStart,M=o.selectionEnd,z=o.selectionDirection??"none",T=o.maxLength,s=o.value,B=x(it(this,Yo)).prev;let N=-1,Y=-1,K;if(s.length!==0&&y!==null&&M!==null){const Me=y===M,Ee=y===s.length&&s.length<T;if(Me&&!Ee){const Re=y;if(Re===0)N=0,Y=1,K="forward";else if(Re===T)N=Re-1,Y=Re,K="backward";else if(T>1&&s.length>1){let ze=0;if(B[0]!==null&&B[1]!==null){K=Re<B[0]?"backward":"forward";const Fe=B[0]===B[1]&&B[0]<T;K==="backward"&&!Fe&&(ze=-1)}N=ze-Re,Y=ze+Re+1}}N!==-1&&Y!==-1&&N!==Y&&((ve=it(this,Ha).current)==null||ve.setSelectionRange(N,Y,K))}const ie=N!==-1?N:y,H=Y!==-1?Y:M,me=K??z;ce(it(this,ja),ie,!0),ce(it(this,Wa),H,!0),x(it(this,Yo)).prev=[ie,H,me]});gr(this,"oninput",o=>{const f=o.currentTarget.value.slice(0,this.opts.maxLength.current);if(f.length>0&&x(it(this,To))&&!x(it(this,To)).test(f)){o.preventDefault();return}typeof it(this,Ic).current=="string"&&f.length<it(this,Ic).current.length&&this.domContext.getDocument().dispatchEvent(new Event("selectionchange")),this.opts.value.current=f});gr(this,"onfocus",o=>{const f=it(this,Ha).current;if(f){const y=Math.min(f.value.length,this.opts.maxLength.current-1),M=f.value.length;f.setSelectionRange(y,M),ce(it(this,ja),y,!0),ce(it(this,Wa),M,!0)}it(this,Xo).current=!0});gr(this,"onpaste",o=>{var Y,K,ie,H;const f=it(this,Ha).current;if(!f)return;const y=me=>{const ve=f.selectionStart===null?void 0:f.selectionStart,Me=f.selectionEnd===null?void 0:f.selectionEnd,Ee=ve!==Me,Re=this.opts.value.current;return(Ee?Re.slice(0,ve)+me+Re.slice(Me):Re.slice(0,ve)+me+Re.slice(ve)).slice(0,this.opts.maxLength.current)},M=me=>me.length>0&&x(it(this,To))&&!x(it(this,To)).test(me);if(!((Y=this.opts.pasteTransformer)!=null&&Y.current)&&(!it(this,Mc).isIOS||!o.clipboardData||!f)){const me=y((K=o.clipboardData)==null?void 0:K.getData("text/plain"));M(me)&&o.preventDefault();return}const z=((ie=o.clipboardData)==null?void 0:ie.getData("text/plain"))??"",T=(H=this.opts.pasteTransformer)!=null&&H.current?this.opts.pasteTransformer.current(z):z;o.preventDefault();const s=y(T);if(M(s))return;f.value=s,this.opts.value.current=s;const B=Math.min(s.length,this.opts.maxLength.current-1),N=s.length;f.setSelectionRange(B,N),ce(it(this,ja),B,!0),ce(it(this,Wa),N,!0)});gr(this,"onmouseover",o=>{ce(it(this,Pc),!0)});gr(this,"onmouseleave",o=>{ce(it(this,Pc),!1)});gr(this,"onblur",o=>{if(x(it(this,Yo)).willSyntheticBlur){x(it(this,Yo)).willSyntheticBlur=!1;return}it(this,Xo).current=!1});Mr(this,Ih,ft(()=>{var o;return{id:this.opts.inputId.current,style:x(it(this,sp)),autocomplete:this.opts.autocomplete.current||"one-time-code","data-pin-input-input":"","data-pin-input-input-mss":x(it(this,ja)),"data-pin-input-input-mse":x(it(this,Wa)),inputmode:this.opts.inputmode.current,pattern:(o=x(it(this,To)))==null?void 0:o.source,maxlength:this.opts.maxLength.current,value:this.opts.value.current,disabled:X6(this.opts.disabled.current),onpaste:this.onpaste,oninput:this.oninput,onkeydown:this.onkeydown,onmouseover:this.onmouseover,onmouseleave:this.onmouseleave,onfocus:this.onfocus,onblur:this.onblur,...this.inputAttachment}}));Mr(this,cp,ft(()=>Array.from({length:this.opts.maxLength.current}).map((o,f)=>{const y=it(this,Xo).current&&x(it(this,ja))!==null&&x(it(this,Wa))!==null&&(x(it(this,ja))===x(it(this,Wa))&&f===x(it(this,ja))||f>=x(it(this,ja))&&f<x(it(this,Wa))),M=this.opts.value.current[f]!==void 0?this.opts.value.current[f]:null;return{char:M,isActive:y,hasFakeCaret:y&&M===null}})));Mr(this,Mh,ft(()=>({cells:x(it(this,cp)),isFocused:it(this,Xo).current,isHovering:x(it(this,Pc))})));var f;this.opts=o,this.attachment=Xa(this.opts.ref),this.domContext=new Z6(o.ref),na(this,Mc,{value:this.opts.value,isIOS:typeof window<"u"&&((f=window==null?void 0:window.CSS)==null?void 0:f.supports("-webkit-touch-callout","none"))}),na(this,Cs,Hk({containerRef:this.opts.ref,inputRef:it(this,Ha),isFocused:it(this,Xo),pushPasswordManagerStrategy:this.opts.pushPasswordManagerStrategy,domContext:this.domContext})),Dn(()=>{const y=it(this,Ha).current,M=this.opts.ref.current;if(!y||!M)return;it(this,Mc).value.current!==y.value&&(this.opts.value.current=y.value),x(it(this,Yo)).prev=[y.selectionStart,y.selectionEnd,y.selectionDirection??"none"];const z=Nu(this.domContext.getDocument(),"selectionchange",it(this,Ph),{capture:!0});it(this,Ph).call(this),this.domContext.getActiveElement()===y&&(it(this,Xo).current=!0),this.domContext.getElementById("pin-input-style")||Vr(this,lp,S0).call(this);const T=()=>{M&&M.style.setProperty("--bits-pin-input-root-height",`${y.clientHeight}px`)};T();const s=new ResizeObserver(T);return s.observe(y),()=>{z(),s.disconnect()}}),Ss([()=>this.opts.value.current,()=>it(this,Ha).current],()=>{Xk(()=>{const y=it(this,Ha).current;if(!y)return;y.dispatchEvent(new Event("input"));const M=y.selectionStart,z=y.selectionEnd,T=y.selectionDirection??"none";M!==null&&z!==null&&(ce(it(this,ja),M,!0),ce(it(this,Wa),z,!0),x(it(this,Yo)).prev=[M,z,T])},this.domContext)}),Wr(()=>{const y=this.opts.value.current,M=it(this,Ic).current,z=this.opts.maxLength.current,T=this.opts.onComplete.current;M!==void 0&&y!==M&&M.length<z&&y.length===z&&T(y)})}static create(o){return new l_(o)}get rootProps(){return x(it(this,Ch))}set rootProps(o){ce(it(this,Ch),o)}get inputWrapperProps(){return x(it(this,Sh))}set inputWrapperProps(o){ce(it(this,Sh),o)}get inputProps(){return x(it(this,Ih))}set inputProps(o){ce(it(this,Ih),o)}get snippetProps(){return x(it(this,Mh))}set snippetProps(o){ce(it(this,Mh),o)}};Ha=new WeakMap,Pc=new WeakMap,Xo=new WeakMap,ja=new WeakMap,Wa=new WeakMap,Ic=new WeakMap,To=new WeakMap,Yo=new WeakMap,Cs=new WeakMap,Mc=new WeakMap,op=new WeakMap,Ch=new WeakMap,Sh=new WeakMap,sp=new WeakMap,lp=new WeakSet,S0=function(){const o=this.domContext.getDocument(),f=o.createElement("style");if(f.id="pin-input-style",o.head.appendChild(f),f.sheet){const y="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";Lu(f.sheet,"[data-pin-input-input]::selection { background: transparent !important; color: transparent !important; }"),Lu(f.sheet,`[data-pin-input-input]:autofill { ${y} }`),Lu(f.sheet,`[data-pin-input-input]:-webkit-autofill { ${y} }`),Lu(f.sheet,"@supports (-webkit-touch-callout: none) { [data-pin-input-input] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),Lu(f.sheet,"[data-pin-input-input] + * { pointer-events: all !important; }")}},Ph=new WeakMap,Ih=new WeakMap,cp=new WeakMap,Mh=new WeakMap;let ym=l_;var kh;const c_=class c_{constructor(o){gr(this,"opts");gr(this,"attachment");Mr(this,kh,ft(()=>({id:this.opts.id.current,[C0.cell]:"","data-active":this.opts.cell.current.isActive?"":void 0,"data-inactive":this.opts.cell.current.isActive?void 0:"",...this.attachment})));this.opts=o,this.attachment=Xa(this.opts.ref)}static create(o){return new c_(o)}get props(){return x(it(this,kh))}set props(o){ce(it(this,kh),o)}};kh=new WeakMap;let xm=c_;function Xk(m,o){const f=o.setTimeout(m,0),y=o.setTimeout(m,10),M=o.setTimeout(m,50);return[f,y,M]}function Lu(m,o){try{m.insertRule(o)}catch{console.error("pin input could not insert CSS rule:",o)}}var Yk=Te("<div><!> <div><input/></div></div>");function Kk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"inputId",19,()=>`${Ya(f)}-input`),z=Lt(o,"ref",15,null),T=Lt(o,"maxlength",3,6),s=Lt(o,"textalign",3,"left"),B=Lt(o,"inputmode",3,"numeric"),N=Lt(o,"onComplete",3,qu),Y=Lt(o,"pushPasswordManagerStrategy",3,"increase-width"),K=Lt(o,"class",3,""),ie=Lt(o,"autocomplete",3,"one-time-code"),H=Lt(o,"disabled",3,!1),me=Lt(o,"value",15,""),ve=Lt(o,"onValueChange",3,qu),Me=ir(o,["$$slots","$$events","$$legacy","id","inputId","ref","maxlength","textalign","pattern","inputmode","onComplete","pushPasswordManagerStrategy","class","children","autocomplete","disabled","value","onValueChange","pasteTransformer"]);const Ee=ym.create({id:vr.with(()=>y()),ref:vr.with(()=>z(),et=>z(et)),inputId:vr.with(()=>M()),autocomplete:vr.with(()=>ie()),maxLength:vr.with(()=>T()),textAlign:vr.with(()=>s()),disabled:vr.with(()=>H()),inputmode:vr.with(()=>B()),pattern:vr.with(()=>o.pattern),onComplete:vr.with(()=>N()),value:vr.with(()=>me(),et=>{me(et),ve()(et)}),pushPasswordManagerStrategy:vr.with(()=>Y()),pasteTransformer:vr.with(()=>o.pasteTransformer)}),Re=ft(()=>Va(Me,Ee.inputProps)),ze=ft(()=>Va(Ee.rootProps,{class:K()})),Fe=ft(()=>Va(Ee.inputWrapperProps,{}));var Ke=Yk();ar(Ke,()=>({...x(ze)}));var rt=E(Ke);oi(rt,()=>o.children??pa,()=>Ee.snippetProps);var qe=q(rt,2);ar(qe,()=>({...x(Fe)}));var He=E(qe);uo(He),ar(He,()=>({...x(Re)})),k(qe),k(Ke),G(m,Ke),Fr()}var Jk=Te("<div><!></div>");function Qk(m,o){const f=co();Br(o,!0);let y=Lt(o,"id",19,()=>Ya(f)),M=Lt(o,"ref",15,null),z=ir(o,["$$slots","$$events","$$legacy","id","ref","cell","child","children"]);const T=xm.create({id:vr.with(()=>y()),ref:vr.with(()=>M(),ie=>M(ie)),cell:vr.with(()=>o.cell)}),s=ft(()=>Va(z,T.props));var B=er(),N=Ct(B);{var Y=ie=>{var H=er(),me=Ct(H);oi(me,()=>o.child,()=>({props:x(s)})),G(ie,H)},K=ie=>{var H=Jk();ar(H,()=>({...x(s)}));var me=E(H);oi(me,()=>o.children??pa),k(H),G(ie,H)};je(N,ie=>{o.child?ie(Y):ie(K,!1)})}G(m,B),Fr()}function Ac(...m){return Lv(Ou(m))}function eA(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=Lt(o,"value",15,""),M=ir(o,["$$slots","$$events","$$legacy","ref","value","class"]);var z=er(),T=Ct(z);{let s=ft(()=>Ac("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",o.class));yi(T,()=>yk,(B,N)=>{N(B,Ps({"data-slot":"command",get class(){return x(s)}},()=>M,{get value(){return y()},set value(Y){y(Y)},get ref(){return f()},set ref(Y){f(Y)}}))})}G(m,z),Fr()}var tA=Cr('<svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"></path></svg>');function _l(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=tA();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}function rA(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=ir(o,["$$slots","$$events","$$legacy","ref","class"]);var M=er(),z=Ct(M);{let T=ft(()=>Ac("py-6 text-center text-sm",o.class));yi(z,()=>bk,(s,B)=>{B(s,Ps({"data-slot":"command-empty",get class(){return x(T)}},()=>y,{get ref(){return f()},set ref(N){f(N)}}))})}G(m,M),Fr()}var nA=Te("<!> <!>",1);function iA(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=ir(o,["$$slots","$$events","$$legacy","ref","class","children","heading","value"]);var M=er(),z=Ct(M);{let T=ft(()=>Ac("text-foreground overflow-hidden p-1",o.class)),s=ft(()=>o.value??o.heading??`----${hk()}`);yi(z,()=>Tk,(B,N)=>{N(B,Ps({"data-slot":"command-group",get class(){return x(T)},get value(){return x(s)}},()=>y,{get ref(){return f()},set ref(Y){f(Y)},children:(Y,K)=>{var ie=nA(),H=Ct(ie);{var me=Me=>{var Ee=er(),Re=Ct(Ee);yi(Re,()=>Sk,(ze,Fe)=>{Fe(ze,{class:"text-muted-foreground px-2 py-1.5 text-xs font-medium",children:(Ke,rt)=>{vn();var qe=bi();Ye(()=>fe(qe,o.heading)),G(Ke,qe)},$$slots:{default:!0}})}),G(Me,Ee)};je(H,Me=>{o.heading&&Me(me)})}var ve=q(H,2);yi(ve,()=>Mk,(Me,Ee)=>{Ee(Me,{get children(){return o.children}})}),G(Y,ie)},$$slots:{default:!0}}))})}G(m,M),Fr()}function aA(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=ir(o,["$$slots","$$events","$$legacy","ref","class"]);var M=er(),z=Ct(M);{let T=ft(()=>Ac("aria-selected:bg-base-300 aria-selected:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",o.class));yi(z,()=>Lk,(s,B)=>{B(s,Ps({"data-slot":"command-item",get class(){return x(T)}},()=>y,{get ref(){return f()},set ref(N){f(N)}}))})}G(m,M),Fr()}var oA=Cr('<svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"></path></svg>');function sA(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=oA();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var lA=Te('<div class="border-base-content/10 flex h-9 items-center gap-2 border-b px-3" data-slot="command-input-wrapper"><!> <!></div>');function cA(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=Lt(o,"value",15,""),M=ir(o,["$$slots","$$events","$$legacy","ref","class","value"]);var z=lA(),T=E(z);sA(T,{class:"size-5 opacity-50"});var s=q(T,2);{let B=ft(()=>Ac("placeholder:text-muted-foreground outline-hidden flex h-10 w-full rounded-md bg-transparent py-3 text-sm disabled:cursor-not-allowed disabled:opacity-50",o.class));yi(s,()=>Ak,(N,Y)=>{Y(N,Ps({"data-slot":"command-input",get class(){return x(B)}},()=>M,{get ref(){return f()},set ref(K){f(K)},get value(){return y()},set value(K){y(K)}}))})}k(z),G(m,z),Fr()}function uA(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=ir(o,["$$slots","$$events","$$legacy","ref","class"]);var M=er(),z=Ct(M);{let T=ft(()=>Ac("max-h-[300px] scroll-py-1 overflow-y-auto overflow-x-hidden",o.class));yi(z,()=>Rk,(s,B)=>{B(s,Ps({"data-slot":"command-list",get class(){return x(T)}},()=>y,{get ref(){return f()},set ref(N){f(N)}}))})}G(m,M),Fr()}var hA=Cr('<svg><path d="M480-80 240-320l57-57 183 183 183-183 57 57L480-80ZM298-584l-58-56 240-240 240 240-58 56-182-182-182 182Z"></path></svg>');function dA(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=hA();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var pA=Te("<span> </span> <!>",1),fA=Te('<span class="font-flag ml-0.5"> </span> ',1),mA=Te('<span class="flex gap-1.5"><span class="font-flag"> </span> </span>'),_A=Te("<!> <!>",1),gA=Te("<!> <!>",1),vA=(m,o)=>{o(0)},yA=Te('<button class="btn btn-xs btn-circle btn-ghost"><!></button>'),xA=Te('<div class="flex items-center"><div class="dropdown"><div tabindex="0" role="button" class="btn btn-sm max-w-74 text-base-content/80 m-1"><!></div> <div><!></div></div> <!></div>');function lv(m,o){Br(o,!0);let f=Lt(o,"countryId",15,0),y=Lt(o,"dropdownDirection",3,"right"),M=ct(null),z=ct(null),T=ct("");function s(){Iv().then(()=>{var ze;(ze=document.activeElement)==null||ze.blur(),ce(T,"")})}var B=xA(),N=E(B),Y=E(N),K=E(Y);{var ie=ze=>{var Fe=pA(),Ke=Ct(Fe),rt=E(Ke,!0);k(Ke);var qe=q(Ke,2);dA(qe,{class:"size-3.5"}),Ye(He=>fe(rt,He),[()=>Zv()]),G(ze,Fe)},H=ze=>{const Fe=ft(()=>So(f()));var Ke=fA(),rt=Ct(Ke),qe=E(rt,!0);k(rt);var He=q(rt);Ye(()=>{fe(qe,x(Fe).flag),fe(He,` ${x(Fe).name??""}`)}),G(ze,Ke)};je(K,ze=>{f()===0?ze(ie):ze(H,!1)})}k(Y);var me=q(Y,2);let ve;var Me=E(me);yi(Me,()=>eA,(ze,Fe)=>{Fe(ze,{children:(Ke,rt)=>{var qe=gA(),He=Ct(qe);yi(He,()=>cA,(De,tt)=>{tt(De,{placeholder:"Country",get ref(){return x(M)},set ref(nt){ce(M,nt)},get value(){return x(T)},set value(nt){ce(T,nt,!0)}})});var et=q(He,2);yi(et,()=>uA,(De,tt)=>{tt(De,{children:(nt,Ze)=>{var ke=_A(),bt=Ct(ke);yi(bt,()=>rA,(re,ge)=>{ge(re,{children:(oe,Ae)=>{vn();var Ne=bi();Ye(pt=>fe(Ne,pt),[()=>Ow()]),G(oe,Ne)},$$slots:{default:!0}})});var te=q(bt,2);yi(te,()=>iA,(re,ge)=>{ge(re,{children:(oe,Ae)=>{var Ne=er(),pt=Ct(Ne);hi(pt,17,()=>Hi.countries,ot=>ot.id,(ot,ut)=>{var St=er(),Bt=Ct(St);yi(Bt,()=>aA,(at,dt)=>{dt(at,{get value(){return x(ut).name},onSelect:()=>{f(x(ut).id),s()},children:(vt,yt)=>{var It=mA(),wt=E(It),mt=E(wt,!0);k(wt);var Dt=q(wt);k(It),Ye(()=>{fe(mt,x(ut).flag),fe(Dt,` ${x(ut).name??""}`)}),G(vt,It)},$$slots:{default:!0}})}),G(ot,St)}),G(oe,Ne)},$$slots:{default:!0}})}),G(nt,ke)},$$slots:{default:!0}})}),G(Ke,qe)},$$slots:{default:!0}})}),k(me),k(N);var Ee=q(N,2);{var Re=ze=>{var Fe=yA();Fe.__click=[vA,f];var Ke=E(Fe);_l(Ke,{class:"size-3.5"}),k(Fe),G(ze,Fe)};je(Ee,ze=>{f()!=0&&ze(Re)})}k(B),Po(B,ze=>ce(z,ze),()=>x(z)),Ye(ze=>ve=zr(me,1,"dropdown-content menu bg-base-100 rounded-box z-1 border-base-content/10 w-52 rounded-lg border py-1 shadow-sm",null,ve,ze),[()=>({"right-1":y()==="left"})]),Ai("focus",Y,()=>{x(M).focus()}),G(m,B),Fr()}Qn(["click"]);var bA=Cr('<svg><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-7-.5-14.5T799-507q-5 29-27 48t-52 19h-80q-33 0-56.5-23.5T560-520v-40H400v-80q0-33 23.5-56.5T480-720h40q0-23 12.5-40.5T563-789q-20-5-40.5-8t-42.5-3q-134 0-227 93t-93 227h200q66 0 113 47t47 113v40H400v110q20 5 39.5 7.5T480-160Z"></path></svg>');function wA(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=bA();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var TA=Cr('<svg><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"></path></svg>'),CA=Cr('<svg><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"></path></svg>');function Uu(m,o){let f=ir(o,["$$slots","$$events","$$legacy","filled"]);var y=er(),M=Ct(y);{var z=s=>{var B=TA();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)},T=s=>{var B=CA();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)};je(M,s=>{o.filled?s(z):s(T,!1)})}G(m,y)}var SA=Te('<label class="tab grow font-semibold max-sm:h-10"><input type="radio" class="tab grow"/> <!> </label>'),PA=Te('<div class="mb-2"><!></div>'),IA=Te('<div class="text-base-content/80 mt-20 text-center text-sm"> <!></div>'),MA=(m,o,f)=>{o.onvisitclick({lat:x(f).lastLatitude,lng:x(f).lastLongitude})},kA=Te('<tr><td class="text-base-content/80 text-center font-medium max-sm:hidden"> </td><td><span class="font-flag tooltip mr-1 text-base sm:text-lg"> </span> <span> <span class="ml-0.5"> </span></span></td><td class="text-base-content/80 text-center font-medium max-sm:px-1"> </td><td class="px-1 text-center"><button class="btn btn-sm"> </button></td></tr>'),AA=Te('<table class="table max-sm:text-sm"><thead class="text-base-content/80"><tr><th class="max-sm:hidden"></th><th> </th><th class="text-center"> <br class="sm:hidden"/> <span class="tooltip max-sm:hidden"><!></span></th><th class="px-1"></th></tr></thead><tbody></tbody></table>'),EA=Te('<tr><td class="text-base-content/80 text-center font-medium"> </td><td><span class="font-flag tooltip mr-1 text-base sm:text-lg"> </span> <span> </span></td><td class="text-base-content/80 text-center font-medium max-sm:px-1"> </td></tr>'),zA=Te('<table class="table max-sm:text-sm"><thead class="text-base-content/80"><tr><th></th><th> </th><th class="text-center"> <br class="sm:hidden"/> <span class="tooltip before:-translate-x-1/4 max-sm:hidden"><!></span></th></tr></thead><tbody></tbody></table>'),LA=Te('<span class="font-flag tooltip ml-0.5"> </span>'),DA=Te("<span> </span>"),RA=Te('<tr><td class="text-base-content/80 text-center font-medium"> </td><td class="max-sm:px-1"><div class="flex items-center gap-2"><!> <div class="items-center gap-2 sm:flex"><span> <span class="ml-0.5"> </span></span> <!> <!> <!></div></div></td><td class="text-base-content/80 text-center font-medium max-sm:px-1"> </td></tr>'),BA=Te('<table class="table max-sm:text-sm"><thead class="text-base-content/80"><tr><th></th><th class="max-sm:px-1"> </th><th class="text-center"> <br class="sm:hidden"/> </th></tr></thead><tbody></tbody></table>'),FA=Te('<tr><td class="text-base-content/80 text-center font-medium"> </td><td class="h-14 max-sm:px-1"><span> </span></td><td class="text-base-content/80 text-center font-medium max-sm:px-1"> </td></tr>'),OA=Te('<table class="table max-sm:text-sm"><thead class="text-base-content/80"><tr><th></th><th class="max-sm:px-1"> </th><th class="text-center"> <br class="sm:hidden"/> </th></tr></thead><tbody></tbody></table>'),NA=Te('<div class="h-screen pt-20"><div class="flex justify-center"><span class="loading loading-spinner"></span></div></div>'),jA=Te('<div class="tabs tabs-box max-sm:tabs-xs"></div> <div class="my-4 flex items-center justify-between"><!> <!></div> <!> <!>',1);function VA(m,o){Br(o,!0);const f=[];let y=ct(1e3);const M=ft(()=>x(y)<=640);let z=ct("today"),T={regions:{label:YT(),icon:km},countries:{label:QT(),icon:wA},players:{label:Xv(),icon:vp},alliances:{label:Yv(),icon:yp}},s=ct("regions"),B=ct(0),N=xi({players:{},alliances:{},regions:{},countries:{}}),Y=ft(()=>{var qe,He,et;return x(s)==="regions"?(He=(qe=N[x(s)][x(B)])==null?void 0:qe[x(z)])==null?void 0:He.entries:(et=N[x(s)][x(z)])==null?void 0:et.entries});const K=5*1e3;Wr(()=>{var De;if(!o.open)return;const qe=x(z),He=x(s),et=x(B);He==="players"&&(!N[He][qe]||Date.now()-N[He][qe].time>K)?en.leaderboardPlayers(qe).then(tt=>{N[He][qe]={time:Date.now(),entries:tt}}).catch(tt=>Nr.error(tt.message)):He==="alliances"&&(!N[He][qe]||Date.now()-N[He][qe].time>K)?en.leaderboardAlliances(qe).then(tt=>{N[He][qe]={time:Date.now(),entries:tt}}).catch(tt=>Nr.error(tt.message)):He==="countries"&&(!N[He][qe]||Date.now()-N[He][qe].time>K)?en.leaderboardCountries(qe).then(tt=>{N[He][qe]={time:Date.now(),entries:tt}}).catch(tt=>Nr.error(tt.message)):He==="regions"&&(!((De=N[He][et])!=null&&De[qe])||Date.now()-N[He][et][qe].time>K)&&en.leaderboardRegions(qe,et).then(tt=>{N[He][et]||(N[He][et]={}),N[He][et][qe]={time:Date.now(),entries:tt}}).catch(tt=>Nr.error(tt.message))});var ie=jA(),H=Ct(ie);hi(H,21,()=>Object.entries(T),([qe,{label:He,icon:et}])=>qe,(qe,He)=>{var et=ft(()=>Mv(x(He),2));let De=()=>x(et)[0],tt=()=>x(et)[1].label,nt=()=>x(et)[1].icon;const Ze=ft(nt);var ke=SA(),bt=E(ke);uo(bt);var te,re=q(bt,2);yi(re,()=>x(Ze),(oe,Ae)=>{Ae(oe,{get this(){return nt()},class:"mr-1 size-5 max-sm:hidden"})});var ge=q(re);k(ke),Ye(()=>{xr(bt,"aria-label",tt()),te!==(te=De())&&(bt.value=(bt.__value=De())??""),fe(ge,` ${tt()??""}`)}),Em(f,[],bt,()=>(De(),x(s)),oe=>ce(s,oe)),G(qe,ke)}),k(H);var me=q(H,2),ve=E(me);Zm(ve,{get value(){return x(z)},set value(qe){ce(z,qe,!0)}});var Me=q(ve,2);{var Ee=qe=>{lv(qe,{dropdownDirection:"left",get countryId(){return x(B)},set countryId(He){ce(B,He,!0)}})};je(Me,qe=>{x(s)==="regions"&&!x(M)&&qe(Ee)})}k(me);var Re=q(me,2);{var ze=qe=>{var He=PA(),et=E(He);lv(et,{get countryId(){return x(B)},set countryId(De){ce(B,De,!0)}}),k(He),G(qe,He)};je(Re,qe=>{x(s)==="regions"&&x(M)&&qe(ze)})}var Fe=q(Re,2);{var Ke=qe=>{var He=IA(),et=E(He),De=q(et);{var tt=Ze=>{var ke=bi();Ye(bt=>fe(ke,bt),[()=>gp().toLowerCase()]),G(Ze,ke)},nt=Ze=>{var ke=er(),bt=Ct(ke);{var te=ge=>{var oe=bi();Ye(Ae=>fe(oe,Ae),[()=>Om()]),G(ge,oe)},re=ge=>{var oe=er(),Ae=Ct(oe);{var Ne=pt=>{var ot=bi();Ye(ut=>fe(ot,ut),[()=>Nm()]),G(pt,ot)};je(Ae,pt=>{x(z)==="month"&&pt(Ne)},!0)}G(ge,oe)};je(bt,ge=>{x(z)==="week"?ge(te):ge(re,!1)},!0)}G(Ze,ke)};je(De,Ze=>{x(z)==="today"?Ze(tt):Ze(nt,!1)})}k(He),Ye(Ze=>fe(et,`${Ze??""} `),[()=>Fm()]),G(qe,He)},rt=qe=>{var He=er(),et=Ct(He);{var De=nt=>{var Ze=er(),ke=Ct(Ze);{var bt=re=>{const ge=ft(()=>x(Y));var oe=AA(),Ae=E(oe),Ne=E(Ae),pt=q(E(Ne)),ot=E(pt,!0);k(pt);var ut=q(pt),St=E(ut),Bt=q(St,2),at=q(Bt),dt=E(at);Uu(dt,{class:"text-base-content/50 mb-0.5 ml-1 inline size-4"}),k(at),k(ut),vn(),k(Ne),k(Ae);var vt=q(Ae);hi(vt,31,()=>x(ge),yt=>yt.id,(yt,It,wt)=>{const mt=ft(()=>So(x(It).countryId));var Dt=kA(),zt=E(Dt),qt=E(zt,!0);k(zt);var tr=q(zt),Qt=E(tr),Ot=E(Qt,!0);k(Qt);var fr=q(Qt,2),kr=E(fr),Ar=q(kr),rr=E(Ar);k(Ar),k(fr),k(tr);var Kt=q(tr),or=E(Kt,!0);k(Kt);var Sr=q(Kt),Dr=E(Sr);Dr.__click=[MA,o,It];var Zr=E(Dr,!0);k(Dr),k(Sr),k(Dt),Ye((se,j,Z)=>{fe(qt,x(wt)+1),xr(Qt,"data-tip",x(mt).name),fe(Ot,x(mt).flag),zr(fr,1,`font-semibold ${se??""}`),fe(kr,`${x(It).name??""} `),fe(rr,`#${x(It).number??""}`),fe(or,j),fe(Zr,Z)},[()=>Oi(x(It).cityId),()=>x(It).pixelsPainted.toLocaleString("en-US"),()=>Ix()]),sl(Dt,()=>ll,()=>({duration:200})),G(yt,Dt)}),k(vt),k(oe),Ye((yt,It,wt,mt)=>{fe(ot,yt),fe(St,`${It??""} `),fe(Bt,`${wt??""} `),xr(at,"data-tip",mt)},[()=>oC(),()=>vc(),()=>yc().toLowerCase(),()=>pC()]),G(re,oe)},te=re=>{var ge=er(),oe=Ct(ge);{var Ae=pt=>{var ot=zA(),ut=E(ot),St=E(ut),Bt=q(E(St)),at=E(Bt,!0);k(Bt);var dt=q(Bt),vt=E(dt),yt=q(vt,2),It=q(yt),wt=E(It);Uu(wt,{class:"text-base-content/50 mb-0.5 ml-1 inline size-4"}),k(It),k(dt),k(St),k(ut);var mt=q(ut);hi(mt,31,()=>x(Y),Dt=>Dt.id,(Dt,zt,qt)=>{const tr=ft(()=>So(x(zt).id));var Qt=EA(),Ot=E(Qt),fr=E(Ot,!0);k(Ot);var kr=q(Ot),Ar=E(kr),rr=E(Ar,!0);k(Ar);var Kt=q(Ar,2),or=E(Kt,!0);k(Kt),k(kr);var Sr=q(kr),Dr=E(Sr,!0);k(Sr),k(Qt),Ye((Zr,se)=>{fe(fr,x(qt)+1),xr(Ar,"data-tip",x(tr).name),fe(rr,x(tr).flag),zr(Kt,1,`font-semibold ${Zr??""}`),fe(or,x(tr).name),fe(Dr,se)},[()=>Oi(x(zt).id),()=>x(zt).pixelsPainted.toLocaleString("en-US")]),sl(Qt,()=>ll,()=>({duration:200})),G(Dt,Qt)}),k(mt),k(ot),Ye((Dt,zt,qt,tr)=>{fe(at,Dt),fe(vt,`${zt??""} `),fe(yt,`${qt??""} `),xr(It,"data-tip",tr)},[()=>Zv(),()=>vc(),()=>yc().toLowerCase(),()=>ZC()]),G(pt,ot)},Ne=pt=>{var ot=er(),ut=Ct(ot);{var St=at=>{const dt=ft(()=>x(Y));var vt=BA(),yt=E(vt),It=E(yt),wt=q(E(It)),mt=E(wt,!0);k(wt);var Dt=q(wt),zt=E(Dt),qt=q(zt,2,!0);k(Dt),k(It),k(yt);var tr=q(yt);hi(tr,31,()=>x(dt),Qt=>Qt.id,(Qt,Ot,fr)=>{const kr=ft(()=>{var xe;return((xe=kt.data)==null?void 0:xe.id)===x(Ot).id});var Ar=RA();let rr;var Kt=E(Ar),or=E(Kt,!0);k(Kt);var Sr=q(Kt),Dr=E(Sr),Zr=E(Dr);lo(Zr,{class:"size-8 border sm:size-10",get userId(){return x(Ot).id},get pictureUrl(){return x(Ot).picture}});var se=q(Zr,2),j=E(se),Z=E(j),X=q(Z),ae=E(X);k(X),k(j);var de=q(j,2);{var Se=xe=>{const Ft=ft(()=>So(x(Ot).equippedFlag));var cr=LA(),Jt=E(cr,!0);k(cr),Ye(()=>{xr(cr,"data-tip",x(Ft).name),fe(Jt,x(Ft).flag)}),G(xe,cr)};je(de,xe=>{x(Ot).equippedFlag&&xe(Se)})}var Ie=q(de,2);{var be=xe=>{Ah(xe,{get username(){return x(Ot).discord},get id(){return x(Ot).discordId}})};je(Ie,xe=>{x(Ot).discord&&xe(be)})}var Oe=q(Ie,2);{var st=xe=>{var Ft=DA(),cr=E(Ft,!0);k(Ft),Ye((Jt,Tr)=>{zr(Ft,1,`badge badge-sm ml-0.5 border-0 ${Jt??""} ${Tr??""}`),fe(cr,x(Ot).allianceName)},[()=>dp(x(Ot).allianceId),()=>Oi(x(Ot).allianceId)]),G(xe,Ft)};je(Oe,xe=>{"allianceName"in x(Ot)&&x(Ot).allianceName&&xe(st)})}k(se),k(Dr),k(Sr);var $e=q(Sr),Mt=E($e,!0);k($e),k(Ar),Ye((xe,Ft,cr)=>{rr=zr(Ar,1,"",null,rr,xe),fe(or,x(fr)+1),zr(j,1,`font-semibold max-sm:ml-2 ${Ft??""} flex gap-1`),fe(Z,`${x(Ot).name??""} `),fe(ae,`#${x(Ot).id??""}`),fe(Mt,cr)},[()=>({"bg-base-200":x(kr)}),()=>Oi(x(Ot).id),()=>x(Ot).pixelsPainted.toLocaleString("en-US")]),sl(Ar,()=>ll,()=>({duration:200})),G(Qt,Ar)}),k(tr),k(vt),Ye((Qt,Ot,fr)=>{fe(mt,Qt),fe(zt,`${Ot??""} `),fe(qt,fr)},[()=>Lm(),()=>vc(),()=>yc().toLowerCase()]),G(at,vt)},Bt=at=>{var dt=er(),vt=Ct(dt);{var yt=It=>{var wt=OA(),mt=E(wt),Dt=E(mt),zt=q(E(Dt)),qt=E(zt,!0);k(zt);var tr=q(zt),Qt=E(tr),Ot=q(Qt,2,!0);k(tr),k(Dt),k(mt);var fr=q(mt);hi(fr,31,()=>x(Y),kr=>kr.id,(kr,Ar,rr)=>{const Kt=ft(()=>{var de;return((de=kt.data)==null?void 0:de.allianceId)===x(Ar).id});var or=FA();let Sr;var Dr=E(or),Zr=E(Dr,!0);k(Dr);var se=q(Dr),j=E(se),Z=E(j,!0);k(j),k(se);var X=q(se),ae=E(X,!0);k(X),k(or),Ye((de,Se,Ie)=>{Sr=zr(or,1,"",null,Sr,de),fe(Zr,x(rr)+1),zr(j,1,`font-semibold ${Se??""}`),fe(Z,x(Ar).name),fe(ae,Ie)},[()=>({"bg-base-200":x(Kt)}),()=>Oi(x(Ar).id),()=>x(Ar).pixelsPainted.toLocaleString("en-US")]),sl(or,()=>ll,()=>({duration:200})),G(kr,or)}),k(fr),k(wt),Ye((kr,Ar,rr)=>{fe(qt,kr),fe(Qt,`${Ar??""} `),fe(Ot,rr)},[()=>mp(),()=>vc(),()=>yc().toLowerCase()]),G(It,wt)};je(vt,It=>{x(s)==="alliances"&&It(yt)},!0)}G(at,dt)};je(ut,at=>{x(s)==="players"?at(St):at(Bt,!1)},!0)}G(pt,ot)};je(oe,pt=>{x(s)==="countries"?pt(Ae):pt(Ne,!1)},!0)}G(re,ge)};je(ke,re=>{x(s)==="regions"?re(bt):re(te,!1)})}G(nt,Ze)},tt=nt=>{var Ze=NA();G(nt,Ze)};je(et,nt=>{x(Y)?nt(De):nt(tt,!1)},!0)}G(qe,He)};je(Fe,qe=>{x(Y)&&x(Y).length===0?qe(Ke):qe(rt,!1)})}fp("innerWidth",qe=>ce(y,qe,!0)),G(m,ie),Fr()}Qn(["click"]);var qA=Cr('<svg><path d="M160-200h160v-320H160v320Zm240 0h160v-560H400v560Zm240 0h160v-240H640v240ZM80-120v-480h240v-240h320v320h240v400H80Z"></path></svg>');function P0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=qA();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var ZA=Te('<dialog class="modal"><div class="modal-box h-11/12 max-w-3xl max-sm:size-full max-sm:rounded-none max-sm:px-3 max-sm:py-5 sm:overflow-x-hidden"><form method="dialog"><button class="btn btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <div class="flex items-center gap-1"><!> <h3 class="text-xl font-bold"> </h3></div> <div class="mt-4"><!></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function UA(m,o){Br(o,!0);let f=Lt(o,"open",15);Dn(()=>{const K=ie=>{ie.key==="Escape"&&f(!1)};return document.addEventListener("keydown",K),()=>document.removeEventListener("keydown",K)});var y=ZA(),M=E(y),z=q(E(M),2),T=E(z);P0(T,{class:"size-6"});var s=q(T,2),B=E(s,!0);k(s),k(z);var N=q(z,2),Y=E(N);VA(Y,{get onvisitclick(){return o.onvisitclick},get open(){return f()}}),k(N),k(M),vn(2),k(y),Wi(y,()=>K=>{Wr(()=>{f()?K.show():K.close()})}),Ye(K=>fe(B,K),[()=>Rm()]),Ai("close",y,()=>f(!1)),G(m,y),Fr()}var $A=Te("<div><!></div>"),GA=Te('<dialog class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <!></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function HA(m,o){Br(o,!0);let f=Lt(o,"open",15);Dn(()=>{const s=B=>{B.key==="Escape"&&f(!1)};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)});var y=GA(),M=E(y),z=q(E(M),2);{var T=s=>{var B=$A(),N=E(B);Ox(N,{}),k(B),ki(2,B,()=>ia,()=>({duration:300})),G(s,B)};je(z,s=>{f()&&s(T)})}k(M),vn(2),k(y),Wi(y,()=>s=>{Wr(()=>{f()?s.show():s.close()})}),Ai("close",y,()=>f(!1)),G(m,y),Fr()}var WA=(m,o,f)=>{localStorage.setItem(x(o),"true"),ce(f,!1)},XA=Te('<span class="indicator-item indicator-bottom indicator-center badge badge-primary badge-xs">new</span>'),YA=Te("<div><!> <!></div>");function Nf(m,o){Br(o,!0);let f=ct(!1);const y=ft(()=>"showed:"+o.key);Dn(()=>{ce(f,!localStorage.getItem(x(y)))});var M=YA();M.__click=[WA,y,f];var z=E(M);{var T=B=>{var N=XA();ki(3,N,()=>ia,()=>({duration:200})),G(B,N)};je(z,B=>{x(f)&&B(T)})}var s=q(z,2);oi(s,()=>o.children),k(M),Ye(()=>zr(M,1,`indicator ${o.class??""}`)),G(m,M),Fr()}Qn(["click"]);var KA=Te("<p>You don't have charges to paint. <br/> </p>");function JA(m,o){Br(o,!1),Nv();var f=KA(),y=q(E(f),2);k(f),Ye(M=>fe(y,` Next charge in ${M??""}`),[()=>tp(kt.cooldown??0)]),G(m,f),Fr()}var QA=Te("<canvas></canvas>");function I0(m,o){Br(o,!0);let f=Lt(o,"width",15,0),y=ir(o,["$$slots","$$events","$$legacy","value","fontSize","color","weight","mono","width"]),M=ft(()=>Math.ceil(o.fontSize)),z=ct(null);const T=window.devicePixelRatio??1,s='"Geist", ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',B='"Geist Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';Wr(()=>{const Y=x(z).getContext("2d");Y.textBaseline="top",Y.font=`${o.weight??"normal"} ${o.fontSize}px ${o.mono?B:s}`,Y.fillStyle=o.color??"#394e6a",Y.setTransform(T,0,0,T,0,0),Y.clearRect(0,0,f(),x(M)),Y.fillText(o.value,0,0);const K=Y.measureText(o.value);f(Math.ceil(K.actualBoundingBoxRight)),ce(M,K.actualBoundingBoxDescent)});var N=QA();ar(N,()=>({width:f()*T,height:x(M)*T,style:`width: ${f()??""}px; height: ${x(M)??""}px`,...y})),Po(N,Y=>ce(z,Y),()=>x(z)),G(m,N),Fr()}var eE=Te('<span class="w-7 text-xs"> </span>'),tE=Te('<span class="flex items-center gap-1 sm:mt-[1px]"><span><!></span> <!></span>'),rE=Te('<span class="loading loading-spinner center-absolute absolute"></span>'),nE=Te('<button><!> <div class="flex items-center gap-2"> <!></div> <!></button>');function M0(m,o){Br(o,!0);let f=ir(o,["$$slots","$$events","$$legacy","loading","charges"]),y=ct(0);var M=nE();ar(M,()=>({...f,class:`btn btn-primary btn-lg sm:btn-xl relative ${o.class??""}`}));var z=E(M);Eh(z,{class:"size-6"});var T=q(z,2),s=E(T),B=q(s);{var N=ie=>{const H=ft(()=>`${Math.floor(o.charges)}/${kt.data.charges.max}`);var me=tE(),ve=E(me),Me=E(ve);{let ze=ft(()=>o.disabled?"#394e6a33":"#ffffff");I0(Me,{weight:600,fontSize:16,get value(){return x(H)},get color(){return x(ze)},get width(){return x(y)},set width(Fe){ce(y,Fe,!0)}})}k(ve);var Ee=q(ve,2);{var Re=ze=>{var Fe=eE(),Ke=E(Fe);k(Fe),Ye(rt=>fe(Ke,`(${rt??""})`),[()=>tp(kt.cooldown)]),G(ze,Fe)};je(Ee,ze=>{o.charges<kt.data.charges.max&&kt.cooldown!==void 0&&ze(Re)})}k(me),Ye(ze=>kc(ve,`width: ${ze??""}px`),[()=>(Math.floor(x(y)/5)+1)*5]),G(ie,me)};je(B,ie=>{o.charges!==void 0&&kt.data&&ie(N)})}k(T);var Y=q(T,2);{var K=ie=>{var H=rE();G(ie,H)};je(Y,ie=>{o.loading&&ie(K)})}k(M),Ye(ie=>fe(s,`${ie??""} `),[()=>$v()]),G(m,M),Fr()}const iE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAABVQTFRFAAAASkKEenHEta7xWmmLi5y0v8vc+SuCVQAAAAF0Uk5TAEDm2GYAAAA/SURBVHjaXcjBDcAwDMNAUW28/8hF0MCIzN9RV7aVfuxp+IGPe+AdPQRpFaRrgcNrn/Bb4LAE4W5aNb3TXUofoSgBYpzN5I4AAAAASUVORK5CYII=",aE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAFxJREFUeNq107EJACAMRFEHyxSu4jbuZ+0IyhUS4ZDogYEr3++Svp+ZDUzGrRTMIwKmiIApImCKiBgbOXOEcRxQsQcW7rVKeA9gj5gD2D3mgC/GcQSLMEdO+/qtE+/GV5duYCOPAAAAAElFTkSuQmCC",oE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAAXNSR0IArs4c6QAAAAJ0Uk5TAAB2k804AAAAKklEQVR42mOAAhsbCA3n//9vQ74ApqE2QIAgwIqBykFaICwMAQwt9HEpAIf2Me1Ro5Q9AAAAAElFTkSuQmCC",sE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAQAAAAnOwc2AAAAAXNSR0IArs4c6QAAABVJREFUeNpjYGA48x8DYwoB1Q0RlQDDCVmniJ241gAAAABJRU5ErkJggg==";class lE{constructor(o){gr(this,"gm");gr(this,"opacity",1);gr(this,"id",`paint-preview-${Math.random()}`);gr(this,"tiles",new Map);this.input=o,this.gm=new fl(this.input.tileSize)}place([o,f],y){const{tile:M,pixel:z}=this.gm.latLonToTileAndPixel(o,f,this.input.tileZoom),T=this.getTileKey(M[0],M[1]);let s=this.tiles.get(T);if(!s){const B=this.gm.tileBoundsLatLon(M[0],M[1],this.input.tileZoom),N=jm(B,!0),Y=new cE({coordinates:N,id:`${this.id}-${T}`,layerPaint:{"raster-opacity":this.opacity,"raster-resampling":"nearest"},tileSize:this.input.tileSize,beforeLayerId:this.input.beforeLayerId});Y.addTo(this.input.map),this.tiles.set(T,Y),s=Y}s.place(z[0],this.input.tileSize-z[1]-1,y)}clear(){const o=this.input.map;for(const f of this.tiles.values())f.removeFrom(o),f.removeDOM();this.tiles.clear()}clearAndPlace(o,f){this.clear(),this.place(o,f)}remove([o,f]){const{tile:y,pixel:M}=this.gm.latLonToTileAndPixel(o,f,this.input.tileZoom),z=this.getTileKey(y[0],y[1]),T=this.tiles.get(z);T&&T.remove(M[0],this.input.tileSize-M[1]-1)}setCanvasOpacity(o){this.opacity=o;for(const f of this.tiles.values())f.setOpacity(o)}getTileKey(o,f){return`${o},${f}`}}class cE{constructor(o){gr(this,"canvas");gr(this,"maps",new Set);this.input=o;const f=this.input.tileSize;this.canvas=document.createElement("canvas"),this.canvas.width=f,this.canvas.height=f}place(o,f,y){var T;const M=((T=Hi.colors)==null?void 0:T[y])??Hi.colors[0],z=this.canvas.getContext("2d");if(z){const s=z.createImageData(1,1),[B,N,Y]=M.rgb,K=y===0?0:255;s.data[0]=B,s.data[1]=N,s.data[2]=Y,s.data[3]=K,z.putImageData(s,o,f)}}remove(o,f){const y=this.canvas.getContext("2d");y&&y.clearRect(o,f,1,1)}addTo(o){const f=this.input.id;o.getSource(f)||o.addSource(f,{type:"canvas",canvas:this.canvas,coordinates:this.input.coordinates}),o.getLayer(f)||(o.addLayer({id:f,type:"raster",source:f,paint:this.input.layerPaint}),this.input.beforeLayerId&&o.moveLayer(f,this.input.beforeLayerId)),this.maps.add(o)}removeFrom(o){const{id:f}=this.input;o.getLayer(f)&&o.removeLayer(f),o.getSource(f)&&o.removeSource(f),this.maps.delete(o)}removeDOM(){this.canvas.remove()}setOpacity(o){for(const f of this.maps.values())f.setPaintProperty(this.input.id,"raster-opacity",o)}}var uE=Cr('<svg><path d="M5 21C4.45 21 3.97917 20.8042 3.5875 20.4125C3.19583 20.0208 3 19.55 3 19V15H5V19H9V21H5ZM15 21V19H19V15H21V19C21 19.55 20.8042 20.0208 20.4125 20.4125C20.0208 20.8042 19.55 21 19 21H15ZM3 9V5C3 4.45 3.19583 3.97917 3.5875 3.5875C3.97917 3.19583 4.45 3 5 3H9V5H5V9H3ZM19 9V5H15V3H19C19.55 3 20.0208 3.19583 20.4125 3.5875C20.8042 3.97917 21 4.45 21 5V9H19Z"></path></svg>');function hE(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=uE();ar(y,()=>({viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...f})),G(m,y)}var dE=Cr('<svg><path d="M5 19H9V21H5C4.45 21 3.97956 20.8038 3.58789 20.4121C3.19622 20.0204 3 19.55 3 19V15H5V19ZM20.6768 20.0908C20.6015 20.2031 20.5138 20.3105 20.4121 20.4121C20.0204 20.8038 19.55 21 19 21H15V19H19V18.4141L20.6768 20.0908ZM21 17.5859L19 15.5859V15H21V17.5859ZM5.58594 5H5V9H3V5C3 4.45 3.19622 3.97956 3.58789 3.58789C3.68947 3.48631 3.79597 3.3975 3.9082 3.32227L5.58594 5ZM19 3C19.55 3 20.0204 3.19622 20.4121 3.58789C20.8038 3.97956 21 4.45 21 5V9H19V5H15V3H19ZM9 5H8.41406L6.41406 3H9V5Z"></path><rect x="1" y="2.41422" width="2" height="29" transform="rotate(-45 1 2.41422)"></rect></svg>');function pE(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=dE();ar(y,()=>({viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...f})),G(m,y)}var fE=Te("<div><!></div>");function al(m,o){Br(o,!0);var f=fE(),y=E(f);oi(y,()=>o.children??pa),k(f),Ye(()=>zr(f,1,`bg-base-100/60 border-base-content/20 -top-15 pointer-events-none absolute left-1/2 line-clamp-1 flex w-max -translate-x-1/2 select-none items-center gap-1 rounded-full border-2 px-3 py-1.5 ${o.class??""}`)),G(m,f),Fr()}var mE=Te('<div class="confetti svelte-15ksp55"></div>'),_E=Te("<div></div>");function Wm(m,o){Br(o,!0);const f=Lt(o,"size",3,10),y=Lt(o,"x",19,()=>[-.5,.5]),M=Lt(o,"y",19,()=>[.25,1]),z=Lt(o,"duration",3,2e3),T=Lt(o,"infinite",3,!1),s=Lt(o,"delay",19,()=>[0,50]),B=Lt(o,"colorRange",19,()=>[0,360]),N=Lt(o,"colorArray",19,()=>[]),Y=Lt(o,"amount",3,50),K=Lt(o,"iterationCount",3,1),ie=Lt(o,"fallDistance",3,"100px"),H=Lt(o,"rounded",3,!1),me=Lt(o,"cone",3,!1),ve=Lt(o,"noGravity",3,!1),Me=Lt(o,"xSpread",3,.15),Ee=Lt(o,"destroyOnComplete",3,!0),Re=Lt(o,"disableForReducedMotion",3,!1);let ze=ct(!1);Dn(()=>{!Ee()||T()||typeof K()=="string"||setTimeout(()=>ce(ze,!0),(z()+s()[1])*K())});function Fe(et,De){return Math.random()*(De-et)+et}function Ke(){return N().length?N()[Math.round(Math.random()*(N().length-1))]:`hsl(${Math.round(Fe(B()[0],B()[1]))}, 75%, 50%)`}var rt=er(),qe=Ct(rt);{var He=et=>{var De=_E();let tt;hi(De,21,()=>({length:Y()}),hp,(nt,Ze)=>{var ke=mE();Ye((bt,te,re,ge,oe,Ae,Ne,pt,ot,ut,St)=>kc(ke,`
        --color: ${bt??""};
        --skew: ${te??""}deg,${re??""}deg;
        --rotation-xyz: ${ge??""}, ${oe??""}, ${Ae??""};
        --rotation-deg: ${Ne??""}deg;
        --translate-y-multiplier: ${pt??""};
        --translate-x-multiplier: ${ot??""};
        --scale: ${ut??""};
        --transition-delay: ${St??""}ms;
        --transition-duration: ${T()?`calc(${z()}ms * var(--scale))`:`${z()}ms`};`),[Ke,()=>Fe(-45,45),()=>Fe(-45,45),()=>Fe(-10,10),()=>Fe(-10,10),()=>Fe(-10,10),()=>Fe(0,360),()=>Fe(M()[0],M()[1]),()=>Fe(y()[0],y()[1]),()=>.1*Fe(2,10),()=>Fe(s()[0],s()[1])]),G(nt,ke)}),k(De),Ye(nt=>{tt=zr(De,1,"confetti-holder svelte-15ksp55",null,tt,nt),kc(De,`
    --fall-distance: ${ie()??""};
    --size: ${f()??""}px;
    --x-spread: ${1-Me()};
    --transition-iteration-count: ${(T()?"infinite":K())??""};`)},[()=>({rounded:H(),cone:me(),"no-gravity":ve(),"reduced-motion":Re()})]),G(et,De)};je(qe,et=>{x(ze)||et(He)})}G(m,rt),Fr()}var gE=async(m,o,f,y)=>{try{ce(o,!0),await en.purchase({id:f,amount:1,variant:y.colorIdx}),await kt.refresh(),aa.notification1.play()}catch(M){Nr.error(M.message)}finally{ce(o,!1)}},vE=Te('<span class="loading loading-spinner center-absolute absolute"></span>'),yE=Te('<!> <span class="text-sm">Droplets</span>',1),xE=Te('<!> Unlocked <span class="center-absolute absolute"><!></span>',1),bE=(m,o)=>o(!1),wE=Te('<div class="flex flex-col gap-4"><section><div class="flex items-center gap-1"><!> <h3 class="text-xl font-bold">Unlock</h3> <div class="ml-auto mr-4"><!></div></div> <p class="text-base-content/80 mt-1 text-sm">Permanently unlock the color</p></section> <div class="bg-base-300 flex flex-col items-center justify-center rounded-xl p-6"><div class="flex grow items-center justify-center"><div class="border-base-content/20 size-32 rounded-2xl border-4"></div></div> <p class="mt-4 text-center text-2xl font-bold"> </p> <div class="flex w-max flex-col"><div><button class="btn btn-xl btn-primary relative mt-3 h-10"><!> <!></button></div> <button class="btn relative mt-3 h-10">Close</button></div></div></div>'),TE=Te('<dialog class="modal !bg-black/80"><div class="modal-box max-h-11/12 w-11/12 max-w-md"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <!></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function CE(m,o){Br(o,!0);let f=Lt(o,"open",15);const y=ft(()=>Hi.colors[o.colorIdx]),M=ft(()=>{var H;return((H=kt.data)==null?void 0:H.droplets)??0});let z=ct(!1);const T=ft(()=>(x(z),kt.hasColor(o.colorIdx)));Dn(()=>{const H=me=>{me.key==="Escape"&&f(!1)};return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)});const s=100,B=Hi.products[s];var N=TE(),Y=E(N),K=q(E(Y),2);{var ie=H=>{var me=wE(),ve=E(me),Me=E(ve),Ee=E(Me);rp(Ee,{class:"size-6"});var Re=q(Ee,4),ze=E(Re);Fv(ze,{get value(){return x(M)}}),k(Re),k(Me),vn(2),k(ve);var Fe=q(ve,2),Ke=E(Fe),rt=E(Ke);k(Ke);var qe=q(Ke,2),He=E(qe,!0);k(qe);var et=q(qe,2),De=E(et);let tt;var nt=E(De);nt.__click=[gE,z,s,o];var Ze=E(nt);{var ke=oe=>{var Ae=vE();G(oe,Ae)};je(Ze,oe=>{x(z)&&oe(ke)})}var bt=q(Ze,2);{var te=oe=>{var Ae=yE(),Ne=Ct(Ae);pp(Ne,{class:"size-5"});var pt=q(Ne);vn(),Ye(ot=>fe(pt,` ${ot??""} `),[()=>B.price.toLocaleString("en-US")]),G(oe,Ae)},re=oe=>{var Ae=xE(),Ne=Ct(Ae);rp(Ne,{class:"size-5"});var pt=q(Ne,2),ot=E(pt);Wm(ot,{}),k(pt),G(oe,Ae)};je(bt,oe=>{x(T)?oe(re,!1):oe(te)})}k(nt),k(De);var ge=q(De,2);ge.__click=[bE,f],k(et),k(Fe),k(me),Ye((oe,Ae)=>{kc(rt,`background: rgb(${x(y).rgb[0]} ${x(y).rgb[1]} ${x(y).rgb[2]})`),xr(rt,"aria-label",x(y).name),fe(He,x(y).name),xr(De,"data-tip",oe),tt=zr(De,1,"",null,tt,Ae),nt.disabled=x(M)<B.price||x(z)||x(T)},[()=>_p(),()=>({tooltip:!x(T)&&x(M)<B.price})]),G(H,me)};je(K,H=>{kt.data&&H(ie)})}k(Y),vn(2),k(N),Wi(N,()=>H=>{Wr(()=>{f()?H.show():H.close()})}),Ai("close",N,()=>f(!1)),G(m,N),Fr()}Qn(["click"]);var bm=function(){return bm=Object.assign||function(o){for(var f,y=1,M=arguments.length;y<M;y++){f=arguments[y];for(var z in f)Object.prototype.hasOwnProperty.call(f,z)&&(o[z]=f[z])}return o},bm.apply(this,arguments)};function Io(m,o,f,y){function M(z){return z instanceof f?z:new f(function(T){T(z)})}return new(f||(f=Promise))(function(z,T){function s(Y){try{N(y.next(Y))}catch(K){T(K)}}function B(Y){try{N(y.throw(Y))}catch(K){T(K)}}function N(Y){Y.done?z(Y.value):M(Y.value).then(s,B)}N((y=y.apply(m,o||[])).next())})}function Mo(m,o){var f={label:0,sent:function(){if(z[0]&1)throw z[1];return z[1]},trys:[],ops:[]},y,M,z,T=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return T.next=s(0),T.throw=s(1),T.return=s(2),typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function s(N){return function(Y){return B([N,Y])}}function B(N){if(y)throw new TypeError("Generator is already executing.");for(;T&&(T=0,N[0]&&(f=0)),f;)try{if(y=1,M&&(z=N[0]&2?M.return:N[0]?M.throw||((z=M.return)&&z.call(M),0):M.next)&&!(z=z.call(M,N[1])).done)return z;switch(M=0,z&&(N=[N[0]&2,z.value]),N[0]){case 0:case 1:z=N;break;case 4:return f.label++,{value:N[1],done:!1};case 5:f.label++,M=N[1],N=[0];continue;case 7:N=f.ops.pop(),f.trys.pop();continue;default:if(z=f.trys,!(z=z.length>0&&z[z.length-1])&&(N[0]===6||N[0]===2)){f=0;continue}if(N[0]===3&&(!z||N[1]>z[0]&&N[1]<z[3])){f.label=N[1];break}if(N[0]===6&&f.label<z[1]){f.label=z[1],z=N;break}if(z&&f.label<z[2]){f.label=z[2],f.ops.push(N);break}z[2]&&f.ops.pop(),f.trys.pop();continue}N=o.call(m,f)}catch(Y){N=[6,Y],M=0}finally{y=z=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}function k0(m,o,f){if(f||arguments.length===2)for(var y=0,M=o.length,z;y<M;y++)(z||!(y in o))&&(z||(z=Array.prototype.slice.call(o,0,y)),z[y]=o[y]);return m.concat(z||Array.prototype.slice.call(o))}var A0="4.6.2";function np(m,o){return new Promise(function(f){return setTimeout(f,m,o)})}function SE(){return new Promise(function(m){var o=new MessageChannel;o.port1.onmessage=function(){return m()},o.port2.postMessage(null)})}function PE(m,o){o===void 0&&(o=1/0);var f=window.requestIdleCallback;return f?new Promise(function(y){return f.call(window,function(){return y()},{timeout:o})}):np(Math.min(m,o))}function E0(m){return!!m&&typeof m.then=="function"}function cv(m,o){try{var f=m();E0(f)?f.then(function(y){return o(!0,y)},function(y){return o(!1,y)}):o(!0,f)}catch(y){o(!1,y)}}function uv(m,o,f){return f===void 0&&(f=16),Io(this,void 0,void 0,function(){var y,M,z,T;return Mo(this,function(s){switch(s.label){case 0:y=Array(m.length),M=Date.now(),z=0,s.label=1;case 1:return z<m.length?(y[z]=o(m[z],z),T=Date.now(),T>=M+f?(M=T,[4,SE()]):[3,3]):[3,4];case 2:s.sent(),s.label=3;case 3:return++z,[3,1];case 4:return[2,y]}})})}function $u(m){return m.then(void 0,function(){}),m}function IE(m,o){for(var f=0,y=m.length;f<y;++f)if(m[f]===o)return!0;return!1}function ME(m,o){return!IE(m,o)}function Xm(m){return parseInt(m)}function so(m){return parseFloat(m)}function Ho(m,o){return typeof m=="number"&&isNaN(m)?o:m}function fa(m){return m.reduce(function(o,f){return o+(f?1:0)},0)}function z0(m,o){if(o===void 0&&(o=1),Math.abs(o)>=1)return Math.round(m/o)*o;var f=1/o;return Math.round(m*f)/f}function kE(m){for(var o,f,y="Unexpected syntax '".concat(m,"'"),M=/^\s*([a-z-]*)(.*)$/i.exec(m),z=M[1]||void 0,T={},s=/([.:#][\w-]+|\[.+?\])/gi,B=function(ie,H){T[ie]=T[ie]||[],T[ie].push(H)};;){var N=s.exec(M[2]);if(!N)break;var Y=N[0];switch(Y[0]){case".":B("class",Y.slice(1));break;case"#":B("id",Y.slice(1));break;case"[":{var K=/^\[([\w-]+)([~|^$*]?=("(.*?)"|([\w-]+)))?(\s+[is])?\]$/.exec(Y);if(K)B(K[1],(f=(o=K[4])!==null&&o!==void 0?o:K[5])!==null&&f!==void 0?f:"");else throw new Error(y);break}default:throw new Error(y)}}return[z,T]}function AE(m){for(var o=new Uint8Array(m.length),f=0;f<m.length;f++){var y=m.charCodeAt(f);if(y>127)return new TextEncoder().encode(m);o[f]=y}return o}function bs(m,o){var f=m[0]>>>16,y=m[0]&65535,M=m[1]>>>16,z=m[1]&65535,T=o[0]>>>16,s=o[0]&65535,B=o[1]>>>16,N=o[1]&65535,Y=0,K=0,ie=0,H=0;H+=z+N,ie+=H>>>16,H&=65535,ie+=M+B,K+=ie>>>16,ie&=65535,K+=y+s,Y+=K>>>16,K&=65535,Y+=f+T,Y&=65535,m[0]=Y<<16|K,m[1]=ie<<16|H}function Ga(m,o){var f=m[0]>>>16,y=m[0]&65535,M=m[1]>>>16,z=m[1]&65535,T=o[0]>>>16,s=o[0]&65535,B=o[1]>>>16,N=o[1]&65535,Y=0,K=0,ie=0,H=0;H+=z*N,ie+=H>>>16,H&=65535,ie+=M*N,K+=ie>>>16,ie&=65535,ie+=z*B,K+=ie>>>16,ie&=65535,K+=y*N,Y+=K>>>16,K&=65535,K+=M*B,Y+=K>>>16,K&=65535,K+=z*s,Y+=K>>>16,K&=65535,Y+=f*N+y*B+M*s+z*T,Y&=65535,m[0]=Y<<16|K,m[1]=ie<<16|H}function fc(m,o){var f=m[0];o%=64,o===32?(m[0]=m[1],m[1]=f):o<32?(m[0]=f<<o|m[1]>>>32-o,m[1]=m[1]<<o|f>>>32-o):(o-=32,m[0]=m[1]<<o|f>>>32-o,m[1]=f<<o|m[1]>>>32-o)}function Na(m,o){o%=64,o!==0&&(o<32?(m[0]=m[1]>>>32-o,m[1]=m[1]<<o):(m[0]=m[1]<<o-32,m[1]=0))}function ri(m,o){m[0]^=o[0],m[1]^=o[1]}var EE=[4283543511,3981806797],zE=[3301882366,444984403];function hv(m){var o=[0,m[0]>>>1];ri(m,o),Ga(m,EE),o[1]=m[0]>>>1,ri(m,o),Ga(m,zE),o[1]=m[0]>>>1,ri(m,o)}var Ud=[2277735313,289559509],$d=[1291169091,658871167],dv=[0,5],LE=[0,1390208809],DE=[0,944331445];function RE(m,o){var f=AE(m);o=o||0;var y=[0,f.length],M=y[1]%16,z=y[1]-M,T=[0,o],s=[0,o],B=[0,0],N=[0,0],Y;for(Y=0;Y<z;Y=Y+16)B[0]=f[Y+4]|f[Y+5]<<8|f[Y+6]<<16|f[Y+7]<<24,B[1]=f[Y]|f[Y+1]<<8|f[Y+2]<<16|f[Y+3]<<24,N[0]=f[Y+12]|f[Y+13]<<8|f[Y+14]<<16|f[Y+15]<<24,N[1]=f[Y+8]|f[Y+9]<<8|f[Y+10]<<16|f[Y+11]<<24,Ga(B,Ud),fc(B,31),Ga(B,$d),ri(T,B),fc(T,27),bs(T,s),Ga(T,dv),bs(T,LE),Ga(N,$d),fc(N,33),Ga(N,Ud),ri(s,N),fc(s,31),bs(s,T),Ga(s,dv),bs(s,DE);B[0]=0,B[1]=0,N[0]=0,N[1]=0;var K=[0,0];switch(M){case 15:K[1]=f[Y+14],Na(K,48),ri(N,K);case 14:K[1]=f[Y+13],Na(K,40),ri(N,K);case 13:K[1]=f[Y+12],Na(K,32),ri(N,K);case 12:K[1]=f[Y+11],Na(K,24),ri(N,K);case 11:K[1]=f[Y+10],Na(K,16),ri(N,K);case 10:K[1]=f[Y+9],Na(K,8),ri(N,K);case 9:K[1]=f[Y+8],ri(N,K),Ga(N,$d),fc(N,33),Ga(N,Ud),ri(s,N);case 8:K[1]=f[Y+7],Na(K,56),ri(B,K);case 7:K[1]=f[Y+6],Na(K,48),ri(B,K);case 6:K[1]=f[Y+5],Na(K,40),ri(B,K);case 5:K[1]=f[Y+4],Na(K,32),ri(B,K);case 4:K[1]=f[Y+3],Na(K,24),ri(B,K);case 3:K[1]=f[Y+2],Na(K,16),ri(B,K);case 2:K[1]=f[Y+1],Na(K,8),ri(B,K);case 1:K[1]=f[Y],ri(B,K),Ga(B,Ud),fc(B,31),Ga(B,$d),ri(T,B)}return ri(T,y),ri(s,y),bs(T,s),bs(s,T),hv(T),hv(s),bs(T,s),bs(s,T),("00000000"+(T[0]>>>0).toString(16)).slice(-8)+("00000000"+(T[1]>>>0).toString(16)).slice(-8)+("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)}function BE(m){var o;return bm({name:m.name,message:m.message,stack:(o=m.stack)===null||o===void 0?void 0:o.split(`
`)},m)}function FE(m){return/^function\s.*?\{\s*\[native code]\s*}$/.test(String(m))}function OE(m){return typeof m!="function"}function NE(m,o){var f=$u(new Promise(function(y){var M=Date.now();cv(m.bind(null,o),function(){for(var z=[],T=0;T<arguments.length;T++)z[T]=arguments[T];var s=Date.now()-M;if(!z[0])return y(function(){return{error:z[1],duration:s}});var B=z[1];if(OE(B))return y(function(){return{value:B,duration:s}});y(function(){return new Promise(function(N){var Y=Date.now();cv(B,function(){for(var K=[],ie=0;ie<arguments.length;ie++)K[ie]=arguments[ie];var H=s+Date.now()-Y;if(!K[0])return N({error:K[1],duration:H});N({value:K[1],duration:H})})})})})}));return function(){return f.then(function(M){return M()})}}function jE(m,o,f,y){var M=Object.keys(m).filter(function(T){return ME(f,T)}),z=$u(uv(M,function(T){return NE(m[T],o)},y));return function(){return Io(this,void 0,void 0,function(){var s,B,N,Y,K;return Mo(this,function(ie){switch(ie.label){case 0:return[4,z];case 1:return s=ie.sent(),[4,uv(s,function(H){return $u(H())},y)];case 2:return B=ie.sent(),[4,Promise.all(B)];case 3:for(N=ie.sent(),Y={},K=0;K<M.length;++K)Y[M[K]]=N[K];return[2,Y]}})})}}function L0(){var m=window,o=navigator;return fa(["MSCSSMatrix"in m,"msSetImmediate"in m,"msIndexedDB"in m,"msMaxTouchPoints"in o,"msPointerEnabled"in o])>=4}function VE(){var m=window,o=navigator;return fa(["msWriteProfilerMark"in m,"MSStream"in m,"msLaunchUri"in o,"msSaveBlob"in o])>=3&&!L0()}function Lh(){var m=window,o=navigator;return fa(["webkitPersistentStorage"in o,"webkitTemporaryStorage"in o,(o.vendor||"").indexOf("Google")===0,"webkitResolveLocalFileSystemURL"in m,"BatteryManager"in m,"webkitMediaStream"in m,"webkitSpeechGrammar"in m])>=5}function ho(){var m=window,o=navigator;return fa(["ApplePayError"in m,"CSSPrimitiveValue"in m,"Counter"in m,o.vendor.indexOf("Apple")===0,"RGBColor"in m,"WebKitMediaKeys"in m])>=4}function Ym(){var m=window,o=m.HTMLElement,f=m.Document;return fa(["safari"in m,!("ongestureend"in m),!("TouchEvent"in m),!("orientation"in m),o&&!("autocapitalize"in o.prototype),f&&"pointerLockElement"in f.prototype])>=4}function Dh(){var m=window;return FE(m.print)&&String(m.browser)==="[object WebPageNamespace]"}function D0(){var m,o,f=window;return fa(["buildID"in navigator,"MozAppearance"in((o=(m=document.documentElement)===null||m===void 0?void 0:m.style)!==null&&o!==void 0?o:{}),"onmozfullscreenchange"in f,"mozInnerScreenX"in f,"CSSMozDocumentRule"in f,"CanvasCaptureMediaStream"in f])>=4}function qE(){var m=window;return fa([!("MediaSettingsRange"in m),"RTCEncodedAudioFrame"in m,""+m.Intl=="[object Intl]",""+m.Reflect=="[object Reflect]"])>=3}function ZE(){var m=window,o=m.URLPattern;return fa(["union"in Set.prototype,"Iterator"in m,o&&"hasRegExpGroups"in o.prototype,"RGB8"in WebGLRenderingContext.prototype])>=3}function UE(){var m=window;return fa(["DOMRectList"in m,"RTCPeerConnectionIceEvent"in m,"SVGGeometryElement"in m,"ontransitioncancel"in m])>=3}function Rh(){var m=window,o=navigator,f=m.CSS,y=m.HTMLButtonElement;return fa([!("getStorageUpdates"in o),y&&"popover"in y.prototype,"CSSCounterStyleRule"in m,f.supports("font-size-adjust: ex-height 0.5"),f.supports("text-transform: full-width")])>=4}function $E(){if(navigator.platform==="iPad")return!0;var m=screen,o=m.width/m.height;return fa(["MediaSource"in window,!!Element.prototype.webkitRequestFullscreen,o>.65&&o<1.53])>=2}function GE(){var m=document;return m.fullscreenElement||m.msFullscreenElement||m.mozFullScreenElement||m.webkitFullscreenElement||null}function HE(){var m=document;return(m.exitFullscreen||m.msExitFullscreen||m.mozCancelFullScreen||m.webkitExitFullscreen).call(m)}function Km(){var m=Lh(),o=D0(),f=window,y=navigator,M="connection";return m?fa([!("SharedWorker"in f),y[M]&&"ontypechange"in y[M],!("sinkId"in new Audio)])>=2:o?fa(["onorientationchange"in f,"orientation"in f,/android/i.test(y.appVersion)])>=2:!1}function WE(){var m=navigator,o=window,f=Audio.prototype,y=o.visualViewport;return fa(["srLatency"in f,"srChannelCount"in f,"devicePosture"in m,y&&"segments"in y,"getTextInformation"in Image.prototype])>=3}function XE(){return JE()?-4:YE()}function YE(){var m=window,o=m.OfflineAudioContext||m.webkitOfflineAudioContext;if(!o)return-2;if(KE())return-1;var f=4500,y=5e3,M=new o(1,y,44100),z=M.createOscillator();z.type="triangle",z.frequency.value=1e4;var T=M.createDynamicsCompressor();T.threshold.value=-50,T.knee.value=40,T.ratio.value=12,T.attack.value=0,T.release.value=.25,z.connect(T),T.connect(M.destination),z.start(0);var s=QE(M),B=s[0],N=s[1],Y=$u(B.then(function(K){return e8(K.getChannelData(0).subarray(f))},function(K){if(K.name==="timeout"||K.name==="suspended")return-3;throw K}));return function(){return N(),Y}}function KE(){return ho()&&!Ym()&&!UE()}function JE(){return ho()&&Rh()&&Dh()||Lh()&&WE()&&ZE()}function QE(m){var o=3,f=500,y=500,M=5e3,z=function(){},T=new Promise(function(s,B){var N=!1,Y=0,K=0;m.oncomplete=function(me){return s(me.renderedBuffer)};var ie=function(){setTimeout(function(){return B(pv("timeout"))},Math.min(y,K+M-Date.now()))},H=function(){try{var me=m.startRendering();switch(E0(me)&&$u(me),m.state){case"running":K=Date.now(),N&&ie();break;case"suspended":document.hidden||Y++,N&&Y>=o?B(pv("suspended")):setTimeout(H,f);break}}catch(ve){B(ve)}};H(),z=function(){N||(N=!0,K>0&&ie())}});return[T,z]}function e8(m){for(var o=0,f=0;f<m.length;++f)o+=Math.abs(m[f]);return o}function pv(m){var o=new Error(m);return o.name=m,o}function R0(m,o,f){var y,M,z;return f===void 0&&(f=50),Io(this,void 0,void 0,function(){var T,s;return Mo(this,function(B){switch(B.label){case 0:T=document,B.label=1;case 1:return T.body?[3,3]:[4,np(f)];case 2:return B.sent(),[3,1];case 3:s=T.createElement("iframe"),B.label=4;case 4:return B.trys.push([4,,10,11]),[4,new Promise(function(N,Y){var K=!1,ie=function(){K=!0,N()},H=function(Me){K=!0,Y(Me)};s.onload=ie,s.onerror=H;var me=s.style;me.setProperty("display","block","important"),me.position="absolute",me.top="0",me.left="0",me.visibility="hidden",o&&"srcdoc"in s?s.srcdoc=o:s.src="about:blank",T.body.appendChild(s);var ve=function(){var Me,Ee;K||(((Ee=(Me=s.contentWindow)===null||Me===void 0?void 0:Me.document)===null||Ee===void 0?void 0:Ee.readyState)==="complete"?ie():setTimeout(ve,10))};ve()})];case 5:B.sent(),B.label=6;case 6:return!((M=(y=s.contentWindow)===null||y===void 0?void 0:y.document)===null||M===void 0)&&M.body?[3,8]:[4,np(f)];case 7:return B.sent(),[3,6];case 8:return[4,m(s,s.contentWindow)];case 9:return[2,B.sent()];case 10:return(z=s.parentNode)===null||z===void 0||z.removeChild(s),[7];case 11:return[2]}})})}function t8(m){for(var o=kE(m),f=o[0],y=o[1],M=document.createElement(f??"div"),z=0,T=Object.keys(y);z<T.length;z++){var s=T[z],B=y[s].join(" ");s==="style"?r8(M.style,B):M.setAttribute(s,B)}return M}function r8(m,o){for(var f=0,y=o.split(";");f<y.length;f++){var M=y[f],z=/^\s*([\w-]+)\s*:\s*(.+?)(\s*!([\w-]+))?\s*$/.exec(M);if(z){var T=z[1],s=z[2],B=z[4];m.setProperty(T,s,B||"")}}}function n8(){for(var m=window;;){var o=m.parent;if(!o||o===m)return!1;try{if(o.location.origin!==m.location.origin)return!0}catch(f){if(f instanceof Error&&f.name==="SecurityError")return!0;throw f}m=o}}var i8="mmMwWLliI0O&1",a8="48px",mc=["monospace","sans-serif","serif"],fv=["sans-serif-thin","ARNO PRO","Agency FB","Arabic Typesetting","Arial Unicode MS","AvantGarde Bk BT","BankGothic Md BT","Batang","Bitstream Vera Sans Mono","Calibri","Century","Century Gothic","Clarendon","EUROSTILE","Franklin Gothic","Futura Bk BT","Futura Md BT","GOTHAM","Gill Sans","HELV","Haettenschweiler","Helvetica Neue","Humanst521 BT","Leelawadee","Letter Gothic","Levenim MT","Lucida Bright","Lucida Sans","Menlo","MS Mincho","MS Outlook","MS Reference Specialty","MS UI Gothic","MT Extra","MYRIAD PRO","Marlett","Meiryo UI","Microsoft Uighur","Minion Pro","Monotype Corsiva","PMingLiU","Pristina","SCRIPTINA","Segoe UI Light","Serifa","SimHei","Small Fonts","Staccato222 BT","TRAJAN PRO","Univers CE 55 Medium","Vrinda","ZWAdobeF"];function o8(){var m=this;return R0(function(o,f){var y=f.document;return Io(m,void 0,void 0,function(){var M,z,T,s,B,N,Y,K,ie,H,me,ve;return Mo(this,function(Me){for(M=y.body,M.style.fontSize=a8,z=y.createElement("div"),z.style.setProperty("visibility","hidden","important"),T={},s={},B=function(Ee){var Re=y.createElement("span"),ze=Re.style;return ze.position="absolute",ze.top="0",ze.left="0",ze.fontFamily=Ee,Re.textContent=i8,z.appendChild(Re),Re},N=function(Ee,Re){return B("'".concat(Ee,"',").concat(Re))},Y=function(){return mc.map(B)},K=function(){for(var Ee={},Re=function(rt){Ee[rt]=mc.map(function(qe){return N(rt,qe)})},ze=0,Fe=fv;ze<Fe.length;ze++){var Ke=Fe[ze];Re(Ke)}return Ee},ie=function(Ee){return mc.some(function(Re,ze){return Ee[ze].offsetWidth!==T[Re]||Ee[ze].offsetHeight!==s[Re]})},H=Y(),me=K(),M.appendChild(z),ve=0;ve<mc.length;ve++)T[mc[ve]]=H[ve].offsetWidth,s[mc[ve]]=H[ve].offsetHeight;return[2,fv.filter(function(Ee){return ie(me[Ee])})]})})})}function s8(){var m=navigator.plugins;if(m){for(var o=[],f=0;f<m.length;++f){var y=m[f];if(y){for(var M=[],z=0;z<y.length;++z){var T=y[z];M.push({type:T.type,suffixes:T.suffixes})}o.push({name:y.name,description:y.description,mimeTypes:M})}}return o}}function l8(){return c8(_8())}function c8(m){var o,f=!1,y,M,z=u8(),T=z[0],s=z[1];return h8(T,s)?(f=d8(s),m?y=M="skipped":(o=p8(T,s),y=o[0],M=o[1])):y=M="unsupported",{winding:f,geometry:y,text:M}}function u8(){var m=document.createElement("canvas");return m.width=1,m.height=1,[m,m.getContext("2d")]}function h8(m,o){return!!(o&&m.toDataURL)}function d8(m){return m.rect(0,0,10,10),m.rect(2,2,6,6),!m.isPointInPath(5,5,"evenodd")}function p8(m,o){f8(m,o);var f=jf(m),y=jf(m);if(f!==y)return["unstable","unstable"];m8(m,o);var M=jf(m);return[M,f]}function f8(m,o){m.width=240,m.height=60,o.textBaseline="alphabetic",o.fillStyle="#f60",o.fillRect(100,1,62,20),o.fillStyle="#069",o.font='11pt "Times New Roman"';var f="Cwm fjordbank gly ".concat("ðŸ˜ƒ");o.fillText(f,2,15),o.fillStyle="rgba(102, 204, 0, 0.2)",o.font="18pt Arial",o.fillText(f,4,45)}function m8(m,o){m.width=122,m.height=110,o.globalCompositeOperation="multiply";for(var f=0,y=[["#f2f",40,40],["#2ff",80,40],["#ff2",60,80]];f<y.length;f++){var M=y[f],z=M[0],T=M[1],s=M[2];o.fillStyle=z,o.beginPath(),o.arc(T,s,40,0,Math.PI*2,!0),o.closePath(),o.fill()}o.fillStyle="#f9c",o.arc(60,60,60,0,Math.PI*2,!0),o.arc(60,60,20,0,Math.PI*2,!0),o.fill("evenodd")}function jf(m){return m.toDataURL()}function _8(){return ho()&&Rh()&&Dh()}function g8(){var m=navigator,o=0,f;m.maxTouchPoints!==void 0?o=Xm(m.maxTouchPoints):m.msMaxTouchPoints!==void 0&&(o=m.msMaxTouchPoints);try{document.createEvent("TouchEvent"),f=!0}catch{f=!1}var y="ontouchstart"in window;return{maxTouchPoints:o,touchEvent:f,touchStart:y}}function v8(){return navigator.oscpu}function y8(){var m=navigator,o=[],f=m.language||m.userLanguage||m.browserLanguage||m.systemLanguage;if(f!==void 0&&o.push([f]),Array.isArray(m.languages))Lh()&&qE()||o.push(m.languages);else if(typeof m.languages=="string"){var y=m.languages;y&&o.push(y.split(","))}return o}function x8(){return window.screen.colorDepth}function b8(){return Ho(so(navigator.deviceMemory),void 0)}function w8(){if(!(ho()&&Rh()&&Dh()))return T8()}function T8(){var m=screen,o=function(y){return Ho(Xm(y),null)},f=[o(m.width),o(m.height)];return f.sort().reverse(),f}var C8=2500,S8=10,ep,Vf;function P8(){if(Vf===void 0){var m=function(){var o=wm();Tm(o)?Vf=setTimeout(m,C8):(ep=o,Vf=void 0)};m()}}function I8(){var m=this;return P8(),function(){return Io(m,void 0,void 0,function(){var o;return Mo(this,function(f){switch(f.label){case 0:return o=wm(),Tm(o)?ep?[2,k0([],ep,!0)]:GE()?[4,HE()]:[3,2]:[3,2];case 1:f.sent(),o=wm(),f.label=2;case 2:return Tm(o)||(ep=o),[2,o]}})})}}function M8(){var m=this;if(ho()&&Rh()&&Dh())return function(){return Promise.resolve(void 0)};var o=I8();return function(){return Io(m,void 0,void 0,function(){var f,y;return Mo(this,function(M){switch(M.label){case 0:return[4,o()];case 1:return f=M.sent(),y=function(z){return z===null?null:z0(z,S8)},[2,[y(f[0]),y(f[1]),y(f[2]),y(f[3])]]}})})}}function wm(){var m=screen;return[Ho(so(m.availTop),null),Ho(so(m.width)-so(m.availWidth)-Ho(so(m.availLeft),0),null),Ho(so(m.height)-so(m.availHeight)-Ho(so(m.availTop),0),null),Ho(so(m.availLeft),null)]}function Tm(m){for(var o=0;o<4;++o)if(m[o])return!1;return!0}function k8(){return Ho(Xm(navigator.hardwareConcurrency),void 0)}function A8(){var m,o=(m=window.Intl)===null||m===void 0?void 0:m.DateTimeFormat;if(o){var f=new o().resolvedOptions().timeZone;if(f)return f}var y=-E8();return"UTC".concat(y>=0?"+":"").concat(y)}function E8(){var m=new Date().getFullYear();return Math.max(so(new Date(m,0,1).getTimezoneOffset()),so(new Date(m,6,1).getTimezoneOffset()))}function z8(){try{return!!window.sessionStorage}catch{return!0}}function L8(){try{return!!window.localStorage}catch{return!0}}function D8(){if(!(L0()||VE()))try{return!!window.indexedDB}catch{return!0}}function R8(){return!!window.openDatabase}function B8(){return navigator.cpuClass}function F8(){var m=navigator.platform;return m==="MacIntel"&&ho()&&!Ym()?$E()?"iPad":"iPhone":m}function O8(){return navigator.vendor||""}function N8(){for(var m=[],o=0,f=["chrome","safari","__crWeb","__gCrWeb","yandex","__yb","__ybro","__firefox__","__edgeTrackingPreventionStatistics","webkit","oprt","samsungAr","ucweb","UCShellJava","puffinDevice"];o<f.length;o++){var y=f[o],M=window[y];M&&typeof M=="object"&&m.push(y)}return m.sort()}function j8(){var m=document;try{m.cookie="cookietest=1; SameSite=Strict;";var o=m.cookie.indexOf("cookietest=")!==-1;return m.cookie="cookietest=1; SameSite=Strict; expires=Thu, 01-Jan-1970 00:00:01 GMT",o}catch{return!1}}function V8(){var m=atob;return{abpIndo:["#Iklan-Melayang","#Kolom-Iklan-728","#SidebarIklan-wrapper",'[title="ALIENBOLA" i]',m("I0JveC1CYW5uZXItYWRz")],abpvn:[".quangcao","#mobileCatfish",m("LmNsb3NlLWFkcw=="),'[id^="bn_bottom_fixed_"]',"#pmadv"],adBlockFinland:[".mainostila",m("LnNwb25zb3JpdA=="),".ylamainos",m("YVtocmVmKj0iL2NsaWNrdGhyZ2guYXNwPyJd"),m("YVtocmVmXj0iaHR0cHM6Ly9hcHAucmVhZHBlYWsuY29tL2FkcyJd")],adBlockPersian:["#navbar_notice_50",".kadr",'TABLE[width="140px"]',"#divAgahi",m("YVtocmVmXj0iaHR0cDovL2cxLnYuZndtcm0ubmV0L2FkLyJd")],adBlockWarningRemoval:["#adblock-honeypot",".adblocker-root",".wp_adblock_detect",m("LmhlYWRlci1ibG9ja2VkLWFk"),m("I2FkX2Jsb2NrZXI=")],adGuardAnnoyances:[".hs-sosyal","#cookieconsentdiv",'div[class^="app_gdpr"]',".as-oil",'[data-cypress="soft-push-notification-modal"]'],adGuardBase:[".BetterJsPopOverlay",m("I2FkXzMwMFgyNTA="),m("I2Jhbm5lcmZsb2F0MjI="),m("I2NhbXBhaWduLWJhbm5lcg=="),m("I0FkLUNvbnRlbnQ=")],adGuardChinese:[m("LlppX2FkX2FfSA=="),m("YVtocmVmKj0iLmh0aGJldDM0LmNvbSJd"),"#widget-quan",m("YVtocmVmKj0iLzg0OTkyMDIwLnh5eiJd"),m("YVtocmVmKj0iLjE5NTZobC5jb20vIl0=")],adGuardFrench:["#pavePub",m("LmFkLWRlc2t0b3AtcmVjdGFuZ2xl"),".mobile_adhesion",".widgetadv",m("LmFkc19iYW4=")],adGuardGerman:['aside[data-portal-id="leaderboard"]'],adGuardJapanese:["#kauli_yad_1",m("YVtocmVmXj0iaHR0cDovL2FkMi50cmFmZmljZ2F0ZS5uZXQvIl0="),m("Ll9wb3BJbl9pbmZpbml0ZV9hZA=="),m("LmFkZ29vZ2xl"),m("Ll9faXNib29zdFJldHVybkFk")],adGuardMobile:[m("YW1wLWF1dG8tYWRz"),m("LmFtcF9hZA=="),'amp-embed[type="24smi"]',"#mgid_iframe1",m("I2FkX2ludmlld19hcmVh")],adGuardRussian:[m("YVtocmVmXj0iaHR0cHM6Ly9hZC5sZXRtZWFkcy5jb20vIl0="),m("LnJlY2xhbWE="),'div[id^="smi2adblock"]',m("ZGl2W2lkXj0iQWRGb3hfYmFubmVyXyJd"),"#psyduckpockeball"],adGuardSocial:[m("YVtocmVmXj0iLy93d3cuc3R1bWJsZXVwb24uY29tL3N1Ym1pdD91cmw9Il0="),m("YVtocmVmXj0iLy90ZWxlZ3JhbS5tZS9zaGFyZS91cmw/Il0="),".etsy-tweet","#inlineShare",".popup-social"],adGuardSpanishPortuguese:["#barraPublicidade","#Publicidade","#publiEspecial","#queTooltip",".cnt-publi"],adGuardTrackingProtection:["#qoo-counter",m("YVtocmVmXj0iaHR0cDovL2NsaWNrLmhvdGxvZy5ydS8iXQ=="),m("YVtocmVmXj0iaHR0cDovL2hpdGNvdW50ZXIucnUvdG9wL3N0YXQucGhwIl0="),m("YVtocmVmXj0iaHR0cDovL3RvcC5tYWlsLnJ1L2p1bXAiXQ=="),"#top100counter"],adGuardTurkish:["#backkapat",m("I3Jla2xhbWk="),m("YVtocmVmXj0iaHR0cDovL2Fkc2Vydi5vbnRlay5jb20udHIvIl0="),m("YVtocmVmXj0iaHR0cDovL2l6bGVuemkuY29tL2NhbXBhaWduLyJd"),m("YVtocmVmXj0iaHR0cDovL3d3dy5pbnN0YWxsYWRzLm5ldC8iXQ==")],bulgarian:[m("dGQjZnJlZW5ldF90YWJsZV9hZHM="),"#ea_intext_div",".lapni-pop-over","#xenium_hot_offers"],easyList:[".yb-floorad",m("LndpZGdldF9wb19hZHNfd2lkZ2V0"),m("LnRyYWZmaWNqdW5reS1hZA=="),".textad_headline",m("LnNwb25zb3JlZC10ZXh0LWxpbmtz")],easyListChina:[m("LmFwcGd1aWRlLXdyYXBbb25jbGljayo9ImJjZWJvcy5jb20iXQ=="),m("LmZyb250cGFnZUFkdk0="),"#taotaole","#aafoot.top_box",".cfa_popup"],easyListCookie:[".ezmob-footer",".cc-CookieWarning","[data-cookie-number]",m("LmF3LWNvb2tpZS1iYW5uZXI="),".sygnal24-gdpr-modal-wrap"],easyListCzechSlovak:["#onlajny-stickers",m("I3Jla2xhbW5pLWJveA=="),m("LnJla2xhbWEtbWVnYWJvYXJk"),".sklik",m("W2lkXj0ic2tsaWtSZWtsYW1hIl0=")],easyListDutch:[m("I2FkdmVydGVudGll"),m("I3ZpcEFkbWFya3RCYW5uZXJCbG9jaw=="),".adstekst",m("YVtocmVmXj0iaHR0cHM6Ly94bHR1YmUubmwvY2xpY2svIl0="),"#semilo-lrectangle"],easyListGermany:["#SSpotIMPopSlider",m("LnNwb25zb3JsaW5rZ3J1ZW4="),m("I3dlcmJ1bmdza3k="),m("I3Jla2xhbWUtcmVjaHRzLW1pdHRl"),m("YVtocmVmXj0iaHR0cHM6Ly9iZDc0Mi5jb20vIl0=")],easyListItaly:[m("LmJveF9hZHZfYW5udW5jaQ=="),".sb-box-pubbliredazionale",m("YVtocmVmXj0iaHR0cDovL2FmZmlsaWF6aW9uaWFkcy5zbmFpLml0LyJd"),m("YVtocmVmXj0iaHR0cHM6Ly9hZHNlcnZlci5odG1sLml0LyJd"),m("YVtocmVmXj0iaHR0cHM6Ly9hZmZpbGlhemlvbmlhZHMuc25haS5pdC8iXQ==")],easyListLithuania:[m("LnJla2xhbW9zX3RhcnBhcw=="),m("LnJla2xhbW9zX251b3JvZG9z"),m("aW1nW2FsdD0iUmVrbGFtaW5pcyBza3lkZWxpcyJd"),m("aW1nW2FsdD0iRGVkaWt1b3RpLmx0IHNlcnZlcmlhaSJd"),m("aW1nW2FsdD0iSG9zdGluZ2FzIFNlcnZlcmlhaS5sdCJd")],estonian:[m("QVtocmVmKj0iaHR0cDovL3BheTRyZXN1bHRzMjQuZXUiXQ==")],fanboyAnnoyances:["#ac-lre-player",".navigate-to-top","#subscribe_popup",".newsletter_holder","#back-top"],fanboyAntiFacebook:[".util-bar-module-firefly-visible"],fanboyEnhancedTrackers:[".open.pushModal","#issuem-leaky-paywall-articles-zero-remaining-nag","#sovrn_container",'div[class$="-hide"][zoompage-fontsize][style="display: block;"]',".BlockNag__Card"],fanboySocial:["#FollowUs","#meteored_share","#social_follow",".article-sharer",".community__social-desc"],frellwitSwedish:[m("YVtocmVmKj0iY2FzaW5vcHJvLnNlIl1bdGFyZ2V0PSJfYmxhbmsiXQ=="),m("YVtocmVmKj0iZG9rdG9yLXNlLm9uZWxpbmsubWUiXQ=="),"article.category-samarbete",m("ZGl2LmhvbGlkQWRz"),"ul.adsmodern"],greekAdBlock:[m("QVtocmVmKj0iYWRtYW4ub3RlbmV0LmdyL2NsaWNrPyJd"),m("QVtocmVmKj0iaHR0cDovL2F4aWFiYW5uZXJzLmV4b2R1cy5nci8iXQ=="),m("QVtocmVmKj0iaHR0cDovL2ludGVyYWN0aXZlLmZvcnRobmV0LmdyL2NsaWNrPyJd"),"DIV.agores300","TABLE.advright"],hungarian:["#cemp_doboz",".optimonk-iframe-container",m("LmFkX19tYWlu"),m("W2NsYXNzKj0iR29vZ2xlQWRzIl0="),"#hirdetesek_box"],iDontCareAboutCookies:['.alert-info[data-block-track*="CookieNotice"]',".ModuleTemplateCookieIndicator",".o--cookies--container","#cookies-policy-sticky","#stickyCookieBar"],icelandicAbp:[m("QVtocmVmXj0iL2ZyYW1ld29yay9yZXNvdXJjZXMvZm9ybXMvYWRzLmFzcHgiXQ==")],latvian:[m("YVtocmVmPSJodHRwOi8vd3d3LnNhbGlkemluaS5sdi8iXVtzdHlsZT0iZGlzcGxheTogYmxvY2s7IHdpZHRoOiAxMjBweDsgaGVpZ2h0OiA0MHB4OyBvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7Il0="),m("YVtocmVmPSJodHRwOi8vd3d3LnNhbGlkemluaS5sdi8iXVtzdHlsZT0iZGlzcGxheTogYmxvY2s7IHdpZHRoOiA4OHB4OyBoZWlnaHQ6IDMxcHg7IG92ZXJmbG93OiBoaWRkZW47IHBvc2l0aW9uOiByZWxhdGl2ZTsiXQ==")],listKr:[m("YVtocmVmKj0iLy9hZC5wbGFuYnBsdXMuY28ua3IvIl0="),m("I2xpdmVyZUFkV3JhcHBlcg=="),m("YVtocmVmKj0iLy9hZHYuaW1hZHJlcC5jby5rci8iXQ=="),m("aW5zLmZhc3R2aWV3LWFk"),".revenue_unit_item.dable"],listeAr:[m("LmdlbWluaUxCMUFk"),".right-and-left-sponsers",m("YVtocmVmKj0iLmFmbGFtLmluZm8iXQ=="),m("YVtocmVmKj0iYm9vcmFxLm9yZyJd"),m("YVtocmVmKj0iZHViaXp6bGUuY29tL2FyLz91dG1fc291cmNlPSJd")],listeFr:[m("YVtocmVmXj0iaHR0cDovL3Byb21vLnZhZG9yLmNvbS8iXQ=="),m("I2FkY29udGFpbmVyX3JlY2hlcmNoZQ=="),m("YVtocmVmKj0id2Vib3JhbWEuZnIvZmNnaS1iaW4vIl0="),".site-pub-interstitiel",'div[id^="crt-"][data-criteo-id]'],officialPolish:["#ceneo-placeholder-ceneo-12",m("W2hyZWZePSJodHRwczovL2FmZi5zZW5kaHViLnBsLyJd"),m("YVtocmVmXj0iaHR0cDovL2Fkdm1hbmFnZXIudGVjaGZ1bi5wbC9yZWRpcmVjdC8iXQ=="),m("YVtocmVmXj0iaHR0cDovL3d3dy50cml6ZXIucGwvP3V0bV9zb3VyY2UiXQ=="),m("ZGl2I3NrYXBpZWNfYWQ=")],ro:[m("YVtocmVmXj0iLy9hZmZ0cmsuYWx0ZXgucm8vQ291bnRlci9DbGljayJd"),m("YVtocmVmXj0iaHR0cHM6Ly9ibGFja2ZyaWRheXNhbGVzLnJvL3Ryay9zaG9wLyJd"),m("YVtocmVmXj0iaHR0cHM6Ly9ldmVudC4ycGVyZm9ybWFudC5jb20vZXZlbnRzL2NsaWNrIl0="),m("YVtocmVmXj0iaHR0cHM6Ly9sLnByb2ZpdHNoYXJlLnJvLyJd"),'a[href^="/url/"]'],ruAd:[m("YVtocmVmKj0iLy9mZWJyYXJlLnJ1LyJd"),m("YVtocmVmKj0iLy91dGltZy5ydS8iXQ=="),m("YVtocmVmKj0iOi8vY2hpa2lkaWtpLnJ1Il0="),"#pgeldiz",".yandex-rtb-block"],thaiAds:["a[href*=macau-uta-popup]",m("I2Fkcy1nb29nbGUtbWlkZGxlX3JlY3RhbmdsZS1ncm91cA=="),m("LmFkczMwMHM="),".bumq",".img-kosana"],webAnnoyancesUltralist:["#mod-social-share-2","#social-tools",m("LmN0cGwtZnVsbGJhbm5lcg=="),".zergnet-recommend",".yt.btn-link.btn-md.btn"]}}function q8(m){var o=m===void 0?{}:m,f=o.debug;return Io(this,void 0,void 0,function(){var y,M,z,T,s,B;return Mo(this,function(N){switch(N.label){case 0:return Z8()?(y=V8(),M=Object.keys(y),z=(B=[]).concat.apply(B,M.map(function(Y){return y[Y]})),[4,U8(z)]):[2,void 0];case 1:return T=N.sent(),f&&$8(y,T),s=M.filter(function(Y){var K=y[Y],ie=fa(K.map(function(H){return T[H]}));return ie>K.length*.6}),s.sort(),[2,s]}})})}function Z8(){return ho()||Km()}function U8(m){var o;return Io(this,void 0,void 0,function(){var f,y,M,z,B,T,s,B;return Mo(this,function(N){switch(N.label){case 0:for(f=document,y=f.createElement("div"),M=new Array(m.length),z={},mv(y),B=0;B<m.length;++B)T=t8(m[B]),T.tagName==="DIALOG"&&T.show(),s=f.createElement("div"),mv(s),s.appendChild(T),y.appendChild(s),M[B]=T;N.label=1;case 1:return f.body?[3,3]:[4,np(50)];case 2:return N.sent(),[3,1];case 3:f.body.appendChild(y);try{for(B=0;B<m.length;++B)M[B].offsetParent||(z[m[B]]=!0)}finally{(o=y.parentNode)===null||o===void 0||o.removeChild(y)}return[2,z]}})})}function mv(m){m.style.setProperty("visibility","hidden","important"),m.style.setProperty("display","block","important")}function $8(m,o){for(var f="DOM blockers debug:\n```",y=0,M=Object.keys(m);y<M.length;y++){var z=M[y];f+=`
`.concat(z,":");for(var T=0,s=m[z];T<s.length;T++){var B=s[T];f+=`
  `.concat(o[B]?"ðŸš«":"âž¡ï¸"," ").concat(B)}}console.log("".concat(f,"\n```"))}function G8(){for(var m=0,o=["rec2020","p3","srgb"];m<o.length;m++){var f=o[m];if(matchMedia("(color-gamut: ".concat(f,")")).matches)return f}}function H8(){if(_v("inverted"))return!0;if(_v("none"))return!1}function _v(m){return matchMedia("(inverted-colors: ".concat(m,")")).matches}function W8(){if(gv("active"))return!0;if(gv("none"))return!1}function gv(m){return matchMedia("(forced-colors: ".concat(m,")")).matches}var X8=100;function Y8(){if(matchMedia("(min-monochrome: 0)").matches){for(var m=0;m<=X8;++m)if(matchMedia("(max-monochrome: ".concat(m,")")).matches)return m;throw new Error("Too high value")}}function K8(){if(_c("no-preference"))return 0;if(_c("high")||_c("more"))return 1;if(_c("low")||_c("less"))return-1;if(_c("forced"))return 10}function _c(m){return matchMedia("(prefers-contrast: ".concat(m,")")).matches}function J8(){if(vv("reduce"))return!0;if(vv("no-preference"))return!1}function vv(m){return matchMedia("(prefers-reduced-motion: ".concat(m,")")).matches}function Q8(){if(yv("reduce"))return!0;if(yv("no-preference"))return!1}function yv(m){return matchMedia("(prefers-reduced-transparency: ".concat(m,")")).matches}function ez(){if(xv("high"))return!0;if(xv("standard"))return!1}function xv(m){return matchMedia("(dynamic-range: ".concat(m,")")).matches}var Nn=Math,da=function(){return 0};function tz(){var m=Nn.acos||da,o=Nn.acosh||da,f=Nn.asin||da,y=Nn.asinh||da,M=Nn.atanh||da,z=Nn.atan||da,T=Nn.sin||da,s=Nn.sinh||da,B=Nn.cos||da,N=Nn.cosh||da,Y=Nn.tan||da,K=Nn.tanh||da,ie=Nn.exp||da,H=Nn.expm1||da,me=Nn.log1p||da,ve=function(He){return Nn.pow(Nn.PI,He)},Me=function(He){return Nn.log(He+Nn.sqrt(He*He-1))},Ee=function(He){return Nn.log(He+Nn.sqrt(He*He+1))},Re=function(He){return Nn.log((1+He)/(1-He))/2},ze=function(He){return Nn.exp(He)-1/Nn.exp(He)/2},Fe=function(He){return(Nn.exp(He)+1/Nn.exp(He))/2},Ke=function(He){return Nn.exp(He)-1},rt=function(He){return(Nn.exp(2*He)-1)/(Nn.exp(2*He)+1)},qe=function(He){return Nn.log(1+He)};return{acos:m(.12312423423423424),acosh:o(1e308),acoshPf:Me(1e154),asin:f(.12312423423423424),asinh:y(1),asinhPf:Ee(1),atanh:M(.5),atanhPf:Re(.5),atan:z(.5),sin:T(-1e300),sinh:s(1),sinhPf:ze(1),cos:B(10.000000000123),cosh:N(1),coshPf:Fe(1),tan:Y(-1e300),tanh:K(1),tanhPf:rt(1),exp:ie(1),expm1:H(1),expm1Pf:Ke(1),log1p:me(10),log1pPf:qe(10),powPI:ve(-100)}}var rz="mmMwWLliI0fiflO&1",qf={default:[],apple:[{font:"-apple-system-body"}],serif:[{fontFamily:"serif"}],sans:[{fontFamily:"sans-serif"}],mono:[{fontFamily:"monospace"}],min:[{fontSize:"1px"}],system:[{fontFamily:"system-ui"}]};function nz(){return iz(function(m,o){for(var f={},y={},M=0,z=Object.keys(qf);M<z.length;M++){var T=z[M],s=qf[T],B=s[0],N=B===void 0?{}:B,Y=s[1],K=Y===void 0?rz:Y,ie=m.createElement("span");ie.textContent=K,ie.style.whiteSpace="nowrap";for(var H=0,me=Object.keys(N);H<me.length;H++){var ve=me[H],Me=N[ve];Me!==void 0&&(ie.style[ve]=Me)}f[T]=ie,o.append(m.createElement("br"),ie)}for(var Ee=0,Re=Object.keys(qf);Ee<Re.length;Ee++){var T=Re[Ee];y[T]=f[T].getBoundingClientRect().width}return y})}function iz(m,o){return o===void 0&&(o=4e3),R0(function(f,y){var M=y.document,z=M.body,T=z.style;T.width="".concat(o,"px"),T.webkitTextSizeAdjust=T.textSizeAdjust="none",Lh()?z.style.zoom="".concat(1/y.devicePixelRatio):ho()&&(z.style.zoom="reset");var s=M.createElement("div");return s.textContent=k0([],Array(o/20<<0),!0).map(function(){return"word"}).join(" "),z.appendChild(s),m(M,z)},'<!doctype html><html><head><meta name="viewport" content="width=device-width, initial-scale=1">')}function az(){return navigator.pdfViewerEnabled}function oz(){var m=new Float32Array(1),o=new Uint8Array(m.buffer);return m[0]=1/0,m[0]=m[0]-m[0],o[3]}function sz(){var m=window.ApplePaySession;if(typeof(m==null?void 0:m.canMakePayments)!="function")return-1;if(lz())return-3;try{return m.canMakePayments()?1:0}catch(o){return cz(o)}}var lz=n8;function cz(m){if(m instanceof Error&&m.name==="InvalidAccessError"&&/\bfrom\b.*\binsecure\b/i.test(m.message))return-2;throw m}function uz(){var m,o=document.createElement("a"),f=(m=o.attributionSourceId)!==null&&m!==void 0?m:o.attributionsourceid;return f===void 0?void 0:String(f)}var B0=-1,F0=-2,hz=new Set([10752,2849,2884,2885,2886,2928,2929,2930,2931,2932,2960,2961,2962,2963,2964,2965,2966,2967,2968,2978,3024,3042,3088,3089,3106,3107,32773,32777,32777,32823,32824,32936,32937,32938,32939,32968,32969,32970,32971,3317,33170,3333,3379,3386,33901,33902,34016,34024,34076,3408,3410,3411,3412,3413,3414,3415,34467,34816,34817,34818,34819,34877,34921,34930,35660,35661,35724,35738,35739,36003,36004,36005,36347,36348,36349,37440,37441,37443,7936,7937,7938]),dz=new Set([34047,35723,36063,34852,34853,34854,34229,36392,36795,38449]),pz=["FRAGMENT_SHADER","VERTEX_SHADER"],fz=["LOW_FLOAT","MEDIUM_FLOAT","HIGH_FLOAT","LOW_INT","MEDIUM_INT","HIGH_INT"],O0="WEBGL_debug_renderer_info",mz="WEBGL_polygon_mode";function _z(m){var o,f,y,M,z,T,s=m.cache,B=N0(s);if(!B)return B0;if(!V0(B))return F0;var N=j0()?null:B.getExtension(O0);return{version:((o=B.getParameter(B.VERSION))===null||o===void 0?void 0:o.toString())||"",vendor:((f=B.getParameter(B.VENDOR))===null||f===void 0?void 0:f.toString())||"",vendorUnmasked:N?(y=B.getParameter(N.UNMASKED_VENDOR_WEBGL))===null||y===void 0?void 0:y.toString():"",renderer:((M=B.getParameter(B.RENDERER))===null||M===void 0?void 0:M.toString())||"",rendererUnmasked:N?(z=B.getParameter(N.UNMASKED_RENDERER_WEBGL))===null||z===void 0?void 0:z.toString():"",shadingLanguageVersion:((T=B.getParameter(B.SHADING_LANGUAGE_VERSION))===null||T===void 0?void 0:T.toString())||""}}function gz(m){var o=m.cache,f=N0(o);if(!f)return B0;if(!V0(f))return F0;var y=f.getSupportedExtensions(),M=f.getContextAttributes(),z=[],T=[],s=[],B=[],N=[];if(M)for(var Y=0,K=Object.keys(M);Y<K.length;Y++){var ie=K[Y];T.push("".concat(ie,"=").concat(M[ie]))}for(var H=bv(f),me=0,ve=H;me<ve.length;me++){var Me=ve[me],Ee=f[Me];s.push("".concat(Me,"=").concat(Ee).concat(hz.has(Ee)?"=".concat(f.getParameter(Ee)):""))}if(y)for(var Re=0,ze=y;Re<ze.length;Re++){var Fe=ze[Re];if(!(Fe===O0&&j0()||Fe===mz&&xz())){var Ke=f.getExtension(Fe);if(!Ke){z.push(Fe);continue}for(var rt=0,qe=bv(Ke);rt<qe.length;rt++){var Me=qe[rt],Ee=Ke[Me];B.push("".concat(Me,"=").concat(Ee).concat(dz.has(Ee)?"=".concat(f.getParameter(Ee)):""))}}}for(var He=0,et=pz;He<et.length;He++)for(var De=et[He],tt=0,nt=fz;tt<nt.length;tt++){var Ze=nt[tt],ke=vz(f,De,Ze);N.push("".concat(De,".").concat(Ze,"=").concat(ke.join(",")))}return B.sort(),s.sort(),{contextAttributes:T,parameters:s,shaderPrecisions:N,extensions:y,extensionParameters:B,unsupportedExtensions:z}}function N0(m){if(m.webgl)return m.webgl.context;var o=document.createElement("canvas"),f;o.addEventListener("webglCreateContextError",function(){return f=void 0});for(var y=0,M=["webgl","experimental-webgl"];y<M.length;y++){var z=M[y];try{f=o.getContext(z)}catch{}if(f)break}return m.webgl={context:f},f}function vz(m,o,f){var y=m.getShaderPrecisionFormat(m[o],m[f]);return y?[y.rangeMin,y.rangeMax,y.precision]:[]}function bv(m){var o=Object.keys(m.__proto__);return o.filter(yz)}function yz(m){return typeof m=="string"&&!m.match(/[^A-Z0-9_x]/)}function j0(){return D0()}function xz(){return Lh()||ho()}function V0(m){return typeof m.getParameter=="function"}function bz(){var m=Km()||ho();if(!m)return-2;if(!window.AudioContext)return-1;var o=new AudioContext().baseLatency;return o==null?-1:isFinite(o)?o:-3}function wz(){if(!window.Intl)return-1;var m=window.Intl.DateTimeFormat;if(!m)return-2;var o=m().resolvedOptions().locale;return!o&&o!==""?-3:o}var Tz={fonts:o8,domBlockers:q8,fontPreferences:nz,audio:XE,screenFrame:M8,canvas:l8,osCpu:v8,languages:y8,colorDepth:x8,deviceMemory:b8,screenResolution:w8,hardwareConcurrency:k8,timezone:A8,sessionStorage:z8,localStorage:L8,indexedDB:D8,openDatabase:R8,cpuClass:B8,platform:F8,plugins:s8,touchSupport:g8,vendor:O8,vendorFlavors:N8,cookiesEnabled:j8,colorGamut:G8,invertedColors:H8,forcedColors:W8,monochrome:Y8,contrast:K8,reducedMotion:J8,reducedTransparency:Q8,hdr:ez,math:tz,pdfViewerEnabled:az,architecture:oz,applePay:sz,privateClickMeasurement:uz,audioBaseLatency:bz,dateTimeLocale:wz,webGlBasics:_z,webGlExtensions:gz};function Cz(m){return jE(Tz,m,[])}var Sz="$ if upgrade to Pro: https://fpjs.dev/pro";function Pz(m){var o=Iz(m),f=Mz(o);return{score:o,comment:Sz.replace(/\$/g,"".concat(f))}}function Iz(m){if(Km())return .4;if(ho())return Ym()&&!(Rh()&&Dh())?.5:.3;var o="value"in m.platform?m.platform.value:"";return/^Win/.test(o)?.6:/^Mac/.test(o)?.5:.7}function Mz(m){return z0(.99+.01*m,1e-4)}function kz(m){for(var o="",f=0,y=Object.keys(m).sort();f<y.length;f++){var M=y[f],z=m[M],T="error"in z?"error":JSON.stringify(z.value);o+="".concat(o?"|":"").concat(M.replace(/([:|\\])/g,"\\$1"),":").concat(T)}return o}function q0(m){return JSON.stringify(m,function(o,f){return f instanceof Error?BE(f):f},2)}function Z0(m){return RE(kz(m))}function Az(m){var o,f=Pz(m);return{get visitorId(){return o===void 0&&(o=Z0(this.components)),o},set visitorId(y){o=y},confidence:f,components:m,version:A0}}function Ez(m){return m===void 0&&(m=50),PE(m,m*2)}function zz(m,o){var f=Date.now();return{get:function(y){return Io(this,void 0,void 0,function(){var M,z,T;return Mo(this,function(s){switch(s.label){case 0:return M=Date.now(),[4,m()];case 1:return z=s.sent(),T=Az(z),(o||y!=null&&y.debug)&&console.log("Copy the text below to get the debug data:\n\n```\nversion: ".concat(T.version,`
userAgent: `).concat(navigator.userAgent,`
timeBetweenLoadAndGet: `).concat(M-f,`
visitorId: `).concat(T.visitorId,`
components: `).concat(q0(z),"\n```")),[2,T]}})})}}}function Lz(){if(!(window.__fpjs_d_m||Math.random()>=.001))try{var m=new XMLHttpRequest;m.open("get","https://m1.openfpcdn.io/fingerprintjs/v".concat(A0,"/npm-monitoring"),!0),m.send()}catch(o){console.error(o)}}function Dz(m){var o;return m===void 0&&(m={}),Io(this,void 0,void 0,function(){var f,y,M;return Mo(this,function(z){switch(z.label){case 0:return(!((o=m.monitoring)!==null&&o!==void 0)||o)&&Lz(),f=m.delayFallback,y=m.debug,[4,Ez(f)];case 1:return z.sent(),M=Cz({cache:{},debug:y}),[2,zz(M,y)]}})})}var Rz={load:Dz,hashComponents:Z0,componentsToDebugString:q0};let Zf=null;async function Bz(){return Zf||(Zf=Rz.load()),Zf}async function Fz(){return(await(await Bz()).get()).visitorId}var Oz=Cr('<svg><path d="M200-80q-50 0-85-35t-35-85q0-39 22.5-69.5T160-313v-334q-35-13-57.5-43.5T80-760q0-50 35-85t85-35q39 0 69.5 22.5T313-800h334q12-35 42.5-57.5T760-880q50 0 85 35t35 85q0 40-22.5 70.5T800-647v334q35 13 57.5 43.5T880-200q0 50-35 85t-85 35q-39 0-69.5-22.5T647-160H313q-13 35-43.5 57.5T200-80Zm0-640q17 0 28.5-11.5T240-760q0-17-11.5-28.5T200-800q-17 0-28.5 11.5T160-760q0 17 11.5 28.5T200-720Zm560 0q17 0 28.5-11.5T800-760q0-17-11.5-28.5T760-800q-17 0-28.5 11.5T720-760q0 17 11.5 28.5T760-720ZM313-240h334q9-26 28-45t45-28v-334q-26-9-45-28t-28-45H313q-9 26-28 45t-45 28v334q26 9 45 28t28 45Zm447 80q17 0 28.5-11.5T800-200q0-17-11.5-28.5T760-240q-17 0-28.5 11.5T720-200q0 17 11.5 28.5T760-160Zm-560 0q17 0 28.5-11.5T240-200q0-17-11.5-28.5T200-240q-17 0-28.5 11.5T160-200q0 17 11.5 28.5T200-160Zm0-600Zm560 0Zm0 560Zm-560 0Z"></path></svg>');function Gu(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=Oz();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var Nz=Cr('<svg><path d="M120-120v-190l358-358-58-56 58-56 76 76 124-124q5-5 12.5-8t15.5-3q8 0 15 3t13 8l94 94q5 6 8 13t3 15q0 8-3 15.5t-8 12.5L705-555l76 78-57 57-56-58-358 358H120Zm80-80h78l332-334-76-76-334 332v78Zm447-410 96-96-37-37-96 96 37 37Zm0 0-37-37 37 37Z"></path></svg>');function wv(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=Nz();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var jz=Cr('<svg><path d="m247-904 57-56 343 343q23 23 23 57t-23 57L457-313q-23 23-57 23t-57-23L153-503q-23-23-23-57t23-57l190-191-96-96Zm153 153L209-560h382L400-751Zm360 471q-33 0-56.5-23.5T680-360q0-21 12.5-45t27.5-45q9-12 19-25t21-25q11 12 21 25t19 25q15 21 27.5 45t12.5 45q0 33-23.5 56.5T760-280ZM80 0v-160h800V0H80Z"></path></svg>');function U0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=jz();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var Vz=Cr('<svg><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm240-400v80h80v-80h-80Zm-160 0v80h80v-80h-80Zm80 80v80h80v-80h-80Zm160 0v80h80v-80h-80Zm-320 0v80h80v-80h-80Zm400-80v80h80v80h80v-80h-80v-80h-80ZM280-360v80h-80v80h80v-80h80v80h80v-80h80v80h80v-80h80v80h80v-80h-80v-80h-80v80h-80v-80h-80v80h-80v-80h-80Zm480-160v80-80Zm0 160v80-80Z"></path></svg>'),qz=Cr('<svg><path d="M440-440v-80h80v80h-80Zm-80 80v-80h80v80h-80Zm160 0v-80h80v80h-80Zm80-80v-80h80v80h-80Zm-320 0v-80h80v80h-80Zm-80 320q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm80-80h80v-80h-80v80Zm160 0h80v-80h-80v80Zm320 0v-80 80Zm-560-80h80v-80h80v80h80v-80h80v80h80v-80h80v80h80v-80h-80v-80h80v-320H200v320h80v80h-80v80Zm0 80v-560 560Zm560-240v80-80ZM600-280v80h80v-80h-80Z"></path></svg>');function $0(m,o){let f=ir(o,["$$slots","$$events","$$legacy","filled"]);var y=er(),M=Ct(y);{var z=s=>{var B=Vz();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)},T=s=>{var B=qz();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)};je(M,s=>{o.filled?s(z):s(T,!1)})}G(m,y)}var Zz=Cr('<svg><path d="M240-80q-33 0-56.5-23.5T160-160v-400q0-33 23.5-56.5T240-640h40v-80q0-83 58.5-141.5T480-920q83 0 141.5 58.5T680-720v80h40q33 0 56.5 23.5T800-560v400q0 33-23.5 56.5T720-80H240Zm0-80h480v-400H240v400Zm240-120q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM360-640h240v-80q0-50-35-85t-85-35q-50 0-85 35t-35 85v80ZM240-160v-400 400Z"></path></svg>');function Cm(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=Zz();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var Uz=Cr('<svg><path d="M419-80q-28 0-52.5-12T325-126L107-403l19-20q20-21 48-25t52 11l74 45v-328q0-17 11.5-28.5T340-760q17 0 29 11.5t12 28.5v472l-97-60 104 133q6 7 14 11t17 4h221q33 0 56.5-23.5T720-240v-160q0-17-11.5-28.5T680-440H461v-80h219q50 0 85 35t35 85v160q0 66-47 113T640-80H419ZM167-620q-13-22-20-47.5t-7-52.5q0-83 58.5-141.5T340-920q83 0 141.5 58.5T540-720q0 27-7 52.5T513-620l-69-40q8-14 12-28.5t4-31.5q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 17 4 31.5t12 28.5l-69 40Zm335 280Z"></path></svg>');function G0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=Uz();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var $z=Cr('<svg><path d="m356-160-56-56 180-180 180 180-56 56-124-124-124 124Zm124-404L300-744l56-56 124 124 124-124 56 56-180 180Z"></path></svg>');function Gz(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=$z();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var Hz=Cr('<svg><path d="M480-120 300-300l58-58 122 122 122-122 58 58-180 180ZM358-598l-58-58 180-180 180 180-58 58-122-122-122 122Z"></path></svg>');function Wz(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=Hz();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var Xz=Te("<!> ",1),Yz=Te("<!> ",1),Kz=Te("<!> ",1),Jz=Te('<!><b> </b> <span class="touchscreen:hidden"> <span class="kbd kbd-xs text-base-content rounded-md"> </span></span> ',1),Qz=Te("<!> ",1),eL=Te("<!> <!>",1),tL=(m,o)=>ce(o,!x(o)),rL=(m,o)=>{ce(o,"colorpicker")},nL=(m,o)=>{o(!o())},iL=(m,o)=>{ce(o,"cleararea")},aL=Te('<div class="tooltip ml-1"><div class="tooltip-content"> <kbd class="kbd kbd-xs text-base-content touchscreen:hidden ml-0.5 rounded-md">C</kbd></div> <button><!></button></div>'),oL=(m,o)=>{aa.smallPlop.play(),o()},sL=(m,o,f)=>{o(x(f).idx)},lL=Te('<!> <span class="bg-base-100 translate-1/2 absolute bottom-0 right-0 flex size-5 items-center justify-center rounded-full max-sm:hidden"><!></span>',1),cL=Te("<div><button><!></button></div>"),uL=(m,o)=>{ce(o,!x(o))},hL=(m,o)=>{ce(o,x(o)==="eraser"?"pencil":"eraser",!0)},dL=Te('<div class="relative px-3"><!> <div class="flex items-center gap-1.5"><button class="btn btn-circle btn-sm btn-soft"><!></button> <div class="flex grow items-center gap-1"><h2 class="select-none text-xl"> <!></h2> <div class="tooltip ml-1"><div class="tooltip-content"> <kbd class="kbd kbd-xs text-base-content touchscreen:hidden ml-0.5 rounded-md">I</kbd></div> <button><!></button></div> <div class="tooltip"><button title="Toggle art opacity"><!></button></div> <!></div> <button class="btn btn-circle btn-sm"><!></button></div> <div class="mb-4 mt-3"><div></div></div> <div class="relative h-12 sm:h-14"><button class="btn btn-lg btn-square sm:btn-xl absolute bottom-0 left-0 shadow-md"><!></button> <div class="absolute bottom-0 left-1/2 -translate-x-1/2"><!></div> <div class="absolute bottom-0 right-0"><div class="tooltip ml-auto"><div class="tooltip-content not-touchscreen:-translate-x-[10%]"> <kbd class="kbd kbd-xs text-base-content touchscreen:hidden ml-0.5 rounded-md">E</kbd></div> <button><!></button></div></div></div></div> <!>',1);function pL(m,o){Br(o,!0);let f=Lt(o,"screenLocked",15),y=Lt(o,"opaquePixelArt",15);const M=ft(()=>new fl(o.tileSize));let z=ct(1),T=ct("pencil");const s=new Map,B=new Map;let N=ct(0),Y=ct(!1),K=ct(!0),ie=ft(()=>kt.charges??0),H=ft(()=>x(ie)-x(N)),me=ct(!1),ve=!1,Me=ct(!1),Ee=ct(xi([]));const Re=ft(()=>x(T)==="pencil"),ze=ft(()=>x(T)==="eraser"),Fe=ft(()=>x(T)==="colorpicker"),Ke=ft(()=>x(T)==="cleararea"),rt=ft(()=>{var _t,Ge;return xc((Ge=(_t=kt)==null?void 0:_t.data)==null?void 0:Ge.role,["admin","global_moderator"])});let qe=ct(!1),He=ct(0),et=ct(void 0),De=ct(void 0);const tt=[1,2,3,32,4,5,6,33,7,34,35,8,9,10,11,37,38,39,40,41,42,12,13,14,15,16,17,43,20,44,18,19,45,46,21,22,47,48,49,23,24,25,26,27,28,53,54,55,29,30,50,56,57,36,51,31,52,61,62,63,58,59,60,0].map(_t=>({...Hi.colors[_t],idx:_t})),nt=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0].map(_t=>({...Hi.colors[_t],idx:_t}));let Ze=ct(!1);const ke=ft(()=>x(Ze)?tt:nt),bt="show-all-colors";Dn(()=>{ce(Ze,localStorage.getItem(bt)==="true")}),Wr(()=>{localStorage.setItem(bt,x(Ze)?"true":"false")});const te="selected-color";Dn(()=>{const _t=Number(localStorage.getItem(te));!isNaN(_t)&&_t<Hi.colors.length&&_t>0&&ce(z,_t,!0)}),Wr(()=>{localStorage.setItem(te,x(z).toString())});const re=new lE({map:o.map,tileSize:o.tileSize,tileZoom:o.tileZoom,beforeLayerId:o.hoverLayerId});Wr(()=>{const _t=y()?1:0;re.setCanvasOpacity(_t)}),Wr(()=>{y()?Gf():ut([...s.values()])});let ge=!1;Dn(()=>{Co(o.map.getCenter(),o.map.getZoom());const _t=o.map.on("click",dr=>{var tn;o.zoom<o.tileZoom+2&&((tn=kt.data)==null?void 0:tn.role)==="user"&&o.map.easeTo({center:dr.lngLat,zoom:17});const In=[dr.lngLat.lat,dr.lngLat.lng];if(x(Re))Ae([In],x(z));else if(x(ze))Ne([In]);else if(x(Fe))pt(In,dr.point);else if(x(Ke)&&(x(Ee).push(In),Ae([In],0),x(Ee).length>=2)){const[Qr,ma]=x(Ee),[di,Xi]=x(M).latLonToPixelsFloor(Qr[0],Qr[1],o.tileZoom),[Zn,ni]=x(M).latLonToPixelsFloor(ma[0],ma[1],o.tileZoom),qi=Math.min(di,Zn),Yi=Math.max(di,Zn),Ei=Math.min(Xi,ni),zi=Math.max(Xi,ni),Ki=[];for(let oa=Ei;oa<=zi;oa++){const Ta=x(M).pixelsToLatLon(qi+.5,oa+.5,o.tileZoom),xt=x(M).pixelsToLatLon(Yi+.5,oa+.5,o.tileZoom),Wt=Ge({lat:Ta[0],lng:Ta[1]},{lat:xt[0],lng:xt[1]}).slice(0,x(H)-Ki.length);if(Ki.push(...Wt),Ki.length>=x(H))break}Ae(Ki,0),ce(Ee,[],!0),ce(T,"pencil")}ce(me,!0)});function Ge(dr,In){const tn=x(M).latLonToPixels(dr.lat,dr.lng,o.tileZoom),Qr=In?x(M).latLonToPixels(In.lat,In.lng,o.tileZoom):tn;return Lx(tn,Qr).map(di=>x(M).pixelsToLatLon(di[0]+.5,di[1]+.5,o.tileZoom))}function At(dr,In){const tn=Ge(dr,In);x(Re)?Ae(tn,x(z)):x(ze)&&Ne(tn),ce(me,!0)}let Rt;function Yt(dr){const In=o.map.unproject([dr.clientX,dr.clientY]);if(x(Me)){const tn=Ge(In,Rt);Ne(tn)}(ge||ve)&&At(In,Rt),Rt=In}window.addEventListener("mousemove",Yt);let br=!1;const Er=o.map.on("touchstart",dr=>{if(dr.points.length==2){f(!1),dt(),br=!0,setTimeout(()=>br=!1,150);return}f()&&setTimeout(()=>{!br&&At(dr.lngLat)},150),Rt=dr.lngLat}),ur=o.map.on("touchmove",dr=>{f()&&At(dr.lngLat,Rt),Rt=dr.lngLat}),rn=dr=>{dr.code==="Space"&&(ge||Rt&&At(Rt),ge=!0,dr.preventDefault())};document.addEventListener("keydown",rn);const pn=dr=>{dr.code==="Space"&&(ge=!1,oe=!1,x(N)===0&&x(ze)&&ce(T,"pencil"))};document.addEventListener("keyup",pn);function _n(dr){if(dr.button===2){ce(Me,!0);const tn=o.map.unproject([dr.clientX,dr.clientY]);Ne([[tn.lat,tn.lng]])}}document.addEventListener("mousedown",_n);function sn(dr){dr.button===2&&ce(Me,!1)}document.addEventListener("mouseup",sn);const En=dr=>{switch(dr.code){case"KeyE":x(N)>0&&(x(ze)?ce(T,"pencil"):ce(T,"eraser"));return;case"KeyI":ce(T,"colorpicker");return;case"KeyC":x(rt)&&ce(T,"cleararea");return}};return document.addEventListener("keypress",En),()=>{ur.unsubscribe(),Er.unsubscribe(),_t.unsubscribe(),document.removeEventListener("mousemove",Yt),document.removeEventListener("keydown",rn),document.removeEventListener("keyup",pn),document.removeEventListener("keypress",En),document.removeEventListener("mousedown",_n),document.removeEventListener("mouseup",sn),St()}});let oe=!1;function Ae(_t,Ge){let At=!1;const Rt=Ge===0;for(let Yt of _t){const[br,Er]=Yt,ur=kx(Ge),{tile:rn,pixel:pn}=x(M).latLonToTileAndPixel(br,Er,o.tileZoom),_n={color:ur,tile:rn,pixel:pn,season:o.season,colorIdx:Ge},sn=Lf(_n),En=s.get(sn),dr=x(ie)-s.size;if(!En&&dr<1){if(oe&&(ge||f()))continue;oe=!0,Nr.info(XC());continue}En&&En.colorIdx===Ge||(aa.plop.play(),At||o.hidePixelHover(),s.set(sn,_n),re.place(Yt,Ge),o.crosshair.place(Yt),At=!0,Rt&&B.set(sn,_n))}ce(N,s.size,!0),At&&!y()?ut([...s.values()]):At&&y()&&Rt&&ut([...B.values()])}function Ne(_t){let Ge=!1,At=!1;for(let Rt of _t){const[Yt,br]=Rt,{tile:Er,pixel:ur}=x(M).latLonToTileAndPixel(Yt,br,o.tileZoom),rn=Lf({tile:Er,pixel:ur,season:o.season}),pn=s.get(rn);pn&&(aa.plop.play(),o.hidePixelHover(),s.delete(rn),B.delete(rn),re.remove([Yt,br]),o.crosshair.remove(Rt),Ge=!0,pn.colorIdx===0&&(At=!0)),s.size===0&&!(ge||ve||f())&&ce(T,"pencil")}ce(N,s.size,!0),Ge&&!y()?ut([...s.values()]):Ge&&y()&&At&&ut([...B.values()])}function pt(_t,Ge){const{tile:At,pixel:Rt}=x(M).latLonToTileAndPixel(_t[0],_t[1],o.tileZoom),Yt=Lf({tile:At,pixel:Rt,season:o.season}),br=s.get(Yt);if(br){vt(br.colorIdx),requestAnimationFrame(()=>{var pn;(pn=document.getElementById(`color-${br.colorIdx}`))==null||pn.focus()});return}const Er=window.devicePixelRatio,ur=Math.floor(Ge.x*Er),rn=Math.floor(Ge.y*Er);o.hidePixelHover(),fM(o.map,ur,rn).then(([pn,_n,sn])=>{const En=Ax({r:pn,g:_n,b:sn});vt(En),requestAnimationFrame(()=>{var dr;(dr=document.getElementById(`color-${En}`))==null||dr.focus()})})}dl(()=>x(z),()=>{o.clickedLatLon&&!x(me)&&(x(z)===void 0&&ce(z,1),Ae([o.clickedLatLon],x(z)))}),Wr(()=>{const _t=x(K)?.8:0;o.crosshair.setCanvasOpacity(_t)});let ot=ct(16.5);Wr(()=>{if(x(et)&&x(De)&&o.clickedLatLon){const _t=o.map.getZoom();if(_t<x(ot)){const[Ge,At]=o.clickedLatLon,Rt=x(M).latLonToPixelBoundsLatLon(Ge,At,o.tileZoom),Yt=Vm(Rt),br=x(et)-x(De).clientHeight,Er=x(et)/2-br/2;o.map.flyTo({center:{lat:Yt[0],lng:Yt[1]},zoom:17.5,offset:_t>11?[0,-Er]:[0,0]})}ce(ot,o.tileZoom,!0)}}),Dn(()=>{const _t=()=>{!document.hidden&&(console.log("Tab visible again"),y()?ut([...B.values()]):ut([...s.values()]))};return document.addEventListener("visibilitychange",_t),()=>document.removeEventListener("visibilitychange",_t)}),Wr(()=>{switch(x(T)){case"pencil":o.map.getCanvas().style.cursor=`url('${oE}') 8 8, default`,o.map.setPaintProperty(o.hoverLayerId,"raster-opacity",.4);return;case"colorpicker":o.map.getCanvas().style.cursor=`url('${iE}') 0 16, default`,o.map.setPaintProperty(o.hoverLayerId,"raster-opacity",0);return;case"eraser":o.map.getCanvas().style.cursor=`url('${aE}') 2 14, default`,o.map.setPaintProperty(o.hoverLayerId,"raster-opacity",.4);return}}),Wr(()=>{f()?at():dt()});async function ut(_t){await mx(_t),o.refreshPixelArt()}async function St(){await Gf(),re.clear(),o.refreshPixelArt(),o.crosshair.clear()}async function Bt(){await St(),dt(),o.map.getCanvas().style.cursor="default",o.map.setPaintProperty(o.hoverLayerId,"raster-opacity",.4),o.onclose()}function at(){o.map.dragPan.disable(),o.map.touchZoomRotate.disable(),document.body.style.overscrollBehavior="none"}function dt(){o.map.dragPan.enable(),o.map.touchZoomRotate.enable(),document.body.style.overscrollBehavior=""}function vt(_t){return _t>=32&&ce(Ze,!0),kt.hasColor(_t)?(aa.smallDropplet.play(),ce(z,_t,!0),ce(T,"pencil"),!0):(aa.smallDropplet.play(),ce(qe,!0),ce(He,_t,!0),!1)}nx(_t=>{_t.type==="leave"&&x(N)>0&&_t.cancel()});const yt="show-paint-more-than-one-pixel-msg";let It=ct(!1);Dn(()=>{var _t;ce(It,!localStorage.getItem(yt)&&(((_t=kt.data)==null?void 0:_t.pixelsPainted)??0)<100,!0)}),Wr(()=>{x(N)>1&&(ce(It,!1),localStorage.setItem(yt,"false"))});const wt="lp";Dn(()=>{var Ge;const _t=localStorage.getItem(wt);if(_t)try{const At=JSON.parse(atob(_t)),Rt=(At==null?void 0:At.time)??0,Yt=60*1e3;(At==null?void 0:At.userId)!==((Ge=kt.data)==null?void 0:Ge.id)&&Date.now()-Rt<30*Yt&&!Wx&&(Nr.error(JC()),Bt())}catch(At){console.error(At)}});function mt(){var Ge;const _t=btoa(JSON.stringify({userId:(Ge=kt.data)==null?void 0:Ge.id,time:Date.now()}));localStorage.setItem(wt,_t)}var Dt=dL(),zt=Ct(Dt),qt=E(zt);{var tr=_t=>{al(_t,{children:(Ge,At)=>{var Rt=Xz(),Yt=Ct(Rt);U0(Yt,{class:"inline size-5"});var br=q(Yt);Ye(Er=>fe(br,` ${Er??""}`),[()=>I5()]),G(Ge,Rt)},$$slots:{default:!0}})},Qt=_t=>{var Ge=er(),At=Ct(Ge);{var Rt=br=>{al(br,{class:"not-touchscreen:hidden",children:(Er,ur)=>{var rn=Yz(),pn=Ct(rn);Hg(pn,{class:"inline size-5"});var _n=q(pn);Ye(sn=>fe(_n,` ${sn??""}`),[()=>A5()]),G(Er,rn)},$$slots:{default:!0}})},Yt=br=>{var Er=er(),ur=Ct(Er);{var rn=_n=>{al(_n,{class:"not-touchscreen:hidden",children:(sn,En)=>{var dr=Kz(),In=Ct(dr);wv(In,{class:"inline size-5"});var tn=q(In,1,!0);Ye(Qr=>fe(tn,Qr),[()=>L5()]),G(sn,dr)},$$slots:{default:!0}})},pn=_n=>{var sn=er(),En=Ct(sn);{var dr=tn=>{al(tn,{class:"touchscreen:hidden",children:(Qr,ma)=>{var di=Jz(),Xi=Ct(di);G0(Xi,{class:"inline size-5"});var Zn=q(Xi),ni=E(Zn,!0);k(Zn);var qi=q(Zn,2),Yi=E(qi),Ei=q(Yi),zi=E(Ei,!0);k(Ei),k(qi);var Ki=q(qi);Ye((oa,Ta,xt,Wt)=>{fe(ni,oa),fe(Yi,`${Ta??""} `),fe(zi,xt),fe(Ki,` ${Wt??""}`)},[()=>B5(),()=>q5(),()=>N5(),()=>$5()]),G(Qr,di)},$$slots:{default:!0}})},In=tn=>{var Qr=er(),ma=Ct(Qr);{var di=Zn=>{al(Zn,{class:"bg-warning text-warning-content animate-bounce",children:(ni,qi)=>{var Yi=Qz(),Ei=Ct(Yi);Eh(Ei,{class:"inline size-5"});var zi=q(Ei);Ye(Ki=>fe(zi,` ${Ki??""}`),[()=>W5()]),G(ni,Yi)},$$slots:{default:!0}})},Xi=Zn=>{var ni=er(),qi=Ct(ni);{var Yi=Ei=>{al(Ei,{class:"bg-warning text-warning-content animate-bounce",children:(zi,Ki)=>{var oa=eL(),Ta=Ct(oa);Gu(Ta,{class:"inline size-5"});var xt=q(Ta,2);{var Wt=yn=>{var On=bi();Ye(Xn=>fe(On,Xn),[()=>Jv()]),G(yn,On)},Rr=yn=>{var On=er(),Xn=Ct(On);{var Vn=wn=>{var Ji=bi();Ye(sr=>fe(Ji,sr),[()=>Qv()]),G(wn,Ji)};je(Xn,wn=>{x(Ee).length===1&&wn(Vn)},!0)}G(yn,On)};je(xt,yn=>{x(Ee).length===0?yn(Wt):yn(Rr,!1)})}G(zi,oa)},$$slots:{default:!0}})};je(qi,Ei=>{x(Ke)&&Ei(Yi)},!0)}G(Zn,ni)};je(ma,Zn=>{x(It)?Zn(di):Zn(Xi,!1)},!0)}G(tn,Qr)};je(En,tn=>{x(Re)&&x(N)===0?tn(dr):tn(In,!1)},!0)}G(_n,sn)};je(ur,_n=>{x(Fe)?_n(rn):_n(pn,!1)},!0)}G(br,Er)};je(At,br=>{x(ze)?br(Rt):br(Yt,!1)},!0)}G(_t,Ge)};je(qt,_t=>{x(ze)&&x(N)===0?_t(tr):_t(Qt,!1)})}var Ot=q(qt,2),fr=E(Ot);fr.__click=[tL,K];var kr=E(fr);{var Ar=_t=>{hE(_t,{class:"size-4"})},rr=_t=>{pE(_t,{class:"size-4"})};je(kr,_t=>{x(K)?_t(Ar):_t(rr,!1)})}k(fr);var Kt=q(fr,2),or=E(Kt),Sr=E(or),Dr=q(Sr);I0(Dr,{class:"inline",fontSize:14,get value(){return`(${x(N)??""})`},mono:!0}),k(or);var Zr=q(or,2),se=E(Zr),j=E(se);vn(),k(se);var Z=q(se,2);Z.__click=[rL,T];var X=E(Z);wv(X,{class:"size-4.5"}),k(Z),k(Zr);var ae=q(Zr,2),de=E(ae);let Se;de.__click=[nL,y];var Ie=E(de);{let _t=ft(()=>!y());$0(Ie,{class:"size-4.5",get filled(){return x(_t)}})}k(de),k(ae);var be=q(ae,2);{var Oe=_t=>{var Ge=aL(),At=E(Ge),Rt=E(At);vn(),k(At);var Yt=q(At,2);Yt.__click=[iL,T];var br=E(Yt);Gu(br,{class:"size-4.5"}),k(Yt),k(Ge),Ye(Er=>{fe(Rt,`${Er??""} `),zr(Yt,1,Ko({"btn btn-circle btn-sm":!0,"btn-ghost":!x(Ke),"btn-primary":x(Ke)}))},[()=>KP()]),G(_t,Ge)};je(be,_t=>{x(rt)&&_t(Oe)})}k(Kt);var st=q(Kt,2);st.__click=[oL,Bt];var $e=E(st);_l($e,{class:"size-4"}),k(st),k(Ot);var Mt=q(Ot,2),xe=E(Mt);hi(xe,23,()=>x(ke),_t=>_t.idx,(_t,Ge,At)=>{const Rt=ft(()=>{const[sn,En,dr]=x(Ge).rgb;return{r:sn,g:En,b:dr}}),Yt=ft(()=>x(z)===x(Ge).idx&&x(Re)),br=ft(()=>x(Ge).idx===0),Er=ft(()=>kt.hasColor(x(Ge).idx));var ur=cL(),rn=E(ur);rn.__click=[sL,vt,Ge];var pn=E(rn);{var _n=sn=>{var En=lL(),dr=Ct(En);Cm(dr,{class:"center-absolute absolute size-4 opacity-30 sm:hidden sm:size-6"});var In=q(dr,2),tn=E(In);Cm(tn,{class:"text-base-content/80 size-4"}),k(In),G(sn,En)};je(pn,sn=>{x(Er)||sn(_n)})}k(rn),k(ur),Ye(()=>{zr(ur,1,Ko({tooltip:!0,"max-sm:h-6":x(Ze),"max-sm:before:translate-x-1/4":x(At)%8===0&&x(Ge).name.length>7,"max-sm:before:-translate-x-1/4":(x(At)-7)%8===0&&x(Ge).name.length>7,"max-xl:before:translate-x-1/4":x(At)%16===0&&x(Ge).name.length>7,"max-xl:before:-translate-x-1/4":(x(At)-15)%16===0&&x(Ge).name.length>7,"xl:before:translate-x-1/4":x(Ze)&&x(At)%32===0&&x(Ge).name.length>7,"xl:before:-translate-x-1/4":x(Ze)&&(x(At)-31)%32===0&&x(Ge).name.length>7})),xr(ur,"data-tip",x(Ge).name),zr(rn,1,Ko({"btn relative aspect-square w-full rounded-xl":!0,"border-primary ring-primary ring-2":x(Yt),"border-base-300":!x(Yt)&&x(br),"border-base-content/20":!x(Yt)&&!x(br),"max-sm:h-6 max-sm:rounded-md":x(Ze)})),kc(rn,x(br)?`background-image: url(${sE}); background-size: cover; image-rendering: pixelated;`:`background: rgb(${x(Rt).r} ${x(Rt).g} ${x(Rt).b})`),xr(rn,"aria-label",x(Ge).name),xr(rn,"id",`color-${x(Ge).idx??""}`)}),Ai("focus",rn,()=>{x(Er)&&(ce(z,x(Ge).idx,!0),ce(T,"pencil"))}),G(_t,ur)}),k(xe),k(Mt);var Ft=q(Mt,2),cr=E(Ft);cr.__click=[uL,Ze];var Jt=E(cr);{var Tr=_t=>{Gz(_t,{class:"size-5"})},Xr=_t=>{Wz(_t,{class:"size-5"})};je(Jt,_t=>{x(Ze)?_t(Tr):_t(Xr,!1)})}k(cr);var dn=q(cr,2),xn=E(dn);{let _t=ft(()=>x(N)>100?"animate-pulse":""),Ge=ft(()=>x(N)===0||x(Y)||x(H)<0||!ai.captcha),At=ft(()=>x(Y)||!ai.captcha);M0(xn,{get class(){return x(_t)},get charges(){return x(H)},get disabled(){return x(Ge)},get loading(){return x(At)},onclick:async()=>{var br;const Rt=(br=ai.captcha)==null?void 0:br.token;if(!Rt)return;aa.droppletAndPlop.play();const Yt=[...s.values()];ce(Y,!0);try{const Er=await Fz();await en.paint(Yt,Rt,Er),await _x(Yt),mt(),kt.refresh(),Xd.shouldReload=!0,await Bt()}catch(Er){Nr.error(`${Er.message}`,{duration:7e3})}finally{ce(Y,!1),ai.captcha=void 0}}})}k(dn);var mn=q(dn,2),jt=E(mn),Et=E(jt),hr=E(Et);vn(),k(Et);var ht=q(Et,2);let Hr;ht.__click=[hL,T];var Yr=E(ht);Hg(Yr,{class:"size-5",get filled(){return x(ze)}}),k(ht),k(jt),k(mn),k(Ft),k(zt),Po(zt,_t=>ce(De,_t),()=>x(De));var qr=q(zt,2);CE(qr,{get colorIdx(){return x(He)},get open(){return x(qe)},set open(_t){ce(qe,_t,!0)}}),Ye((_t,Ge,At,Rt,Yt,br)=>{fe(Sr,`${_t??""} `),fe(j,`${Ge??""} `),zr(Z,1,Ko({"btn btn-circle btn-sm":!0,"btn-ghost":!x(Fe),"btn-primary":x(Fe)})),xr(ae,"data-tip",At),Se=zr(de,1,"btn btn-sm btn-circle btn-ghost text-base-content/80",null,Se,Rt),zr(xe,1,Ko({"md:grid-cols-16 min-[100rem]:grid-cols-32 grid grid-cols-8":!0,"xl:grid-cols-32 sm:grid-cols-16 gap-0.5 sm:gap-1":x(Ze),"gap-1":!x(Ze)})),fe(hr,`${Yt??""} `),Hr=zr(ht,1,"btn btn-lg btn-square sm:btn-xl shadow-md",null,Hr,br),ht.disabled=x(N)===0},[()=>K5(),()=>e3(),()=>Uv(),()=>({"text-primary":!y()}),()=>Dx(),()=>({"btn-primary":x(ze)})]),fp("innerHeight",_t=>ce(et,_t,!0)),G(m,Dt),Fr()}Qn(["click"]);function Jm(...m){return Lv(Ou(m))}var fL=Te("<div><!></div>");function mL(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=ir(o,["$$slots","$$events","$$legacy","ref","class","children"]);var M=fL();ar(M,T=>({class:T,...y}),[()=>Jm("flex items-center",o.class)]);var z=E(M);oi(z,()=>o.children??pa),k(M),Po(M,T=>f(T),()=>f()),G(m,M),Fr()}var _L=Te('<div class="pointer-events-none absolute inset-0 flex items-center justify-center"><div class="animate-caret-blink bg-base-content/80 h-4 w-px duration-1000"></div></div>'),gL=Te(" <!>",1);function vL(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=ir(o,["$$slots","$$events","$$legacy","ref","cell","class"]);var M=er(),z=Ct(M);{let T=ft(()=>Jm("border-input relative flex size-12 items-center justify-center border-y border-r text-xl transition-all first:rounded-l-md first:border-l last:rounded-r-md",o.cell.isActive&&"ring-base-content/40 z-10 ring-2",o.class));yi(z,()=>Qk,(s,B)=>{B(s,Ps({get cell(){return o.cell},get class(){return x(T)}},()=>y,{get ref(){return f()},set ref(N){f(N)},children:(N,Y)=>{vn();var K=gL(),ie=Ct(K),H=q(ie);{var me=ve=>{var Me=_L();G(ve,Me)};je(H,ve=>{o.cell.hasFakeCaret&&ve(me)})}Ye(()=>fe(ie,`${o.cell.char??""} `)),G(N,K)},$$slots:{default:!0}}))})}G(m,M),Fr()}function yL(m,o){Br(o,!0);let f=Lt(o,"ref",15,null),y=Lt(o,"value",15,""),M=ir(o,["$$slots","$$events","$$legacy","ref","class","value"]);var z=er(),T=Ct(z);{let s=ft(()=>Jm("flex items-center gap-2 has-[:disabled]:opacity-50 [&_input]:disabled:cursor-not-allowed",o.class));yi(T,()=>Kk,(B,N)=>{N(B,Ps({get class(){return x(s)}},()=>M,{get ref(){return f()},set ref(Y){f(Y)},get value(){return y()},set value(Y){y(Y)}}))})}G(m,z),Fr()}var Uf={exports:{}},Tv;function xL(){return Tv||(Tv=1,(function(m){(function(o){m.exports?m.exports=o():window.intlTelInput=o()})(()=>{var o=(()=>{var f=Object.defineProperty,y=Object.getOwnPropertyDescriptor,M=Object.getOwnPropertyNames,z=Object.prototype.hasOwnProperty,T=(te,re)=>{for(var ge in re)f(te,ge,{get:re[ge],enumerable:!0})},s=(te,re,ge,oe)=>{if(re&&typeof re=="object"||typeof re=="function")for(let Ae of M(re))!z.call(te,Ae)&&Ae!==ge&&f(te,Ae,{get:()=>re[Ae],enumerable:!(oe=y(re,Ae))||oe.enumerable});return te},B=te=>s(f({},"__esModule",{value:!0}),te),N={};T(N,{Iti:()=>nt,default:()=>bt});var Y=[["af","93"],["ax","358",1],["al","355"],["dz","213"],["as","1",5,["684"]],["ad","376"],["ao","244"],["ai","1",6,["264"]],["ag","1",7,["268"]],["ar","54"],["am","374"],["aw","297"],["ac","247"],["au","61",0,null,"0"],["at","43"],["az","994"],["bs","1",8,["242"]],["bh","973"],["bd","880"],["bb","1",9,["246"]],["by","375"],["be","32"],["bz","501"],["bj","229"],["bm","1",10,["441"]],["bt","975"],["bo","591"],["ba","387"],["bw","267"],["br","55"],["io","246"],["vg","1",11,["284"]],["bn","673"],["bg","359"],["bf","226"],["bi","257"],["kh","855"],["cm","237"],["ca","1",1,["204","226","236","249","250","263","289","306","343","354","365","367","368","382","387","403","416","418","428","431","437","438","450","584","468","474","506","514","519","548","579","581","584","587","604","613","639","647","672","683","705","709","742","753","778","780","782","807","819","825","867","873","879","902","905"]],["cv","238"],["bq","599",1,["3","4","7"]],["ky","1",12,["345"]],["cf","236"],["td","235"],["cl","56"],["cn","86"],["cx","61",2,["89164"],"0"],["cc","61",1,["89162"],"0"],["co","57"],["km","269"],["cg","242"],["cd","243"],["ck","682"],["cr","506"],["ci","225"],["hr","385"],["cu","53"],["cw","599",0],["cy","357"],["cz","420"],["dk","45"],["dj","253"],["dm","1",13,["767"]],["do","1",2,["809","829","849"]],["ec","593"],["eg","20"],["sv","503"],["gq","240"],["er","291"],["ee","372"],["sz","268"],["et","251"],["fk","500"],["fo","298"],["fj","679"],["fi","358",0],["fr","33"],["gf","594"],["pf","689"],["ga","241"],["gm","220"],["ge","995"],["de","49"],["gh","233"],["gi","350"],["gr","30"],["gl","299"],["gd","1",14,["473"]],["gp","590",0],["gu","1",15,["671"]],["gt","502"],["gg","44",1,["1481","7781","7839","7911"],"0"],["gn","224"],["gw","245"],["gy","592"],["ht","509"],["hn","504"],["hk","852"],["hu","36"],["is","354"],["in","91"],["id","62"],["ir","98"],["iq","964"],["ie","353"],["im","44",2,["1624","74576","7524","7924","7624"],"0"],["il","972"],["it","39",0],["jm","1",4,["876","658"]],["jp","81"],["je","44",3,["1534","7509","7700","7797","7829","7937"],"0"],["jo","962"],["kz","7",1,["33","7"],"8"],["ke","254"],["ki","686"],["xk","383"],["kw","965"],["kg","996"],["la","856"],["lv","371"],["lb","961"],["ls","266"],["lr","231"],["ly","218"],["li","423"],["lt","370"],["lu","352"],["mo","853"],["mg","261"],["mw","265"],["my","60"],["mv","960"],["ml","223"],["mt","356"],["mh","692"],["mq","596"],["mr","222"],["mu","230"],["yt","262",1,["269","639"],"0"],["mx","52"],["fm","691"],["md","373"],["mc","377"],["mn","976"],["me","382"],["ms","1",16,["664"]],["ma","212",0,null,"0"],["mz","258"],["mm","95"],["na","264"],["nr","674"],["np","977"],["nl","31"],["nc","687"],["nz","64"],["ni","505"],["ne","227"],["ng","234"],["nu","683"],["nf","672"],["kp","850"],["mk","389"],["mp","1",17,["670"]],["no","47",0],["om","968"],["pk","92"],["pw","680"],["ps","970"],["pa","507"],["pg","675"],["py","595"],["pe","51"],["ph","63"],["pl","48"],["pt","351"],["pr","1",3,["787","939"]],["qa","974"],["re","262",0,null,"0"],["ro","40"],["ru","7",0,null,"8"],["rw","250"],["ws","685"],["sm","378"],["st","239"],["sa","966"],["sn","221"],["rs","381"],["sc","248"],["sl","232"],["sg","65"],["sx","1",21,["721"]],["sk","421"],["si","386"],["sb","677"],["so","252"],["za","27"],["kr","82"],["ss","211"],["es","34"],["lk","94"],["bl","590",1],["sh","290"],["kn","1",18,["869"]],["lc","1",19,["758"]],["mf","590",2],["pm","508"],["vc","1",20,["784"]],["sd","249"],["sr","597"],["sj","47",1,["79"]],["se","46"],["ch","41"],["sy","963"],["tw","886"],["tj","992"],["tz","255"],["th","66"],["tl","670"],["tg","228"],["tk","690"],["to","676"],["tt","1",22,["868"]],["tn","216"],["tr","90"],["tm","993"],["tc","1",23,["649"]],["tv","688"],["ug","256"],["ua","380"],["ae","971"],["gb","44",0,null,"0"],["us","1",0],["uy","598"],["vi","1",24,["340"]],["uz","998"],["vu","678"],["va","39",1,["06698"]],["ve","58"],["vn","84"],["wf","681"],["eh","212",1,["5288","5289"],"0"],["ye","967"],["zm","260"],["zw","263"]],K=[];for(let te=0;te<Y.length;te++){const re=Y[te];K[te]={name:"",iso2:re[0],dialCode:re[1],priority:re[2]||0,areaCodes:re[3]||null,nodeById:{},nationalPrefix:re[4]||null}}var ie=K,H={ad:"Andorra",ae:"United Arab Emirates",af:"Afghanistan",ag:"Antigua & Barbuda",ai:"Anguilla",al:"Albania",am:"Armenia",ao:"Angola",ar:"Argentina",as:"American Samoa",at:"Austria",au:"Australia",aw:"Aruba",ax:"Ã…land Islands",az:"Azerbaijan",ba:"Bosnia & Herzegovina",bb:"Barbados",bd:"Bangladesh",be:"Belgium",bf:"Burkina Faso",bg:"Bulgaria",bh:"Bahrain",bi:"Burundi",bj:"Benin",bl:"St. BarthÃ©lemy",bm:"Bermuda",bn:"Brunei",bo:"Bolivia",bq:"Caribbean Netherlands",br:"Brazil",bs:"Bahamas",bt:"Bhutan",bw:"Botswana",by:"Belarus",bz:"Belize",ca:"Canada",cc:"Cocos (Keeling) Islands",cd:"Congo - Kinshasa",cf:"Central African Republic",cg:"Congo - Brazzaville",ch:"Switzerland",ci:"CÃ´te dâ€™Ivoire",ck:"Cook Islands",cl:"Chile",cm:"Cameroon",cn:"China",co:"Colombia",cr:"Costa Rica",cu:"Cuba",cv:"Cape Verde",cw:"CuraÃ§ao",cx:"Christmas Island",cy:"Cyprus",cz:"Czechia",de:"Germany",dj:"Djibouti",dk:"Denmark",dm:"Dominica",do:"Dominican Republic",dz:"Algeria",ec:"Ecuador",ee:"Estonia",eg:"Egypt",eh:"Western Sahara",er:"Eritrea",es:"Spain",et:"Ethiopia",fi:"Finland",fj:"Fiji",fk:"Falkland Islands",fm:"Micronesia",fo:"Faroe Islands",fr:"France",ga:"Gabon",gb:"United Kingdom",gd:"Grenada",ge:"Georgia",gf:"French Guiana",gg:"Guernsey",gh:"Ghana",gi:"Gibraltar",gl:"Greenland",gm:"Gambia",gn:"Guinea",gp:"Guadeloupe",gq:"Equatorial Guinea",gr:"Greece",gt:"Guatemala",gu:"Guam",gw:"Guinea-Bissau",gy:"Guyana",hk:"Hong Kong SAR China",hn:"Honduras",hr:"Croatia",ht:"Haiti",hu:"Hungary",id:"Indonesia",ie:"Ireland",il:"Israel",im:"Isle of Man",in:"India",io:"British Indian Ocean Territory",iq:"Iraq",ir:"Iran",is:"Iceland",it:"Italy",je:"Jersey",jm:"Jamaica",jo:"Jordan",jp:"Japan",ke:"Kenya",kg:"Kyrgyzstan",kh:"Cambodia",ki:"Kiribati",km:"Comoros",kn:"St. Kitts & Nevis",kp:"North Korea",kr:"South Korea",kw:"Kuwait",ky:"Cayman Islands",kz:"Kazakhstan",la:"Laos",lb:"Lebanon",lc:"St. Lucia",li:"Liechtenstein",lk:"Sri Lanka",lr:"Liberia",ls:"Lesotho",lt:"Lithuania",lu:"Luxembourg",lv:"Latvia",ly:"Libya",ma:"Morocco",mc:"Monaco",md:"Moldova",me:"Montenegro",mf:"St. Martin",mg:"Madagascar",mh:"Marshall Islands",mk:"North Macedonia",ml:"Mali",mm:"Myanmar (Burma)",mn:"Mongolia",mo:"Macao SAR China",mp:"Northern Mariana Islands",mq:"Martinique",mr:"Mauritania",ms:"Montserrat",mt:"Malta",mu:"Mauritius",mv:"Maldives",mw:"Malawi",mx:"Mexico",my:"Malaysia",mz:"Mozambique",na:"Namibia",nc:"New Caledonia",ne:"Niger",nf:"Norfolk Island",ng:"Nigeria",ni:"Nicaragua",nl:"Netherlands",no:"Norway",np:"Nepal",nr:"Nauru",nu:"Niue",nz:"New Zealand",om:"Oman",pa:"Panama",pe:"Peru",pf:"French Polynesia",pg:"Papua New Guinea",ph:"Philippines",pk:"Pakistan",pl:"Poland",pm:"St. Pierre & Miquelon",pr:"Puerto Rico",ps:"Palestinian Territories",pt:"Portugal",pw:"Palau",py:"Paraguay",qa:"Qatar",re:"RÃ©union",ro:"Romania",rs:"Serbia",ru:"Russia",rw:"Rwanda",sa:"Saudi Arabia",sb:"Solomon Islands",sc:"Seychelles",sd:"Sudan",se:"Sweden",sg:"Singapore",sh:"St. Helena",si:"Slovenia",sj:"Svalbard & Jan Mayen",sk:"Slovakia",sl:"Sierra Leone",sm:"San Marino",sn:"Senegal",so:"Somalia",sr:"Suriname",ss:"South Sudan",st:"SÃ£o TomÃ© & PrÃ­ncipe",sv:"El Salvador",sx:"Sint Maarten",sy:"Syria",sz:"Eswatini",tc:"Turks & Caicos Islands",td:"Chad",tg:"Togo",th:"Thailand",tj:"Tajikistan",tk:"Tokelau",tl:"Timor-Leste",tm:"Turkmenistan",tn:"Tunisia",to:"Tonga",tr:"Turkey",tt:"Trinidad & Tobago",tv:"Tuvalu",tw:"Taiwan",tz:"Tanzania",ua:"Ukraine",ug:"Uganda",us:"United States",uy:"Uruguay",uz:"Uzbekistan",va:"Vatican City",vc:"St. Vincent & Grenadines",ve:"Venezuela",vg:"British Virgin Islands",vi:"U.S. Virgin Islands",vn:"Vietnam",vu:"Vanuatu",wf:"Wallis & Futuna",ws:"Samoa",ye:"Yemen",yt:"Mayotte",za:"South Africa",zm:"Zambia",zw:"Zimbabwe"},me=H,ve={selectedCountryAriaLabel:"Selected country",noCountrySelected:"No country selected",countryListAriaLabel:"List of countries",searchPlaceholder:"Search",zeroSearchResults:"No results found",oneSearchResult:"1 result found",multipleSearchResults:"${count} results found",ac:"Ascension Island",xk:"Kosovo"},Me=ve,Ee={...me,...Me},Re=Ee;for(let te=0;te<ie.length;te++)ie[te].name=Re[ie[te].iso2];var ze=0,Fe={allowDropdown:!0,autoPlaceholder:"polite",containerClass:"",countryOrder:null,countrySearch:!0,customPlaceholder:null,dropdownContainer:null,excludeCountries:[],fixDropdownWidth:!0,formatAsYouType:!0,formatOnDisplay:!0,geoIpLookup:null,hiddenInput:null,i18n:{},initialCountry:"",loadUtils:null,nationalMode:!0,onlyCountries:[],placeholderNumberType:"MOBILE",showFlags:!0,separateDialCode:!1,strictMode:!1,useFullscreenPopup:typeof navigator<"u"&&typeof window<"u"?/Android.+Mobile|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=500:!1,validationNumberTypes:["MOBILE"]},Ke=["800","822","833","844","855","866","877","880","881","882","883","884","885","886","887","888","889"],rt=te=>te.replace(/\D/g,""),qe=(te="")=>te.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),He=te=>{const re=rt(te);if(re.charAt(0)==="1"){const ge=re.substr(1,3);return Ke.includes(ge)}return!1},et=(te,re,ge,oe)=>{if(ge===0&&!oe)return 0;let Ae=0;for(let Ne=0;Ne<re.length;Ne++){if(/[+0-9]/.test(re[Ne])&&Ae++,Ae===te&&!oe)return Ne+1;if(oe&&Ae===te+1)return Ne}return re.length},De=(te,re,ge)=>{const oe=document.createElement(te);return re&&Object.entries(re).forEach(([Ae,Ne])=>oe.setAttribute(Ae,Ne)),ge&&ge.appendChild(oe),oe},tt=(te,...re)=>{const{instances:ge}=ke;Object.values(ge).forEach(oe=>oe[te](...re))},nt=class{constructor(te,re={}){this.id=ze++,this.telInput=te,this.highlightedItem=null,this.options=Object.assign({},Fe,re),this.hadInitialPlaceholder=!!te.getAttribute("placeholder")}_init(){this.options.useFullscreenPopup&&(this.options.fixDropdownWidth=!1),this.options.onlyCountries.length===1&&(this.options.initialCountry=this.options.onlyCountries[0]),this.options.separateDialCode&&(this.options.nationalMode=!1),this.options.allowDropdown&&!this.options.showFlags&&!this.options.separateDialCode&&(this.options.nationalMode=!1),this.options.useFullscreenPopup&&!this.options.dropdownContainer&&(this.options.dropdownContainer=document.body),this.isAndroid=typeof navigator<"u"?/Android/i.test(navigator.userAgent):!1,this.isRTL=!!this.telInput.closest("[dir=rtl]");const te=this.options.allowDropdown||this.options.separateDialCode;this.showSelectedCountryOnLeft=this.isRTL?!te:te,this.options.separateDialCode&&(this.isRTL?this.originalPaddingRight=this.telInput.style.paddingRight:this.originalPaddingLeft=this.telInput.style.paddingLeft),this.options.i18n={...Re,...this.options.i18n};const re=new Promise((oe,Ae)=>{this.resolveAutoCountryPromise=oe,this.rejectAutoCountryPromise=Ae}),ge=new Promise((oe,Ae)=>{this.resolveUtilsScriptPromise=oe,this.rejectUtilsScriptPromise=Ae});this.promise=Promise.all([re,ge]),this.selectedCountryData={},this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners(),this._initRequests()}_processCountryData(){this._processAllCountries(),this._processDialCodes(),this._translateCountryNames(),this._sortCountries()}_sortCountries(){this.options.countryOrder&&(this.options.countryOrder=this.options.countryOrder.map(te=>te.toLowerCase())),this.countries.sort((te,re)=>{const{countryOrder:ge}=this.options;if(ge){const oe=ge.indexOf(te.iso2),Ae=ge.indexOf(re.iso2),Ne=oe>-1,pt=Ae>-1;if(Ne||pt)return Ne&&pt?oe-Ae:Ne?-1:1}return te.name.localeCompare(re.name)})}_addToDialCodeMap(te,re,ge){re.length>this.dialCodeMaxLen&&(this.dialCodeMaxLen=re.length),this.dialCodeToIso2Map.hasOwnProperty(re)||(this.dialCodeToIso2Map[re]=[]);for(let Ae=0;Ae<this.dialCodeToIso2Map[re].length;Ae++)if(this.dialCodeToIso2Map[re][Ae]===te)return;const oe=ge!==void 0?ge:this.dialCodeToIso2Map[re].length;this.dialCodeToIso2Map[re][oe]=te}_processAllCountries(){const{onlyCountries:te,excludeCountries:re}=this.options;if(te.length){const ge=te.map(oe=>oe.toLowerCase());this.countries=ie.filter(oe=>ge.includes(oe.iso2))}else if(re.length){const ge=re.map(oe=>oe.toLowerCase());this.countries=ie.filter(oe=>!ge.includes(oe.iso2))}else this.countries=ie}_translateCountryNames(){for(let te=0;te<this.countries.length;te++){const re=this.countries[te].iso2.toLowerCase();this.options.i18n.hasOwnProperty(re)&&(this.countries[te].name=this.options.i18n[re])}}_processDialCodes(){this.dialCodes={},this.dialCodeMaxLen=0,this.dialCodeToIso2Map={};for(let te=0;te<this.countries.length;te++){const re=this.countries[te];this.dialCodes[re.dialCode]||(this.dialCodes[re.dialCode]=!0),this._addToDialCodeMap(re.iso2,re.dialCode,re.priority)}for(let te=0;te<this.countries.length;te++){const re=this.countries[te];if(re.areaCodes){const ge=this.dialCodeToIso2Map[re.dialCode][0];for(let oe=0;oe<re.areaCodes.length;oe++){const Ae=re.areaCodes[oe];for(let Ne=1;Ne<Ae.length;Ne++){const pt=Ae.substr(0,Ne),ot=re.dialCode+pt;this._addToDialCodeMap(ge,ot),this._addToDialCodeMap(re.iso2,ot)}this._addToDialCodeMap(re.iso2,re.dialCode+Ae)}}}}_generateMarkup(){var dt,vt,yt;this.telInput.classList.add("iti__tel-input"),!this.telInput.hasAttribute("autocomplete")&&!(this.telInput.form&&this.telInput.form.hasAttribute("autocomplete"))&&this.telInput.setAttribute("autocomplete","off");const{allowDropdown:te,separateDialCode:re,showFlags:ge,containerClass:oe,hiddenInput:Ae,dropdownContainer:Ne,fixDropdownWidth:pt,useFullscreenPopup:ot,countrySearch:ut,i18n:St}=this.options;let Bt="iti";te&&(Bt+=" iti--allow-dropdown"),ge&&(Bt+=" iti--show-flags"),oe&&(Bt+=` ${oe}`),ot||(Bt+=" iti--inline-dropdown");const at=De("div",{class:Bt});if((dt=this.telInput.parentNode)==null||dt.insertBefore(at,this.telInput),te||ge||re){this.countryContainer=De("div",{class:"iti__country-container"},at),this.showSelectedCountryOnLeft?this.countryContainer.style.left="0px":this.countryContainer.style.right="0px",te?(this.selectedCountry=De("button",{type:"button",class:"iti__selected-country","aria-expanded":"false","aria-label":this.options.i18n.selectedCountryAriaLabel,"aria-haspopup":"true","aria-controls":`iti-${this.id}__dropdown-content`,role:"combobox"},this.countryContainer),this.telInput.disabled&&this.selectedCountry.setAttribute("disabled","true")):this.selectedCountry=De("div",{class:"iti__selected-country"},this.countryContainer);const It=De("div",{class:"iti__selected-country-primary"},this.selectedCountry);if(this.selectedCountryInner=De("div",{class:"iti__flag"},It),this.selectedCountryA11yText=De("span",{class:"iti__a11y-text"},this.selectedCountryInner),te&&(this.dropdownArrow=De("div",{class:"iti__arrow","aria-hidden":"true"},It)),re&&(this.selectedDialCode=De("div",{class:"iti__selected-dial-code"},this.selectedCountry)),te){const wt=pt?"":"iti--flexible-dropdown-width";if(this.dropdownContent=De("div",{id:`iti-${this.id}__dropdown-content`,class:`iti__dropdown-content iti__hide ${wt}`}),ut&&(this.searchInput=De("input",{type:"text",class:"iti__search-input",placeholder:St.searchPlaceholder,role:"combobox","aria-expanded":"true","aria-label":St.searchPlaceholder,"aria-controls":`iti-${this.id}__country-listbox`,"aria-autocomplete":"list",autocomplete:"off"},this.dropdownContent),this.searchResultsA11yText=De("span",{class:"iti__a11y-text"},this.dropdownContent)),this.countryList=De("ul",{class:"iti__country-list",id:`iti-${this.id}__country-listbox`,role:"listbox","aria-label":St.countryListAriaLabel},this.dropdownContent),this._appendListItems(),ut&&this._updateSearchResultsText(),Ne){let mt="iti iti--container";ot?mt+=" iti--fullscreen-popup":mt+=" iti--inline-dropdown",this.dropdown=De("div",{class:mt}),this.dropdown.appendChild(this.dropdownContent)}else this.countryContainer.appendChild(this.dropdownContent)}}if(at.appendChild(this.telInput),this._updateInputPadding(),Ae){const It=this.telInput.getAttribute("name")||"",wt=Ae(It);if(wt.phone){const mt=(vt=this.telInput.form)==null?void 0:vt.querySelector(`input[name="${wt.phone}"]`);mt?this.hiddenInput=mt:(this.hiddenInput=De("input",{type:"hidden",name:wt.phone}),at.appendChild(this.hiddenInput))}if(wt.country){const mt=(yt=this.telInput.form)==null?void 0:yt.querySelector(`input[name="${wt.country}"]`);mt?this.hiddenInputCountry=mt:(this.hiddenInputCountry=De("input",{type:"hidden",name:wt.country}),at.appendChild(this.hiddenInputCountry))}}}_appendListItems(){for(let te=0;te<this.countries.length;te++){const re=this.countries[te],ge=te===0?"iti__highlight":"",oe=De("li",{id:`iti-${this.id}__item-${re.iso2}`,class:`iti__country ${ge}`,tabindex:"-1",role:"option","data-dial-code":re.dialCode,"data-country-code":re.iso2,"aria-selected":"false"},this.countryList);re.nodeById[this.id]=oe;let Ae="";this.options.showFlags&&(Ae+=`<div class='iti__flag iti__${re.iso2}'></div>`),Ae+=`<span class='iti__country-name'>${re.name}</span>`,Ae+=`<span class='iti__dial-code'>+${re.dialCode}</span>`,oe.insertAdjacentHTML("beforeend",Ae)}}_setInitialState(te=!1){const re=this.telInput.getAttribute("value"),ge=this.telInput.value,Ae=re&&re.charAt(0)==="+"&&(!ge||ge.charAt(0)!=="+")?re:ge,Ne=this._getDialCode(Ae),pt=He(Ae),{initialCountry:ot,geoIpLookup:ut}=this.options,St=ot==="auto"&&ut;if(Ne&&!pt)this._updateCountryFromNumber(Ae);else if(!St||te){const Bt=ot?ot.toLowerCase():"";Bt&&this._getCountryData(Bt,!0)?this._setCountry(Bt):Ne&&pt?this._setCountry("us"):this._setCountry()}Ae&&this._updateValFromNumber(Ae)}_initListeners(){this._initTelInputListeners(),this.options.allowDropdown&&this._initDropdownListeners(),(this.hiddenInput||this.hiddenInputCountry)&&this.telInput.form&&this._initHiddenInputListener()}_initHiddenInputListener(){var te;this._handleHiddenInputSubmit=()=>{this.hiddenInput&&(this.hiddenInput.value=this.getNumber()),this.hiddenInputCountry&&(this.hiddenInputCountry.value=this.getSelectedCountryData().iso2||"")},(te=this.telInput.form)==null||te.addEventListener("submit",this._handleHiddenInputSubmit)}_initDropdownListeners(){this._handleLabelClick=re=>{this.dropdownContent.classList.contains("iti__hide")?this.telInput.focus():re.preventDefault()};const te=this.telInput.closest("label");te&&te.addEventListener("click",this._handleLabelClick),this._handleClickSelectedCountry=()=>{this.dropdownContent.classList.contains("iti__hide")&&!this.telInput.disabled&&!this.telInput.readOnly&&this._openDropdown()},this.selectedCountry.addEventListener("click",this._handleClickSelectedCountry),this._handleCountryContainerKeydown=re=>{this.dropdownContent.classList.contains("iti__hide")&&["ArrowUp","ArrowDown"," ","Enter"].includes(re.key)&&(re.preventDefault(),re.stopPropagation(),this._openDropdown()),re.key==="Tab"&&this._closeDropdown()},this.countryContainer.addEventListener("keydown",this._handleCountryContainerKeydown)}_initRequests(){let{loadUtils:te,initialCountry:re,geoIpLookup:ge}=this.options;te&&!ke.utils?(this._handlePageLoad=()=>{var Ae;window.removeEventListener("load",this._handlePageLoad),(Ae=ke.attachUtils(te))==null||Ae.catch(()=>{})},ke.documentReady()?this._handlePageLoad():window.addEventListener("load",this._handlePageLoad)):this.resolveUtilsScriptPromise(),re==="auto"&&ge&&!this.selectedCountryData.iso2?this._loadAutoCountry():this.resolveAutoCountryPromise()}_loadAutoCountry(){ke.autoCountry?this.handleAutoCountry():ke.startedLoadingAutoCountry||(ke.startedLoadingAutoCountry=!0,typeof this.options.geoIpLookup=="function"&&this.options.geoIpLookup((te="")=>{const re=te.toLowerCase();re&&this._getCountryData(re,!0)?(ke.autoCountry=re,setTimeout(()=>tt("handleAutoCountry"))):(this._setInitialState(!0),tt("rejectAutoCountryPromise"))},()=>{this._setInitialState(!0),tt("rejectAutoCountryPromise")}))}_openDropdownWithPlus(){this._openDropdown(),this.searchInput.value="+",this._filterCountries("",!0)}_initTelInputListeners(){const{strictMode:te,formatAsYouType:re,separateDialCode:ge,formatOnDisplay:oe,allowDropdown:Ae,countrySearch:Ne}=this.options;let pt=!1;new RegExp("\\p{L}","u").test(this.telInput.value)&&(pt=!0),this._handleInputEvent=ot=>{if(this.isAndroid&&(ot==null?void 0:ot.data)==="+"&&ge&&Ae&&Ne){const at=this.telInput.selectionStart||0,dt=this.telInput.value.substring(0,at-1),vt=this.telInput.value.substring(at);this.telInput.value=dt+vt,this._openDropdownWithPlus();return}this._updateCountryFromNumber(this.telInput.value)&&this._triggerCountryChange();const ut=(ot==null?void 0:ot.data)&&/[^+0-9]/.test(ot.data),St=(ot==null?void 0:ot.inputType)==="insertFromPaste"&&this.telInput.value;ut||St&&!te?pt=!0:/[^+0-9]/.test(this.telInput.value)||(pt=!1);const Bt=(ot==null?void 0:ot.detail)&&ot.detail.isSetNumber&&!oe;if(re&&!pt&&!Bt){const at=this.telInput.selectionStart||0,vt=this.telInput.value.substring(0,at).replace(/[^+0-9]/g,"").length,yt=(ot==null?void 0:ot.inputType)==="deleteContentForward",It=this._formatNumberAsYouType(),wt=et(vt,It,at,yt);this.telInput.value=It,this.telInput.setSelectionRange(wt,wt)}},this.telInput.addEventListener("input",this._handleInputEvent),(te||ge)&&(this._handleKeydownEvent=ot=>{if(ot.key&&ot.key.length===1&&!ot.altKey&&!ot.ctrlKey&&!ot.metaKey){if(ge&&Ae&&Ne&&ot.key==="+"){ot.preventDefault(),this._openDropdownWithPlus();return}if(te){const ut=this.telInput.value,St=ut.charAt(0)==="+",Bt=!St&&this.telInput.selectionStart===0&&ot.key==="+",at=/^[0-9]$/.test(ot.key),dt=ge?at:Bt||at,vt=ut.slice(0,this.telInput.selectionStart)+ot.key+ut.slice(this.telInput.selectionEnd),yt=this._getFullNumber(vt),It=ke.utils.getCoreNumber(yt,this.selectedCountryData.iso2),wt=this.maxCoreNumberLength&&It.length>this.maxCoreNumberLength;let mt=!1;if(St){const Dt=this.selectedCountryData.iso2;mt=this._getCountryFromNumber(yt)!==Dt}(!dt||wt&&!mt&&!Bt)&&ot.preventDefault()}}},this.telInput.addEventListener("keydown",this._handleKeydownEvent))}_cap(te){const re=parseInt(this.telInput.getAttribute("maxlength")||"",10);return re&&te.length>re?te.substr(0,re):te}_trigger(te,re={}){const ge=new CustomEvent(te,{bubbles:!0,cancelable:!0,detail:re});this.telInput.dispatchEvent(ge)}_openDropdown(){const{fixDropdownWidth:te,countrySearch:re}=this.options;if(te&&(this.dropdownContent.style.width=`${this.telInput.offsetWidth}px`),this.dropdownContent.classList.remove("iti__hide"),this.selectedCountry.setAttribute("aria-expanded","true"),this._setDropdownPosition(),re){const ge=this.countryList.firstElementChild;ge&&(this._highlightListItem(ge,!1),this.countryList.scrollTop=0),this.searchInput.focus()}this._bindDropdownListeners(),this.dropdownArrow.classList.add("iti__arrow--up"),this._trigger("open:countrydropdown")}_setDropdownPosition(){if(this.options.dropdownContainer&&this.options.dropdownContainer.appendChild(this.dropdown),!this.options.useFullscreenPopup){const te=this.telInput.getBoundingClientRect(),re=this.telInput.offsetHeight;this.options.dropdownContainer&&(this.dropdown.style.top=`${te.top+re}px`,this.dropdown.style.left=`${te.left}px`,this._handleWindowScroll=()=>this._closeDropdown(),window.addEventListener("scroll",this._handleWindowScroll))}}_bindDropdownListeners(){this._handleMouseoverCountryList=oe=>{var Ne;const Ae=(Ne=oe.target)==null?void 0:Ne.closest(".iti__country");Ae&&this._highlightListItem(Ae,!1)},this.countryList.addEventListener("mouseover",this._handleMouseoverCountryList),this._handleClickCountryList=oe=>{var Ne;const Ae=(Ne=oe.target)==null?void 0:Ne.closest(".iti__country");Ae&&this._selectListItem(Ae)},this.countryList.addEventListener("click",this._handleClickCountryList);let te=!0;this._handleClickOffToClose=()=>{te||this._closeDropdown(),te=!1},document.documentElement.addEventListener("click",this._handleClickOffToClose);let re="",ge=null;if(this._handleKeydownOnDropdown=oe=>{["ArrowUp","ArrowDown","Enter","Escape"].includes(oe.key)&&(oe.preventDefault(),oe.stopPropagation(),oe.key==="ArrowUp"||oe.key==="ArrowDown"?this._handleUpDownKey(oe.key):oe.key==="Enter"?this._handleEnterKey():oe.key==="Escape"&&this._closeDropdown()),!this.options.countrySearch&&/^[a-zA-ZÃ€-Ã¿Ð°-ÑÐ-Ð¯ ]$/.test(oe.key)&&(oe.stopPropagation(),ge&&clearTimeout(ge),re+=oe.key.toLowerCase(),this._searchForCountry(re),ge=setTimeout(()=>{re=""},1e3))},document.addEventListener("keydown",this._handleKeydownOnDropdown),this.options.countrySearch){const oe=()=>{const Ne=this.searchInput.value.trim();Ne?this._filterCountries(Ne):this._filterCountries("",!0)};let Ae=null;this._handleSearchChange=()=>{Ae&&clearTimeout(Ae),Ae=setTimeout(()=>{oe(),Ae=null},100)},this.searchInput.addEventListener("input",this._handleSearchChange),this.searchInput.addEventListener("click",Ne=>Ne.stopPropagation())}}_searchForCountry(te){for(let re=0;re<this.countries.length;re++){const ge=this.countries[re];if(ge.name.substr(0,te.length).toLowerCase()===te){const Ae=ge.nodeById[this.id];this._highlightListItem(Ae,!1),this._scrollTo(Ae);break}}}_filterCountries(te,re=!1){let ge=!0;this.countryList.innerHTML="";const oe=qe(te);for(let Ae=0;Ae<this.countries.length;Ae++){const Ne=this.countries[Ae],pt=qe(Ne.name),ot=Ne.name.split(/[^a-zA-ZÃ€-Ã¿Ð°-ÑÐ-Ð¯]/).map(St=>St[0]).join("").toLowerCase(),ut=`+${Ne.dialCode}`;if(re||pt.includes(oe)||ut.includes(oe)||Ne.iso2.includes(oe)||ot.includes(oe)){const St=Ne.nodeById[this.id];St&&this.countryList.appendChild(St),ge&&(this._highlightListItem(St,!1),ge=!1)}}ge&&this._highlightListItem(null,!1),this.countryList.scrollTop=0,this._updateSearchResultsText()}_updateSearchResultsText(){const{i18n:te}=this.options,re=this.countryList.childElementCount;let ge;re===0?ge=te.zeroSearchResults:re===1?ge=te.oneSearchResult:ge=te.multipleSearchResults.replace("${count}",re.toString()),this.searchResultsA11yText.textContent=ge}_handleUpDownKey(te){var ge,oe;let re=te==="ArrowUp"?(ge=this.highlightedItem)==null?void 0:ge.previousElementSibling:(oe=this.highlightedItem)==null?void 0:oe.nextElementSibling;!re&&this.countryList.childElementCount>1&&(re=te==="ArrowUp"?this.countryList.lastElementChild:this.countryList.firstElementChild),re&&(this._scrollTo(re),this._highlightListItem(re,!1))}_handleEnterKey(){this.highlightedItem&&this._selectListItem(this.highlightedItem)}_updateValFromNumber(te){let re=te;if(this.options.formatOnDisplay&&ke.utils&&this.selectedCountryData){const ge=this.options.nationalMode||re.charAt(0)!=="+"&&!this.options.separateDialCode,{NATIONAL:oe,INTERNATIONAL:Ae}=ke.utils.numberFormat,Ne=ge?oe:Ae;re=ke.utils.formatNumber(re,this.selectedCountryData.iso2,Ne)}re=this._beforeSetNumber(re),this.telInput.value=re}_updateCountryFromNumber(te){const re=this._getCountryFromNumber(te);return re!==null?this._setCountry(re):!1}_ensureHasDialCode(te){const{dialCode:re,nationalPrefix:ge}=this.selectedCountryData;if(te.charAt(0)==="+"||!re)return te;const Ne=ge&&te.charAt(0)===ge&&!this.options.separateDialCode?te.substring(1):te;return`+${re}${Ne}`}_getCountryFromNumber(te){const re=te.indexOf("+");let ge=re?te.substring(re):te;const oe=this.selectedCountryData.iso2,Ae=this.selectedCountryData.dialCode;ge=this._ensureHasDialCode(ge);const Ne=this._getDialCode(ge,!0),pt=rt(ge);if(Ne){const ot=rt(Ne),ut=this.dialCodeToIso2Map[ot];if(!oe&&this.defaultCountry&&ut.includes(this.defaultCountry))return this.defaultCountry;const St=oe&&ut.includes(oe)&&(pt.length===ot.length||!this.selectedCountryData.areaCodes);if(!(Ae==="1"&&He(pt))&&!St){for(let at=0;at<ut.length;at++)if(ut[at])return ut[at]}}else{if(ge.charAt(0)==="+"&&pt.length)return"";if((!ge||ge==="+")&&!this.selectedCountryData.iso2)return this.defaultCountry}return null}_highlightListItem(te,re){const ge=this.highlightedItem;if(ge&&(ge.classList.remove("iti__highlight"),ge.setAttribute("aria-selected","false")),this.highlightedItem=te,this.highlightedItem){this.highlightedItem.classList.add("iti__highlight"),this.highlightedItem.setAttribute("aria-selected","true");const oe=this.highlightedItem.getAttribute("id")||"";this.selectedCountry.setAttribute("aria-activedescendant",oe),this.options.countrySearch&&this.searchInput.setAttribute("aria-activedescendant",oe)}re&&this.highlightedItem.focus()}_getCountryData(te,re){for(let ge=0;ge<this.countries.length;ge++)if(this.countries[ge].iso2===te)return this.countries[ge];if(re)return null;throw new Error(`No country data for '${te}'`)}_setCountry(te){const{separateDialCode:re,showFlags:ge,i18n:oe}=this.options,Ae=this.selectedCountryData.iso2?this.selectedCountryData:{};if(this.selectedCountryData=te?this._getCountryData(te,!1)||{}:{},this.selectedCountryData.iso2&&(this.defaultCountry=this.selectedCountryData.iso2),this.selectedCountryInner){let Ne="",pt="";te&&ge?(Ne=`iti__flag iti__${te}`,pt=`${this.selectedCountryData.name} +${this.selectedCountryData.dialCode}`):(Ne="iti__flag iti__globe",pt=oe.noCountrySelected),this.selectedCountryInner.className=Ne,this.selectedCountryA11yText.textContent=pt}if(this._setSelectedCountryTitleAttribute(te,re),re){const Ne=this.selectedCountryData.dialCode?`+${this.selectedCountryData.dialCode}`:"";this.selectedDialCode.innerHTML=Ne,this._updateInputPadding()}return this._updatePlaceholder(),this._updateMaxLength(),Ae.iso2!==te}_updateInputPadding(){if(this.selectedCountry){const re=(this.selectedCountry.offsetWidth||this._getHiddenSelectedCountryWidth())+6;this.showSelectedCountryOnLeft?this.telInput.style.paddingLeft=`${re}px`:this.telInput.style.paddingRight=`${re}px`}}_updateMaxLength(){const{strictMode:te,placeholderNumberType:re,validationNumberTypes:ge}=this.options,{iso2:oe}=this.selectedCountryData;if(te&&ke.utils)if(oe){const Ae=ke.utils.numberType[re];let Ne=ke.utils.getExampleNumber(oe,!1,Ae,!0),pt=Ne;for(;ke.utils.isPossibleNumber(Ne,oe,ge);)pt=Ne,Ne+="0";const ot=ke.utils.getCoreNumber(pt,oe);this.maxCoreNumberLength=ot.length,oe==="by"&&(this.maxCoreNumberLength=ot.length+1)}else this.maxCoreNumberLength=null}_setSelectedCountryTitleAttribute(te=null,re){if(!this.selectedCountry)return;let ge;te&&!re?ge=`${this.selectedCountryData.name}: +${this.selectedCountryData.dialCode}`:te?ge=this.selectedCountryData.name:ge="Unknown",this.selectedCountry.setAttribute("title",ge)}_getHiddenSelectedCountryWidth(){if(this.telInput.parentNode){const te=this.telInput.parentNode.cloneNode(!1);te.style.visibility="hidden",document.body.appendChild(te);const re=this.countryContainer.cloneNode();te.appendChild(re);const ge=this.selectedCountry.cloneNode(!0);re.appendChild(ge);const oe=ge.offsetWidth;return document.body.removeChild(te),oe}return 0}_updatePlaceholder(){const{autoPlaceholder:te,placeholderNumberType:re,nationalMode:ge,customPlaceholder:oe}=this.options,Ae=te==="aggressive"||!this.hadInitialPlaceholder&&te==="polite";if(ke.utils&&Ae){const Ne=ke.utils.numberType[re];let pt=this.selectedCountryData.iso2?ke.utils.getExampleNumber(this.selectedCountryData.iso2,ge,Ne):"";pt=this._beforeSetNumber(pt),typeof oe=="function"&&(pt=oe(pt,this.selectedCountryData)),this.telInput.setAttribute("placeholder",pt)}}_selectListItem(te){const re=this._setCountry(te.getAttribute("data-country-code"));this._closeDropdown(),this._updateDialCode(te.getAttribute("data-dial-code")),this.telInput.focus(),re&&this._triggerCountryChange()}_closeDropdown(){this.dropdownContent.classList.add("iti__hide"),this.selectedCountry.setAttribute("aria-expanded","false"),this.selectedCountry.removeAttribute("aria-activedescendant"),this.highlightedItem&&this.highlightedItem.setAttribute("aria-selected","false"),this.options.countrySearch&&this.searchInput.removeAttribute("aria-activedescendant"),this.dropdownArrow.classList.remove("iti__arrow--up"),document.removeEventListener("keydown",this._handleKeydownOnDropdown),this.options.countrySearch&&this.searchInput.removeEventListener("input",this._handleSearchChange),document.documentElement.removeEventListener("click",this._handleClickOffToClose),this.countryList.removeEventListener("mouseover",this._handleMouseoverCountryList),this.countryList.removeEventListener("click",this._handleClickCountryList),this.options.dropdownContainer&&(this.options.useFullscreenPopup||window.removeEventListener("scroll",this._handleWindowScroll),this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown)),this._handlePageLoad&&window.removeEventListener("load",this._handlePageLoad),this._trigger("close:countrydropdown")}_scrollTo(te){const re=this.countryList,ge=document.documentElement.scrollTop,oe=re.offsetHeight,Ae=re.getBoundingClientRect().top+ge,Ne=Ae+oe,pt=te.offsetHeight,ot=te.getBoundingClientRect().top+ge,ut=ot+pt,St=ot-Ae+re.scrollTop;if(ot<Ae)re.scrollTop=St;else if(ut>Ne){const Bt=oe-pt;re.scrollTop=St-Bt}}_updateDialCode(te){const re=this.telInput.value,ge=`+${te}`;let oe;if(re.charAt(0)==="+"){const Ae=this._getDialCode(re);Ae?oe=re.replace(Ae,ge):oe=ge,this.telInput.value=oe}}_getDialCode(te,re){let ge="";if(te.charAt(0)==="+"){let oe="";for(let Ae=0;Ae<te.length;Ae++){const Ne=te.charAt(Ae);if(!isNaN(parseInt(Ne,10))){if(oe+=Ne,re)this.dialCodeToIso2Map[oe]&&(ge=te.substr(0,Ae+1));else if(this.dialCodes[oe]){ge=te.substr(0,Ae+1);break}if(oe.length===this.dialCodeMaxLen)break}}}return ge}_getFullNumber(te){const re=te||this.telInput.value.trim(),{dialCode:ge}=this.selectedCountryData;let oe;const Ae=rt(re);return this.options.separateDialCode&&re.charAt(0)!=="+"&&ge&&Ae?oe=`+${ge}`:oe="",oe+re}_beforeSetNumber(te){let re=te;if(this.options.separateDialCode){let ge=this._getDialCode(re);if(ge){ge=`+${this.selectedCountryData.dialCode}`;const oe=re[ge.length]===" "||re[ge.length]==="-"?ge.length+1:ge.length;re=re.substr(oe)}}return this._cap(re)}_triggerCountryChange(){this._trigger("countrychange")}_formatNumberAsYouType(){const te=this._getFullNumber(),re=ke.utils?ke.utils.formatNumberAsYouType(te,this.selectedCountryData.iso2):te,{dialCode:ge}=this.selectedCountryData;return this.options.separateDialCode&&this.telInput.value.charAt(0)!=="+"&&re.includes(`+${ge}`)?(re.split(`+${ge}`)[1]||"").trim():re}handleAutoCountry(){this.options.initialCountry==="auto"&&ke.autoCountry&&(this.defaultCountry=ke.autoCountry,this.selectedCountryData.iso2||this.selectedCountryInner.classList.contains("iti__globe")||this.setCountry(this.defaultCountry),this.resolveAutoCountryPromise())}handleUtils(){ke.utils&&(this.telInput.value&&this._updateValFromNumber(this.telInput.value),this.selectedCountryData.iso2&&(this._updatePlaceholder(),this._updateMaxLength())),this.resolveUtilsScriptPromise()}destroy(){var Ae,Ne;const{allowDropdown:te,separateDialCode:re}=this.options;if(te){this._closeDropdown(),this.selectedCountry.removeEventListener("click",this._handleClickSelectedCountry),this.countryContainer.removeEventListener("keydown",this._handleCountryContainerKeydown);const pt=this.telInput.closest("label");pt&&pt.removeEventListener("click",this._handleLabelClick)}const{form:ge}=this.telInput;this._handleHiddenInputSubmit&&ge&&ge.removeEventListener("submit",this._handleHiddenInputSubmit),this.telInput.removeEventListener("input",this._handleInputEvent),this._handleKeydownEvent&&this.telInput.removeEventListener("keydown",this._handleKeydownEvent),this.telInput.removeAttribute("data-intl-tel-input-id"),re&&(this.isRTL?this.telInput.style.paddingRight=this.originalPaddingRight:this.telInput.style.paddingLeft=this.originalPaddingLeft);const oe=this.telInput.parentNode;(Ae=oe==null?void 0:oe.parentNode)==null||Ae.insertBefore(this.telInput,oe),(Ne=oe==null?void 0:oe.parentNode)==null||Ne.removeChild(oe),delete ke.instances[this.id]}getExtension(){return ke.utils?ke.utils.getExtension(this._getFullNumber(),this.selectedCountryData.iso2):""}getNumber(te){if(ke.utils){const{iso2:re}=this.selectedCountryData;return ke.utils.formatNumber(this._getFullNumber(),re,te)}return""}getNumberType(){return ke.utils?ke.utils.getNumberType(this._getFullNumber(),this.selectedCountryData.iso2):-99}getSelectedCountryData(){return this.selectedCountryData}getValidationError(){if(ke.utils){const{iso2:te}=this.selectedCountryData;return ke.utils.getValidationError(this._getFullNumber(),te)}return-99}isValidNumber(){if(!this.selectedCountryData.iso2)return!1;const te=this._getFullNumber(),re=te.search(new RegExp("\\p{L}","u"));if(re>-1){const ge=te.substring(0,re),oe=this._utilsIsPossibleNumber(ge),Ae=this._utilsIsPossibleNumber(te);return oe&&Ae}return this._utilsIsPossibleNumber(te)}_utilsIsPossibleNumber(te){return ke.utils?ke.utils.isPossibleNumber(te,this.selectedCountryData.iso2,this.options.validationNumberTypes):null}isValidNumberPrecise(){if(!this.selectedCountryData.iso2)return!1;const te=this._getFullNumber(),re=te.search(new RegExp("\\p{L}","u"));if(re>-1){const ge=te.substring(0,re),oe=this._utilsIsValidNumber(ge),Ae=this._utilsIsValidNumber(te);return oe&&Ae}return this._utilsIsValidNumber(te)}_utilsIsValidNumber(te){return ke.utils?ke.utils.isValidNumber(te,this.selectedCountryData.iso2,this.options.validationNumberTypes):null}setCountry(te){const re=te==null?void 0:te.toLowerCase(),ge=this.selectedCountryData.iso2;(te&&re!==ge||!te&&ge)&&(this._setCountry(re),this._updateDialCode(this.selectedCountryData.dialCode),this._triggerCountryChange())}setNumber(te){const re=this._updateCountryFromNumber(te);this._updateValFromNumber(te),re&&this._triggerCountryChange(),this._trigger("input",{isSetNumber:!0})}setPlaceholderNumberType(te){this.options.placeholderNumberType=te,this._updatePlaceholder()}setDisabled(te){this.telInput.disabled=te,te?this.selectedCountry.setAttribute("disabled","true"):this.selectedCountry.removeAttribute("disabled")}},Ze=te=>{if(!ke.utils&&!ke.startedLoadingUtilsScript){let re;if(typeof te=="function")try{re=Promise.resolve(te())}catch(ge){return Promise.reject(ge)}else return Promise.reject(new TypeError(`The argument passed to attachUtils must be a function that returns a promise for the utilities module, not ${typeof te}`));return ke.startedLoadingUtilsScript=!0,re.then(ge=>{const oe=ge==null?void 0:ge.default;if(!oe||typeof oe!="object")throw new TypeError("The loader function passed to attachUtils did not resolve to a module object with utils as its default export.");return ke.utils=oe,tt("handleUtils"),!0}).catch(ge=>{throw tt("rejectUtilsScriptPromise",ge),ge})}return null},ke=Object.assign((te,re)=>{const ge=new nt(te,re);return ge._init(),te.setAttribute("data-intl-tel-input-id",ge.id.toString()),ke.instances[ge.id]=ge,ge},{defaults:Fe,documentReady:()=>document.readyState==="complete",getCountryData:()=>ie,getInstance:te=>{const re=te.getAttribute("data-intl-tel-input-id");return re?ke.instances[re]:null},instances:{},attachUtils:Ze,startedLoadingUtilsScript:!1,startedLoadingAutoCountry:!1,version:"25.3.2"}),bt=ke;return B(N)})();return o.default})})(Uf)),Uf.exports}var bL=xL();const wL=qm(bL);var TL=Te('<div><span class="loading loading-spinner loading-xl"></span></div>'),CL=Te('<span class="w-8"> </span>'),SL=Te('<div class="text-center"><h2 class="text-2xl font-bold"> </h2> <p class="text-base-content/80 mt-0.5 text-sm"> </p></div> <form class="mt-8 flex w-full flex-col gap-3"><input class="input pl-12! w-full" type="tel" id="phone"/> <button class="btn btn-primary w-full"> <!></button></form>',1),PL=async(m,o,f)=>{await o(x(f))},IL=Te('<span class="w-8"> </span>'),ML=(m,o)=>{ce(o,"")},kL=Te('<div class="text-center"><h2 class="text-2xl font-bold"> </h2> <p class="mt-0.5 text-sm"> </p></div> <div class="mt-4"><!></div> <div class="mt-3 flex flex-col items-center gap-1"><button class="btn btn-ghost w-max"> <!></button> <button class="text-primary cursor-pointer text-xs"> </button></div>',1),AL=Te('<div class="flex h-full w-full flex-col items-center justify-center"><!></div>');function EL(m,o){Br(o,!0);let f=ct(!0),y=ct(""),M=ct(0),z=ct(!1);const T=ft(()=>x(M)>0||x(z));let s=ct(!1),B=ct(""),N=ct(void 0);const Y=ft(()=>{var Me;return`phone:${(Me=kt.data)==null?void 0:Me.id}`});Wr(()=>{const Me=localStorage.getItem(x(Y));Me&&ce(y,Me,!0)}),Dn(()=>{en.getOtpCooldown().then(Re=>{ce(M,Re.cooldownMs,!0)}).catch(Re=>{Nr.error(Re.message)}).finally(()=>{ce(f,!1)});const Me=1e3,Ee=setInterval(()=>{ce(M,Math.max(0,x(M)-Me),!0)},Me);return()=>{clearInterval(Ee)}});async function K(Me){try{ce(z,!0);const Ee=await en.sendOtp(Me);Nr.info(`${tS()} ${Ee.phone}`),ce(y,Ee.phone,!0),ce(M,Ee.cooldownMs,!0),localStorage.setItem(x(Y),x(y))}catch(Ee){Nr.error(Ee.message)}finally{ce(z,!1)}}Wr(()=>{x(B).length===6&&(ce(s,!0),(async()=>{try{await en.verifyOtp(x(B)),await kt.refresh(),Nr.success(iS()),localStorage.removeItem(x(Y)),o.onsuccess(x(y))}catch(Me){Nr.error(Me.message)}finally{ce(B,""),ce(s,!1)}})())});var ie=AL(),H=E(ie);{var me=Me=>{var Ee=TL();G(Me,Ee)},ve=Me=>{var Ee=er(),Re=Ct(Ee);{var ze=Ke=>{var rt=SL(),qe=Ct(rt),He=E(qe),et=E(He,!0);k(He);var De=q(He,2),tt=E(De,!0);k(De),k(qe);var nt=q(qe,2),Ze=E(nt);Wi(Ze,()=>ge=>(ce(N,wL(ge,{strictMode:!0,initialCountry:"br",loadUtils:()=>jx(()=>import("../chunks/DwuERyDq.js"),[],import.meta.url),containerClass:"w-full",dropdownContainer:document.body})),()=>{var oe;(oe=x(N))==null||oe.destroy()}));var ke=q(Ze,2),bt=E(ke),te=q(bt);{var re=ge=>{var oe=CL(),Ae=E(oe);k(oe),Ye(Ne=>fe(Ae,`(${Ne??""})`),[()=>tp(x(M))]),G(ge,oe)};je(te,ge=>{x(M)>0&&ge(re)})}k(ke),k(nt),Ye((ge,oe,Ae)=>{fe(et,ge),fe(tt,oe),ke.disabled=x(T),fe(bt,`${Ae??""} `)},[()=>GS(),()=>XS(),()=>JS()]),Ai("submit",nt,async()=>{var oe;if(x(T))return;if(!((oe=x(N))!=null&&oe.isValidNumber())){Nr.error(sS());return}const ge=x(N).getNumber();await K(ge)}),G(Ke,rt)},Fe=Ke=>{var rt=kL(),qe=Ct(rt),He=E(qe),et=E(He,!0);k(He);var De=q(He,2),tt=E(De);k(De),k(qe);var nt=q(qe,2),Ze=E(nt);{const Ne=(pt,ot)=>{let ut=()=>ot==null?void 0:ot().cells;var St=er(),Bt=Ct(St);yi(Bt,()=>mL,(at,dt)=>{dt(at,{class:"border-primary",children:(vt,yt)=>{var It=er(),wt=Ct(It);hi(wt,16,ut,mt=>mt,(mt,Dt)=>{var zt=er(),qt=Ct(zt);yi(qt,()=>vL,(tr,Qt)=>{Qt(tr,{get cell(){return Dt},class:"border-base-content/20 size-11 sm:size-12"})}),G(mt,zt)}),G(vt,It)},$$slots:{default:!0}})}),G(pt,St)};yi(Ze,()=>yL,(pt,ot)=>{ot(pt,{maxlength:6,class:"mx-auto w-max",get disabled(){return x(s)},get value(){return x(B)},set value(ut){ce(B,ut,!0)},children:Ne,$$slots:{default:!0}})})}k(nt);var ke=q(nt,2),bt=E(ke);bt.__click=[PL,K,y];var te=E(bt),re=q(te);{var ge=Ne=>{var pt=IL(),ot=E(pt);k(pt),Ye(ut=>fe(ot,`(${ut??""})`),[()=>tp(x(M))]),G(Ne,pt)};je(re,Ne=>{x(M)>0&&Ne(ge)})}k(bt);var oe=q(bt,2);oe.__click=[ML,y];var Ae=E(oe,!0);k(oe),k(ke),Ye((Ne,pt,ot,ut)=>{fe(et,Ne),fe(tt,`${pt??""} ${x(y)??""}`),bt.disabled=x(T),fe(te,`${ot??""} `),fe(Ae,ut)},[()=>tP(),()=>iP(),()=>sP(),()=>uP()]),G(Ke,rt)};je(Re,Ke=>{x(y)?Ke(Fe,!1):Ke(ze)},!0)}G(Me,Ee)};je(H,Me=>{x(f)?Me(me):Me(ve,!1)})}k(ie),G(m,ie),Fr()}Qn(["click"]);var zL=Te('<dialog class="modal"><div class="modal-box h-72 max-w-sm"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <!></div></dialog>');function LL(m,o){Br(o,!0);let f=Lt(o,"open",15);var y=zL(),M=E(y),z=q(E(M),2);{var T=s=>{EL(s,{onsuccess:()=>f(!1)})};je(z,s=>{f()&&s(T)})}k(M),k(y),Wi(y,()=>s=>{Wr(()=>{f()?s.show():s.close()})}),Ai("close",y,()=>f(!1)),G(m,y),Fr()}var DL=(m,o)=>{o()},RL=Te('<span class="center-absolute loading loading-spinner absolute"></span>'),BL=Te('<button type="button" class="relative hover:brightness-95 disabled:opacity-50"><!> <!></button>'),FL=(m,o,f)=>{o(x(f).id)},OL=Te('<span class="center-absolute loading loading-spinner absolute"></span>'),NL=Te('<button type="button" class="relative hover:brightness-95 disabled:opacity-50"><!> <!></button>'),jL=Te('<div><div class="text-base-content/80 text-sm"> </div> <div class="mt-2 grid grid-cols-3 gap-2"><!> <!></div></div>'),VL=Te('<a class="btn border-0 bg-[#5865F2] text-white"><!> </a>'),qL=async(m,o,f)=>{try{ce(o,!0),await en.unlinkDiscord(),kt.refresh(),Nr.success(SS()),ce(f,!1)}catch(y){Nr.error(y.message,{duration:5e3})}finally{ce(o,!1)}},ZL=Te('<button class="btn btn-error btn-soft"><!> </button>'),UL=(m,o)=>{var f;(f=x(o))==null||f.show()},$L=(m,o)=>{o(!1)},GL=(m,o)=>{var f;(f=x(o))==null||f.close()},HL=async(m,o)=>{try{ce(o,!0),await en.deleteMe(),Nr.warning(DS()),await kt.logout()}catch(f){Nr.error(f.message)}finally{ce(o,!1)}},WL=Te('<dialog class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <h3 class="flex items-center gap-1.5 text-lg font-bold"> </h3> <form class="mt-3 w-full"><div class="flex flex-col gap-6 sm:flex-row"><div class="sm:min-w-34 flex items-center justify-center gap-6 sm:flex-col sm:gap-3"><div class="relative w-max"><!> <a class="tooltip btn btn-circle tooltip-right absolute -bottom-1 -right-1 max-sm:overflow-x-hidden" href="/profile-picture"><!></a></div> <!></div> <div class="flex w-full flex-col gap-3"><!> <!> <label class="label text-sm"><input class="checkbox checkbox-xs" type="checkbox"/> </label></div></div> <div class="mt-4 flex w-full items-center justify-between"><button type="button" class="btn btn-error btn-soft btn-sm w-max"> </button> <div class="flex gap-2"><button class="btn btn-soft" type="button"> </button> <button class="btn btn-primary" type="submit"> </button></div></div></form></div></dialog> <dialog class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <h3 class="flex items-center gap-1.5 text-lg font-bold"> </h3> <p class="mt-4"> </p> <div class="mt-4 flex justify-end gap-2"><button class="btn btn-soft"> </button> <button class="btn btn-error"> </button></div></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog>',1);function XL(m,o){Br(o,!0);let f=Lt(o,"open",15),y=ct(xi(o.userData.name)),M=ct(xi(o.userData.discord)),z=ct(xi(o.userData.showLastPixel)),T=ct(!1),s=ct(void 0),B=ct(void 0);const N=ix("2025-09_discord_linking");let Y=ct(!!o.userData.discordId);Dn(()=>{const rr=Kt=>{Kt.key==="Escape"&&f(!1)};return document.addEventListener("keydown",rr),()=>document.removeEventListener("keydown",rr)});let K=ct(void 0),ie=ct(void 0);Wr(()=>{ce(y,o.userData.name,!0),ce(z,o.userData.showLastPixel,!0)}),Wr(()=>{f()&&!x(B)&&en.getMyProfilePictures().then(rr=>{ce(B,rr,!0)}).catch(rr=>{Nr.error(rr.message)})});let H=ct(!1);async function me(rr){try{ce(H,!0),await en.changeProfilePicture(rr),await kt.refresh()}finally{ce(H,!1)}}var ve=WL(),Me=Ct(ve),Ee=E(Me),Re=q(E(Ee),2),ze=E(Re,!0);k(Re);var Fe=q(Re,2),Ke=E(Fe),rt=E(Ke),qe=E(rt),He=E(qe);lo(He,{class:"size-30",get userId(){return o.userData.id},get pictureUrl(){return o.userData.picture}});var et=q(He,2),De=E(et);Rv(De,{class:"size-5"}),k(et),k(qe);var tt=q(qe,2);{var nt=rr=>{var Kt=jL(),or=E(Kt),Sr=E(or,!0);k(or);var Dr=q(or,2),Zr=E(Dr);{var se=Z=>{var X=BL();X.__click=[DL,me];var ae=E(X);lo(ae,{class:"size-10 border",get userId(){return o.userData.id}});var de=q(ae,2);{var Se=Ie=>{var be=RL();G(Ie,be)};je(de,Ie=>{x(H)&&Ie(Se)})}k(X),Ye(()=>X.disabled=x(H)),G(Z,X)};je(Zr,Z=>{o.userData.picture&&Z(se)})}var j=q(Zr,2);hi(j,17,()=>x(B),Z=>Z.id,(Z,X)=>{var ae=er(),de=Ct(ae);{var Se=Ie=>{var be=NL();be.__click=[FL,me,X];var Oe=E(be);lo(Oe,{class:"size-10 border",get userId(){return o.userData.id},get pictureUrl(){return x(X).url}});var st=q(Oe,2);{var $e=Mt=>{var xe=OL();G(Mt,xe)};je(st,Mt=>{x(H)&&Mt($e)})}k(be),Ye(()=>be.disabled=x(H)),G(Ie,be)};je(de,Ie=>{o.userData.picture!==x(X).url&&Ie(Se)})}G(Z,ae)}),k(Dr),k(Kt),Ye(Z=>fe(Sr,Z),[()=>sw()]),G(rr,Kt)};je(tt,rr=>{var Kt;(Kt=x(B))!=null&&Kt.length&&rr(nt)})}k(rt);var Ze=q(rt,2),ke=E(Ze);{let rr=ft(()=>Xf()),Kt=ft(()=>Xf());Jf(ke,{get label(){return x(rr)},get placeholder(){return x(Kt)},min:1,max:16,get value(){return x(y)},set value(or){ce(y,or,!0)},get validate(){return x(K)},set validate(or){ce(K,or,!0)}})}var bt=q(ke,2);{var te=rr=>{var Kt=er(),or=Ct(Kt);{var Sr=Zr=>{var se=VL(),j=E(se);em(j,{class:"size-4.5"});var Z=q(j);k(se),Ye((X,ae)=>{xr(se,"href",X),fe(Z,` ${ae??""}`)},[()=>ax("/discord/authorize"),()=>MS()]),G(Zr,se)},Dr=Zr=>{var se=ZL();se.__click=[qL,T,Y];var j=E(se);em(j,{class:"size-4.5"});var Z=q(j);k(se),Ye(X=>{se.disabled=x(T),fe(Z,` ${X??""}`)},[()=>{var X;return ES({username:((X=o.userData)==null?void 0:X.discord)??""})}]),G(Zr,se)};je(or,Zr=>{x(Y)?Zr(Dr,!1):Zr(Sr)})}G(rr,Kt)},re=rr=>{{let Kt=ft(()=>l3());Jf(rr,{label:"Discord",get placeholder(){return x(Kt)},max:32,get value(){return x(M)},set value(or){ce(M,or,!0)},get validate(){return x(ie)},set validate(or){ce(ie,or,!0)}})}};je(bt,rr=>{N?rr(te):rr(re,!1)})}var ge=q(bt,2),oe=E(ge);uo(oe);var Ae=q(oe);k(ge),k(Ze),k(Ke);var Ne=q(Ke,2),pt=E(Ne);pt.__click=[UL,s];var ot=E(pt,!0);k(pt);var ut=q(pt,2),St=E(ut);St.__click=[$L,f];var Bt=E(St,!0);k(St);var at=q(St,2),dt=E(at,!0);k(at),k(ut),k(Ne),k(Fe),k(Ee),k(Me),Wi(Me,()=>rr=>{Wr(()=>{f()?rr.show():rr.close()})});var vt=q(Me,2),yt=E(vt),It=q(E(yt),2),wt=E(It,!0);k(It);var mt=q(It,2),Dt=E(mt,!0);k(mt);var zt=q(mt,2),qt=E(zt);qt.__click=[GL,s];var tr=E(qt,!0);k(qt);var Qt=q(qt,2);Qt.__click=[HL,T];var Ot=E(Qt,!0);k(Qt),k(zt),k(yt);var fr=q(yt,2),kr=E(fr),Ar=E(kr,!0);k(kr),k(fr),k(vt),Po(vt,rr=>ce(s,rr),()=>x(s)),Ye((rr,Kt,or,Sr,Dr,Zr,se,j,Z,X,ae)=>{fe(ze,rr),xr(et,"data-tip",Kt),fe(Ae,` ${or??""}`),fe(ot,Sr),St.disabled=x(T),fe(Bt,Dr),at.disabled=x(T),fe(dt,Zr),fe(wt,se),fe(Dt,j),fe(tr,Z),Qt.disabled=x(T),fe(Ot,X),fe(Ar,ae)},[()=>pP(),()=>Rx(),()=>uw(),()=>Yg(),()=>cl(),()=>Mx(),()=>mw(),()=>vw(),()=>up(),()=>Yg(),()=>cl()]),Ai("close",Me,()=>f(!1)),Ai("submit",Fe,async()=>{var rr,Kt;try{if(!((rr=x(K))!=null&&rr())||!((Kt=x(ie))!=null&&Kt()))return;ce(T,!0),await en.updateMe({name:x(y),showLastPixel:x(z),discord:x(M)}),kt.refresh(),Nr.success(yS()),f(!1)}catch(or){Nr.error(or.message,{duration:5e3})}finally{ce(T,!1)}}),Sx(oe,()=>x(z),rr=>ce(z,rr)),G(m,ve),Fr()}Qn(["click"]);var YL=Cr('<svg><path d="M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z"></path></svg>');function KL(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=YL();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var JL=Cr('<svg><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z"></path></svg>');function QL(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=JL();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var eD=Cr('<svg><path d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z"></path></svg>');function tD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=eD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var rD=Cr('<svg><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"></path></svg>');function H0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=rD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var nD=Cr('<svg><path d="M240-80q-50 0-85-35t-35-85v-120h120v-560l60 60 60-60 60 60 60-60 60 60 60-60 60 60 60-60 60 60 60-60v680q0 50-35 85t-85 35H240Zm480-80q17 0 28.5-11.5T760-200v-560H320v440h360v120q0 17 11.5 28.5T720-160ZM360-600v-80h240v80H360Zm0 120v-80h240v80H360Zm320-120q-17 0-28.5-11.5T640-640q0-17 11.5-28.5T680-680q17 0 28.5 11.5T720-640q0 17-11.5 28.5T680-600Zm0 120q-17 0-28.5-11.5T640-520q0-17 11.5-28.5T680-560q17 0 28.5 11.5T720-520q0 17-11.5 28.5T680-480ZM240-160h360v-80H200v40q0 17 11.5 28.5T240-160Zm-40 0v-80 80Z"></path></svg>');function iD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=nD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var aD=Cr('<svg><defs><radialGradient id="snoo-radial-gragient" cx="169.75" cy="92.19" r="50.98" fx="169.75" fy="92.19" gradientTransform="matrix(1 0 0 .87 0 11.64)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#feffff"></stop><stop offset=".4" stop-color="#feffff"></stop><stop offset=".51" stop-color="#f9fcfc"></stop><stop offset=".62" stop-color="#edf3f5"></stop><stop offset=".7" stop-color="#dee9ec"></stop><stop offset=".72" stop-color="#d8e4e8"></stop><stop offset=".76" stop-color="#ccd8df"></stop><stop offset=".8" stop-color="#c8d5dd"></stop><stop offset=".83" stop-color="#ccd6de"></stop><stop offset=".85" stop-color="#d8dbe2"></stop><stop offset=".88" stop-color="#ede3e9"></stop><stop offset=".9" stop-color="#ffebef"></stop></radialGradient><radialGradient xlink:href="#snoo-radial-gragient" id="snoo-radial-gragient-2" cx="47.31" r="50.98" fx="47.31"></radialGradient><radialGradient xlink:href="#snoo-radial-gragient" id="snoo-radial-gragient-3" cx="109.61" cy="85.59" r="153.78" fx="109.61" fy="85.59" gradientTransform="matrix(1 0 0 .7 0 25.56)"></radialGradient><radialGradient id="snoo-radial-gragient-4" cx="-6.01" cy="64.68" r="12.85" fx="-6.01" fy="64.68" gradientTransform="matrix(1.07 0 0 1.55 81.08 27.26)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#f60"></stop><stop offset=".5" stop-color="#ff4500"></stop><stop offset=".7" stop-color="#fc4301"></stop><stop offset=".82" stop-color="#f43f07"></stop><stop offset=".92" stop-color="#e53812"></stop><stop offset="1" stop-color="#d4301f"></stop></radialGradient><radialGradient xlink:href="#snoo-radial-gragient-4" id="snoo-radial-gragient-5" cx="-73.55" cy="64.68" r="12.85" fx="-73.55" fy="64.68" gradientTransform="matrix(-1.07 0 0 1.55 62.87 27.26)"></radialGradient><radialGradient id="snoo-radial-gragient-6" cx="107.93" cy="166.96" r="45.3" fx="107.93" fy="166.96" gradientTransform="matrix(1 0 0 .66 0 57.4)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#172e35"></stop><stop offset=".29" stop-color="#0e1c21"></stop><stop offset=".73" stop-color="#030708"></stop><stop offset="1"></stop></radialGradient><radialGradient xlink:href="#snoo-radial-gragient" id="snoo-radial-gragient-7" cx="147.88" cy="32.94" r="39.77" fx="147.88" fy="32.94" gradientTransform="matrix(1 0 0 .98 0 .54)"></radialGradient><radialGradient id="snoo-radial-gragient-8" cx="131.31" cy="73.08" r="32.6" fx="131.31" fy="73.08" gradientUnits="userSpaceOnUse"><stop offset=".48" stop-color="#7a9299"></stop><stop offset=".67" stop-color="#172e35"></stop><stop offset=".75"></stop><stop offset=".82" stop-color="#172e35"></stop></radialGradient></defs><path fill="#ff4500" stroke-width="0" d="M108 0C48.35 0 0 48.35 0 108c0 29.82 12.09 56.82 31.63 76.37l-20.57 20.57C6.98 209.02 9.87 216 15.64 216H108c59.65 0 108-48.35 108-108S167.65 0 108 0Z"></path><circle cx="169.22" cy="106.98" r="25.22" fill="url(#snoo-radial-gragient)" stroke-width="0"></circle><circle cx="46.78" cy="106.98" r="25.22" fill="url(#snoo-radial-gragient-2)" stroke-width="0"></circle><ellipse cx="108.06" cy="128.64" fill="url(#snoo-radial-gragient-3)" stroke-width="0" rx="72" ry="54"></ellipse><path fill="url(#snoo-radial-gragient-4)" stroke-width="0" d="M86.78 123.48c-.42 9.08-6.49 12.38-13.56 12.38s-12.46-4.93-12.04-14.01c.42-9.08 6.49-15.02 13.56-15.02s12.46 7.58 12.04 16.66Z"></path><path fill="url(#snoo-radial-gragient-5)" stroke-width="0" d="M129.35 123.48c.42 9.08 6.49 12.38 13.56 12.38s12.46-4.93 12.04-14.01c-.42-9.08-6.49-15.02-13.56-15.02s-12.46 7.58-12.04 16.66Z"></path><ellipse cx="79.63" cy="116.37" class="snoo-cls-11 svelte-1977t4s" rx="2.8" ry="3.05"></ellipse><ellipse cx="146.21" cy="116.37" class="snoo-cls-11 svelte-1977t4s" rx="2.8" ry="3.05"></ellipse><path fill="url(#snoo-radial-gragient-6)" stroke-width="0" d="M108.06 142.92c-8.76 0-17.16.43-24.92 1.22-1.33.13-2.17 1.51-1.65 2.74 4.35 10.39 14.61 17.69 26.57 17.69s22.23-7.3 26.57-17.69c.52-1.23-.33-2.61-1.65-2.74-7.77-.79-16.16-1.22-24.92-1.22Z"></path><circle cx="147.49" cy="49.43" r="17.87" fill="url(#snoo-radial-gragient-7)" stroke-width="0"></circle><path fill="url(#snoo-radial-gragient-8)" stroke-width="0" d="M107.8 76.92c-2.14 0-3.87-.89-3.87-2.27 0-16.01 13.03-29.04 29.04-29.04 2.14 0 3.87 1.73 3.87 3.87s-1.73 3.87-3.87 3.87c-11.74 0-21.29 9.55-21.29 21.29 0 1.38-1.73 2.27-3.87 2.27Z"></path><path fill="#842123" stroke-width="0" d="M62.82 122.65c.39-8.56 6.08-14.16 12.69-14.16 6.26 0 11.1 6.39 11.28 14.33.17-8.88-5.13-15.99-12.05-15.99s-13.14 6.05-13.56 15.2c-.42 9.15 4.97 13.83 12.04 13.83h.52c-6.44-.16-11.3-4.79-10.91-13.2Zm90.48 0c-.39-8.56-6.08-14.16-12.69-14.16-6.26 0-11.1 6.39-11.28 14.33-.17-8.88 5.13-15.99 12.05-15.99 7.07 0 13.14 6.05 13.56 15.2.42 9.15-4.97 13.83-12.04 13.83h-.52c6.44-.16 11.3-4.79 10.91-13.2Z"></path></svg>');function oD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=aD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 216 216",...f}),void 0,void 0,"svelte-1977t4s"),G(m,y)}var sD=Cr('<svg><path d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240ZM330-120 120-330v-300l210-210h300l210 210v300L630-120H330Zm34-80h232l164-164v-232L596-760H364L200-596v232l164 164Zm116-280Z"></path></svg>');function W0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=sD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var lD=Cr('<svg><path d="M480-440q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0-80q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0 440q-139-35-229.5-159.5T160-516v-244l320-120 320 120v244q0 152-90.5 276.5T480-80Zm0-400Zm0-315-240 90v189q0 54 15 105t41 96q42-21 88-33t96-12q50 0 96 12t88 33q26-45 41-96t15-105v-189l-240-90Zm0 515q-36 0-70 8t-65 22q29 30 63 52t72 34q38-12 72-34t63-52q-31-14-65-22t-70-8Z"></path></svg>');function Cv(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=lD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var cD=Cr('<svg><path d="m476-80 182-480h84L924-80h-84l-43-122H603L560-80h-84ZM160-200l-56-56 202-202q-35-35-63.5-80T190-640h84q20 39 40 68t48 58q33-33 68.5-92.5T484-720H40v-80h280v-80h80v80h280v80H564q-21 72-63 148t-83 116l96 98-30 82-122-125-202 201Zm468-72h144l-72-204-72 204Z"></path></svg>');function uD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=cD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"currentColor",...f})),G(m,y)}var hD=Cr('<svg><path d="M792-56 671-177q-25 16-53 27.5T560-131v-82q14-5 27.5-10t25.5-12L480-368v208L280-360H120v-240h128L56-792l56-56 736 736-56 56Zm-8-232-58-58q17-31 25.5-65t8.5-70q0-94-55-168T560-749v-82q124 28 202 125.5T840-481q0 53-14.5 102T784-288ZM650-422l-90-90v-130q47 22 73.5 66t26.5 96q0 15-2.5 29.5T650-422ZM480-592 376-696l104-104v208Zm-80 238v-94l-72-72H200v80h114l86 86Zm-36-130Z"></path></svg>');function dD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=hD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var pD=Cr('<svg><path d="M560-131v-82q90-26 145-100t55-168q0-94-55-168T560-749v-82q124 28 202 125.5T840-481q0 127-78 224.5T560-131ZM120-360v-240h160l200-200v640L280-360H120Zm440 40v-322q47 22 73.5 66t26.5 96q0 51-26.5 94.5T560-320ZM400-606l-86 86H200v80h114l86 86v-252ZM300-480Z"></path></svg>');function fD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=pD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var mD=(m,o)=>{ce(o,!0)},_D=Te('<span class="tooltip font-flag ml-0.5"> </span>'),gD=Te('<div class="mt-1"><!></div>'),vD=Te('<p class="w-full text-black"> <!></p>'),yD=Te('<p class="w-full text-black"><!></p>'),xD=Te('<div class=" flex items-center gap-[8px]"><!> <!></div>'),bD=(m,o,f)=>{localStorage.setItem(vx,x(o).key),ce(f,x(o).key,!0),location.reload()},wD=Te('<span class="center-absolute loading loading-spinner loading-xs absolute"></span>'),TD=Te("<li><button><!> </button></li>"),CD=Te('<div class="tooltip"><button class="btn btn-sm btn-circle"><!></button></div>'),SD=async(m,o)=>{var f;try{const y=await((f=x(o))==null?void 0:f.prompt());(y==null?void 0:y.outcome)==="accepted"&&ce(o,void 0)}catch(y){Nr.error(G2({error:y.message}))}},PD=Te('<button class="btn pwa:hidden w-full sm:hidden"><!> </button>'),ID=Te('<a class="btn w-full" target="_blank"><!> </a>'),MD=Te('<a class="btn w-full" target="_blank"><!> </a>'),kD=Te('<form class="w-full" method="POST"><button class="btn w-full"><!> </button></form> <a class="btn w-full" target="_blank"><!> </a>',1),AD=async(m,o,f,y)=>{var M;try{ce(o,!0),await f.user.logout(),y(),Nr.warning(FS(),{icon:H0}),(M=f.onlogout)==null||M.call(f)}catch{Nr.error(jS())}finally{ce(o,!1)}},ED=Te('<div class="dropdown"><div tabindex="0" role="button"><!></div> <div class="dropdown-content menu bg-base-100 rounded-box border-base-300 z-1 relative right-1 w-[min(100vw-24px,400px)] translate-y-2 border p-4 shadow-md" tabindex="0"><button class="btn btn-ghost btn-circle absolute right-2 top-2"><!></button> <section class="flex gap-2"><div class="relative"><!> <button class="btn btn-circle btn-sm absolute -bottom-1 -right-1"><!></button></div> <div><div class="flex items-center gap-1.5 pr-8 text-lg font-medium"><h3 class="line-clamp-1 text-ellipsis text-lg"> </h3> <span> </span> <!> <!></div> <div class="flex items-center gap-1"><!> <span> <span class="text-primary font-semibold"> </span></span></div> <div class="flex items-center gap-1"><!> <span class="text-secondary"><span class="font-semibold"> </span> <button class="tooltip"><!></button></span></div></div></section> <section class="mt-3 flex flex-col gap-2"><!> <div class="mb-1 flex items-center justify-between"><h3 class="text-lg font-semibold"> </h3> <div class="flex items-center gap-2"><div class="dropdown dropdown-end"><div tabindex="0" role="button" class="btn btn-sm btn-circle"><!></div> <ul tabindex="0" class="dropdown-content menu bg-base-100 z-1 w-max rounded-xl p-2 shadow-sm"></ul></div> <div class="tooltip"><button class="btn btn-sm btn-circle"><!></button></div> <!></div></div>  <!> <!> <!> <a class="btn w-full" href="https://www.twitch.tv/directory/category/wplace" target="_blank"><!> </a> <a class="btn w-full" href="http://discord.gg/wplacelive" target="_blank"><!> Discord</a> <a class="btn w-full" href="https://www.reddit.com/r/WplaceLive/" target="_blank"><!> Reddit</a> <!> <button class="btn"><!> </button></section></div></div> <!>',1);function zD(m,o){Br(o,!0);let f=ct(!1),y=ct(!1);function M(){var ie;(ie=document.activeElement)==null||ie.blur()}const z=[{label:"ðŸ‡ºðŸ‡¸ English",key:"en"},{label:"ðŸ‡§ðŸ‡· PortuguÃªs",key:"pt"}];let T=ct(""),s=ct(void 0);const B=ft(()=>{var ie;return!!((ie=o.user.data)!=null&&ie.banned)||!!o.user.timeoutUntil});var N=er(),Y=Ct(N);{var K=ie=>{var H=ED(),me=Ct(H),ve=E(me);let Me;var Ee=E(ve);Ov(Ee,{get userId(){return o.user.data.id},get level(){return o.user.data.level},get pictureUrl(){return o.user.data.picture}}),k(ve);var Re=q(ve,2),ze=E(Re);ze.__click=M;var Fe=E(ze);_l(Fe,{class:"size-5"}),k(ze);var Ke=q(ze,2),rt=E(Ke),qe=E(rt);lo(qe,{get userId(){return o.user.data.id},get pictureUrl(){return o.user.data.picture},get isSuspended(){return x(B)}});var He=q(qe,2);He.__click=[mD,f];var et=E(He);Qf(et,{class:"size-4"}),k(He),k(rt);var De=q(rt,2),tt=E(De),nt=E(tt),Ze=E(nt,!0);k(nt);var ke=q(nt,2),bt=E(ke);k(ke);var te=q(ke,2);{var re=jt=>{const Et=ft(()=>So(o.user.data.equippedFlag));var hr=_D(),ht=E(hr,!0);k(hr),Ye(()=>{xr(hr,"data-tip",x(Et).name),fe(ht,x(Et).flag)}),G(jt,hr)};je(te,jt=>{o.user.data.equippedFlag&&jt(re)})}var ge=q(te,2);{var oe=jt=>{var Et=gD(),hr=E(Et);Ah(hr,{get username(){return o.user.data.discord},get id(){return o.user.data.discordId}}),k(Et),G(jt,Et)};je(ge,jt=>{o.user.data.discord&&jt(oe)})}k(tt);var Ae=q(tt,2),Ne=E(Ae);Eh(Ne,{class:"inline size-4"});var pt=q(Ne,2),ot=E(pt),ut=q(ot),St=E(ut,!0);k(ut),k(pt),k(Ae);var Bt=q(Ae,2),at=E(Bt);KL(at,{class:"inline size-4"});var dt=q(at,2),vt=E(dt),yt=E(vt);k(vt);var It=q(vt),wt=q(It),mt=E(wt);Uu(mt,{class:"mb-0.5 inline size-4 opacity-50"}),k(wt),k(dt),k(Bt),k(De),k(Ke);var Dt=q(Ke,2),zt=E(Dt);{var qt=jt=>{var Et=xD(),hr=E(Et);W0(hr,{class:"size-6 text-red-500"});var ht=q(hr,2);{var Hr=qr=>{var _t=vD(),Ge=E(_t),At=q(Ge);{var Rt=Yt=>{var br=bi();Ye(Er=>fe(br,`(${Er??""})`),[()=>sI({reason:cx()})]),G(Yt,br)};je(At,Yt=>{o.user.data.suspensionReason==="bot"&&Yt(Rt)})}k(_t),Ye(Yt=>fe(Ge,`${Yt??""} `),[()=>sx()]),G(qr,_t)},Yr=qr=>{var _t=er(),Ge=Ct(_t);{var At=Rt=>{var Yt=yD(),br=E(Yt);Mm(br,()=>lx({until:`<span class="text-secondary font-medium text-nowrap">${o.user.timeoutUntil.toLocaleString()}</span>`})),k(Yt),G(Rt,Yt)};je(Ge,Rt=>{o.user.timeoutUntil&&Rt(At)},!0)}G(qr,_t)};je(ht,qr=>{var _t;(_t=o.user.data)!=null&&_t.banned?qr(Hr):qr(Yr,!1)})}k(Et),G(jt,Et)};je(zt,jt=>{x(B)&&jt(qt)})}var tr=q(zt,2),Qt=E(tr),Ot=E(Qt,!0);k(Qt);var fr=q(Qt,2),kr=E(fr),Ar=E(kr),rr=E(Ar);uD(rr,{class:"size-4"}),k(Ar);var Kt=q(Ar,2);hi(Kt,21,()=>z,hp,(jt,Et)=>{const hr=ft(()=>x(T)===x(Et).key);var ht=TD(),Hr=E(ht);let Yr;Hr.__click=[bD,Et,T];var qr=E(Hr);{var _t=At=>{var Rt=wD();G(At,Rt)};je(qr,At=>{x(hr)&&At(_t)})}var Ge=q(qr);k(Hr),k(ht),Ye(At=>{Yr=zr(Hr,1,"font-flag relative font-medium",null,Yr,At),fe(Ge,` ${x(Et).label??""}`)},[()=>({"bg-base-200":x(hr)})]),G(jt,ht)}),k(Kt),k(kr);var or=q(kr,2),Sr=E(or);Sr.__click=()=>{ai.muted=!ai.muted};var Dr=E(Sr);{var Zr=jt=>{dD(jt,{class:"size-4"})},se=jt=>{fD(jt,{class:"size-4"})};je(Dr,jt=>{ai.muted?jt(Zr):jt(se,!1)})}k(Sr),k(or);var j=q(or,2);{var Z=jt=>{var Et=CD(),hr=E(Et);hr.__click=()=>{ai.theme=ai.theme==="dark"?"custom-winter":"dark"};var ht=E(hr);{var Hr=qr=>{tD(qr,{class:"size-4"})},Yr=qr=>{QL(qr,{class:"size-4"})};je(ht,qr=>{ai.theme==="dark"?qr(Hr):qr(Yr,!1)})}k(hr),k(Et),Ye(qr=>xr(Et,"data-tip",qr),[()=>ai.theme==="dark"?wI():yI()]),G(jt,Et)};je(j,jt=>{var Et,hr;xc((hr=(Et=o.user)==null?void 0:Et.data)==null?void 0:hr.role,["admin","moderator","global_moderator"])&&jt(Z)})}k(fr),k(tr);var X=q(tr,2);{var ae=jt=>{var Et=PD();Et.__click=[SD,s];var hr=E(Et);zv(hr,{class:"size-5"});var ht=q(hr);k(Et),Ye(Hr=>fe(ht,` ${Hr??""}`),[()=>X2()]),G(jt,Et)};je(X,jt=>{x(s)&&jt(ae)})}var de=q(X,2);{var Se=jt=>{var Et=ID(),hr=E(Et);Cv(hr,{class:"size-5"});var ht=q(hr);k(Et),Ye(Hr=>{xr(Et,"href",`${vi.url.origin??""}/admin/dashboard`),fe(ht,` ${Hr??""}`)},[()=>iI()]),G(jt,Et)};je(de,jt=>{var Et;((Et=o.user.data)==null?void 0:Et.role)==="admin"&&jt(Se)})}var Ie=q(de,2);{var be=jt=>{var Et=MD(),hr=E(Et);Cv(hr,{class:"size-5"});var ht=q(hr);k(Et),Ye(Hr=>{xr(Et,"href",`${vi.url.origin??""}/admin`),fe(ht,` ${Hr??""}`)},[()=>jP()]),G(jt,Et)};je(Ie,jt=>{var Et;(Et=o.user.data)!=null&&Et.role&&o.user.data.role!=="user"&&jt(be)})}var Oe=q(Ie,2),st=E(Oe);Vv(st,{class:"size-5"});var $e=q(st);k(Oe);var Mt=q(Oe,2),xe=E(Mt);Kf(xe,{class:"size-5"}),vn(),k(Mt);var Ft=q(Mt,2),cr=E(Ft);oD(cr,{class:"size-5"}),vn(),k(Ft);var Jt=q(Ft,2);{var Tr=jt=>{var Et=kD(),hr=Ct(Et),ht=E(hr),Hr=E(ht);iD(Hr,{class:"size-5"});var Yr=q(Hr);k(ht),k(hr);var qr=q(hr,2),_t=E(qr);Uu(_t,{class:"size-5"});var Ge=q(_t);k(qr),Ye((At,Rt,Yt)=>{xr(hr,"action",`${ox}/payment/create-portal-session`),fe(Yr,` ${At??""}`),xr(qr,"href",Rt),fe(Ge,` ${Yt??""}`)},[()=>xx(),()=>Bv(vi.url.origin),()=>Kv()]),G(jt,Et)};je(Jt,jt=>{var Et;(Et=o.user.data)!=null&&Et.isCustomer&&jt(Tr)})}var Xr=q(Jt,2);Xr.__click=[AD,y,o,M];var dn=E(Xr);H0(dn,{class:"size-5"});var xn=q(dn);k(Xr),k(Dt),k(Re),k(me);var mn=q(me,2);XL(mn,{get userData(){return o.user.data},get open(){return x(f)},set open(jt){ce(f,jt,!0)}}),Ye((jt,Et,hr,ht,Hr,Yr,qr,_t,Ge,At,Rt,Yt)=>{Me=zr(ve,1,"btn size-12 p-0 shadow-md",null,Me,jt),xr(ve,"title",Et),xr(nt,"title",o.user.data.name),fe(Ze,o.user.data.name),zr(ke,1,hr),fe(bt,`#${o.user.data.id??""}`),fe(ot,`${ht??""}: `),fe(St,Hr),fe(yt,`Level ${Yr??""}`),fe(It,` (${qr??""}%) `),xr(wt,"data-tip",_t),fe(Ot,Ge),xr(or,"data-tip",At),fe($e,` ${Rt??""}`),Xr.disabled=x(y),fe(xn,` ${Yt??""}`)},[()=>({"bg-red-500":x(B)}),()=>j2(),()=>Ko(Oi(o.user.data.id)),()=>Am(),()=>o.user.data.pixelsPainted.toLocaleString("en-US"),()=>Math.floor(o.user.data.level),()=>Math.floor(o.user.data.level%1*100),()=>n3(),()=>Z2(),()=>ai.muted?FC():DC(),()=>J2(),()=>tw()]),Ai("focus",ve,()=>{ce(s,window.pwaInstallPrompt,!0)}),G(ie,H)};je(Y,ie=>{o.user.data&&o.user.charges!==void 0&&ie(K)})}G(m,N),Fr()}Qn(["click"]);var LD=Cr('<svg><path d="M100-240v-480l360 240-360 240Zm400 0v-480l360 240-360 240ZM180-480Zm400 0Zm-400 90 136-90-136-90v180Zm400 0 136-90-136-90v180Z"></path></svg>');function DD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=LD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"currentColor",...f})),G(m,y)}var RD=Cr('<svg><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q146 0 255.5 91.5T872-559h-82q-19-73-68.5-130.5T600-776v16q0 33-23.5 56.5T520-680h-80v80q0 17-11.5 28.5T400-560h-80v80h80v120h-40L168-552q-3 18-5.5 36t-2.5 36q0 131 92 225t228 95v80Zm364-20L716-228q-21 12-45 20t-51 8q-75 0-127.5-52.5T440-380q0-75 52.5-127.5T620-560q75 0 127.5 52.5T800-380q0 27-8 51t-20 45l128 128-56 56ZM620-280q42 0 71-29t29-71q0-42-29-71t-71-29q-42 0-71 29t-29 71q0 42 29 71t71 29Z"></path></svg>');function BD(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=RD();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var FD=async(m,o,f,y,M,z)=>{if(x(o)){f.map.easeTo(x(o)),ce(o,void 0);return}ce(y,!0);try{Co(f.map.getCenter(),f.map.getZoom());const T=new fl(x(M)),{tile:s,pixel:B}=await en.getRandomTile(f.season),N=s.x*x(M)+B.x,Y=s.y*x(M)+B.y,[K,ie]=T.pixelsToLatLon(N,Y,x(z)),H={lat:K,lng:ie},me=x(z)+2;ce(o,{zoom:me,center:H},!0),f.map.flyTo(x(o)),hl.isEmpty()&&hl.push({pos:f.map.getCenter(),zoom:f.map.getZoom()}),setTimeout(()=>{ce(o,void 0)},2500),hl.push({pos:H,zoom:me})}catch(T){Nr.error(T.message)}finally{ce(y,!1)}},OD=Te('<button class="btn btn-square shadow-md"><!></button>');function ND(m,o){Br(o,!0);const f=ft(()=>Hi.seasons[o.season].tileSize),y=ft(()=>Hi.seasons[o.season].zoom);let M=ct(!1),z=ct(void 0);var T=OD();T.__click=[FD,z,o,M,f,y];var s=E(T);{var B=Y=>{BD(Y,{class:"size-5"})},N=Y=>{DD(Y,{class:"size-5"})};je(s,Y=>{x(z)?Y(N,!1):Y(B)})}k(T),Ye(Y=>{xr(T,"title",Y),T.disabled=x(M)},[()=>f2()]),G(m,T),Fr()}Qn(["click"]);var jD=Te('<label class="tab grow font-semibold max-sm:h-10"><input type="radio" class="tab grow"/> <!> </label>'),VD=Te('<div class="text-base-content/80 mt-20 text-center text-sm"> <!></div>'),qD=Te('<span class="font-flag tooltip ml-0.5"> </span>'),ZD=Te("<span> </span>"),UD=Te('<tr><td class="text-base-content/80 text-center font-medium"> </td><td class="max-sm:px-1"><div class="flex items-center gap-2"><!> <div class="items-center gap-2 sm:flex"><span> <span class="ml-0.5"> </span></span> <!> <!> <!></div></div></td><td class="text-base-content/80 text-center font-medium max-sm:px-1"> </td></tr>'),$D=Te('<table class="table"><thead class="text-base-content/80"><tr><th></th><th class="max-sm:px-1"> </th><th class="text-center"> <br class="sm:hidden"/> </th></tr></thead><tbody></tbody></table>'),GD=Te('<tr><td class="text-base-content/80 text-center font-medium"> </td><td class="h-14 max-sm:px-1"><span> </span></td><td class="text-base-content/80 text-center font-medium max-sm:px-1"> </td></tr>'),HD=Te('<table class="table"><thead class="text-base-content/80"><tr><th></th><th class="max-sm:px-1"> </th><th class="text-center"> <br class="sm:hidden"/> </th></tr></thead><tbody></tbody></table>'),WD=Te('<div class="h-screen pt-20"><div class="flex justify-center"><span class="loading loading-spinner"></span></div></div>'),XD=Te('<div class="tabs tabs-box"></div> <div class="my-4 flex items-center justify-between"><!></div> <!>',1);function YD(m,o){Br(o,!0);const f=[];let y=ct("today"),M={players:{label:Xv(),icon:vp},alliances:{label:Yv(),icon:yp}},z=ct("players"),T=xi({players:{},alliances:{}});const s=ft(()=>T[x(z)][x(y)]);Wr(()=>{if(x(s))return;const ve=x(y),Me=x(z);Me==="players"?en.leaderboardRegionPlayers(o.regionId,ve).then(Ee=>{T[Me][ve]=Ee}).catch(Ee=>{Nr.error(Ee.message)}):Me==="alliances"&&en.leaderboardRegionAlliances(o.regionId,ve).then(Ee=>{T[Me][ve]=Ee}).catch(Ee=>{Nr.error(Ee.message)})});var B=XD(),N=Ct(B);hi(N,21,()=>Object.entries(M),([ve,{label:Me,icon:Ee}])=>ve,(ve,Me)=>{var Ee=ft(()=>Mv(x(Me),2));let Re=()=>x(Ee)[0],ze=()=>x(Ee)[1].label,Fe=()=>x(Ee)[1].icon;const Ke=ft(Fe);var rt=jD(),qe=E(rt);uo(qe);var He,et=q(qe,2);yi(et,()=>x(Ke),(tt,nt)=>{nt(tt,{get this(){return Fe()},class:"mr-1 size-5 max-sm:hidden"})});var De=q(et);k(rt),Ye(()=>{xr(qe,"aria-label",ze()),He!==(He=Re())&&(qe.value=(qe.__value=Re())??""),fe(De,` ${ze()??""}`)}),Em(f,[],qe,()=>(Re(),x(z)),tt=>ce(z,tt)),G(ve,rt)}),k(N);var Y=q(N,2),K=E(Y);Zm(K,{get value(){return x(y)},set value(ve){ce(y,ve,!0)}}),k(Y);var ie=q(Y,2);{var H=ve=>{var Me=VD(),Ee=E(Me),Re=q(Ee);{var ze=Ke=>{var rt=bi();Ye(qe=>fe(rt,qe),[()=>gp().toLowerCase()]),G(Ke,rt)},Fe=Ke=>{var rt=er(),qe=Ct(rt);{var He=De=>{var tt=bi();Ye(nt=>fe(tt,nt),[()=>Om()]),G(De,tt)},et=De=>{var tt=er(),nt=Ct(tt);{var Ze=ke=>{var bt=bi();Ye(te=>fe(bt,te),[()=>Nm()]),G(ke,bt)};je(nt,ke=>{x(y)==="month"&&ke(Ze)},!0)}G(De,tt)};je(qe,De=>{x(y)==="week"?De(He):De(et,!1)},!0)}G(Ke,rt)};je(Re,Ke=>{x(y)==="today"?Ke(ze):Ke(Fe,!1)})}k(Me),Ye(Ke=>fe(Ee,`${Ke??""} `),[()=>Fm()]),G(ve,Me)},me=ve=>{var Me=er(),Ee=Ct(Me);{var Re=Fe=>{var Ke=er(),rt=Ct(Ke);{var qe=et=>{const De=ft(()=>x(s));var tt=$D(),nt=E(tt),Ze=E(nt),ke=q(E(Ze)),bt=E(ke,!0);k(ke);var te=q(ke),re=E(te),ge=q(re,2,!0);k(te),k(Ze),k(nt);var oe=q(nt);hi(oe,31,()=>x(De),Ae=>Ae.id,(Ae,Ne,pt)=>{const ot=ft(()=>{var Kt;return((Kt=kt.data)==null?void 0:Kt.id)===x(Ne).id});var ut=UD();let St;var Bt=E(ut),at=E(Bt,!0);k(Bt);var dt=q(Bt),vt=E(dt),yt=E(vt);lo(yt,{class:"size-10 border",get userId(){return x(Ne).id},get pictureUrl(){return x(Ne).picture}});var It=q(yt,2),wt=E(It),mt=E(wt),Dt=q(mt),zt=E(Dt);k(Dt),k(wt);var qt=q(wt,2);{var tr=Kt=>{const or=ft(()=>So(x(Ne).equippedFlag));var Sr=qD(),Dr=E(Sr,!0);k(Sr),Ye(()=>{xr(Sr,"data-tip",x(or).name),fe(Dr,x(or).flag)}),G(Kt,Sr)};je(qt,Kt=>{"equippedFlag"in x(Ne)&&x(Ne).equippedFlag&&Kt(tr)})}var Qt=q(qt,2);{var Ot=Kt=>{Ah(Kt,{get username(){return x(Ne).discord},get id(){return x(Ne).discordId}})};je(Qt,Kt=>{x(Ne).discord&&Kt(Ot)})}var fr=q(Qt,2);{var kr=Kt=>{var or=ZD(),Sr=E(or,!0);k(or),Ye((Dr,Zr)=>{zr(or,1,`badge badge-sm ml-0.5 border-0 ${Dr??""} ${Zr??""}`),fe(Sr,x(Ne).allianceName)},[()=>dp(x(Ne).allianceId),()=>Oi(x(Ne).allianceId)]),G(Kt,or)};je(fr,Kt=>{"allianceName"in x(Ne)&&x(Ne).allianceName&&Kt(kr)})}k(It),k(vt),k(dt);var Ar=q(dt),rr=E(Ar,!0);k(Ar),k(ut),Ye((Kt,or,Sr)=>{St=zr(ut,1,"",null,St,Kt),fe(at,x(pt)+1),zr(wt,1,`font-semibold max-sm:ml-2 ${or??""} flex gap-1`),fe(mt,`${x(Ne).name??""} `),fe(zt,`#${x(Ne).id??""}`),fe(rr,Sr)},[()=>({"bg-base-200":x(ot)}),()=>Oi(x(Ne).id),()=>x(Ne).pixelsPainted.toLocaleString("en-US")]),sl(ut,()=>ll,()=>({duration:200})),G(Ae,ut)}),k(oe),k(tt),Ye((Ae,Ne,pt)=>{fe(bt,Ae),fe(re,`${Ne??""} `),fe(ge,pt)},[()=>Lm(),()=>vc(),()=>yc().toLowerCase()]),G(et,tt)},He=et=>{var De=er(),tt=Ct(De);{var nt=Ze=>{var ke=HD(),bt=E(ke),te=E(bt),re=q(E(te)),ge=E(re,!0);k(re);var oe=q(re),Ae=E(oe),Ne=q(Ae,2,!0);k(oe),k(te),k(bt);var pt=q(bt);hi(pt,31,()=>x(s),ot=>ot.id,(ot,ut,St)=>{const Bt=ft(()=>{var qt;return((qt=kt.data)==null?void 0:qt.allianceId)===x(ut).id});var at=GD();let dt;var vt=E(at),yt=E(vt,!0);k(vt);var It=q(vt),wt=E(It),mt=E(wt,!0);k(wt),k(It);var Dt=q(It),zt=E(Dt,!0);k(Dt),k(at),Ye((qt,tr,Qt)=>{dt=zr(at,1,"",null,dt,qt),fe(yt,x(St)+1),zr(wt,1,`font-semibold ${tr??""}`),fe(mt,x(ut).name),fe(zt,Qt)},[()=>({"bg-base-200":x(Bt)}),()=>Oi(x(ut).id),()=>x(ut).pixelsPainted.toLocaleString("en-US")]),sl(at,()=>ll,()=>({duration:200})),G(ot,at)}),k(pt),k(ke),Ye((ot,ut,St)=>{fe(ge,ot),fe(Ae,`${ut??""} `),fe(Ne,St)},[()=>mp(),()=>vc(),()=>yc().toLowerCase()]),G(Ze,ke)};je(tt,Ze=>{x(z)==="alliances"&&Ze(nt)},!0)}G(et,De)};je(rt,et=>{x(z)==="players"?et(qe):et(He,!1)})}G(Fe,Ke)},ze=Fe=>{var Ke=WD();G(Fe,Ke)};je(Ee,Fe=>{x(s)?Fe(Re):Fe(ze,!1)},!0)}G(ve,Me)};je(ie,ve=>{x(s)&&x(s).length===0?ve(H):ve(me,!1)})}G(m,B),Fr()}var KD=Te('<div class="mt-5"><!></div>'),JD=Te('<dialog class="modal"><div class="modal-box h-11/12 max-w-3xl"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button></form> <h2><span class="font-flag tooltip"> </span> <span> </span> <span> </span></h2> <!></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog>');function QD(m,o){Br(o,!0);let f=Lt(o,"open",15);const y=ft(()=>So(o.region.countryId));Dn(()=>{const ve=Me=>{Me.key==="Escape"&&f(!1)};return document.addEventListener("keydown",ve),()=>document.removeEventListener("keydown",ve)});var M=JD(),z=E(M),T=q(E(z),2),s=E(T),B=E(s,!0);k(s);var N=q(s,2),Y=E(N,!0);k(N);var K=q(N,2),ie=E(K);k(K),k(T);var H=q(T,2);{var me=ve=>{var Me=KD(),Ee=E(Me);YD(Ee,{get regionId(){return o.region.id}}),k(Me),ki(2,Me,()=>ia,()=>({duration:300})),G(ve,Me)};je(H,ve=>{f()&&ve(me)})}k(z),vn(2),k(M),Wi(M,()=>ve=>{Wr(()=>{f()?ve.show():ve.close()})}),Ye(ve=>{zr(T,1,`flex gap-2 text-xl font-bold sm:text-2xl ${ve??""}`),xr(s,"data-tip",x(y).name),fe(B,x(y).flag),fe(Y,o.region.name),fe(ie,`#${o.region.number??""}`)},[()=>Oi(o.region.cityId)]),Ai("close",M,()=>f(!1)),G(m,M),Fr()}var eR=Cr('<svg><path d="M791-55 686-160H160v-112q0-34 17.5-62.5T224-378q45-23 91.5-37t94.5-21L55-791l57-57 736 736-57 57ZM240-240h366L486-360h-6q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm496-138q29 14 46 42.5t18 61.5L666-408q18 7 35.5 14t34.5 16ZM568-506l-59-59q23-9 37-29.5t14-45.5q0-33-23.5-56.5T480-720q-25 0-45.5 14T405-669l-59-59q23-34 58-53t76-19q66 0 113 47t47 113q0 41-19 76t-53 58Zm38 266H240h366ZM457-617Z"></path></svg>');function tR(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=eR();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"currentColor",...f})),G(m,y)}var rR=Cr('<svg><path d="m233-120 65-281L80-590l288-25 112-265 112 265 288 25-218 189 65 281-247-149-247 149Z"></path></svg>'),nR=Cr('<svg><path d="m354-287 126-76 126 77-33-144 111-96-146-13-58-136-58 135-146 13 111 97-33 143ZM233-120l65-281L80-590l288-25 112-265 112 265 288 25-218 189 65 281-247-149-247 149Zm247-350Z"></path></svg>');function iR(m,o){let f=ir(o,["$$slots","$$events","$$legacy","filled"]);var y=er(),M=Ct(y);{var z=s=>{var B=rR();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)},T=s=>{var B=nR();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)};je(M,s=>{o.filled?s(z):s(T,!1)})}G(m,y)}var aR=(m,o,f,y,M)=>{if(x(o)&&x(f)){const z=x(o)-x(f).clientHeight,T=x(o)/2-z/2;y.map.flyTo({center:{lat:x(M).center[0],lng:x(M).center[1]},zoom:17.5,offset:[0,-T]})}},oR=(m,o,f)=>o.onclickregion(x(f)),sR=Te('<button><span class="font-flag tooltip"> </span> <span class="line-clamp-1 text-ellipsis"> </span> <span> </span></button>'),lR=Te('<div class="skeleton h-5 w-16"></div>'),cR=Te('<div class="skeleton mt-1 h-5 w-32"></div>'),uR=Te('<span class="font-flag tooltip ml-0.5"> </span>'),hR=(m,o)=>{navigator.clipboard.writeText(x(o).allianceId.toString()),Nr.success(Bm())},dR=Te("<button><!></button>"),pR=Te("<span> </span> <!>",1),fR=Te('<span class="tooltip"><!></span>'),mR=Te('<span class="tooltip"><!></span>'),_R=(m,o)=>{o("report-user")},gR=Te("<li><button><!> </button></li>"),vR=(m,o)=>{o("timeout")},yR=Te("<li><button><!> </button></li>"),xR=(m,o)=>{o("ban")},bR=Te("<li><button><!> </button></li>"),wR=async(m,o,f,y,M,z)=>{ce(o,!0);try{await en.banAllianceUser(x(f).id),await y({...x(M),season:z.season})}catch(T){Nr.error(T.message)}finally{ce(o,!1)}},TR=Te('<li><button class="text-error font-medium"><!> </button></li>'),CR=Te('<div class="dropdown dropdown-top max-sm:dropdown-top max-sm:dropdown-left ml-1"><button tabindex="0" class="btn btn-xs btn-circle"><!></button> <ul tabindex="0" class="dropdown-content menu bg-base-100 z-1 mb-1 w-max gap-0.5 rounded-xl p-2.5 shadow-sm"></ul></div>'),SR=Te('<div class="flex items-center gap-1"><span> </span> <div class="ml-0.5"><!></div> <div class="flex flex-wrap items-center gap-1"><span><span> </span> <span> </span></span> <!> <!> <!> <!></div> <!></div>'),PR=(m,o)=>o.onclickpaint(o.latLon),IR=async(m,o,f,y)=>{try{ce(o,!0),x(f)?(await en.deleteFavoriteLocation(x(f).id),Nr.warning(uS())):(await en.favoriteLocation(x(y).center),Nr.success(pS())),aa.smallPlop.play(),kt.refresh()}catch(M){Nr.error(M.message)}finally{ce(o,!1)}},MR=Te("<button><!> </button>"),kR=(m,o,f)=>o.onclickshare(BI(vi.url,{pos:{lat:x(f).center[0],lng:x(f).center[1]},zoom:o.zoom})),AR=Te('<div><div class="flex gap-2 px-3"><div class="flex grow gap-1"><button class="btn btn-sm btn-circle btn-soft"><!></button> <h2 class="mt-0.5 flex items-center gap-2 text-lg"><span class="whitespace-nowrap"> </span> <!></h2></div> <button class="btn btn-circle btn-sm"><!></button></div> <div class="text-base-content/80 mt-1 px-3 text-sm"><!></div> <div class="hide-scrollbar flex max-w-full gap-1.5 overflow-x-auto px-3 pb-2 pt-3 sm:pb-3"><button class="btn btn-primary"><!> </button> <!> <button class="btn btn-primary btn-soft"><!> </button></div></div>');function ER(m,o){Br(o,!0);let f=ct(void 0);const y=ft(()=>new fl(o.tileSize));let M=ct(void 0),z=ct(void 0),T=ct(!1),s=ct(!1);const B=ft(()=>{var at,dt,vt;return!!((dt=(at=x(f))==null?void 0:at.paintedBy)!=null&&dt.id)&&((vt=kt.data)==null?void 0:vt.id)===x(f).paintedBy.id}),N=ft(()=>{const[at,dt]=o.latLon??[0,0],vt=x(y).latLonToPixelBoundsLatLon(at,dt,o.pixelArtZoom),yt=Vm(vt),{tile:It,pixel:wt}=x(y).latLonToTileAndPixel(at,dt,o.pixelArtZoom),mt=x(y).latLonToRegionAndPixel(at,dt,o.pixelArtZoom);return{bounds:vt,center:yt,tile:It,pixel:wt,regionPixel:mt.pixel}});Wr(()=>{aa.plop.play(),o.crosshair.clearAndPlace(o.latLon)});let Y=0;const K=({pixel:at,tile:dt,season:vt})=>`s${vt}:p(${at[0]},${at[1]}):t(${dt[0]},${dt[1]})`;let ie;dl(()=>[x(N),o.season],()=>{const at={...x(N),season:o.season},dt=K(at);if(ce(f,o.pixelInfoCache.get(dt),!0),x(f)!==void 0)return;o.pixelInfoCache.size===0&&(Y=0),Y++,Y>6?(clearTimeout(ie),ie=setTimeout(async()=>H(at),500)):H(at)});async function H(at){var yt;const dt=await en.getPixelInfo({...at,isModerator:xc((yt=kt.data)==null?void 0:yt.role,["admin","global_moderator","moderator"])});if(dt.paintedBy!==void 0){const It=K(at);o.pixelInfoCache.set(It,dt)}const vt=K({...x(N),season:o.season});return ce(f,o.pixelInfoCache.get(vt),!0),dt}function me(){o.crosshair.clear(),aa.smallPlop.play(),o.onclose()}Dn(()=>{const at=dt=>{dt.key==="Escape"&&me()};return document.addEventListener("keydown",at),()=>document.removeEventListener("keydown",at)});const ve=ft(()=>{var yt,It,wt,mt,Dt;const at=[],dt=(It=(yt=kt)==null?void 0:yt.data)==null?void 0:It.role;xc(dt,["admin"])&&!x(B)&&at.push("ban-user"),xc(dt,["admin","global_moderator","moderator"])&&!x(B)&&at.push("timeout-user"),!x(B)&&kt.data&&at.push("report-user");const vt=(wt=x(f))==null?void 0:wt.paintedBy;return(vt==null?void 0:vt.allianceId)===((mt=kt.data)==null?void 0:mt.allianceId)&&((Dt=kt.data)==null?void 0:Dt.allianceRole)==="admin"&&kt.data.id!==(vt==null?void 0:vt.id)&&!x(B)&&at.push("ban-alliance"),at});function Me(at){const dt=(async()=>await i0(o.map,{maxHeight:1080,maxWidth:1080,quality:.8,type:"image/jpeg"}))();o.onclickmodaction(x(f),dt,o.latLon,at)}var Ee=AR(),Re=E(Ee),ze=E(Re),Fe=E(ze);Fe.__click=[aR,M,z,o,N];var Ke=E(Fe);km(Ke,{class:"fill-primary size-5"}),k(Fe);var rt=q(Fe,2),qe=E(rt),He=E(qe);k(qe);var et=q(qe,2);{var De=at=>{const dt=ft(()=>x(f).region),vt=ft(()=>So(x(dt).countryId));var yt=sR();yt.__click=[oR,o,dt];var It=E(yt),wt=E(It,!0);k(It);var mt=q(It,2),Dt=E(mt,!0);k(mt);var zt=q(mt,2),qt=E(zt);k(zt),k(yt),Ye(tr=>{zr(yt,1,`btn btn-xs flex gap-1 py-3 text-sm max-sm:max-w-32 ${tr??""}`),xr(It,"data-tip",x(vt).name),fe(wt,x(vt).flag),fe(Dt,x(dt).name),fe(qt,`#${x(dt).number??""}`)},[()=>Oi(x(dt).cityId)]),G(at,yt)},tt=at=>{var dt=lR();G(at,dt)};je(et,at=>{var dt;(dt=x(f))!=null&&dt.region?at(De):at(tt,!1)})}k(rt),k(ze);var nt=q(ze,2);nt.__click=me;var Ze=E(nt);_l(Ze,{class:"size-4"}),k(nt),k(Re);var ke=q(Re,2),bt=E(ke);{var te=at=>{var dt=cR();G(at,dt)},re=at=>{var dt=er(),vt=Ct(dt);{var yt=wt=>{var mt=bi();Ye(Dt=>fe(mt,Dt),[()=>_C()]),G(wt,mt)},It=wt=>{const mt=ft(()=>x(f).paintedBy);var Dt=SR(),zt=E(Dt),qt=E(zt);k(zt);var tr=q(zt,2),Qt=E(tr);lo(Qt,{class:"size-5 border-0",get userId(){return x(mt).id},get pictureUrl(){return x(mt).picture}}),k(tr);var Ot=q(tr,2),fr=E(Ot),kr=E(fr),Ar=E(kr,!0);k(kr);var rr=q(kr,2),Kt=E(rr);k(rr),k(fr);var or=q(fr,2);{var Sr=Ie=>{const be=ft(()=>So(x(mt).equippedFlag));var Oe=uR(),st=E(Oe,!0);k(Oe),Ye(()=>{xr(Oe,"data-tip",x(be).name),fe(st,x(be).flag)}),G(Ie,Oe)};je(or,Ie=>{x(mt).equippedFlag&&Ie(Sr)})}var Dr=q(or,2);{var Zr=Ie=>{Ah(Ie,{get username(){return x(mt).discord},get id(){return x(mt).discordId}})};je(Dr,Ie=>{x(mt).discord&&Ie(Zr)})}var se=q(Dr,2);{var j=Ie=>{var be=pR(),Oe=Ct(be),st=E(Oe,!0);k(Oe);var $e=q(Oe,2);{var Mt=xe=>{var Ft=dR();Ft.__click=[hR,mt];var cr=E(Ft);Dm(cr,{class:"size-3"}),k(Ft),Ye((Jt,Tr)=>{zr(Ft,1,Jt),xr(Ft,"title",Tr)},[()=>Ko(Oi(x(mt).allianceId)),()=>Fx({allianceId:x(mt).allianceId})]),G(xe,Ft)};je($e,xe=>{var Ft,cr,Jt;(((Ft=kt.data)==null?void 0:Ft.role)==="admin"||((cr=kt.data)==null?void 0:cr.role)==="moderator"||((Jt=kt.data)==null?void 0:Jt.role)==="global_moderator")&&xe(Mt)})}Ye((xe,Ft)=>{zr(Oe,1,`badge badge-sm ml-0.5 border-0 ${xe??""} ${Ft??""}`),fe(st,x(mt).allianceName)},[()=>dp(x(mt).allianceId),()=>Oi(x(mt).allianceId)]),G(Ie,be)};je(se,Ie=>{x(mt).allianceId&&Ie(j)})}var Z=q(se,2);{var X=Ie=>{var be=fR(),Oe=E(be);Wg(Oe,{class:"text-error size-4"}),k(be),Ye(st=>xr(be,"data-tip",st),[()=>Wv()]),G(Ie,be)},ae=Ie=>{var be=er(),Oe=Ct(be);{var st=$e=>{var Mt=mR(),xe=E(Mt);Wf(xe,{class:"text-error size-4"}),k(Mt),Ye(Ft=>xr(Mt,"data-tip",Ft),[()=>Ex()]),G($e,Mt)};je(Oe,$e=>{x(f).paintedBy.timedOut&&$e(st)},!0)}G(Ie,be)};je(Z,Ie=>{x(f).paintedBy.banned?Ie(X):Ie(ae,!1)})}k(Ot);var de=q(Ot,2);{var Se=Ie=>{var be=CR(),Oe=E(be),st=E(Oe);Um(st,{class:"size-4"}),k(Oe);var $e=q(Oe,2);hi($e,21,()=>x(ve),hp,(Mt,xe)=>{var Ft=er(),cr=Ct(Ft);{var Jt=Xr=>{var dn=gR(),xn=E(dn);let mn;xn.__click=[_R,Me];var jt=E(xn);W0(jt,{class:"size-5"});var Et=q(jt);k(xn),k(dn),Ye((hr,ht)=>{mn=zr(xn,1,"text-error py-2 font-medium",null,mn,hr),fe(Et,` ${ht??""}`)},[()=>({"cursor-not-allowed":x(B)}),()=>bx()]),G(Xr,dn)},Tr=Xr=>{var dn=er(),xn=Ct(dn);{var mn=Et=>{var hr=yR(),ht=E(hr);let Hr;ht.__click=[vR,Me];var Yr=E(ht);Wf(Yr,{class:"size-5"});var qr=q(Yr);k(ht),k(hr),Ye((_t,Ge)=>{Hr=zr(ht,1,"text-error font-medium",null,Hr,_t),fe(qr,` ${Ge??""}`)},[()=>({"cursor-not-allowed":x(B)}),()=>wx()]),G(Et,hr)},jt=Et=>{var hr=er(),ht=Ct(hr);{var Hr=qr=>{var _t=bR(),Ge=E(_t);let At;Ge.__click=[xR,Me];var Rt=E(Ge);Wg(Rt,{class:"size-5"});var Yt=q(Rt);k(Ge),k(_t),Ye((br,Er)=>{At=zr(Ge,1,"text-error font-medium",null,At,br),fe(Yt,` ${Er??""}`)},[()=>({"cursor-not-allowed":x(B)}),()=>Tx()]),G(qr,_t)},Yr=qr=>{var _t=er(),Ge=Ct(_t);{var At=Rt=>{var Yt=TR(),br=E(Yt);br.__click=[wR,s,mt,H,N,o];var Er=E(br);tR(Er,{class:"size-5"});var ur=q(Er);k(br),k(Yt),Ye(rn=>fe(ur,` ${rn??""}`),[()=>Hv()]),G(Rt,Yt)};je(Ge,Rt=>{x(xe)==="ban-alliance"&&Rt(At)},!0)}G(qr,_t)};je(ht,qr=>{x(xe)==="ban-user"?qr(Hr):qr(Yr,!1)},!0)}G(Et,hr)};je(xn,Et=>{x(xe)==="timeout-user"?Et(mn):Et(jt,!1)},!0)}G(Xr,dn)};je(cr,Xr=>{x(xe)==="report-user"?Xr(Jt):Xr(Tr,!1)})}G(Mt,Ft)}),k($e),k(be),G(Ie,be)};je(de,Ie=>{x(ve).length>0&&Ie(Se)})}k(Dt),Ye((Ie,be)=>{var Oe;fe(qt,`${Ie??""}:`),zr(fr,1,`font-medium ${be??""} flex gap-1.5`),fe(Ar,((Oe=kt.data)==null?void 0:Oe.id)===x(mt).id?kt.data.name:x(mt).name),fe(Kt,`#${x(mt).id??""}`)},[()=>yC(),()=>Oi(x(mt).id)]),G(wt,Dt)};je(vt,wt=>{x(f).paintedBy.id===0?wt(yt):wt(It,!1)},!0)}G(at,dt)};je(bt,at=>{x(f)===void 0?at(te):at(re,!1)})}k(ke);var ge=q(ke,2),oe=E(ge);oe.__click=[PR,o];var Ae=E(oe);Eh(Ae,{class:"size-4.5"});var Ne=q(Ae);k(oe);var pt=q(oe,2);{var ot=at=>{const dt=ft(()=>kt.data.favoriteLocations.find(Dt=>Math.abs(Dt.latitude-x(N).center[0])<5e-5&&Math.abs(Dt.longitude-x(N).center[1])<5e-5)),vt=ft(()=>!x(dt)&&kt.data.favoriteLocations.length>=kt.data.maxFavoriteLocations);var yt=MR();let It;yt.__click=[IR,T,dt,N];var wt=E(yt);{let Dt=ft(()=>!!x(dt));iR(wt,{class:"size-4.5",get filled(){return x(Dt)}})}var mt=q(wt);k(yt),Ye((Dt,zt)=>{It=zr(yt,1,"btn btn-primary btn-soft",null,It,Dt),yt.disabled=x(T)||x(vt),fe(mt,` ${zt??""}`)},[()=>({"text-yellow-400":!!x(dt)}),()=>x(vt)?wC():SC()]),G(at,yt)};je(pt,at=>{kt.data&&at(ot)})}var ut=q(pt,2);ut.__click=[kR,o,N];var St=E(ut);a0(St,{class:"size-4.5"});var Bt=q(St);k(ut),k(ge),k(Ee),Po(Ee,at=>ce(z,at),()=>x(z)),Ye((at,dt)=>{fe(He,`Pixel: ${x(N).regionPixel[0]??""}, ${x(N).regionPixel[1]??""}`),oe.disabled=kt.loading,fe(Ne,` ${at??""}`),fe(Bt,` ${dt??""}`)},[()=>$v(),()=>MC()]),fp("innerHeight",at=>ce(M,at,!0)),G(m,Ee),Fr()}Qn(["click"]);var zR=Te("<!> <!>",1),LR=(m,o,f)=>{o(x(f))},DR=Te('<div class="mt-3 flex justify-center"><span class="loading loading-spinner"></span></div>'),RR=Te('<div class="mt-3 flex justify-center"><p class="text-base-content/80 text-sm">No one has painted in this area yet.</p></div>'),BR=(m,o)=>{navigator.clipboard.writeText(x(o).map(f=>f.id).join(", ")),Nr.success("Player IDs copied to clipboard")},FR=(m,o,f,y,M)=>{o.crosshair.clear(),f(x(y).painted),ce(M,x(y).id,!0)},OR=Te("<span> </span>"),NR=Te('<tr><th> </th><td class="flex items-center gap-1"><!> <div class="ml-0.5 flex flex-wrap items-center gap-1"><span><span> </span> <span> </span></span> <!></div></td><td class="text-center"> </td></tr>'),jR=Te('<div class="max-h-[25vh] overflow-y-auto"><table class="table"><thead><tr><th></th><th>Player <button class="btn btn-xs btn-circle btn-ghost ml-0.5" title="Copy player IDs to clipboard"><!></button></th><th class="text-center">Pixels Painted</th></tr></thead><tbody></tbody></table></div>'),VR=Te('<div class="rounded-t-box bg-base-100 border-base-300 sm:rounded-b-box w-full border-t sm:mb-3 sm:shadow-xl"><div class="p-3"><div class="flex justify-between gap-1"><h2 class="flex items-center gap-1 pl-1 text-lg"><button class="btn btn-circle btn-soft size-7"><!></button> <span>Selected area</span> <span class="text-base-content/80 ml-0.5 text-sm"> </span></h2> <button class="btn btn-circle btn-sm"><!></button></div> <div class="pb-3"><!></div></div></div>');function qR(m,o){Br(o,!0);let f=xi([]),y=ct(xi([])),M=ct(!1),z=ct(void 0);Dn(()=>{const H=o.map.on("click",async me=>{if(f.length>=2){o.onclose();return}if(f.push(me.lngLat),o.crosshair.place([me.lngLat.lat,me.lngLat.lng]),aa.plop.play(),f.length===2)try{ce(M,!0),ce(y,await T(f[0],f[1]),!0),s(x(y))}finally{ce(M,!1)}});return()=>{H.unsubscribe(),o.crosshair.clear()}});async function T(H,me){const ve=new fl(o.tileSize),[Me,Ee]=ve.latLonToPixelsFloor(H.lat,H.lng,o.pixelArtZoom),[Re,ze]=ve.latLonToPixelsFloor(me.lat,me.lng,o.pixelArtZoom),[Fe,Ke]=[Math.min(Me,Re),Math.min(Ee,ze)],[rt,qe]=[Math.max(Me,Re),Math.max(Ee,ze)],He=rt-Fe,et=qe-Ke;if(He*et>1e6)return Nr.error("The selected area is too big. Please select an area smaller than 1,000,000 pixels."),[];const tt=Math.floor(Fe/o.tileSize),nt=Math.floor(Ke/o.tileSize),Ze=Math.floor(rt/o.tileSize),ke=Math.floor(qe/o.tileSize),bt=Ze-tt+1,te=ke-nt+1,re=new Array(te).fill(0).flatMap((ot,ut)=>new Array(bt).fill(0).map(async(St,Bt)=>{const at=tt+Bt,dt=nt+ut;let vt=0,yt=0,It=o.tileSize-1,wt=o.tileSize-1;dt===nt&&(yt=Ke%o.tileSize),at===tt&&(vt=Fe%o.tileSize),dt===ke&&(wt=qe%o.tileSize),at===Ze&&(It=rt%o.tileSize);const tr=[at,dt],Qt=[vt,yt],Ot=[It,wt];return{response:await en.getPixelAreaInfo({season:o.season,tile:tr,p0:Qt,p1:Ot}),tile:tr,p0:Qt,p1:Ot}})),ge=await Promise.all(re),oe=new Map;for(const{response:ot,p0:ut,p1:St,tile:Bt}of ge){const[at,dt]=Bt,[vt,yt]=ut,[It,wt]=St,mt=It-vt+1,Dt=wt-yt+1;for(let zt=0;zt<Dt;zt++)for(let qt=0;qt<mt;qt++){const tr=zt*mt+qt,Qt=ot.paintedBy[tr];let Ot=oe.get(Qt);Ot||(Ot={latitudes:[],longitudes:[]},oe.set(Qt,Ot));const[fr,kr]=ve.pixelsToLatLon(at*o.tileSize+(vt+qt+.5),dt*o.tileSize+(yt+zt+.5),o.pixelArtZoom);Ot.latitudes.push(fr),Ot.longitudes.push(kr)}}const{users:Ae}=await en.getMultipleUsersInfoById([...oe.keys()]),Ne=ux(Ae,ot=>ot.id),pt=[...oe.entries()].map(([ot,ut])=>({...Ne[ot]??{id:ot,name:"Player"},painted:ut}));return pt.sort((ot,ut)=>ut.painted.latitudes.length-ot.painted.latitudes.length),pt}function s(H){for(const me of H)B(me.painted);ce(z,void 0)}function B(H){for(let me=0;me<H.latitudes.length;me++)o.crosshair.place([H.latitudes[me],H.longitudes[me]]);aa.plop.play()}var N=er(),Y=Ct(N);{var K=H=>{al(H,{class:"bg-warning",children:(me,ve)=>{var Me=zR(),Ee=Ct(Me);Gu(Ee,{class:"inline size-5"});var Re=q(Ee,2);{var ze=Ke=>{var rt=bi();Ye(qe=>fe(rt,qe),[()=>Jv()]),G(Ke,rt)},Fe=Ke=>{var rt=er(),qe=Ct(rt);{var He=et=>{var De=bi();Ye(tt=>fe(De,tt),[()=>Qv()]),G(et,De)};je(qe,et=>{f.length===1&&et(He)},!0)}G(Ke,rt)};je(Re,Ke=>{f.length===0?Ke(ze):Ke(Fe,!1)})}G(me,Me)},$$slots:{default:!0}})},ie=H=>{const me=ft(()=>x(y).filter(Ze=>Ze.id!==0));var ve=VR(),Me=E(ve),Ee=E(Me),Re=E(Ee),ze=E(Re);ze.__click=[LR,s,y];var Fe=E(ze);Gu(Fe,{class:"size-4"}),k(ze);var Ke=q(ze,4),rt=E(Ke);k(Ke),k(Re);var qe=q(Re,2);qe.__click=function(...Ze){var ke;(ke=o.onclose)==null||ke.apply(this,Ze)};var He=E(qe);_l(He,{class:"size-4"}),k(qe),k(Ee);var et=q(Ee,2),De=E(et);{var tt=Ze=>{var ke=DR();G(Ze,ke)},nt=Ze=>{var ke=er(),bt=Ct(ke);{var te=ge=>{var oe=RR();G(ge,oe)},re=ge=>{var oe=jR(),Ae=E(oe),Ne=E(Ae),pt=E(Ne),ot=q(E(pt)),ut=q(E(ot));ut.__click=[BR,me];var St=E(ut);Dm(St,{class:"size-3"}),k(ut),k(ot),vn(),k(pt),k(Ne);var Bt=q(Ne);hi(Bt,23,()=>x(me),at=>at.id,(at,dt,vt)=>{var yt=NR();let It;yt.__click=[FR,o,B,dt,z];var wt=E(yt),mt=E(wt,!0);k(wt);var Dt=q(wt),zt=E(Dt);lo(zt,{class:"size-5 border-0",get userId(){return x(dt).id},get pictureUrl(){return x(dt).picture}});var qt=q(zt,2),tr=E(qt),Qt=E(tr),Ot=E(Qt,!0);k(Qt);var fr=q(Qt,2),kr=E(fr);k(fr),k(tr);var Ar=q(tr,2);{var rr=Sr=>{var Dr=OR(),Zr=E(Dr,!0);k(Dr),Ye((se,j)=>{zr(Dr,1,`badge badge-sm ml-0.5 border-0 ${se??""} ${j??""}`),fe(Zr,x(dt).allianceName)},[()=>dp(x(dt).allianceId),()=>Oi(x(dt).allianceId)]),G(Sr,Dr)};je(Ar,Sr=>{x(dt).allianceId&&Sr(rr)})}k(qt),k(Dt);var Kt=q(Dt),or=E(Kt,!0);k(Kt),k(yt),Ye((Sr,Dr,Zr)=>{It=zr(yt,1,"hover:bg-base-200 cursor-pointer",null,It,Sr),fe(mt,x(vt)+1),zr(tr,1,`font-medium ${Dr??""} flex gap-1.5`),fe(Ot,x(dt).name),fe(kr,`#${x(dt).id??""}`),fe(or,Zr)},[()=>({"!bg-base-300":x(dt).id===x(z)}),()=>Oi(x(dt).id),()=>x(dt).painted.latitudes.length.toLocaleString()]),G(at,yt)}),k(Bt),k(Ae),k(oe),G(ge,oe)};je(bt,ge=>{x(me).length===0?ge(te):ge(re,!1)},!0)}G(Ze,ke)};je(De,Ze=>{x(M)?Ze(tt):Ze(nt,!1)})}k(et),k(Me),k(ve),Ye(Ze=>fe(rt,`(Pixels: ${Ze??""})`),[()=>x(y).reduce((Ze,ke)=>Ze+ke.painted.latitudes.length,0)]),ki(3,ve,()=>Gd,()=>({duration:100})),G(H,ve)};je(Y,H=>{f.length<2?H(K):H(ie,!1)})}G(m,N),Fr()}Qn(["click"]);function ZR(m){var y;const o=document.createElement("div");(y=m.parentElement)==null||y.insertBefore(o,m.nextSibling);const f=new IntersectionObserver(M=>{M[0].isIntersecting?m.classList.remove("stuck"):m.classList.add("stuck")},{threshold:0,rootMargin:"0px"});return f.observe(o),()=>{o.remove(),f.disconnect()}}var Sm;(m=>{function o(){let f,y;return{promise:new Promise((z,T)=>{f=z,y=T}),resolve:f,reject:y}}m.withResolvers=o})(Sm||(Sm={}));var UR=Cr('<svg><path d="M200-120v-680h360l16 80h224v400H520l-16-80H280v280h-80Z"></path></svg>'),$R=Cr('<svg><path d="M200-120v-680h360l16 80h224v400H520l-16-80H280v280h-80Zm300-440Zm86 160h134v-240H510l-16-80H280v240h290l16 80Z"></path></svg>');function GR(m,o){let f=ir(o,["$$slots","$$events","$$legacy","filled"]);var y=er(),M=Ct(y);{var z=s=>{var B=UR();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)},T=s=>{var B=$R();ar(B,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(s,B)};je(M,s=>{o.filled?s(z):s(T,!1)})}G(m,y)}var HR=Te("<p><!></p>"),WR=Te('<span class="loading loading-spinner center-absolute absolute"></span>'),XR=Te('<button class="btn btn-lg sm:btn-md btn-primary relative h-10"><!> <!> <span class="text-sm">Droplets</span></button>'),YR=Te('<span class="loading loading-spinner center-absolute absolute"></span>'),KR=Te('<!> <span class="text-sm"> </span>',1),JR=Te('<span class="text-sm"> </span>'),QR=Te('<button><div class="tooltip-content max-w-54 p-2"> </div> <!> <!></button>'),e7=Te('<div class="bg-base-300 flex flex-col items-center justify-center rounded-xl p-6"><div class="font-flag flex grow items-center justify-center p-1 text-7xl"> </div> <h3 class="mt-2 text-center text-xl font-bold"> <!></h3> <!> <div><!></div></div>'),t7=(m,o)=>{ce(o,!x(o))},r7=Te('<div><div class="text-primary flex items-center gap-1"><!> <h3 class="text-xl font-medium">Flags</h3></div> <p class="text-base-content/80 text-sm"> </p> <div class="grid-cols mt-3 grid gap-3 sm:grid-cols-2 lg:grid-cols-4"></div> <div class="mt-4 flex justify-center"><button class="btn btn-lg"> </button></div></div>');function n7(m,o){Br(o,!0);const f=(Fe,Ke=pa,rt=pa)=>{const qe=ft(()=>{var ut;return(((ut=kt.data)==null?void 0:ut.droplets)??0)>=s.price}),He=ft(()=>x(N)===Ke().id),et=ft(()=>y.has(Ke().id));var De=e7(),tt=E(De),nt=E(tt,!0);k(tt);var Ze=q(tt,2),ke=E(Ze),bt=q(ke);{var te=ut=>{var St=HR(),Bt=E(St);Uu(Bt,{class:"text-base-content/60 size-4.5 inline pb-0.5"}),k(St),Ye(at=>{zr(St,1,Ko({"tooltip inline":!0,"lg:before:-translate-x-1/3":(rt()+1)%4===0,"lg:before:translate-x-1/3":rt()%4===0,"before:-translate-x-1/3":(rt()+1)%2===0,"before:translate-x-1/3":rt()%2===0})),xr(St,"data-tip",at)},[()=>uI()]),G(ut,St)};je(bt,ut=>{x(et)&&ut(te)})}k(Ze);var re=q(Ze,2);{var ge=ut=>{Wm(ut,{})};je(re,ut=>{Ke().id===x(Y)&&ut(ge)})}var oe=q(re,2);let Ae;var Ne=E(oe);{var pt=ut=>{var St=XR();St.__click=async()=>{if(!(x(et)&&!await o.promptUserConfirmation(Ke().name)))try{const yt=Ke().id;ce(N,yt,!0),await en.purchase({id:T,amount:1,variant:yt}),kt.refresh(),aa.notification1.play();const It=z.find(wt=>wt.id===yt);It&&(It.owned=!0),ce(Y,yt,!0)}catch(yt){Nr.error(yt.message)}finally{ce(N,void 0)}};var Bt=E(St);{var at=yt=>{var It=WR();G(yt,It)};je(Bt,yt=>{x(He)&&yt(at)})}var dt=q(Bt,2);pp(dt,{class:"size-4"});var vt=q(dt);vn(),k(St),Ye(yt=>{St.disabled=!x(qe)||x(He),fe(vt,` ${yt??""} `)},[()=>s.price.toLocaleString("en-US")]),G(ut,St)},ot=ut=>{const St=ft(()=>{var zt;return((zt=kt.data)==null?void 0:zt.equippedFlag)===Ke().id});var Bt=QR();let at;Bt.__click=async()=>{try{ce(N,Ke().id,!0);const zt=x(St)?0:Ke().id;await en.equipFlag(zt),kt.data&&(kt.data.equippedFlag=zt),kt.refresh()}catch(zt){Nr.error(zt.message)}finally{ce(N,void 0)}};var dt=E(Bt),vt=E(dt,!0);k(dt);var yt=q(dt,2);{var It=zt=>{var qt=YR();G(zt,qt)};je(yt,zt=>{x(He)&&zt(It)})}var wt=q(yt,2);{var mt=zt=>{var qt=KR(),tr=Ct(qt);_l(tr,{class:"size-4"});var Qt=q(tr,2),Ot=E(Qt,!0);k(Qt),Ye(fr=>fe(Ot,fr),[()=>Aw()]),G(zt,qt)},Dt=zt=>{var qt=JR(),tr=E(qt,!0);k(qt),Ye(Qt=>fe(tr,Qt),[()=>Lw()]),G(zt,qt)};je(wt,zt=>{x(St)?zt(mt):zt(Dt,!1)})}k(Bt),Ye((zt,qt)=>{at=zr(Bt,1,"btn btn-lg sm:btn-md tooltip tooltip-bottom relative h-10",null,at,zt),Bt.disabled=x(He),fe(vt,qt)},[()=>({"btn-warning":x(St)}),()=>Iw()]),G(ut,Bt)};je(Ne,ut=>{Ke().owned?ut(ot,!1):ut(pt)})}k(oe),k(De),Ye((ut,St)=>{fe(nt,Ke().flag),fe(ke,`${Ke().name??""} `),Ae=zr(oe,1,"mt-3",null,Ae,ut),xr(oe,"data-tip",St)},[()=>({tooltip:!x(qe)}),()=>_p()]),G(Fe,De)},y=new Set([8,30,32,84,96,125,143,146,150,192,200,236,240,251]),M=Hi.countries.map(Fe=>({...Fe,owned:kt.flagsBitmap.get(Fe.id)}));M.sort((Fe,Ke)=>Number(Ke.owned)-Number(Fe.owned));const z=xi(M),T=110,s=Hi.products[T];let B=ct(!1),N=ct(void 0),Y=ct(void 0);var K=r7(),ie=E(K),H=E(ie);GR(H,{class:"size-5.5",filled:!0}),vn(2),k(ie);var me=q(ie,2),ve=E(me,!0);k(me);var Me=q(me,2);hi(Me,23,()=>z,Fe=>Fe.id,(Fe,Ke,rt)=>{var qe=er(),He=Ct(qe);{var et=De=>{f(De,()=>x(Ke),()=>x(rt))};je(He,De=>{(x(rt)<8||x(B))&&De(et)})}G(Fe,qe)}),k(Me);var Ee=q(Me,2),Re=E(Ee);Re.__click=[t7,B];var ze=E(Re,!0);k(Re),k(Ee),k(K),Ye(Fe=>{fe(ve,Fe),fe(ze,x(B)?"Show less":"Show more")},[()=>Cw()]),G(m,K),Fr()}Qn(["click"]);var i7=Te('<p class="mt-1 text-center text-sm"> </p>'),a7=(m,o)=>{kv(o,-1)},o7=(m,o)=>{kv(o)},s7=(m,o,f)=>{o(x(f))},l7=Te('<button class="text-base-content/80 absolute left-full top-1/2 ml-2 size-10 -translate-y-1/2 rounded-full text-[10px] font-bold">MAX</button>'),c7=async(m,o,f,y)=>{try{ce(o,!0),await en.purchase({id:f.productId,amount:y()}),aa.notification1.play(),f.onpurchasecompleted(y())}catch(M){Nr.error(M.message)}finally{ce(o,!1)}},u7=Te('<span class="loading loading-spinner center-absolute absolute"></span>'),h7=Te('<div class="bg-base-300 flex flex-col items-center justify-center rounded-xl p-6"><div class="flex grow items-center justify-center"><!></div> <p class="mt-2 text-center text-2xl font-bold sm:text-3xl"> </p> <!> <div class="relative mt-4 flex justify-center gap-3"><button class="btn btn-circle">-</button> <input class="input number-input max-w-16 text-center font-bold opacity-80" type="number" min="1"/> <button class="btn btn-circle">+</button> <!></div> <div><button class="btn btn-xl btn-primary relative mt-3 h-10"><!> <!> <span class="text-sm">Droplets</span></button></div></div>');function Sv(m,o){Br(o,!0);let f=Lt(o,"amount",15,1);const y=ft(()=>f()*o.unitPrice),M=ft(()=>Math.floor(o.userDroplets/o.unitPrice));let z=ct(!1);Wr(()=>{f()<0&&f(0)});var T=h7(),s=E(T),B=E(s);oi(B,()=>o.icon??pa),k(s);var N=q(s,2),Y=E(N,!0);k(N);var K=q(N,2);{var ie=De=>{var tt=i7(),nt=E(tt,!0);k(tt),Ye(()=>fe(nt,o.subtitle)),G(De,tt)};je(K,De=>{o.subtitle&&De(ie)})}var H=q(K,2),me=E(H);me.__click=[a7,f];var ve=q(me,2);uo(ve);var Me=q(ve,2);Me.__click=[o7,f];var Ee=q(Me,2);{var Re=De=>{var tt=l7();tt.__click=[s7,f,M],G(De,tt)};je(Ee,De=>{f()<x(M)&&De(Re)})}k(H);var ze=q(H,2);let Fe;var Ke=E(ze);Ke.__click=[c7,z,o,f];var rt=E(Ke);{var qe=De=>{var tt=u7();G(De,tt)};je(rt,De=>{x(z)&&De(qe)})}var He=q(rt,2);pp(He,{class:"size-4"});var et=q(He);vn(),k(Ke),k(ze),k(T),Ye((De,tt,nt,Ze)=>{fe(Y,De),Me.disabled=f()>=x(M),xr(ze,"data-tip",tt),Fe=zr(ze,1,"",null,Fe,nt),Ke.disabled=o.userDroplets<x(y)||x(z)||!f(),fe(et,` ${Ze??""} `)},[()=>o.title(f()),()=>_p(),()=>({tooltip:o.userDroplets<x(y)}),()=>x(y).toLocaleString("en-US")]),zm(ve,f),G(m,T),Fr()}Qn(["click"]);var d7=Cr('<svg><path d="M346-140 100-386q-10-10-15-22t-5-25q0-13 5-25t15-22l230-229-106-106 62-65 400 400q10 10 14.5 22t4.5 25q0 13-4.5 25T686-386L440-140q-10 10-22 15t-25 5q-13 0-25-5t-22-15Zm47-506L179-432h428L393-646Zm399 526q-36 0-61-25.5T706-208q0-27 13.5-51t30.5-47l42-54 44 54q16 23 30 47t14 51q0 37-26 62.5T792-120Z"></path></svg>');function p7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=d7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var f7=Cr('<svg><path d="M280-80q-33 0-56.5-23.5T200-160q0-33 23.5-56.5T280-240q33 0 56.5 23.5T360-160q0 33-23.5 56.5T280-80Zm400 0q-33 0-56.5-23.5T600-160q0-33 23.5-56.5T680-240q33 0 56.5 23.5T760-160q0 33-23.5 56.5T680-80ZM246-720l96 200h280l110-200H246Zm-38-80h590q23 0 35 20.5t1 41.5L692-482q-11 20-29.5 31T622-440H324l-44 80h480v80H280q-45 0-68-39.5t-2-78.5l54-98-144-304H40v-80h130l38 80Zm134 280h280-280Z"></path></svg>');function X0(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=f7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var m7=Cr('<svg><path d="m700-300-57-56 84-84H120v-80h607l-83-84 57-56 179 180-180 180Z"></path></svg>');function _7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=m7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var g7=Cr('<svg><path d="M280-160v-80h400v80H280Zm160-160v-327L336-544l-56-56 200-200 200 200-56 56-104-103v327h-80Z"></path></svg>');function v7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=g7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var y7=Te('<div><section class="not-stuck:border-transparent stuck:border-base-content/10 bg-base-100/70 sticky top-0 z-10 border-b px-6 pb-4 pt-6 backdrop-blur-sm"><div class="relative flex items-center gap-1"><!> <h3 class="text-3xl font-bold"> </h3> <div class="ml-auto mr-4"><!></div> <form method="dialog" class="absolute -right-4 -top-4"><button class="btn btn-sm btn-circle btn-ghost">âœ•</button></form></div></section> <div class="flex flex-col gap-6 px-6 pb-6"><section><div class="text-primary flex items-center gap-1"><!> <h3 class="text-xl font-medium"> </h3></div> <p class="text-base-content/80 text-sm"> </p> <div class="mt-3 grid gap-3 sm:grid-cols-2"><!> <!></div></section> <section><div class="text-primary flex items-center gap-1"><!> <h3 class="text-xl font-medium"> </h3></div> <div class="mt-3"><div class="bg-base-300 flex flex-col items-center justify-center rounded-xl p-6"><div class="flex grow items-center justify-center"><div class="relative flex size-52 items-center justify-center"><div class="scale-[3]"><!></div></div></div> <p class="mt-2 text-center text-2xl font-bold sm:text-3xl"> </p> <p class="mt-1 text-center text-sm"> </p> <div><a href="/profile-picture"><button class="btn btn-xl btn-primary relative mt-3 h-10"><!> <span class="text-sm">Droplets</span></button></a></div></div></div></section> <section><!></section></div></div>'),x7=Te('<span class="center-absolute absolute"><!></span>'),b7=(m,o,f)=>{var y;(y=x(o))==null||y.resolve(!1),x(f).close()},w7=(m,o,f)=>{var y;(y=x(o))==null||y.resolve(!0),x(f).close()},T7=Te('<dialog class="modal"><div class="modal-box max-h-11/12 w-11/12 max-w-4xl p-0"><!></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog> <dialog class="modal"><div class="modal-box w-max overflow-hidden"><div class="flex flex-col items-center gap-6 px-4"><h2 class="text-lg font-semibold"> </h2> <div class="flex items-center gap-2 text-3xl sm:text-5xl"><span class="text-base-content/80 flex items-center gap-2"> <span class="text-primary text-3xl font-semibold max-sm:hidden"> </span></span> <span><!></span> <span class="text-primary flex font-bold"> </span></div> <form method="dialog"><button class="btn btn-primary btn-lg relative"> <!></button></form></div></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog> <dialog class="modal"><div class="modal-box w-max overflow-hidden"><h3 class="mb-2 text-lg font-bold"> </h3> <p class="text-sm opacity-80"><!></p> <div class="mt-5 flex justify-end gap-2"><button class="btn btn-ghost"> </button> <button class="btn btn-primary"> </button></div></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog>',1);function C7(m,o){Br(o,!0);let f=Lt(o,"open",15),y=ct(null),M=ct(xi({name:Kg(),prev:1e3,new:1e5}));Dn(()=>{const Ot=fr=>{fr.key==="Escape"&&f(!1)};return document.addEventListener("keydown",Ot),()=>document.removeEventListener("keydown",Ot)});const z={id:70,product:Hi.products[70]},T={id:80,product:Hi.products[80]},s={product:Hi.products[120]};let B=ct(null),N=ct(null),Y=ct("");async function K(Ot){return x(B).showModal(),ce(N,Sm.withResolvers(),!0),ce(Y,Ot,!0),x(N).promise}var ie=T7(),H=Ct(ie),me=E(H),ve=E(me);{var Me=Ot=>{var fr=y7(),kr=E(fr),Ar=E(kr),rr=E(Ar);X0(rr,{class:"size-8"});var Kt=q(rr,2),or=E(Kt,!0);k(Kt);var Sr=q(Kt,2),Dr=E(Sr);{let Yt=ft(()=>{var br;return((br=kt.data)==null?void 0:br.droplets)??0});Fv(Dr,{get value(){return x(Yt)}})}k(Sr),vn(2),k(Ar),k(kr),Wi(kr,()=>ZR);var Zr=q(kr,2),se=E(Zr),j=E(se),Z=E(j);p7(Z,{class:"size-5.5",filled:!0});var X=q(Z,2),ae=E(X,!0);k(X),k(j);var de=q(j,2),Se=E(de,!0);k(de);var Ie=q(de,2),be=E(Ie);{const Yt=Er=>{v7(Er,{class:"text-primary size-26"})};let br=ft(()=>k2());Sv(be,{get productId(){return z.id},title:Er=>P2({amount:z.product.items[0].amount*Er}),get subtitle(){return x(br)},get unitPrice(){return z.product.price},get userDroplets(){return kt.data.droplets},onpurchasecompleted:async Er=>{var pn,_n,sn,En;const ur=(_n=(pn=kt.data)==null?void 0:pn.charges)==null?void 0:_n.max;await kt.refresh();const rn=(En=(sn=kt.data)==null?void 0:sn.charges)==null?void 0:En.max;ur!==void 0&&rn!==void 0&&(ce(M,{name:Kg(),prev:ur,new:rn},!0),x(y).show())},icon:Yt,$$slots:{icon:!0}})}var Oe=q(be,2);{const Yt=Er=>{U0(Er,{class:"text-primary my-3 size-20"})};let br=ft(()=>g2());Sv(Oe,{get productId(){return T.id},title:Er=>_3({amount:T.product.items[0].amount*Er}),get subtitle(){return x(br)},get unitPrice(){return T.product.price},get userDroplets(){return kt.data.droplets},onpurchasecompleted:async Er=>{var rn,pn,_n;const ur=(pn=(rn=kt.data)==null?void 0:rn.charges)==null?void 0:pn.count;await kt.refresh(),ur!==void 0&&(ce(M,{name:p3(),prev:Math.floor(ur),new:Math.floor(ur+T.product.items[0].amount*Er)},!0),(_n=x(y))==null||_n.show())},icon:Yt,$$slots:{icon:!0}})}k(Ie),k(se);var st=q(se,2),$e=E(st),Mt=E($e);vp(Mt,{class:"size-5.5",filled:!0});var xe=q(Mt,2),Ft=E(xe,!0);k(xe),k($e);var cr=q($e,2),Jt=E(cr),Tr=E(Jt),Xr=E(Tr),dn=E(Xr),xn=E(dn);Ov(xn,{get userId(){return kt.data.id},get level(){return kt.data.level},get pictureUrl(){return kt.data.picture}}),k(dn),k(Xr),k(Tr);var mn=q(Tr,2),jt=E(mn,!0);k(mn);var Et=q(mn,2),hr=E(Et,!0);k(Et);var ht=q(Et,2);let Hr;var Yr=E(ht),qr=E(Yr),_t=E(qr);pp(_t,{class:"size-4"});var Ge=q(_t);vn(),k(qr),k(Yr),k(ht),k(Jt),k(cr),k(st);var At=q(st,2),Rt=E(At);n7(Rt,{promptUserConfirmation:K}),k(At),k(Zr),k(fr),Ye((Yt,br,Er,ur,rn,pn,_n,sn,En)=>{fe(or,Yt),fe(ae,br),fe(Se,Er),fe(Ft,ur),fe(jt,rn),fe(hr,pn),xr(ht,"data-tip",_n),Hr=zr(ht,1,"",null,Hr,sn),qr.disabled=kt.data.droplets<s.product.price,fe(Ge,` ${En??""} `)},[()=>qv(),()=>x2(),()=>T2(),()=>bw(),()=>z2(),()=>R2(),()=>_p(),()=>({tooltip:kt.data.droplets<s.product.price}),()=>s.product.price.toLocaleString("en-US")]),ki(2,fr,()=>ia),G(Ot,fr)};je(ve,Ot=>{kt.data&&f()&&Ot(Me)})}k(me);var Ee=q(me,2),Re=E(Ee),ze=E(Re,!0);k(Re),k(Ee),k(H),Wi(H,()=>Ot=>{Wr(()=>{f()?Ot.show():Ot.close()})});var Fe=q(H,2),Ke=E(Fe),rt=E(Ke),qe=E(rt),He=E(qe,!0);k(qe);var et=q(qe,2),De=E(et),tt=E(De),nt=q(tt),Ze=E(nt);k(nt),k(De);var ke=q(De,2),bt=E(ke);_7(bt,{class:"size-5"}),k(ke);var te=q(ke,2),re=E(te,!0);k(te),k(et);var ge=q(et,2),oe=E(ge),Ae=E(oe),Ne=q(Ae);ju(Ne,()=>x(M).new,Ot=>{var fr=x7(),kr=E(fr);Wm(kr,{}),k(fr),G(Ot,fr)}),k(oe),k(ge),k(rt),k(Ke);var pt=q(Ke,2),ot=E(pt),ut=E(ot,!0);k(ot),k(pt),k(Fe),Po(Fe,Ot=>ce(y,Ot),()=>x(y));var St=q(Fe,2),Bt=E(St),at=E(Bt),dt=E(at,!0);k(at);var vt=q(at,2),yt=E(vt);Mm(yt,()=>_I({country:x(Y)})),k(vt);var It=q(vt,2),wt=E(It);wt.__click=[b7,N,B];var mt=E(wt,!0);k(wt);var Dt=q(wt,2);Dt.__click=[w7,N,B];var zt=E(Dt,!0);k(Dt),k(It),k(Bt);var qt=q(Bt,2),tr=E(qt),Qt=E(tr,!0);k(tr),k(qt),k(St),Po(St,Ot=>ce(B,Ot),()=>x(B)),Ye((Ot,fr,kr,Ar,rr,Kt,or)=>{fe(ze,Ot),fe(He,x(M).name),fe(tt,`${x(M).prev??""} `),fe(Ze,`(+${x(M).new-x(M).prev})`),fe(re,x(M).new),fe(Ae,`${fr??""} `),fe(ut,kr),fe(dt,Ar),fe(mt,rr),fe(zt,Kt),fe(Qt,or)},[()=>cl(),()=>cl(),()=>cl(),()=>pI(),()=>up(),()=>Vx(),()=>cl()]),Ai("close",H,()=>f(!1)),G(m,ie),Fr()}Qn(["click"]);var S7=Cr('<svg><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"></path></svg>');function P7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=S7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var I7=Cr('<svg><path d="M480-680q-33 0-56.5-23.5T400-760q0-33 23.5-56.5T480-840q33 0 56.5 23.5T560-760q0 33-23.5 56.5T480-680Zm-60 560v-480h120v480H420Z"></path></svg>');function M7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=I7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var k7=Cr('<svg><path d="M440-40v-80q-125-14-214.5-103.5T122-438H42v-80h80q14-125 103.5-214.5T440-836v-80h80v80q125 14 214.5 103.5T838-518h80v80h-80q-14 125-103.5 214.5T520-120v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Z"></path></svg>');function A7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=k7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var E7=Cr('<svg><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Z"></path></svg>');function z7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=E7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var L7=Cr('<svg><path d="M380-720v-98L142-580h98v60H40v-200h60v98l238-238h-98v-60h200v200h-60ZM593-40q-24 0-46-9t-39-26L304-280l30-31q16-16 37.5-21.5t42.5.5l66 19v-327q0-17 11.5-28.5T520-680q17 0 28.5 11.5T560-640v433l-97-27 102 102q5 5 12.5 8.5T593-120h167q33 0 56.5-23.5T840-200v-160q0-17 11.5-28.5T880-400q17 0 28.5 11.5T920-360v160q0 66-47 113T760-40H593Zm7-280v-160q0-17 11.5-28.5T640-520q17 0 28.5 11.5T680-480v160h-80Zm120 0v-120q0-17 11.5-28.5T760-480q17 0 28.5 11.5T800-440v120h-80Zm-20 80Z"></path></svg>');function D7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=L7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var R7=Cr('<svg><path d="M280-200v-80h284q63 0 109.5-40T720-420q0-60-46.5-100T564-560H312l104 104-56 56-200-200 200-200 56 56-104 104h252q97 0 166.5 63T800-420q0 94-69.5 157T564-200H280Z"></path></svg>');function B7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=R7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}var F7=Cr('<svg><path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Zm319 93Zm-151 75Z"></path></svg>');function O7(m,o){let f=ir(o,["$$slots","$$events","$$legacy"]);var y=F7();ar(y,()=>({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",...f})),G(m,y)}function $f(m){const o=document.createElement("img");return o.src=m,new Promise((f,y)=>{o.addEventListener("load",()=>{f(o)}),o.addEventListener("error",M=>{y(M)})})}function N7(m){const o=document.createElement("canvas");o.width=m.naturalWidth,o.height=m.naturalHeight;const f=o.getContext("2d");return f==null||f.drawImage(m,0,0),o}function j7(m,o,f){return m<o?o:m>f?f:m}function V7(m,o){const f=10**o;return Math.round(m*f)/f}var q7=Te('<meta property="og:title" content="Wplace - A massive real-time pixel art canvas on the world map!"/> <meta name="twitter:title" content="Wplace - A massive real-time pixel art canvas on the world map!"/> <meta name="robots" content="index, follow, max-image-preview:large"/> <meta name="color-scheme" content="light only"/>',1),Z7=(m,o)=>{ce(o,!x(o))},U7=Te("<button><!></button>"),$7=async(m,o,f,y)=>{var M;x(o)||ce(o,await new Promise((z,T)=>{navigator.geolocation.getCurrentPosition(s=>{z(s)},s=>{T(s)})})),x(o)&&(Co({lat:x(o).coords.latitude,lng:x(o).coords.longitude},x(f)),(M=x(y))==null||M.flyTo({center:{lat:x(o).coords.latitude,lng:x(o).coords.longitude},zoom:16.5}))},G7=Te('<div class="relative"><!> <span class="center-absolute absolute text-[10px] text-red-400">?</span></div>'),H7=Te('<button class="btn btn-lg btn-square sm:btn-xl z-30 shadow-md"><!></button>'),W7=(m,o,f,y)=>{var M;ce(o,!0),x(f)&&Co((M=x(f))==null?void 0:M.getCenter(),x(y))},X7=Te('<button class="btn btn-primary shadow-xl"> </button>'),Y7=Te('<a class="badge badge-secondary absolute -left-2 top-0 -translate-x-full translate-y-1/2 font-semibold" target="_blank"><!></a>'),K7=Te('<div class="relative"><!> <!></div>'),J7=(m,o,f,y)=>{var z;ce(o,!0);const M=(z=x(f))==null?void 0:z.getCenter();M&&Co(M,x(y))},Q7=Te('<button class="btn btn-square shadow-md"><!></button>'),e9=(m,o)=>{ce(o,!0)},t9=Te('<button class="btn btn-square relative shadow-md"><!></button>'),r9=(m,o)=>{ce(o,!0)},n9=Te('<button class="btn btn-square relative shadow-md"><!></button>'),i9=Te('<div class="flex flex-col items-center gap-3"><!> <!> <!> <!></div>'),a9=(m,o)=>{ce(o,!x(o))},o9=Te('<div class="flex flex-col gap-3"><button><!></button></div>'),s9=Te('<div class="z-100 absolute bottom-1 left-1/2 -translate-x-1/2"><!></div>'),l9=(m,o)=>{ce(o,!0)},c9=Te('<button class="btn btn-sm btn-circle"><!></button>'),u9=(m,o)=>{var f;(f=x(o))==null||f.zoomIn()},h9=(m,o)=>{var f;(f=x(o))==null||f.zoomOut()},d9=(m,o)=>{ce(o,{name:"getPixelAreaInfo"},!0)},p9=Te('<button class="btn btn-sm btn-circle" title="Select area"><!></button>'),f9=Te('<button class="btn btn-sm btn-circle"><!></button>'),m9=()=>{window.location.replace(vi.url.origin)},_9=Te('<button class="btn btn-sm btn-circle not-pwa:hidden"><!></button>'),g9=(m,o)=>{x(o)&&hl.goToPrev(x(o))},v9=Te('<button class="btn btn-sm btn-circle"><!></button>'),y9=Te('<div class="btn btn-sm btn-error w-max cursor-auto text-nowrap text-xs sm:text-base"><!> </div>'),x9=(m,o,f)=>{var y;(y=x(o))==null||y.flyTo({center:x(o).getCenter(),zoom:f})},b9=Te('<button class="btn sm:btn-lg duration text-nowrap text-xs transition-opacity sm:text-base"><!> </button>'),w9=Te("<span></span>"),T9=Te('<div class="absolute bottom-0 left-0 z-50 w-full sm:left-1/2 sm:max-w-md sm:-translate-x-1/2 md:max-w-lg"><div class="rounded-t-box bg-base-100 border-base-300 sm:rounded-b-box w-full border-t pt-2 sm:mb-3 sm:shadow-xl"><!></div></div>'),C9=Te('<div class="absolute bottom-0 left-0 z-50 w-full"><div class="rounded-t-box bg-base-100 border-base-300 w-full border-t py-3"><!></div></div>'),S9=Te('<div class="absolute bottom-0 left-0 z-50 w-full sm:left-1/2 sm:max-w-md sm:-translate-x-1/2 md:max-w-xl"><!></div>'),P9=(m,o)=>{ce(o,{name:"mainMenu"},!0)},I9=Te('<div class="absolute bottom-0 left-0 z-50 w-full sm:left-1/2 sm:max-w-md sm:-translate-x-1/2"><div class="rounded-t-box bg-base-100 border-base-300 sm:rounded-b-box w-full border-t pt-2 sm:mb-3 sm:shadow-xl"><div class="px-3 pb-2 pt-1"><div class="flex items-center justify-between"><span><!> </span> <button class="btn btn-circle btn-sm"><!></button></div> <div class="mt-1 flex items-center justify-center gap-4"><button class="btn btn-primary w-46"><!></button></div></div></div></div>'),M9=Te('<div class="disable-pinch-zoom relative h-full overflow-hidden svelte-6wmtgk"><div id="map" class="h-screen w-screen cursor-default"></div> <div><div><!> <!></div></div> <!> <div><!> <div class="flex flex-col gap-1 max-sm:hidden"><button class="btn btn-sm btn-circle">+</button> <button class="btn btn-sm btn-circle">-</button></div> <div class="max-sm:hidden"><a href="https://www.twitch.tv/directory/category/wplace" class="btn btn-sm btn-circle" target="_blank" title="Livestreams"><!></a></div> <!> <!> <!> <!></div> <div><!> <!></div> <div><!></div> <div><!></div> <div><!></div>  <!></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>',1);function _B(m,o){Br(o,!0);const f=zf,y=hx,M=new fl(y),z=f-.4,T=RI(vi.url),s=T.season??Gg,B=new Map;let N=ct(void 0),Y=ct(14.5),K=ct(!1);const ie=ft(()=>{var xt;return((xt=kt.data)==null?void 0:xt.id)===401});let H=ct(!1),me=ct(xi(T.select&&T.pos?{name:"pixelSelected",latLon:[T.pos.lat,T.pos.lng]}:{name:"mainMenu"}));Dn(()=>{Re().then(Rr=>ce(N,Rr));let xt=[0,0];function Wt(Rr){var yn;if(x(N)&&x(Y)>f+1){const{lat:On,lng:Xn}=x(N).unproject([Rr.clientX,Rr.clientY]),Vn=M.latLonToPixels(On,Xn,f),wn=Math.floor(Vn[0]),Ji=Math.floor(Vn[1]);if(xt[0]!==wn||xt[1]!==Ji){const sr=M.latLonToPixelBoundsLatLon(On,Xn,f),Ut=jm(sr,!0);(yn=x(N).getSource(Ke))==null||yn.setCoordinates(Ut),xt=[wn,Ji]}}}return window.addEventListener("mousemove",Wt),()=>{var Rr;(Rr=x(N))==null||Rr.remove(),window.removeEventListener("mousemove",Wt),Ee&&clearInterval(Ee),Gf()}}),dl(()=>[ai.theme],()=>{if(x(N)){Me=!1;const xt=ve(ai.theme);x(N).setStyle(xt)}});function ve(xt){return`https://maps.wplace.live/styles/${xt==="custom-winter"?"liberty":"fiord"}`}let Me=!1,Ee;async function Re(){const xt=T.pos?{...T.pos,zoom:x(Y)}:await SI();T.zoom!==void 0&&(xt.zoom=T.zoom);const Wt=await new Promise(Vn=>{const wn=new Vd.Map({style:ve(ai.theme),center:xt,zoom:xt.zoom,container:"map",dragRotate:!1,doubleClickZoom:!1,pitch:0,maxPitch:0,attributionControl:!1});wn.touchZoomRotate.disableRotation(),wn.on("styledata",Ji=>{Me||(ai.theme==="custom-winter"&&(wn.setLayoutProperty("poi_transit","visibility","none"),wn.setLayoutProperty("poi_r20","visibility","none"),wn.setLayoutProperty("poi_r7","visibility","none"),wn.setLayoutProperty("poi_r1","visibility","none"),wn.setLayoutProperty("building","visibility","none"),wn.setLayoutProperty("building-3d","visibility","none"),wn.setLayoutProperty("landuse_pitch","visibility","none"),wn.setLayoutProperty("landuse_hospital","visibility","none"),wn.setLayoutProperty("landuse_school","visibility","none"),wn.setLayoutProperty("landuse_residential","visibility","none"),wn.setLayoutProperty("waterway_tunnel","visibility","none"),wn.setFilter("water",["all",["!=","brunnel","tunnel"],["!=","class","swimming_pool"]])),Fe(wn),et(),Me=!0)}),wn.on("style.load",()=>{Vn(wn)})}),Rr=Hi.refreshIntervalMs;function yn(){let Vn=x(Y)>f+1.5?Rr:2.5*Rr;try{document.visibilityState==="visible"&&Fe(Wt)}finally{setTimeout(yn,Vn)}}Ee=setTimeout(yn,Rr),Wt.on("load",()=>{T.discordLinked&&(Nr.success(wS()),vi.url.searchParams.delete("discord-linked"),Im(vi.url.toString()))});let On=x(Y);Wt.on("zoom",()=>{ce(Y,Wt.getZoom(),!0);const Vn=V7(x(Y),1);Vn!=On&&(x(te)&&x(te).setOpacity(re(On)),On=Vn)});let Xn="default";return Wt.on("dragstart",()=>{const Vn=Wt.getCanvas();Xn=Vn.style.cursor,Vn.style.cursor="move"}),Wt.on("dragend",()=>{Wt.getCanvas().style.cursor=Xn}),Wt.on("mouseout",()=>{De()}),Wt.on("click",async Vn=>{var Ur;const wn=Vn.lngLat.lat,Ji=Vn.lngLat.lng,sr=[wn,Ji];if(x(me).name==="paintingPixel"||x(me).name==="getPixelAreaInfo")return;if(x(me).name==="selectHq"){x(me).hq=sr,(Ur=x(ge))==null||Ur.clearAndPlace(sr);return}const Ut=Wt.getZoom();if(Ut<z){Nr.info(ZS());return}Co({lat:wn,lng:Ji},Ut),ce(me,{name:"pixelSelected",latLon:sr},!0)}),Wt}const ze="pixel-art-layer";function Fe(xt){const Wt=window.innerWidth,Rr=`${dx}/s${Gg}/tiles/{x}/{y}.png`;if(B.clear(),!xt.style)return;xt.getSource(ze)?xt.refreshTiles(ze):xt.addSource(ze,{type:"raster",tiles:[Rr],minzoom:f,maxzoom:f,tileSize:Wt>640?550:400}),xt.getLayer(ze)||xt.addLayer({id:ze,type:"raster",source:ze,paint:{"raster-resampling":"nearest","raster-opacity":x(nt)}})}const Ke="pixel-hover",rt=1e-5,qe=[[0,0],[rt,0],[rt,-rt],[0,-rt]],He=.4;async function et(){var xt,Wt,Rr,yn;if(!((xt=x(N))!=null&&xt.getSource(Ke))){const On=N7(await $f(TI));(Wt=x(N))==null||Wt.addSource(Ke,{type:"canvas",canvas:On,coordinates:qe})}(Rr=x(N))!=null&&Rr.getLayer(Ke)||(yn=x(N))==null||yn.addLayer({id:Ke,type:"raster",source:Ke,paint:{"raster-resampling":"nearest","raster-opacity":He}})}function De(){var xt,Wt;(Wt=(xt=x(N))==null?void 0:xt.getSource(Ke))==null||Wt.setCoordinates(qe)}let tt=ct(xi(T.opaque??!0)),nt=ft(()=>x(tt)?1:.1);Wr(()=>{var xt;(xt=x(N))!=null&&xt.getLayer(ze)&&x(N).setPaintProperty(ze,"raster-opacity",x(nt))});let Ze=ct(void 0),ke=ct(void 0),bt=ct(void 0);Dn(()=>(navigator.permissions.query({name:"geolocation"}).then(xt=>{xt.state==="granted"&&ce(bt,navigator.geolocation.watchPosition(Wt=>{ce(Ze,Wt)},Wt=>{ce(ke,Wt)},{enableHighAccuracy:!1,maximumAge:1e3,timeout:6e3}),!0)}),()=>{x(bt)&&navigator.geolocation.clearWatch(x(bt))}));let te=ct(void 0);dl(()=>[x(Ze),x(N)],()=>{var xt,Wt;if(x(Ze)&&x(N)){const Rr={lat:x(Ze).coords.latitude,lng:x(Ze).coords.longitude},yn=re(x(Y));if(!x(te)){const On=document.createElement("div");On.classList.add("maplibregl-user-location-dot"),On.classList.add("cursor-auto"),ce(te,new Vd.Marker({element:On,opacity:yn}).setLngLat(Rr).addTo(x(N)))}(Wt=(xt=x(te))==null?void 0:xt.setLngLat(Rr))==null||Wt.setOpacity(yn)}});function re(xt){return xt<f?"1.0":j7((xt-f)*.2,.5,1).toFixed(2)}let ge=ct(void 0);Wr(()=>{var xt;x(N)&&((xt=ul(()=>x(ge)))==null||xt.clear(),$f(Jg).then(Wt=>{ce(ge,new ev({id:"select-crosshair",map:x(N),tileSize:y,zoom:f,img:Wt,markerFn:()=>{const Rr=new Vd.Marker({color:"#0069ff"});return Rr.addClassName("z-20"),Rr}}))}))});let oe=ct(void 0);Wr(()=>{var xt;x(N)&&((xt=ul(()=>x(ge)))==null||xt.clear(),$f(Jg).then(Wt=>{ce(oe,new ev({id:"paint-crosshair",map:x(N),tileSize:y,zoom:f,img:Wt}))}))});let Ae=ct(!1),Ne=ct(!1),pt=ct(!1),ot=ct(!!T.newUser),ut=ct(!1),St=ct(!!T.alliance),Bt=ct(!1);const at="void-message-2";let dt=ct(!1);Wr(()=>{const xt=localStorage.getItem(at);kt.data&&!xt&&(ce(dt,!0),localStorage.setItem(at,"true"))});let vt=ct(!1),yt=ct(xi(vi.url)),It=ct(xi({cityId:0,countryId:1,id:0,name:"None",number:1})),wt=ct(!1);const mt="view-rules";let Dt=!1;Wr(()=>{kt.data&&(!Dt&&kt.data.pixelsPainted>1&&(localStorage.getItem(mt)||(ce(wt,!0),localStorage.setItem(mt,"true"))),Dt=!0)});let zt=ct(!1);Wr(()=>{var xt;ce(zt,!!((xt=kt.data)!=null&&xt.needsPhoneVerification))});let qt=ct([]),tr=ft(()=>x(Y)<z?"1.0":x(Y)<z+2?"0.5":"0.3");Wr(()=>{var Wt;const xt=(Wt=kt.data)==null?void 0:Wt.favoriteLocations;if(xt&&x(N)){for(const Rr of ul(()=>x(qt)))Rr.remove();ce(qt,xt.map(Rr=>{const yn=document.createElement("div");yn.classList.add("text-yellow-400"),yn.classList.add("cursor-pointer"),yn.classList.add("z-10"),yn.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
					<path fill="#000a" d="m183-51 79-338L-1-617l346-29 135-319 135 319 346 29-263 228 79 338-297-180L183-51Z"/>
					<path d="m293-203.08 49.62-212.54-164.93-142.84 217.23-18.85L480-777.69l85.08 200.38 217.23 18.85-164.93 142.84L667-203.08 480-315.92 293-203.08Z"/>
				</svg>`;const On={lat:Rr.latitude,lng:Rr.longitude};return yn.addEventListener("click",Vn=>{Vn.stopPropagation(),Qt([Rr.latitude,Rr.longitude])}),new Vd.Marker({element:yn,opacity:x(tr)}).setLngLat(On).addTo(x(N))}))}});function Qt(xt){var Rr;const Wt={lat:xt[0],lng:xt[1]};(Rr=x(N))==null||Rr.flyTo({center:Wt,zoom:Math.max(x(Y),15)}),Co(Wt,x(Y)),ce(me,{name:"pixelSelected",latLon:[Wt.lat,Wt.lng]},!0)}Wr(()=>{if(x(me).name==="paintingPixel")for(const xt of x(qt))xt.addClassName("hidden");else for(const xt of x(qt))xt.removeClassName("hidden"),xt.setOpacity(x(tr))});let Ot=Number.MAX_VALUE;Wr(()=>{if(kt.charges!==void 0&&kt.data){const xt=kt.data.charges.max,Wt=kt.charges;Ot<xt&&Wt>=xt&&aa.notification1.play(),Ot=kt.charges}});let fr=ct(!1),kr=Date.now();Dn(()=>{const xt=DI(),Wt=()=>{var yn;if(!document.hidden&&Date.now()-kr>30*gc.min){if(xt){const Xn=(yn=x(N))==null?void 0:yn.getCenter();Xn&&Co(Xn,x(Y)),window.location.replace(vi.url.origin)}else kt.refresh();kr=Date.now()}};return document.addEventListener("visibilitychange",Wt),()=>document.removeEventListener("visibilitychange",Wt)}),Dn(()=>{function xt(){en.online=!0}window.addEventListener("online",xt);function Wt(){en.online=!1}return window.addEventListener("offline",Wt),()=>{window.removeEventListener("online",xt),window.removeEventListener("offline",Wt)}}),Wr(()=>{if(!en.online){const xt=setInterval(()=>{en.health().then(()=>{en.online=!0,!kt.data&&!kt.loading&&kt.refresh()})},5e3);return()=>{clearInterval(xt)}}}),Dn(()=>{function xt(Wt){Wt.data.type&&x(N)&&Fe(x(N))}return navigator.serviceWorker.addEventListener("message",xt),()=>{navigator.serviceWorker.removeEventListener("message",xt)}});let Ar=ct(!1),rr=ct("report-user"),Kt=ct(void 0),or=ct(void 0),Sr=ct(void 0),Dr=ct(0);var Zr=M9();rx(xt=>{var Wt=q7();tx.title="Wplace - Paint the world",vn(6),G(xt,Wt)});var se=Ct(Zr);{const xt=sr=>{var Ut=U7();Ut.__click=[Z7,tt];var Ur=E(Ut);{let lr=ft(()=>!x(tt));$0(Ur,{class:"size-5",get filled(){return x(lr)}})}k(Ut),Ye(lr=>{xr(Ut,"title",lr),zr(Ut,1,Ko({"btn btn-lg btn-square sm:btn-xl z-30 shadow-md":!0,"text-base-content/80":x(tt),"btn-primary btn-soft":!x(tt)}))},[()=>Uv()]),G(sr,Ut)},Wt=sr=>{var Ut=H7();Ut.__click=[$7,Ze,Y,N];var Ur=E(Ut);{var lr=nn=>{z7(nn,{class:"size-5.5 fill-blue-800"})},Tn=nn=>{var Cn=G7(),$n=E(Cn);A7($n,{class:"size-5.5 fill-red-400"}),vn(2),k(Cn),G(nn,Cn)};je(Ur,nn=>{x(Ze)?nn(lr):nn(Tn,!1)})}k(Ut),Ye(nn=>xr(Ut,"title",nn),[()=>zb()]),G(sr,Ut)};var j=q(E(se),2);let Rr;var Z=E(j);let yn;var X=E(Z);{var ae=sr=>{var Ut=X7();Ut.__click=[W7,Ae,N,Y];var Ur=E(Ut,!0);k(Ut),Ye(lr=>fe(Ur,lr),[()=>Kx()]),G(sr,Ut)},de=sr=>{var Ut=er(),Ur=Ct(Ut);{var lr=Tn=>{var nn=K7(),Cn=E(nn);{var $n=Mn=>{var bn=Y7(),ln=E(bn);{var Sn=gn=>{var fn=bi("MOD");G(gn,fn)},kn=gn=>{var fn=er(),an=Ct(fn);{var po=Gn=>{var jn=bi("GM");G(Gn,jn)},pi=Gn=>{var jn=bi("ADMIN");G(Gn,jn)};je(an,Gn=>{var jn;((jn=kt.data)==null?void 0:jn.role)==="global_moderator"?Gn(po):Gn(pi,!1)},!0)}G(gn,fn)};je(ln,gn=>{var fn;((fn=kt.data)==null?void 0:fn.role)==="moderator"?gn(Sn):gn(kn,!1)})}k(bn),Ye(()=>{var gn;return xr(bn,"href",((gn=kt.data)==null?void 0:gn.role)==="admin"?`${vi.url.origin}/admin/dashboard`:`${vi.url.origin}/admin`)}),G(Mn,bn)};je(Cn,Mn=>{var bn;xc((bn=kt.data)==null?void 0:bn.role,["admin","moderator","global_moderator"])&&Mn($n)})}var Pr=q(Cn,2);zD(Pr,{get user(){return kt},onlogout:()=>{ce(me,{name:"mainMenu"},!0)}}),k(nn),ki(3,nn,()=>ia,()=>({duration:150})),G(Tn,nn)};je(Ur,Tn=>{kt.data&&x(N)&&x(me).name!=="paintingPixel"&&Tn(lr)},!0)}G(sr,Ut)};je(X,sr=>{!kt.loading&&!kt.data?sr(ae):sr(de,!1)})}var Se=q(X,2);{var Ie=sr=>{var Ut=i9(),Ur=E(Ut);{var lr=Pr=>{Nf(Pr,{key:"shop-profile-picture",children:(Mn,bn)=>{var ln=Q7();ln.__click=[J7,Ne,N,Y];var Sn=E(ln);X0(Sn,{class:"size-5"}),k(ln),Ye(kn=>xr(ln,"title",kn),[()=>qv()]),G(Mn,ln)},$$slots:{default:!0}})};je(Ur,Pr=>{kt.data&&Pr(lr)})}var Tn=q(Ur,2);{var nn=Pr=>{var Mn=t9();Mn.__click=[e9,St];var bn=E(Mn);yp(bn,{class:"size-5"}),k(Mn),Ye(ln=>xr(Mn,"title",ln),[()=>mp()]),G(Pr,Mn)};je(Tn,Pr=>{kt.data&&Pr(nn)})}var Cn=q(Tn,2);ND(Cn,{get map(){return x(N)},get season(){return s}});var $n=q(Cn,2);Nf($n,{key:"region-leaderboard",children:(Pr,Mn)=>{var bn=n9();bn.__click=[r9,pt];var ln=E(bn);P0(ln,{class:"size-5"}),k(bn),Ye(Sn=>xr(bn,"title",Sn),[()=>Rm()]),G(Pr,bn)},$$slots:{default:!0}}),k(Ut),ki(3,Ut,()=>ia,()=>({duration:150})),G(sr,Ut)},be=sr=>{var Ut=er(),Ur=Ct(Ut);{var lr=Tn=>{var nn=o9(),Cn=E(nn);let $n;Cn.__click=[a9,K];var Pr=E(Cn);{var Mn=ln=>{Cm(ln,{class:"size-5"})},bn=ln=>{rp(ln,{class:"size-5"})};je(Pr,ln=>{x(K)?ln(Mn):ln(bn,!1)})}k(Cn),k(nn),Ye((ln,Sn)=>{xr(Cn,"title",ln),$n=zr(Cn,1,"btn btn-square not-touchscreen:hidden shadow-md",null,$n,Sn)},[()=>x(K)?ob():cb(),()=>({"btn-primary":x(K)})]),ki(1,nn,()=>ia,()=>({delay:150,duration:150})),G(Tn,nn)};je(Ur,Tn=>{x(N)&&x(me).name==="paintingPixel"&&Tn(lr)},!0)}G(sr,Ut)};je(Se,sr=>{x(N)&&x(me).name!=="paintingPixel"?sr(Ie):sr(be,!1)})}k(Z),k(j);var Oe=q(j,2);{var st=sr=>{var Ut=s9(),Ur=E(Ut);{let lr=ft(()=>fx.trim());Nx(Ur,{get siteKey(){return x(lr)},refreshExpired:"auto",appearance:"interaction-only",callback:Tn=>{ai.captcha={token:Tn,time:Date.now()}}})}k(Ut),ki(2,Ut,()=>ia,()=>({duration:300})),G(sr,Ut)};je(Oe,sr=>{px&&(!ai.captcha||ai.now-ai.captcha.time>180*1e3)&&sr(st)})}var $e=q(Oe,2);let On;var Mt=E($e);{var xe=sr=>{Nf(sr,{key:"info",children:(Ut,Ur)=>{var lr=c9();lr.__click=[l9,ut];var Tn=E(lr);M7(Tn,{class:"size-3.5"}),k(lr),Ye(nn=>xr(lr,"title",nn),[()=>db()]),G(Ut,lr)},$$slots:{default:!0}})};je(Mt,sr=>{x(me).name!=="paintingPixel"&&sr(xe)})}var Ft=q(Mt,2),cr=E(Ft);cr.__click=[u9,N];var Jt=q(cr,2);Jt.__click=[h9,N],k(Ft);var Tr=q(Ft,2),Xr=E(Tr),dn=E(Xr);Vv(dn,{class:"size-4"}),k(Xr),k(Tr);var xn=q(Tr,2);{var mn=sr=>{var Ut=p9();Ut.__click=[d9,me];var Ur=E(Ut);Gu(Ur,{class:"size-4"}),k(Ut),G(sr,Ut)};je(xn,sr=>{var Ut,Ur;x(me).name!=="paintingPixel"&&(((Ut=kt.data)==null?void 0:Ut.role)==="admin"||((Ur=kt.data)==null?void 0:Ur.role)==="global_moderator")&&sr(mn)})}var jt=q(xn,2);{var Et=sr=>{var Ut=f9(),Ur=E(Ut);O7(Ur,{class:"size-4",onclick:()=>{ce(H,!x(H))}}),k(Ut),Ye(lr=>xr(Ut,"title",lr),[()=>iw()]),G(sr,Ut)};je(jt,sr=>{x(ie)&&sr(Et)})}var hr=q(jt,2);{var ht=sr=>{var Ut=_9();Ut.__click=[m9];var Ur=E(Ut);qx(Ur,{class:"size-3"}),k(Ut),Ye(lr=>xr(Ut,"title",lr),[()=>Ux()]),G(sr,Ut)};je(hr,sr=>{x(me).name!=="paintingPixel"&&sr(ht)})}var Hr=q(hr,2);{var Yr=sr=>{var Ut=v9();Ut.__click=[g9,N];var Ur=E(Ut);B7(Ur,{class:"size-3"}),k(Ut),Ye((lr,Tn)=>{xr(Ut,"title",lr),Ut.disabled=Tn},[()=>bb(),()=>!hl.hasPrev()]),ki(1,Ut,()=>ia,()=>({delay:1e3,duration:300})),ki(2,Ut,()=>ia,()=>({duration:300})),G(sr,Ut)};je(Hr,sr=>{hl.hasPrev()&&x(me).name!=="paintingPixel"&&sr(Yr)})}k($e);var qr=q($e,2);let Xn;var _t=E(qr);{var Ge=sr=>{var Ut=y9(),Ur=E(Ut);Zx(Ur,{class:"size-5"});var lr=q(Ur);k(Ut),Ye(Tn=>fe(lr,` ${Tn??""}`),[()=>Cb()]),ki(1,Ut,()=>ia,()=>({duration:1e3})),ki(2,Ut,()=>ia),G(sr,Ut)};je(_t,sr=>{en.online||sr(Ge)})}var At=q(_t,2);{var Rt=sr=>{var Ut=b9();Ut.__click=[x9,N,f];var Ur=E(Ut);D7(Ur,{class:"size-5"});var lr=q(Ur);k(Ut),Ye(Tn=>fe(lr,` ${Tn??""}`),[()=>Ib()]),ki(3,Ut,()=>ia,()=>({duration:300})),G(sr,Ut)};je(At,sr=>{x(Y)<z&&sr(Rt)})}k(qr);var Yt=q(qr,2);let Vn;var br=E(Yt);xt(br),k(Yt);var Er=q(Yt,2);let wn;var ur=E(Er);{var rn=sr=>{M0(sr,{class:"z-30",onclick:()=>{var Ut;(Ut=kt.data)!=null&&Ut.needsPhoneVerification?(ce(zt,!0),Nr.warning(Xg())):kt.charges!==void 0&&kt.charges<1?Nr.warning(JA,{icon:Wf}):x(N)&&kt.data?(aa.smallDropplet.play(),ce(me,{name:"paintingPixel"},!0)):(ce(Ae,!0),x(N)&&Co(x(N).getCenter(),x(Y)))},get disabled(){return kt.loading},get loading(){return kt.loading},get charges(){return kt.charges}})},pn=sr=>{var Ut=w9();G(sr,Ut)};je(ur,sr=>{x(me).name==="mainMenu"?sr(rn):sr(pn,!1)})}k(Er);var _n=q(Er,2);let Ji;var sn=E(_n);Wt(sn),k(_n);var En=q(_n,2);{var dr=sr=>{var Ut=er(),Ur=Ct(Ut);{var lr=nn=>{var Cn=T9(),$n=E(Cn),Pr=E($n);ER(Pr,{get latLon(){return x(me).latLon},get map(){return x(N)},get crosshair(){return x(ge)},get pixelInfoCache(){return B},get season(){return s},get tileSize(){return y},get pixelArtZoom(){return f},get zoom(){return x(Y)},get opaquePixelArt(){return x(tt)},onclose:()=>ce(me,{name:"mainMenu"},!0),onclickshare:Mn=>{ce(yt,Mn,!0),ce(vt,!0)},onclickpaint:([Mn,bn])=>{var Sn,kn,gn;if(!kt.data){ce(Ae,!0);return}if((Sn=kt.data)!=null&&Sn.needsPhoneVerification){ce(zt,!0),Nr.warning(Xg());return}if(kt.charges!==void 0&&kt.charges<1){Nr.warning(Rb());return}const ln=Vm(M.latLonToPixelBoundsLatLon(Mn,bn,f));(kn=x(N))==null||kn.flyTo({center:{lat:ln[0],lon:ln[1]}}),ce(me,{name:"paintingPixel",clickedLatLon:[Mn,bn]},!0),(gn=x(ge))==null||gn.clear()},onclickregion:Mn=>{ce(It,Mn,!0),ce(Bt,!0)},onclickmodaction:(Mn,bn,ln,Sn)=>{var gn,fn,an;(gn=x(N))==null||gn.setZoom(Math.max(x(Y),f+3.5));const kn=M.latLonToPixelBoundsLatLon(ln[0],ln[1],f);(fn=x(N))==null||fn.setCenter({lat:kn.min[0],lng:(kn.max[1]+kn.min[1])/2}),ce(Kt,bn,!0),ce(or,Mn,!0),ce(Sr,ln,!0),ce(Dr,((an=x(N))==null?void 0:an.getZoom())??0,!0),ce(rr,Sn,!0),ce(Ar,!0)}}),k($n),k(Cn),ki(3,$n,()=>Gd,()=>({duration:100})),G(nn,Cn)},Tn=nn=>{var Cn=er(),$n=Ct(Cn);{var Pr=bn=>{var ln=C9(),Sn=E(ln),kn=E(Sn);pL(kn,{get map(){return x(N)},get clickedLatLon(){return x(me).clickedLatLon},get tileSize(){return y},get tileZoom(){return f},get season(){return s},get zoom(){return x(Y)},get crosshair(){return x(oe)},refreshPixelArt:()=>x(N)&&Fe(x(N)),hidePixelHover:De,hoverLayerId:Ke,onclose:()=>{ce(me,{name:"mainMenu"},!0),De()},get screenLocked(){return x(K)},set screenLocked(gn){ce(K,gn,!0)},get opaquePixelArt(){return x(tt)},set opaquePixelArt(gn){ce(tt,gn,!0)}}),k(Sn),k(ln),ki(3,Sn,()=>Gd,()=>({duration:100})),G(bn,ln)},Mn=bn=>{var ln=er(),Sn=Ct(ln);{var kn=fn=>{var an=S9(),po=E(an);qR(po,{get map(){return x(N)},get tileSize(){return y},get pixelArtZoom(){return zf},get season(){return s},get crosshair(){return x(oe)},onclose:()=>{ce(me,{name:"mainMenu"},!0),De()}}),k(an),G(fn,an)},gn=fn=>{var an=er(),po=Ct(an);{var pi=Gn=>{var jn=I9(),zn=E(jn),qa=E(zn),Lr=E(qa),$r=E(Lr),_a=E($r);G0(_a,{class:"inline size-4"});var cn=q(_a);k($r);var Li=q($r,2);Li.__click=[P9,me];var ga=E(Li);_l(ga,{class:"size-4"}),k(Li),k(Lr);var sa=q(Lr,2),Ka=E(sa);Ka.__click=async()=>{var Ca;if(x(me).name==="selectHq"){const Ja=x(me).hq;if(Ja)try{ce(fr,!0),await en.updateAllianceHeadquarters(Ja[0],Ja[1]),(Ca=x(ge))==null||Ca.clear(),ce(St,!0),ce(me,{name:"mainMenu"},!0)}catch(Jo){Nr.error(Jo.message)}finally{ce(fr,!1)}}};var Is=E(Ka);P7(Is,{class:"size-6"}),k(Ka),k(sa),k(qa),k(zn),k(jn),Ye(Ca=>{fe(cn,` ${Ca??""}`),Ka.disabled=x(me).hq===void 0||x(fr)},[()=>jC()]),ki(3,zn,()=>Gd,()=>({duration:100})),G(Gn,jn)};je(po,Gn=>{x(me).name==="selectHq"&&Gn(pi)},!0)}G(fn,an)};je(Sn,fn=>{x(me).name==="getPixelAreaInfo"?fn(kn):fn(gn,!1)},!0)}G(bn,ln)};je($n,bn=>{x(me).name==="paintingPixel"&&x(oe)?bn(Pr):bn(Mn,!1)},!0)}G(nn,Cn)};je(Ur,nn=>{x(me).name==="pixelSelected"&&x(ge)?nn(lr):nn(Tn,!1)})}G(sr,Ut)};je(En,sr=>{x(N)&&sr(dr)})}k(se),Ye((sr,Ut,Ur,lr,Tn,nn,Cn,$n,Pr)=>{Rr=zr(j,1,"absolute right-2 top-2 z-30",null,Rr,sr),yn=zr(Z,1,"flex flex-col gap-4",null,yn,Ut),On=zr($e,1,"absolute left-2 top-2 z-30 flex flex-col gap-3",null,On,Ur),xr(cr,"title",lr),xr(Jt,"title",Tn),Xn=zr(qr,1,"absolute left-1/2 top-2 z-30 flex -translate-x-1/2 flex-col items-center justify-center gap-2",null,Xn,nn),Vn=zr(Yt,1,"absolute bottom-3 left-3 z-30",null,Vn,Cn),wn=zr(Er,1,"absolute bottom-3 left-1/2 z-30 -translate-x-1/2",null,wn,$n),Ji=zr(_n,1,"absolute bottom-3 right-3 z-30",null,Ji,Pr)},[()=>({hidden:x(H)}),()=>({"items-end":!kt.data,"items-center":kt.data}),()=>({hidden:x(H)}),()=>mb(),()=>vb(),()=>({hidden:x(H)}),()=>({hidden:x(H)}),()=>({hidden:x(H)}),()=>({hidden:x(H)})])}var In=q(se,2);HA(In,{get open(){return x(Ae)},set open(xt){ce(Ae,xt,!0)}});var tn=q(In,2);C7(tn,{get open(){return x(Ne)},set open(xt){ce(Ne,xt,!0)}});var Qr=q(tn,2);RM(Qr,{get open(){return x(ot)},set open(xt){ce(ot,xt,!0)}});var ma=q(Qr,2);QM(ma,{get open(){return x(ut)},set open(xt){ce(ut,xt,!0)}});var di=q(ma,2);zM(di,{get open(){return x(wt)},set open(xt){ce(wt,xt,!0)}});var Xi=q(di,2);UA(Xi,{onvisitclick:xt=>{var Wt;(Wt=x(N))==null||Wt.flyTo({center:xt,zoom:zf+1}),Co(xt,x(Y)),hl.push({pos:xt,zoom:x(Y)}),ce(pt,!1)},get open(){return x(pt)},set open(xt){ce(pt,xt,!0)}});var Zn=q(Xi,2);QD(Zn,{get region(){return x(It)},get open(){return x(Bt)},set open(xt){ce(Bt,xt,!0)}});var ni=q(Zn,2);Bx(ni,{get open(){return ai.dropletsDialogOpen},set open(xt){ai.dropletsDialogOpen=xt}});var qi=q(ni,2);{var Yi=xt=>{pM(xt,{onhqchange:()=>{ce(me,{name:"selectHq"},!0),ce(St,!1)},onhqclick:Wt=>{var Rr;(Rr=x(N))==null||Rr.flyTo({center:Wt,zoom:Math.max(x(Y),15)}),ce(me,{name:"pixelSelected",latLon:[Wt.lat,Wt.lng]},!0),ce(St,!1)},onlastpixelclick:Wt=>{var Rr;(Rr=x(N))==null||Rr.flyTo({center:Wt,zoom:Math.max(x(Y),15)}),ce(me,{name:"pixelSelected",latLon:[Wt.lat,Wt.lng]},!0),ce(St,!1)},get open(){return x(St)},set open(Wt){ce(St,Wt,!0)}})};je(qi,xt=>{x(N)&&xt(Yi)})}var Ei=q(qi,2);LL(Ei,{get open(){return x(zt)},set open(xt){ce(zt,xt,!0)}});var zi=q(Ei,2);{var Ki=xt=>{SM(xt,{get url(){return x(yt)},get map(){return x(N)},hideHover:()=>{var Wt,Rr;(Wt=x(N))==null||Wt.setPaintProperty(Ke,"raster-opacity",0),(Rr=x(ge))==null||Rr.setCanvasOpacity(0)},showHover:()=>{var Wt,Rr;(Wt=x(N))==null||Wt.setPaintProperty(Ke,"raster-opacity",He),(Rr=x(ge))==null||Rr.setCanvasOpacity(1)},get open(){return x(vt)},set open(Wt){ce(vt,Wt,!0)}})};je(zi,xt=>{x(N)&&xt(Ki)})}var oa=q(zi,2);{var Ta=xt=>{Cx(xt,{get image(){return x(Kt)},get paintedBy(){return x(or).paintedBy},get latLon(){return x(Sr)},get zoom(){return x(Dr)},get action(){return x(rr)},get open(){return x(Ar)},set open(Wt){ce(Ar,Wt,!0)}})};je(oa,xt=>{x(or)&&x(Kt)&&x(Sr)&&xt(Ta)})}G(m,Zr),Fr()}Qn(["click"]);export{_B as component};
